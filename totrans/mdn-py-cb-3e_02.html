<html><head></head><body>
<section data-number="0.5" id="chapter-2-statements-and-syntax">
<h2 class="likechapterhead" data-number="0.5"><span><span class="kobospan" id="kobo.1.1">2</span></span><br class="tipbox1"/> <span id="x1-840002"/><span class="kobospan" id="kobo.2.1">Statements and Syntax</span></h2>
<p class="normal"><span class="kobospan" id="kobo.3.1">Python syntax is designed</span><span id="dx1-84001"/><span class="kobospan" id="kobo.4.1"> to be simple. </span><span class="kobospan" id="kobo.4.2">In this chapter, we’ll look at some of the most commonly used statements in the language as a way to understand the rules. </span><span class="kobospan" id="kobo.4.3">Concrete examples can help clarify the language’s syntax.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.5.1">We’ll cover some of the basics of creating script files first. </span><span class="kobospan" id="kobo.5.2">Then we’ll move on to looking at some of the more commonly used statements. </span><span class="kobospan" id="kobo.5.3">Python only has about 20 or so different kinds of imperative statements</span><span id="dx1-84002"/><span class="kobospan" id="kobo.6.1"> in the language. </span><span class="kobospan" id="kobo.6.2">We’ve already looked at two kinds of statements in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.7.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.8.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.9.1">1</span></span></a><span class="kobospan" id="kobo.10.1">, the assignment statement and the expression statement.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.11.1">When we write something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.12.1">&gt;&gt;&gt; print("hello world") 
 
hello world</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.13.1">We’re actually executing a statement that contains only the evaluation of a function, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.14.1">print()</span></span></span></span><span class="kobospan" id="kobo.15.1">. </span><span class="kobospan" id="kobo.15.2">This kind of statement—where we evaluate a function or a method of an object—is common.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.16.1">The other kind of statement</span><span id="dx1-84006"/><span class="kobospan" id="kobo.17.1"> we’ve already seen is the assignment statement. </span><span class="kobospan" id="kobo.17.2">Python has many variations on this theme. </span><span class="kobospan" id="kobo.17.3">Most of the time, we’re assigning a single value to a single variable. </span><span class="kobospan" id="kobo.17.4">When a function returns a tuple as a result, we can unpack that collection and assign more than one variable at the same time in a single assignment statement. </span><span class="kobospan" id="kobo.17.5">It is done like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.18.1">&gt;&gt;&gt; quotient, remainder = divmod(355, 113)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.19.1">The recipes in this chapter will look at the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.20.1">if</span></span></span></span><span class="kobospan" id="kobo.21.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.22.1">while</span></span></span></span><span class="kobospan" id="kobo.23.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.24.1">for</span></span></span></span><span class="kobospan" id="kobo.25.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.26.1">with</span></span></span></span><span class="kobospan" id="kobo.27.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.28.1">try</span></span></span></span><span class="kobospan" id="kobo.29.1"> statements. </span><span class="kobospan" id="kobo.29.2">We’ll also touch on a few of the simpler statements as we go, like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.30.1">pass</span></span></span></span><span class="kobospan" id="kobo.31.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.32.1">break</span></span></span></span><span class="kobospan" id="kobo.33.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.34.1">raise</span></span></span></span><span class="kobospan" id="kobo.35.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.36.1">In later chapters, we’ll look at other statements. </span><span class="kobospan" id="kobo.36.2">Here’s a summary:</span></p>
<div class="center">
<div class="tabular">
<table class="tabular1" id="TBL-1">
<tbody class="calibre19">
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-1-1-">
<td class="td" id="TBL-1-1-1"><span class="kobospan2" id="kobo.37.1">
                Statement
              </span></td>
<td class="td" id="TBL-1-1-2"><span class="kobospan2" id="kobo.38.1">
                Chapter
              </span></td>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-1-2-">
<td class="td" id="TBL-1-2-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.39.1">def</span></span></span></span>
</td>
<td class="td" id="TBL-1-2-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.40.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.41.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.42.1">3</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-3-">
<td class="td" id="TBL-1-3-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.43.1">return</span></span></span></span>
</td>
<td class="td" id="TBL-1-3-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.44.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.45.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.46.1">3</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-4-">
<td class="td" id="TBL-1-4-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.47.1">import</span></span></span></span>
</td>
<td class="td" id="TBL-1-4-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.48.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.49.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.50.1">3</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-5-">
<td class="td" id="TBL-1-5-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.51.1">del</span></span></span></span>
</td>
<td class="td" id="TBL-1-5-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.52.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.53.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.54.1">4</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-6-">
<td class="td" id="TBL-1-6-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.55.1">class</span></span></span></span>
</td>
<td class="td" id="TBL-1-6-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.56.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.57.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.58.1">7</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-7-">
<td class="td" id="TBL-1-7-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.59.1">match</span></span></span></span>
</td>
<td class="td" id="TBL-1-7-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.60.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.61.1"> </span></span><a href="ch012.xhtml#x1-4520008" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.62.1">8</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-8-">
<td class="td" id="TBL-1-8-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.63.1">type</span></span></span></span>
</td>
<td class="td" id="TBL-1-8-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.64.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.65.1"> </span></span><a href="ch014.xhtml#x1-57300010" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.66.1">10</span></span></a>
</td>
</tr>
<tr class="even" id="TBL-1-9-">
<td class="td" id="TBL-1-9-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.67.1">assert</span></span></span></span>
</td>
<td class="td" id="TBL-1-9-2">
<span class="cmti-10x-x1"><span class="kobospan2" id="kobo.68.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan2" id="kobo.69.1"> </span></span><a href="ch014.xhtml#x1-57300010" class="calibre22"><span class="cmti-10x-x2"><span class="kobospan2" id="kobo.70.1">10</span></span></a>
</td>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-1-10-">
<td class="td" id="TBL-1-10-1"/>
<td class="calibre23"/>
</tr>
</tbody>
</table>
</div>
<span id="x1-84009r1"/> <span id="x1-84010"/> <span><span class="kobospan" id="kobo.71.1">Table 2.1: </span></span><span><span class="kobospan" id="kobo.72.1">Python Statements and Chapters </span></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.73.1">In this chapter, we’ll look at the following recipes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><a href="ch006_split_000.xhtml#x1-850001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.74.1">Writing Python script and module files – syntax basics</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_000.xhtml#x1-910002" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.75.1">Writing long lines of code</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.76.1">Including descriptions and documentation</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.77.1">Writing better docstrings with RST markup</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_000.xhtml#x1-1170005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.78.1">Designing complex if...elif chains</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-1230006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.79.1">Saving intermediate results with the := ”walrus” operator</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-1290007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.80.1">Avoiding a potential problem with break statements</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-1350008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.81.1">Leveraging exception matching rules</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-1410009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.82.1">Avoiding a potential problem with an except: clause</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-14600010" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.83.1">Concealing an exception root cause</span></span></a></p></li>
<li class="calibre7"><p class="normal2"><a href="ch006_split_001.xhtml#x1-15200011" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.84.1">Managing a context using the with statement</span></span></a></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.85.1">We’ll start by looking at the big picture – scripts and modules – and then we’ll move down into details of individual statements. </span><span id="x1-84011r155"/></p>
<section data-number="0.5.1" id="writing-python-script-and-module-files-syntax-basics">
<h1 class="unnumbered" data-number="0.5.1"><span><span class="kobospan" id="kobo.86.1">2.1 </span></span> <span id="x1-850001"/><span class="kobospan" id="kobo.87.1">Writing Python script and module files – syntax basics</span></h1>
<p class="normal"><span class="kobospan" id="kobo.88.1">The point of Python (and programming in general) is to create</span><span id="dx1-85001"/><span class="kobospan" id="kobo.89.1"> automated solutions</span><span id="dx1-85002"/><span class="kobospan" id="kobo.90.1"> to problems that involve data and processing. </span><span class="kobospan" id="kobo.90.2">Further, the software we write is a kind of knowledge representation; this means clarity is perhaps the most important quality aspect of software.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.91.1">In Python, we implement automated solutions by creating script files. </span><span class="kobospan" id="kobo.91.2">These are the top-level, main programs of Python programming. </span><span class="kobospan" id="kobo.91.3">In addition to main scripts, we may also create modules (and packages of modules) to help organize the software into intellectually manageable chunks. </span><span class="kobospan" id="kobo.91.4">A script is a module; however, it has a distinct intent to do useful processing when started by the OS.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.92.1">A key part of creating clear, readable Python files is making sure our code follows the widely adopted conventions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.93.1">For example, we need to be sure to save our files in UTF-8 encoding. </span><span class="kobospan" id="kobo.93.2">While ASCII encoding is still supported by Python, it’s a poor choice for modern programming. </span><span class="kobospan" id="kobo.93.3">We’ll also need to be sure our editor uses spaces instead of the tab character. </span><span class="kobospan" id="kobo.93.4">This is often a configuration setting in programming editors. </span><span class="kobospan" id="kobo.93.5">Using Unix newlines is also helpful for portability. </span><span id="x1-85003r153"/></p>
<section data-number="0.5.1.1" id="getting-ready-10">
<h2 class="likechapterhead" data-number="0.5.1.1"><span><span class="kobospan" id="kobo.94.1">2.1.1 </span></span> <span id="x1-860001"/><span class="kobospan" id="kobo.95.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.96.1">To edit Python</span><span id="dx1-86001"/><span class="kobospan" id="kobo.97.1"> scripts, we’ll need a good</span><span id="dx1-86002"/><span class="kobospan" id="kobo.98.1"> programming editor. </span><span class="kobospan" id="kobo.98.2">It’s nearly impossible to suggest just one. </span><span class="kobospan" id="kobo.98.3">So we’ll suggest a few.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.99.1">The JetBrains PyCharm editor has numerous features. </span><span class="kobospan" id="kobo.99.2">The community edition</span><span id="dx1-86003"/><span class="kobospan" id="kobo.100.1"> version is free. </span><span class="kobospan" id="kobo.100.2">See </span><a class="url" href="https://www.jetbrains.com/pycharm/download/"><span class="url1"><span class="kobospan" id="kobo.101.1">https://www.jetbrains.com/pycharm/download/</span></span></a><span class="kobospan" id="kobo.102.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.103.1">ActiveState has Komodo IDE, which is also very sophisticated. </span><span class="kobospan" id="kobo.103.2">The Komodo Edit version is free and does some of the same</span><span id="dx1-86004"/><span class="kobospan" id="kobo.104.1"> things as the full Komodo IDE. </span><span class="kobospan" id="kobo.104.2">See </span><a class="url" href="http://komodoide.com/komodo-edit/"><span class="url1"><span class="kobospan" id="kobo.105.1">http://komodoide.com/komodo-edit/</span></span></a><span class="kobospan" id="kobo.106.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.107.1">Notepad++ is good for Windows</span><span id="dx1-86005"/><span class="kobospan" id="kobo.108.1"> developers. </span><span class="kobospan" id="kobo.108.2">See </span><a class="url" href="https://notepad-plus-plus.org"><span class="url1"><span class="kobospan" id="kobo.109.1">https://notepad-plus-plus.org</span></span></a><span class="kobospan" id="kobo.110.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.111.1">BBEdit is very nice</span><span id="dx1-86006"/><span class="kobospan" id="kobo.112.1"> for macOS X developers. </span><span class="kobospan" id="kobo.112.2">See </span><a class="url" href="http://www.barebones.com/products/bbedit/"><span class="url1"><span class="kobospan" id="kobo.113.1">http://www.barebones.com/products/bbedit/</span></span></a><span class="kobospan" id="kobo.114.1">. </span><span class="kobospan" id="kobo.114.2">Sublime is also popular</span><span id="dx1-86007"/><span class="kobospan" id="kobo.115.1"> on macOS X. </span><span class="kobospan" id="kobo.115.2">See </span><a class="url" href="https://www.sublimetext.com"><span class="url1"><span class="kobospan" id="kobo.116.1">https://www.sublimetext.com</span></span></a><span class="kobospan" id="kobo.117.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.118.1">For Linux developers, there are</span><span id="dx1-86008"/><span class="kobospan" id="kobo.119.1"> several</span><span id="dx1-86009"/><span class="kobospan" id="kobo.120.1"> built-in editors, including </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.121.1">Vim </span></span><span class="kobospan" id="kobo.122.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.123.1">gedit</span></span><span class="kobospan" id="kobo.124.1">. </span><span class="kobospan" id="kobo.124.2">Since Linux tends to be biased toward developers, the editors available are all suitable for writing Python.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.125.1">It is helpful is to have two windows open while working:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.126.1">An editor to create the final script or module file.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.127.1">A terminal session with Python’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.128.1">&gt;&gt;&gt;</span></span></span></span><span class="kobospan" id="kobo.129.1"> prompt, where we can try things out to see what works and what doesn’t.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.130.1">Most editors recognize the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.131.1">.py</span></span></span></span><span class="kobospan" id="kobo.132.1"> extension and provide appropriate formatting based on </span><a href="https://peps.python.org/pep-0008/" class="url"><span class="kobospan" id="kobo.133.1">PEP-8</span></a><span class="kobospan" id="kobo.134.1">. </span><span class="kobospan" id="kobo.134.2">This generally includes the following:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.135.1">The file encoding should be UTF-8.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.136.1">Indentation should be four spaces.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.137.1">We want the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.138.1">Tab </span></span><span class="kobospan" id="kobo.139.1">key on the keyboard to insert spaces instead of the tab character, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.140.1">\t</span></span></span></span><span class="kobospan" id="kobo.141.1">.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.142.1">Once the editor is configured, we can write a script file that other people can easily use or extend. </span><span id="x1-86010r162"/></p>
</section>
<section data-number="0.5.1.2" id="how-to-do-it...-10">
<h2 class="likechapterhead" data-number="0.5.1.2"><span><span class="kobospan" id="kobo.143.1">2.1.2 </span></span> <span id="x1-870002"/><span class="kobospan" id="kobo.144.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.145.1">Here’s how we create a script file:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-87002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.146.1">The first line of most Python</span><span id="dx1-87003"/><span class="kobospan" id="kobo.147.1"> script files looks</span><span id="dx1-87004"/><span class="kobospan" id="kobo.148.1"> like this:</span></p>
<pre class="programlisting" id="listing-18"><code class="calibre13"><span class="kobospan" id="kobo.149.1">#!/usr/bin/env python3</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.150.1">This sets an association between the file you’re writing and Python. </span><span class="kobospan" id="kobo.150.2">If the file’s mode is set to executable with the bash </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.151.1">chmod</span></span></span></span><span class="kobospan" id="kobo.152.1"> command, and the directory is on the OS </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.153.1">PATH</span></span></span></span><span class="kobospan" id="kobo.154.1"> list, the script will be a first-class application, as usable as any of the built-in commands.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.155.1">For Windows, the filename-to-program association is done through a setting in the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.156.1">Default Programs </span></span><span class="kobospan" id="kobo.157.1">control panel. </span><span class="kobospan" id="kobo.157.2">Find the panel for </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.158.1">Set</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.159.1">Associations</span></span><span class="kobospan" id="kobo.160.1">, and make sure </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.161.1">.py</span></span></span></span><span class="kobospan" id="kobo.162.1"> files are bound to the Python program. </span><span class="kobospan" id="kobo.162.2">This is often set by the installer, and we rarely need to change it or set it manually.</span></p>
</div></li>
<li class="calibre7"><div id="x1-87007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.163.1">After the preamble, convention suggests we include a triple-quoted block of text. </span><span class="kobospan" id="kobo.163.2">This is the documentation</span><span id="dx1-87008"/><span class="kobospan" id="kobo.164.1"> string (called a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.165.1">docstring</span></span><span class="kobospan" id="kobo.166.1">) for the file we’re going to create:</span></p>
<pre class="programlisting" id="listing-19"><code class="calibre13"><span class="kobospan" id="kobo.167.1">""" 
 
A summary of this script. 
 
"""</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.168.1">Because Python triple-quoted strings can be indefinitely long, feel free to write as much as necessary. </span><span class="kobospan" id="kobo.168.2">This should be the primary vehicle for describing the script or library module. </span><span class="kobospan" id="kobo.168.3">This can even include examples of how it works.</span></p>
</div></li>
<li class="calibre7"><div id="x1-87013x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.169.1">Now comes the interesting part of the script: the part that really does something. </span><span class="kobospan" id="kobo.169.2">We can write all the statements we need to get the job done. </span><span class="kobospan" id="kobo.169.3">For now, we’ll use this as a placeholder:</span></p>
<pre class="programlisting" id="listing-20"><code class="calibre13"><span class="kobospan" id="kobo.170.1">print(’hello world’)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.171.1">This isn’t much, but at least the script does something. </span><span class="kobospan" id="kobo.171.2">It’s common to create function and class definitions, as well as to write statements to use the functions and classes to do things.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.172.1">For our first, simple script, all of the statements must begin at the left margin and must be complete on a single line. </span><span class="kobospan" id="kobo.172.2">There are many Python statements that have blocks of statements nested inside them. </span><span class="kobospan" id="kobo.172.3">These internal blocks of statements will be indented to clarify their scope. </span><span class="kobospan" id="kobo.172.4">Generally—because we set indentation</span><span id="dx1-87015"/><span class="kobospan" id="kobo.173.1"> to four spaces—we can hit</span><span id="dx1-87016"/><span class="kobospan" id="kobo.174.1"> the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.175.1">Tab </span></span><span class="kobospan" id="kobo.176.1">key to properly indent the code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.177.1">Our file should look like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.178.1">#!/usr/bin/env python3 
 
""" 
 
My First Script: Calculate an important value. 
 
""" 
 
 
 
print(355 / 113)</span></code></pre>
<p class="normal1"><span id="x1-87024r163"/></p>
</section>
<section data-number="0.5.1.3" id="how-it-works...-10">
<h2 class="likechapterhead" data-number="0.5.1.3"><span><span class="kobospan" id="kobo.179.1">2.1.3 </span></span> <span id="x1-880003"/><span class="kobospan" id="kobo.180.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.181.1">Unlike other languages, there’s very little </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.182.1">boilerplate </span></span><span class="kobospan" id="kobo.183.1">in Python. </span><span class="kobospan" id="kobo.183.2">There’s only one line of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.184.1">overhead </span></span><span class="kobospan" id="kobo.185.1">and even the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.186.1">#!/usr/bin/env</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.187.1"> python3</span></span></span></span><span class="kobospan" id="kobo.188.1"> line is generally optional.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.189.1">Why do we set the encoding to UTF-8? </span><span class="kobospan" id="kobo.189.2">While the language was originally designed to work using just the original 128 ASCII characters, we often find that ASCII is limiting. </span><span class="kobospan" id="kobo.189.3">This is legal Python if we save our file in UTF-8:</span></p>
<pre class="programlisting" id="listing-21"><code class="calibre13"><span class="kobospan" id="kobo.190.1"> = 355/113 
 
print()</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.191.1">It’s important to be consistent when choosing between spaces and tabs in Python. </span><span class="kobospan" id="kobo.191.2">They are both more or less invisible, and mixing them up can easily lead to errors when trying to run the script. </span><span class="kobospan" id="kobo.191.3">Spaces are suggested.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.192.1">The initial </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.193.1">#!</span></span></span></span><span class="kobospan" id="kobo.194.1"> line is a comment. </span><span class="kobospan" id="kobo.194.2">Because the two characters</span><span id="dx1-88003"/><span class="kobospan" id="kobo.195.1"> are sometimes</span><span id="dx1-88004"/><span class="kobospan" id="kobo.196.1"> called sharp and bang, the combination</span><span id="dx1-88005"/><span class="kobospan" id="kobo.197.1"> is called ”shebang.” </span><span class="kobospan" id="kobo.197.2">Everything between a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.198.1">#</span></span></span></span><span class="kobospan" id="kobo.199.1"> and the end of the line is ignored. </span><span class="kobospan" id="kobo.199.2">The Linux loader (a program named </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.200.1">execve</span></span><span class="kobospan" id="kobo.201.1">) looks at the first few bytes</span><span id="dx1-88006"/><span class="kobospan" id="kobo.202.1"> of a file to see what the file contains. </span><span class="kobospan" id="kobo.202.2">These first few bytes are sometimes</span><span id="dx1-88007"/><span class="kobospan" id="kobo.203.1"> called </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.204.1">magic bytes </span></span><span class="kobospan" id="kobo.205.1">because the loader’s behavior seems magical. </span><span class="kobospan" id="kobo.205.2">When present, this two-character sequence of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.206.1">#!</span></span></span></span><span class="kobospan" id="kobo.207.1"> is followed by the path to the program responsible for processing the rest of the data in the file. </span><span class="kobospan" id="kobo.207.2">We prefer to use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.208.1">/usr/bin/env</span></span></span></span><span class="kobospan" id="kobo.209.1"> to start the Python program for us. </span><span class="kobospan" id="kobo.209.2">We can leverage the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.210.1">env</span></span></span></span><span class="kobospan" id="kobo.211.1"> program</span><span id="dx1-88008"/><span class="kobospan" id="kobo.212.1"> to make Python-specific environment</span><span id="dx1-88009"/><span class="kobospan" id="kobo.213.1"> settings. </span><span id="x1-88010r165"/></p>
</section>
<section data-number="0.5.1.4" id="theres-more...-5">
<h2 class="likechapterhead" data-number="0.5.1.4"><span><span class="kobospan" id="kobo.214.1">2.1.4 </span></span> <span id="x1-890004"/><span class="kobospan" id="kobo.215.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.216.1">The </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.217.1">Python Standard Library </span></span><span class="kobospan" id="kobo.218.1">documents are derived, in part, from the documentation strings present in the module files. </span><span class="kobospan" id="kobo.218.2">It’s common practice to write sophisticated docstrings in modules, packages, and scripts. </span><span class="kobospan" id="kobo.218.3">There are</span><span id="dx1-89001"/><span class="kobospan" id="kobo.219.1"> tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.220.1">pydoc </span></span><span class="kobospan" id="kobo.221.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.222.1">Sphinx </span></span><span class="kobospan" id="kobo.223.1">that can reformat</span><span id="dx1-89002"/><span class="kobospan" id="kobo.224.1"> the module docstrings into elegant documentation. </span><span class="kobospan" id="kobo.224.2">We’ll look at this in the </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.225.1">Writing better docstrings with RST</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.226.1">markup</span></span></a><span class="kobospan" id="kobo.227.1"> recipe, as well as the </span><a href="ch021.xhtml#x1-9270003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.228.1">Using Sphinx autodoc to create the API reference</span></span></a><span class="kobospan" id="kobo.229.1"> recipe in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.230.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.231.1"> </span></span><a href="ch021.xhtml#x1-91400017" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.232.1">17</span></span></a><span class="kobospan" id="kobo.233.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.234.1">Additionally, unit test cases can be included in the docstrings. </span><span class="kobospan" id="kobo.234.2">Tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.235.1">doctest</span></span><span class="kobospan" id="kobo.236.1"> can extract examples</span><span id="dx1-89003"/><span class="kobospan" id="kobo.237.1"> from the document strings and execute the code to see if the answers in the documentation match the answers found by running the code. </span><span class="kobospan" id="kobo.237.2">This is the subject of many recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.238.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.239.1"> </span></span><a href="ch019_split_000.xhtml#x1-79400015" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.240.1">15</span></span></a><span class="kobospan" id="kobo.241.1">. </span><span class="kobospan" id="kobo.241.2">Many examples in this book are validated by </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.242.1">doctest</span></span><span class="kobospan" id="kobo.243.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.244.1">Triple-quoted documentation strings are preferred over </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.245.1">#</span></span></span></span><span class="kobospan" id="kobo.246.1"> comments. </span><span class="kobospan" id="kobo.246.2">While all text between </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.247.1">#</span></span></span></span><span class="kobospan" id="kobo.248.1"> and the end of the line is ignored, this is limited to a single line; the conventional approach is to use it sparingly. </span><span class="kobospan" id="kobo.248.2">A docstring can be of indefinite size; they are used widely.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.249.1">There’s another bit of overhead that’s sometimes included. </span><span class="kobospan" id="kobo.249.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.250.1">Vim </span></span><span class="kobospan" id="kobo.251.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.252.1">gedit</span></span><span class="kobospan" id="kobo.253.1"> editors let</span><span id="dx1-89004"/><span class="kobospan" id="kobo.254.1"> us keep edit</span><span id="dx1-89005"/><span class="kobospan" id="kobo.255.1"> preferences in the file. </span><span class="kobospan" id="kobo.255.2">This is</span><span id="dx1-89006"/><span class="kobospan" id="kobo.256.1"> called a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.257.1">modeline</span></span><span class="kobospan" id="kobo.258.1">. </span><span class="kobospan" id="kobo.258.2">Here’s a typical modeline that’s useful for Python:</span></p>
<pre class="programlisting" id="listing-22"><code class="calibre13"><span class="kobospan" id="kobo.259.1"># vim: tabstop=8 expandtab shiftwidth=4 softtabstop=4</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.260.1">This makes sure any tab characters will be transformed into eight spaces; when we hit the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.261.1">Tab </span></span><span class="kobospan" id="kobo.262.1">key, we’ll shift four spaces. </span><span class="kobospan" id="kobo.262.2">This is widely used because tab characters are traditionally indented eight spaces, and this replacement is likely to create proper indentation. </span><span class="kobospan" id="kobo.262.3">This setting is embedded in the code; we don’t have to do any </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.263.1">Vim </span></span><span class="kobospan" id="kobo.264.1">setup to apply these</span><span id="dx1-89008"/><span class="kobospan" id="kobo.265.1"> settings to our Python script files. </span><span id="x1-89009r166"/></p>
</section>
<section data-number="0.5.1.5" id="see-also-10">
<h2 class="likechapterhead" data-number="0.5.1.5"><span><span class="kobospan" id="kobo.266.1">2.1.5 </span></span> <span id="x1-900005"/><span class="kobospan" id="kobo.267.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.268.1">We’ll look at how to write useful document strings in the </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.269.1">Including</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.270.1">descriptions and documentation</span></span></a><span class="kobospan" id="kobo.271.1"> and </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.272.1">Writing better docstrings with</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.273.1">RST markup</span></span></a><span class="kobospan" id="kobo.274.1"> recipes.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.275.1">For more information on suggested style, see </span><a href="https://www.python.org/dev/peps/pep-0008/" class="url"><span class="kobospan" id="kobo.276.1">PEP-8</span></a><span class="kobospan" id="kobo.277.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-90001r161"/></p>
</section>
</section>
<section data-number="0.5.2" id="writing-long-lines-of-code">
<h1 class="unnumbered" data-number="0.5.2"><span><span class="kobospan" id="kobo.278.1">2.2 </span></span> <span id="x1-910002"/><span class="kobospan" id="kobo.279.1">Writing long lines of code</span></h1>
<p class="normal"><span class="kobospan" id="kobo.280.1">There are many times when we need to write lines</span><span id="dx1-91001"/><span class="kobospan" id="kobo.281.1"> of code that are so long that they’re very hard to read. </span><span class="kobospan" id="kobo.281.2">Many people like to limit the length of a line of code to 80 characters or fewer. </span><span class="kobospan" id="kobo.281.3">It’s a well-known principle of graphic design that a narrower area of text is easier to read. </span><span class="kobospan" id="kobo.281.4">See </span><a class="url" href="http://webtypography.net/2.1.2"><span class="url1"><span class="kobospan" id="kobo.282.1">http://webtypography.net/2.1.2</span></span></a><span class="kobospan" id="kobo.283.1"> for a deeper discussion</span><span id="dx1-91002"/><span class="kobospan" id="kobo.284.1"> of line width and readability.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.285.1">While fewer characters per line is easier on the eyes, our code can refuse to cooperate with this principle. </span><span class="kobospan" id="kobo.285.2">How can we break long Python statements into more manageable pieces? </span><span id="x1-91003r167"/></p>
<section data-number="0.5.2.1" id="getting-ready-11">
<h2 class="likechapterhead" data-number="0.5.2.1"><span><span class="kobospan" id="kobo.286.1">2.2.1 </span></span> <span id="x1-920001"/><span class="kobospan" id="kobo.287.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.288.1">Let’s say we’ve got something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.289.1">&gt;&gt;&gt; import math
&gt;&gt;&gt; example_value = (63/25) * (17+15*math.sqrt(5)) / (7+15*math.sqrt(5))
&gt;&gt;&gt; mantissa_fraction, exponent = math.frexp(example_value)
&gt;&gt;&gt; mantissa_whole = int(mantissa_fraction*2**53)
&gt;&gt;&gt; message_text = f’the internal representation is {mantissa_whole:d}/2**53*2**{exponent:d}’
&gt;&gt;&gt; print(message_text) 
 
the internal representation is 7074237752514592/2**53*2**2</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.290.1">This code includes a long formula, and a long format string into which we’re injecting values. </span><span class="kobospan" id="kobo.290.2">This looks bad when typeset in a book; the f-string line may be broken incorrectly. </span><span class="kobospan" id="kobo.290.3">It may look bad on our screen when trying to edit this script. </span><span class="kobospan" id="kobo.290.4">(For more on f-strings, see </span><a href="ch005_split_000.xhtml#x1-410004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.291.1">Building complicated strings with f-strings</span></span></a><span class="kobospan" id="kobo.292.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.293.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.294.1"> </span></span><a href="ch005_split_000.xhtml#x1-170001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.295.1">1</span></span></a><span class="kobospan" id="kobo.296.1">.)</span></p>
<p class="normal1"><span class="kobospan" id="kobo.297.1">We can’t haphazardly break Python statements into chunks. </span><span class="kobospan" id="kobo.297.2">The syntax rules are clear that a statement must be complete on a single </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.298.1">logical</span></span><span class="kobospan" id="kobo.299.1"> line.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.300.1">The term ”logical line” provides a hint</span><span id="dx1-92011"/><span class="kobospan" id="kobo.301.1"> as to how we can proceed. </span><span class="kobospan" id="kobo.301.2">Python makes a distinction between logical lines</span><span id="dx1-92012"/><span class="kobospan" id="kobo.302.1"> and physical lines; we’ll leverage these syntax rules to break up long statements. </span><span id="x1-92013r169"/></p>
</section>
<section data-number="0.5.2.2" id="how-to-do-it...-11">
<h2 class="likechapterhead" data-number="0.5.2.2"><span><span class="kobospan" id="kobo.303.1">2.2.2 </span></span> <span id="x1-930002"/><span class="kobospan" id="kobo.304.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.305.1">Python gives us several ways to wrap long statements so they’re more readable:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.306.1">We can use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.307.1">\</span></span></span></span><span class="kobospan" id="kobo.308.1"> at the end of a line to continue the logical line onto the next physical line. </span><span class="kobospan" id="kobo.308.2">While this always works, it can be hard to spot the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.309.1">\</span></span></span></span><span class="kobospan" id="kobo.310.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.311.1">Python has a rule that a statement can span multiple </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.312.1">logical </span></span><span class="kobospan" id="kobo.313.1">lines because the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.314.1">()</span></span></span></span><span class="kobospan" id="kobo.315.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.316.1">[]</span></span></span></span><span class="kobospan" id="kobo.317.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.318.1">{}</span></span></span></span><span class="kobospan" id="kobo.319.1"> characters must balance. </span><span class="kobospan" id="kobo.319.2">Further, we can also exploit the way Python automatically concatenates adjacent string literals to make a single, longer string literal: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.320.1">("a"</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.321.1"> "b")</span></span></span></span><span class="kobospan" id="kobo.322.1"> is the same as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.323.1">"ab"</span></span></span></span><span class="kobospan" id="kobo.324.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.325.1">In some cases, we can decompose a statement into multiple statements by assigning intermediate results to separate variables.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.326.1">We’ll look at each one of these in separate parts of this recipe.</span></p>
<section data-number="0.5.2.2.1" id="using-a-backslash-to-break-a-long-statement-into-logical-lines">
<h3 class="likesubsubsectionhead" data-number="0.5.2.2.1"><span id="x1-940002"/><span class="kobospan" id="kobo.327.1">Using a backslash to break a long statement into logical lines</span></h3>
<ol class="calibre2">
<li class="calibre7"><div id="x1-94002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.328.1">If there’s a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.329.1">meaningful </span></span><span class="kobospan" id="kobo.330.1">break, insert</span><span id="dx1-94003"/><span class="kobospan" id="kobo.331.1"> the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.332.1">\</span></span></span></span><span class="kobospan" id="kobo.333.1"> to separate</span><span id="dx1-94004"/><span class="kobospan" id="kobo.334.1"> the statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.335.1">&gt;&gt;&gt; message_text = f’the internal representation is \ 
 
... </span><span class="kobospan" id="kobo.335.2">{mantissa_whole:d}/2**53*2**{exponent:d}’</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.336.1">For this to work, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.337.1">\</span></span></span></span><span class="kobospan" id="kobo.338.1"> must be the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.339.1">last </span></span><span class="kobospan" id="kobo.340.1">character on the line. </span><span class="kobospan" id="kobo.340.2">An extra space after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.341.1">\</span></span></span></span><span class="kobospan" id="kobo.342.1"> is fairly hard to see; some care is required. </span><span class="kobospan" id="kobo.342.2">The </span><a href="https://www.python.org/dev/peps/pep-0008/" class="url"><span class="kobospan" id="kobo.343.1">PEP-8</span></a><span class="kobospan" id="kobo.344.1"> proposal provides guidelines on formatting and tends to discourage this technique.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.345.1">In spite of this being a little hard</span><span id="dx1-94008"/><span class="kobospan" id="kobo.346.1"> to see, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.347.1">\</span></span></span></span><span class="kobospan" id="kobo.348.1"> can always</span><span id="dx1-94009"/><span class="kobospan" id="kobo.349.1"> be used. </span><span class="kobospan" id="kobo.349.2">Think of it as the last resort in making a line of code more readable.</span></p>
</section>
<section data-number="0.5.2.2.2" id="using-the-characters-to-break-a-long-statement-into-sensible-pieces">
<h3 class="likesubsubsectionhead" data-number="0.5.2.2.2"><span id="x1-950002"/><span class="kobospan" id="kobo.350.1">Using the () characters to break a long statement into sensible pieces</span></h3>
<ol class="calibre2">
<li class="calibre7"><div id="x1-95002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.351.1">Write the whole statement</span><span id="dx1-95003"/><span class="kobospan" id="kobo.352.1"> on one</span><span id="dx1-95004"/><span class="kobospan" id="kobo.353.1"> line, even if it’s confusing:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.354.1">&gt;&gt;&gt; import math  &gt;&gt;&gt; example_value1 = (63/25) * (17+15*math.sqrt(5)) / (7+15*math.sqrt(5))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.355.1">Add the extra </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.356.1">()</span></span></span></span><span class="kobospan" id="kobo.357.1"> characters, which don’t change the value but allow breaking the expression into multiple lines:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.358.1">&gt;&gt;&gt; example_value2 = (63/25) * ( (17+15*math.sqrt(5)) / (7+15*math.sqrt(5)) )  &gt;&gt;&gt; example_value2 == example_value1 
 
True</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-95015x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.359.1">Break the line inside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.360.1">()</span></span></span></span><span class="kobospan" id="kobo.361.1"> characters:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.362.1">&gt;&gt;&gt; example_value3 = (63/25) * ( 
 
... </span><span class="kobospan" id="kobo.362.2">    (17+15*math.sqrt(5)) 
 
... </span><span class="kobospan" id="kobo.362.3">    / (7+15*math.sqrt(5)) 
 
... </span><span class="kobospan" id="kobo.362.4">) 
 
 
 
&gt;&gt;&gt; example_value3 == example_value1 
 
True</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.363.1">The matching </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.364.1">()</span></span></span></span><span class="kobospan" id="kobo.365.1"> characters technique is quite powerful and will work in a wide variety of cases. </span><span class="kobospan" id="kobo.365.2">This is widely used and highly recommended.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.366.1">We can almost always find a way to add extra </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.367.1">()</span></span></span></span><span class="kobospan" id="kobo.368.1"> characters to a statement. </span><span class="kobospan" id="kobo.368.2">In rare cases when we can’t add </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.369.1">()</span></span></span></span><span class="kobospan" id="kobo.370.1"> characters, we can fall back on using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.371.1">\</span></span></span></span><span class="kobospan" id="kobo.372.1"> to break the statement into sections.</span></p>
</section>
<section data-number="0.5.2.2.3" id="using-string-literal-concatenation">
<h3 class="likesubsubsectionhead" data-number="0.5.2.2.3"><span id="x1-960002"/><span class="kobospan" id="kobo.373.1">Using string literal concatenation</span></h3>
<p class="normal"><span class="kobospan" id="kobo.374.1">We can combine the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.375.1">()</span></span></span></span><span class="kobospan" id="kobo.376.1"> characters with another</span><span id="dx1-96001"/><span class="kobospan" id="kobo.377.1"> rule that joins adjacent string literals. </span><span class="kobospan" id="kobo.377.2">This is particularly effective for long, complex format strings:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-96003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.378.1">Wrap the long string value in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.379.1">()</span></span></span></span><span class="kobospan" id="kobo.380.1"> characters.</span></p>
</div></li>
<li class="calibre7"><div id="x1-96005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.381.1">Break the string into meaningful substrings:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.382.1">&gt;&gt;&gt; message_text = ( 
 
... </span><span class="kobospan" id="kobo.382.2">f’the internal representation ’ 
 
... </span><span class="kobospan" id="kobo.382.3">f’is {mantissa_whole:d}/2**53*2**{exponent:d}’ 
 
... </span><span class="kobospan" id="kobo.382.4">) 
 
 
 
&gt;&gt;&gt; message_text 
 
’the internal representation is 7074237752514592/2**53*2**2’</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.383.1">We can always break a long string literal into adjacent pieces. </span><span class="kobospan" id="kobo.383.2">We can then use as many physical line breaks as we need. </span><span class="kobospan" id="kobo.383.3">With string literal values, no explicit operator is needed.</span></p>
</section>
<section data-number="0.5.2.2.4" id="assigning-intermediate-results-to-separate-variables">
<h3 class="likesubsubsectionhead" data-number="0.5.2.2.4"><span id="x1-970002"/><span class="kobospan" id="kobo.384.1">Assigning intermediate results to separate variables</span></h3>
<p class="normal"><span class="kobospan" id="kobo.385.1">Here’s the context</span><span id="dx1-97001"/><span class="kobospan" id="kobo.386.1"> for this technique:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.387.1">&gt;&gt;&gt; import math
&gt;&gt;&gt; example_value = (63/25) * (17+15*math.sqrt(5)) / (7+15*math.sqrt(5))
</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.388.1">We can break this into three intermediate values:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-97007x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.389.1">Identify sub-expressions in the overall expression. </span><span class="kobospan" id="kobo.389.2">Assign these to variables:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.390.1">&gt;&gt;&gt; a = (63/25) 
 
&gt;&gt;&gt; b = (17+15*math.sqrt(5)) 
 
&gt;&gt;&gt; c = (7+15*math.sqrt(5))</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-97013x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.391.1">Replace the sub-expressions with the variables that were created:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.392.1">&gt;&gt;&gt; example_value = a * b / c</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.393.1">We can always take a sub-expression and assign</span><span id="dx1-97016"/><span class="kobospan" id="kobo.394.1"> it to a variable, and use the variable everywhere the sub-expression was used. </span><span class="kobospan" id="kobo.394.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.395.1">15*sqrt(5)</span></span></span></span><span class="kobospan" id="kobo.396.1"> product is repeated; this, too, is a good candidate for refactoring the expression.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.397.1">We didn’t give these variables descriptive names. </span><span class="kobospan" id="kobo.397.2">In some cases, the sub-expressions have some semantics that we can capture with meaningful names. </span><span id="x1-97017r171"/></p>
</section>
</section>
<section data-number="0.5.2.3" id="how-it-works...-11">
<h2 class="likechapterhead" data-number="0.5.2.3"><span><span class="kobospan" id="kobo.398.1">2.2.3 </span></span> <span id="x1-980003"/><span class="kobospan" id="kobo.399.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.400.1">The Python language manual makes a distinction between logical lines and physical lines. </span><span class="kobospan" id="kobo.400.2">A logical line contains a complete statement. </span><span class="kobospan" id="kobo.400.3">It can span multiple physical</span><span id="dx1-98001"/><span class="kobospan" id="kobo.401.1"> lines through a technique called </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.402.1">line joining</span></span><span class="kobospan" id="kobo.403.1">. </span><span class="kobospan" id="kobo.403.2">The manual</span><span id="dx1-98002"/><span class="kobospan" id="kobo.404.1"> identifies two</span><span id="dx1-98003"/><span class="kobospan" id="kobo.405.1"> techniques: </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.406.1">explicit line joining </span></span><span class="kobospan" id="kobo.407.1">and </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.408.1">implicit line</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.409.1">joining</span></span><span class="kobospan" id="kobo.410.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.411.1">The use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.412.1">\</span></span></span></span><span class="kobospan" id="kobo.413.1"> for explicit line joining is sometimes helpful. </span><span class="kobospan" id="kobo.413.2">Because it’s easy to overlook, it’s not generally encouraged. </span><a href="https://www.python.org/dev/peps/pep-0008/" class="url"><span class="kobospan" id="kobo.414.1">PEP-8</span></a><span class="kobospan" id="kobo.415.1"> suggests this should be the method of last resort.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.416.1">The use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.417.1">()</span></span></span></span><span class="kobospan" id="kobo.418.1"> for implicit</span><span id="dx1-98004"/><span class="kobospan" id="kobo.419.1"> line joining can be used in many cases. </span><span class="kobospan" id="kobo.419.2">It often fits semantically with the structure of the expressions, so it is encouraged. </span><span id="x1-98005r184"/></p>
</section>
<section data-number="0.5.2.4" id="theres-more...-6">
<h2 class="likechapterhead" data-number="0.5.2.4"><span><span class="kobospan" id="kobo.420.1">2.2.4 </span></span> <span id="x1-990004"/><span class="kobospan" id="kobo.421.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.422.1">Expressions are used</span><span id="dx1-99001"/><span class="kobospan" id="kobo.423.1"> widely in a number of Python statements. </span><span class="kobospan" id="kobo.423.2">Any expression can have </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.424.1">()</span></span></span></span><span class="kobospan" id="kobo.425.1"> characters added. </span><span class="kobospan" id="kobo.425.2">This gives us a lot of flexibility.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.426.1">There are, however, a few places where we may have a long statement that does not specifically involve a long expression. </span><span class="kobospan" id="kobo.426.2">The most notable example of this is the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.427.1">import</span></span></span></span><span class="kobospan" id="kobo.428.1"> statement—it can become long, but doesn’t use any expressions. </span><span class="kobospan" id="kobo.428.2">In spite of not having a proper expression, it does, however, still permit the use of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.429.1">()</span></span></span></span><span class="kobospan" id="kobo.430.1">. </span><span class="kobospan" id="kobo.430.2">The following example shows we can surround a very long list of imported names:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.431.1">&gt;&gt;&gt; from math import ( 
 
... </span><span class="kobospan" id="kobo.431.2">    sin, cos, tan, 
 
... </span><span class="kobospan" id="kobo.431.3">    sqrt, log, frexp)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.432.1">While the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.433.1">()</span></span></span></span><span class="kobospan" id="kobo.434.1"> characters are emphatically </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.435.1">not </span></span><span class="kobospan" id="kobo.436.1">part of an expression, they are part of the syntax available to help</span><span id="dx1-99006"/><span class="kobospan" id="kobo.437.1"> make the statement more readable. </span><span id="x1-99007r185"/></p>
</section>
<section data-number="0.5.2.5" id="see-also-11">
<h2 class="likechapterhead" data-number="0.5.2.5"><span><span class="kobospan" id="kobo.438.1">2.2.5 </span></span> <span id="x1-1000005"/><span class="kobospan" id="kobo.439.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.440.1">Implicit line joining also applies to the matching </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.441.1">[]</span></span></span></span><span class="kobospan" id="kobo.442.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.443.1">{}</span></span></span></span><span class="kobospan" id="kobo.444.1"> characters. </span><span class="kobospan" id="kobo.444.2">These apply to collection data structures that we’ll look at in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.445.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.446.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.447.1">4</span></span></a><span class="kobospan" id="kobo.448.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-100001r168"/></p>
</section>
</section>
<section data-number="0.5.3" id="including-descriptions-and-documentation">
<h1 class="unnumbered" data-number="0.5.3"><span><span class="kobospan" id="kobo.449.1">2.3 </span></span> <span id="x1-1010003"/><span class="kobospan" id="kobo.450.1">Including descriptions and documentation</span></h1>
<p class="normal"><span class="kobospan" id="kobo.451.1">When we have a useful</span><span id="dx1-101001"/><span class="kobospan" id="kobo.452.1"> script, we often need</span><span id="dx1-101002"/><span class="kobospan" id="kobo.453.1"> to leave notes for ourselves—and others—on what it does, how it solves some particular problem, and when it should be used. </span><span class="kobospan" id="kobo.453.2">This recipe contains a suggested outline to help make the documentation reasonably complete. </span><span id="x1-101003r187"/></p>
<section data-number="0.5.3.1" id="getting-ready-12">
<h2 class="likechapterhead" data-number="0.5.3.1"><span><span class="kobospan" id="kobo.454.1">2.3.1 </span></span> <span id="x1-1020001"/><span class="kobospan" id="kobo.455.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.456.1">If we’ve used the </span><a href="ch006_split_000.xhtml#x1-850001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.457.1">Writing Python script and module files – syntax basics</span></span></a><span class="kobospan" id="kobo.458.1"> recipe to start a script file, we’ll have a small documentation string in place. </span><span class="kobospan" id="kobo.458.2">We’ll expand on this documentation string in this recipe.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.459.1">There are other places where documentation strings should be used. </span><span class="kobospan" id="kobo.459.2">We’ll look at these additional locations in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.460.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.461.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.462.1">3</span></span></a><span class="kobospan" id="kobo.463.1"> and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.464.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.465.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.466.1">7</span></span></a><span class="kobospan" id="kobo.467.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.468.1">We have two general kinds of modules for which we’ll be writing summary docstrings:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.469.1">Library modules</span></span><span class="kobospan" id="kobo.470.1">: These files will contain mostly function</span><span id="dx1-102001"/><span class="kobospan" id="kobo.471.1"> definitions as well as class definitions. </span><span class="kobospan" id="kobo.471.2">The docstring summary should focus on the definitions in the module, describing what the module is. </span><span class="kobospan" id="kobo.471.3">The docstring can provide examples of using the functions and classes that are defined in the module. </span><span class="kobospan" id="kobo.471.4">In </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.472.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.473.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.474.1">3</span></span></a><span class="kobospan" id="kobo.475.1">, and </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.476.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.477.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.478.1">7</span></span></a><span class="kobospan" id="kobo.479.1">, we’ll look more closely at these modules.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.480.1">Scripts</span></span><span class="kobospan" id="kobo.481.1">: These are files that we generally expect</span><span id="dx1-102002"/><span class="kobospan" id="kobo.482.1"> will do some real work. </span><span class="kobospan" id="kobo.482.2">The docstring should describe what the module does and how to use it. </span><span class="kobospan" id="kobo.482.3">The options, environment variables, and configuration files are important parts of this docstring.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.483.1">We will sometimes create files</span><span id="dx1-102003"/><span class="kobospan" id="kobo.484.1"> that contain</span><span id="dx1-102004"/><span class="kobospan" id="kobo.485.1"> a little of both. </span><span class="kobospan" id="kobo.485.2">This requires a proper balance between doing and being. </span><span id="x1-102005r189"/></p>
</section>
<section data-number="0.5.3.2" id="how-to-do-it...-12">
<h2 class="likechapterhead" data-number="0.5.3.2"><span><span class="kobospan" id="kobo.486.1">2.3.2 </span></span> <span id="x1-1030002"/><span class="kobospan" id="kobo.487.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.488.1">The first step in writing documentation</span><span id="dx1-103001"/><span class="kobospan" id="kobo.489.1"> is the same for both</span><span id="dx1-103002"/><span class="kobospan" id="kobo.490.1"> library modules and scripts:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-103004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.491.1">Write a brief summary of what the script or module is or does. </span><span class="kobospan" id="kobo.491.2">The summary doesn’t need to dig too deeply into how it works. </span><span class="kobospan" id="kobo.491.3">Like a lede in a newspaper article, it introduces the who, what, when, where, how, and why of the module. </span><span class="kobospan" id="kobo.491.4">Details will follow in the body of the docstring.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.492.1">It can help to avoid needless phrases like </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.493.1">This script</span></span><span class="kobospan" id="kobo.494.1">. </span><span class="kobospan" id="kobo.494.2">We might start our module docstring like this:</span></p>
<pre class="programlisting" id="listing-23"><code class="calibre13"><span class="kobospan" id="kobo.495.1">""" 
 
Downloads and decodes the current Special Marine Warning (SMW) 
 
for the area ’AKQ’. 
 
"""</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.496.1">We’ll separate the other steps based on the general focus of the module.</span></p>
<section data-number="0.5.3.2.1" id="writing-docstrings-for-scripts">
<h3 class="likesubsubsectionhead" data-number="0.5.3.2.1"><span id="x1-1040002"/><span class="kobospan" id="kobo.497.1">Writing docstrings for scripts</span></h3>
<p class="normal"><span class="kobospan" id="kobo.498.1">When we document a script, we need</span><span id="dx1-104001"/><span class="kobospan" id="kobo.499.1"> to focus on the needs</span><span id="dx1-104002"/><span class="kobospan" id="kobo.500.1"> of a person who will use the script.</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-104004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.501.1">Start as shown earlier, creating a summary sentence.</span></p>
</div></li>
<li class="calibre7"><div id="x1-104006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.502.1">Sketch an outline for the rest of the docstring. </span><span class="kobospan" id="kobo.502.2">We’ll be</span><span id="dx1-104007"/><span class="kobospan" id="kobo.503.1"> using </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.504.1">ReStructuredText </span></span><span class="kobospan" id="kobo.505.1">(</span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.506.1">RST</span></span><span class="kobospan" id="kobo.507.1">) markup. </span><span class="kobospan" id="kobo.507.2">Write the topic on one line, then put a line of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.508.1">=</span></span></span></span><span class="kobospan" id="kobo.509.1"> under the topic to make it a proper section title. </span><span class="kobospan" id="kobo.509.2">Remember to leave a blank line between each topic.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.510.1">Topics may include:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.511.1">SYNOPSIS</span></span><span class="kobospan" id="kobo.512.1">: A summary of how to run this script. </span><span class="kobospan" id="kobo.512.2">If the script uses the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.513.1">argparse</span></span></span></span><span class="kobospan" id="kobo.514.1"> module to process command-line arguments, the help text produced by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.515.1">argparse</span></span></span></span><span class="kobospan" id="kobo.516.1"> is the ideal synopsis text. </span><span class="kobospan" id="kobo.516.2">Other installable</span><span id="dx1-104008"/><span class="kobospan" id="kobo.517.1"> tools like </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.518.1">click </span></span><span class="kobospan" id="kobo.519.1">or </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.520.1">invoke </span></span><span class="kobospan" id="kobo.521.1">can also produce</span><span id="dx1-104009"/><span class="kobospan" id="kobo.522.1"> elegant synopsis text. </span><span class="kobospan" id="kobo.522.2">(See </span><a href="ch010.xhtml#x1-3490004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.523.1">Using argparse to get command-line</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.524.1">input</span></span></a><span class="kobospan" id="kobo.525.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.526.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.527.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.528.1">6</span></span></a><span class="kobospan" id="kobo.529.1">.)</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.530.1">DESCRIPTION</span></span><span class="kobospan" id="kobo.531.1">: An explanation of what this script does.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.532.1">OPTIONS</span></span><span class="kobospan" id="kobo.533.1">: This provides the details of all parameters and options. </span><span class="kobospan" id="kobo.533.2">(See </span><a href="ch010.xhtml#x1-3490004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.534.1">Using argparse to get command-line input</span></span></a><span class="kobospan" id="kobo.535.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.536.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.537.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.538.1">6</span></span></a><span class="kobospan" id="kobo.539.1">.)</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.540.1">ENVIRONMENT</span></span><span class="kobospan" id="kobo.541.1">: This provides the place to describe the environment variables and what they mean. </span><span class="kobospan" id="kobo.541.2">(See </span><a href="ch010.xhtml#x1-3670007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.542.1">Using the OS</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.543.1">environment settings</span></span></a><span class="kobospan" id="kobo.544.1"> in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.545.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.546.1"> </span></span><a href="ch010.xhtml#x1-3300006" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.547.1">6</span></span></a><span class="kobospan" id="kobo.548.1">.)</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.549.1">FILES</span></span><span class="kobospan" id="kobo.550.1">: The names of files that are created or read by a script are very important pieces of information.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.551.1">EXAMPLES</span></span><span class="kobospan" id="kobo.552.1">: Some examples of using the script are always helpful. </span><span class="kobospan" id="kobo.552.2">In some cases, this is the only part a user will read.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.553.1">SEE ALSO</span></span><span class="kobospan" id="kobo.554.1">: Any related scripts or background information.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.555.1">Other topics that might be interesting include </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.556.1">EXIT STATUS</span></span><span class="kobospan" id="kobo.557.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.558.1">AUTHOR</span></span><span class="kobospan" id="kobo.559.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.560.1">BUGS</span></span><span class="kobospan" id="kobo.561.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.562.1">REPORTING BUGS</span></span><span class="kobospan" id="kobo.563.1">, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.564.1">HISTORY</span></span><span class="kobospan" id="kobo.565.1">, or </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.566.1">COPYRIGHT</span></span><span class="kobospan" id="kobo.567.1">. </span><span class="kobospan" id="kobo.567.2">In some cases, advice on reporting bugs, for instance, doesn’t really belong in a module’s docstring, but rather elsewhere in the project’s GitHub or SourceForge pages.</span></p>
</div></li>
<li class="calibre7"><div id="x1-104011x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.568.1">Fill in the details under each topic. </span><span class="kobospan" id="kobo.568.2">It’s important to be accurate. </span><span class="kobospan" id="kobo.568.3">Since the documentation is in the same file as the code, it’s easier to be correct, complete, and consistent.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.569.1">Here’s an example</span><span id="dx1-104012"/><span class="kobospan" id="kobo.570.1"> of a docstring</span><span id="dx1-104013"/><span class="kobospan" id="kobo.571.1"> for a script:</span></p>
<pre class="programlisting" id="listing-24"><code class="calibre13"><span class="kobospan" id="kobo.572.1">""" 
 
Downloads and decodes the current Special Marine Warning (SMW) 
 
for the area \textquotesingle AKQ\textquotesingle{} 
 
 
 
SYNOPSIS 
 
======== 
 
 
 
:: 
 
 
 
    python3 akq_weather.py 
 
 
 
DESCRIPTION 
 
=========== 
 
 
 
Downloads the Special Marine Warnings 
 
 
 
Files 
 
===== 
 
 
 
Writes a file, ’’AKW.html’’. 
 
 
 
EXAMPLES 
 
======== 
 
 
 
Here’s an example:: 
 
 
 
    slott\$ python3 akq_weather.py 
 
    None issued by this office recently.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.573.1">In the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.574.1">SYNOPSIS</span></span></span></span><span class="kobospan" id="kobo.575.1"> section, we used </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.576.1">::</span></span></span></span><span class="kobospan" id="kobo.577.1"> as a separate paragraph. </span><span class="kobospan" id="kobo.577.2">In the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.578.1">EXAMPLES</span></span></span></span><span class="kobospan" id="kobo.579.1"> section, we used </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.580.1">::</span></span></span></span><span class="kobospan" id="kobo.581.1"> at the end of a paragraph. </span><span class="kobospan" id="kobo.581.2">Both versions are hints to the RST processing tools that the indented section that follows</span><span id="dx1-104042"/><span class="kobospan" id="kobo.582.1"> should be typeset</span><span id="dx1-104043"/><span class="kobospan" id="kobo.583.1"> as code. </span><span class="kobospan" id="kobo.583.2">See </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.584.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.585.1"> </span></span><a href="ch021.xhtml#x1-91400017" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.586.1">17</span></span></a><span class="cmti-10x-x"><span class="kobospan" id="kobo.587.1">, </span></span><a href="ch021.xhtml#x1-91400017" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.588.1">Documentation and</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.589.1">Style</span></span></a><span class="kobospan" id="kobo.590.1">.</span></p>
</section>
<section data-number="0.5.3.2.2" id="writing-docstrings-for-library-modules">
<h3 class="likesubsubsectionhead" data-number="0.5.3.2.2"><span id="x1-1050002"/><span class="kobospan" id="kobo.591.1">Writing docstrings for library modules</span></h3>
<p class="normal"><span class="kobospan" id="kobo.592.1">When we document a library</span><span id="dx1-105001"/><span class="kobospan" id="kobo.593.1"> module, we need</span><span id="dx1-105002"/><span class="kobospan" id="kobo.594.1"> to focus on the needs of a programmer who will import the module to use it in their code:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-105004x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.595.1">Sketch an outline for the rest of the docstring. </span><span class="kobospan" id="kobo.595.2">We’ll be using RST markup. </span><span class="kobospan" id="kobo.595.3">Write the topic on one line. </span><span class="kobospan" id="kobo.595.4">Include a line of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.596.1">=</span></span></span></span><span class="kobospan" id="kobo.597.1"> characters under each topic to make the topic into a proper heading. </span><span class="kobospan" id="kobo.597.2">Remember to leave a blank line between each paragraph.</span></p>
</div></li>
<li class="calibre7"><div id="x1-105006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.598.1">Start as shown previously, creating a summary sentence:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.599.1">DESCRIPTION</span></span><span class="kobospan" id="kobo.600.1">: A summary of what the module contains and why the module is useful</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.601.1">MODULE CONTENTS</span></span><span class="kobospan" id="kobo.602.1">: The classes and functions defined in this module</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.603.1">EXAMPLES</span></span><span class="kobospan" id="kobo.604.1">: Examples of using the module</span></p></li>
</ul>
</div></li>
<li class="calibre7"><div id="x1-105008x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.605.1">Fill in the details for each topic. </span><span class="kobospan" id="kobo.605.2">The module contents may be a long list of class or function definitions. </span><span class="kobospan" id="kobo.605.3">The docstring should be a summary. </span><span class="kobospan" id="kobo.605.4">Within each class or function, we’ll have a separate docstring</span><span id="dx1-105009"/><span class="kobospan" id="kobo.606.1"> with the details</span><span id="dx1-105010"/><span class="kobospan" id="kobo.607.1"> for that item.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-105011r190"/></p>
</section>
</section>
<section data-number="0.5.3.3" id="how-it-works...-12">
<h2 class="likechapterhead" data-number="0.5.3.3"><span><span class="kobospan" id="kobo.608.1">2.3.3 </span></span> <span id="x1-1060003"/><span class="kobospan" id="kobo.609.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.610.1">Over the decades, the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.611.1">man page </span></span><span class="kobospan" id="kobo.612.1">outline has evolved to contain a complete description of Linux commands. </span><span class="kobospan" id="kobo.612.2">This general approach to writing documentation has proven useful and resilient. </span><span class="kobospan" id="kobo.612.3">We can capitalize on a large body of experience, and structure our documentation to follow the man page model.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.613.1">We want to prepare module docstrings</span><span id="dx1-106001"/><span class="kobospan" id="kobo.614.1"> that can be used by the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.615.1">Sphinx </span></span><span class="kobospan" id="kobo.616.1">Python documentation generator (see </span><a class="url" href="http://www.sphinx-doc.org/en/stable/"><span class="url1"><span class="kobospan" id="kobo.617.1">http://www.sphinx-doc.org/en/stable/</span></span></a><span class="kobospan" id="kobo.618.1">). </span><span class="kobospan" id="kobo.618.2">This is the tool used to produce Python’s documentation files. </span><span class="kobospan" id="kobo.618.3">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.619.1">autodoc</span></span><span class="kobospan" id="kobo.620.1"> extension in </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.621.1">Sphinx </span></span><span class="kobospan" id="kobo.622.1">will read the docstring</span><span id="dx1-106002"/><span class="kobospan" id="kobo.623.1"> headers on our modules, classes, and functions to produce the final documentation that looks like other modules</span><span id="dx1-106003"/><span class="kobospan" id="kobo.624.1"> in the Python</span><span id="dx1-106004"/><span class="kobospan" id="kobo.625.1"> ecosystem. </span><span id="x1-106005r193"/></p>
</section>
<section data-number="0.5.3.4" id="theres-more...-7">
<h2 class="likechapterhead" data-number="0.5.3.4"><span><span class="kobospan" id="kobo.626.1">2.3.4 </span></span> <span id="x1-1070004"/><span class="kobospan" id="kobo.627.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.628.1">RST markup has a simple, central syntax</span><span id="dx1-107001"/><span class="kobospan" id="kobo.629.1"> rule: paragraphs are separated by blank lines.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.630.1">This rule makes it easy to write documents that can be examined by the various RST processing tools and reformatted to look nice.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.631.1">It can be challenging to write good software documentation. </span><span class="kobospan" id="kobo.631.2">There’s a broad chasm between too little information and documentation that recapitulates details apparent from looking at the code.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.632.1">What’s important is to focus on the needs of a person who doesn’t know too much about the software or how it works, but can read the Python code. </span><span class="kobospan" id="kobo.632.2">Provide this </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.633.1">semi-knowledgeable </span></span><span class="kobospan" id="kobo.634.1">user with the information they need to understand what the software does and how to use it. </span><span id="x1-107002r194"/></p>
</section>
<section data-number="0.5.3.5" id="see-also-12">
<h2 class="likechapterhead" data-number="0.5.3.5"><span><span class="kobospan" id="kobo.635.1">2.3.5 </span></span> <span id="x1-1080005"/><span class="kobospan" id="kobo.636.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.637.1">We look at additional techniques in </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.638.1">Writing better docstrings with RST</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.639.1">markup</span></span></a><span class="kobospan" id="kobo.640.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.641.1">If we’ve used the </span><a href="ch006_split_000.xhtml#x1-850001" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.642.1">Writing Python script and module files – syntax basics</span></span></a><span class="kobospan" id="kobo.643.1"> recipe, we’ll have put a documentation string in our script file. </span><span class="kobospan" id="kobo.643.2">When we build functions in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.644.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.645.1"> </span></span><a href="ch007_split_000.xhtml#x1-1610003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.646.1">3</span></span></a><span class="kobospan" id="kobo.647.1">, and classes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.648.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.649.1"> </span></span><a href="ch011_split_000.xhtml#x1-3760007" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.650.1">7</span></span></a><span class="kobospan" id="kobo.651.1">, we’ll look at other places where documentation strings can be placed.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.652.1">See </span><a class="url" href="http://www.sphinx-doc.org/en/stable/"><span class="url1"><span class="kobospan" id="kobo.653.1">http://www.sphinx-doc.org/en/stable/</span></span></a><span class="kobospan" id="kobo.654.1"> for more information</span><span id="dx1-108001"/><span class="kobospan" id="kobo.655.1"> on </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.656.1">Sphinx</span></span><span class="kobospan" id="kobo.657.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.658.1">For more background on the man</span><span id="dx1-108002"/><span class="kobospan" id="kobo.659.1"> page outline, see </span><a class="url" href="https://en.wikipedia.org/wiki/Man_page"><span class="url1"><span class="kobospan" id="kobo.660.1">https://en.wikipedia.org/wiki/Man_page</span></span></a><span class="kobospan" id="kobo.661.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-108003r188"/></p>
</section>
</section>
<section data-number="0.5.4" id="writing-better-docstrings-with-rst-markup">
<h1 class="unnumbered" data-number="0.5.4"><span><span class="kobospan" id="kobo.662.1">2.4 </span></span> <span id="x1-1090004"/><span class="kobospan" id="kobo.663.1">Writing better docstrings with RST markup</span></h1>
<p class="normal"><span class="kobospan" id="kobo.664.1">When we have a useful script, we often</span><span id="dx1-109001"/><span class="kobospan" id="kobo.665.1"> need to leave notes</span><span id="dx1-109002"/><span class="kobospan" id="kobo.666.1"> on what it does, how it works, and when it should be used. </span><span class="kobospan" id="kobo.666.2">Many tools for producing</span><span id="dx1-109003"/><span class="kobospan" id="kobo.667.1"> documentation, including </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.668.1">Docutils</span></span><span class="kobospan" id="kobo.669.1">, work with RST markup. </span><span class="kobospan" id="kobo.669.2">This allows us to write plain text documentation. </span><span class="kobospan" id="kobo.669.3">It can include some special punctuation to pick a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.670.1">bold </span></span><span class="kobospan" id="kobo.671.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.672.1">italic</span></span><span class="kobospan" id="kobo.673.1"> font variant to call attention to details. </span><span class="kobospan" id="kobo.673.2">In addition, RST permits organizing content via lists and section headings. </span><span id="x1-109004r195"/></p>
<section data-number="0.5.4.1" id="getting-ready-13">
<h2 class="likechapterhead" data-number="0.5.4.1"><span><span class="kobospan" id="kobo.674.1">2.4.1 </span></span> <span id="x1-1100001"/><span class="kobospan" id="kobo.675.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.676.1">In the </span><a href="ch006_split_000.xhtml#x1-1010003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.677.1">Including descriptions and documentation</span></span></a><span class="kobospan" id="kobo.678.1"> recipe, we looked at putting some basic documentation into a module. </span><span class="kobospan" id="kobo.678.2">We’ll look at a few of the RST formatting rules for creating readable documentation. </span><span id="x1-110001r197"/></p>
</section>
<section data-number="0.5.4.2" id="how-to-do-it...-13">
<h2 class="likechapterhead" data-number="0.5.4.2"><span><span class="kobospan" id="kobo.679.1">2.4.2 </span></span> <span id="x1-1110002"/><span class="kobospan" id="kobo.680.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-111002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.681.1">Start with an outline of the key point, creating RST section titles to organize the material. </span><span class="kobospan" id="kobo.681.2">A section title has a one-line title followed by a line of underline characters using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.682.1">=</span></span></span></span><span class="kobospan" id="kobo.683.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.684.1">-</span></span></span></span><span class="kobospan" id="kobo.685.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.686.1">^</span></span></span></span><span class="kobospan" id="kobo.687.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.688.1">~</span></span></span></span><span class="kobospan" id="kobo.689.1"> as long as the title.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.690.1">A heading will look like this:</span></p>
<pre class="programlisting" id="listing-25"><code class="calibre13"><span class="kobospan" id="kobo.691.1">Topic 
 
=====</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.692.1">The heading text is on one line and the underlining characters are on the next line. </span><span class="kobospan" id="kobo.692.2">This must be surrounded by blank lines. </span><span class="kobospan" id="kobo.692.3">There can be more underline characters than title characters, but never fewer.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.693.1">The RST tools will infer our chosen pattern of using underlining characters. </span><span class="kobospan" id="kobo.693.2">As long as the underline characters are used consistently, the docutil tools will detect the document’s structure.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.694.1">When starting out, it can help to have an explicit standard for heading underlines:</span></p>
<div class="tabular">
<table class="tabular1" id="TBL-2">
<tbody class="calibre19">
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-2-1-">
<td class="td" id="TBL-2-1-1"><span class="kobospan2" id="kobo.695.1">
                      Character
                    </span></td>
<td class="td" id="TBL-2-1-2"><span class="kobospan2" id="kobo.696.1">
                      Level
                    </span></td>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-2-2-">
<td class="td" id="TBL-2-2-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.697.1">=</span></span></span></span>
</td>
<td class="td" id="TBL-2-2-2"><span class="kobospan2" id="kobo.698.1">
                      1
                    </span></td>
</tr>
<tr class="even" id="TBL-2-3-">
<td class="td" id="TBL-2-3-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.699.1">-</span></span></span></span>
</td>
<td class="td" id="TBL-2-3-2"><span class="kobospan2" id="kobo.700.1">
                      2
                    </span></td>
</tr>
<tr class="even" id="TBL-2-4-">
<td class="td" id="TBL-2-4-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.701.1">^</span></span></span></span>
</td>
<td class="td" id="TBL-2-4-2"><span class="kobospan2" id="kobo.702.1">
                      3
                    </span></td>
</tr>
<tr class="even" id="TBL-2-5-">
<td class="td" id="TBL-2-5-1">
<span class="obeylines-h1"><span class="verb"><span class="cmtt-10x-x1"><span class="kobospan2" id="kobo.703.1">~</span></span></span></span>
</td>
<td class="td" id="TBL-2-5-2"><span class="kobospan2" id="kobo.704.1">
                      4
                    </span></td>
</tr>
<tr class="odd">
<td class="calibre20">
<hr class="calibre21"/>
</td>
<td class="calibre20">
<hr class="calibre21"/>
</td>
</tr>
<tr class="even" id="TBL-2-6-">
<td class="td" id="TBL-2-6-1"/>
<td class="calibre23"/>
</tr>
</tbody>
</table>
</div>
</div></li>
<li class="calibre7"><div id="x1-111006x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.705.1">Fill in the various paragraphs. </span><span class="kobospan" id="kobo.705.2">Paragraphs (including the section titles) are separated by at least one empty line.</span></p>
</div></li>
<li class="calibre7"><div id="x1-111008x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.706.1">If the programming editor has a spell checker, use it. </span><span class="kobospan" id="kobo.706.2">Doing this can be frustrating because the code samples</span><span id="dx1-111009"/><span class="kobospan" id="kobo.707.1"> often have abbreviations</span><span id="dx1-111010"/><span class="kobospan" id="kobo.708.1"> that fail spell checking.</span></p>
</div></li>
</ol>
<p class="normal1"><span id="x1-111011r198"/></p>
</section>
<section data-number="0.5.4.3" id="how-it-works...-13">
<h2 class="likechapterhead" data-number="0.5.4.3"><span><span class="kobospan" id="kobo.709.1">2.4.3 </span></span> <span id="x1-1120003"/><span class="kobospan" id="kobo.710.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.711.1">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.712.1">Docutils </span></span><span class="kobospan" id="kobo.713.1">conversion programs will examine the document, looking for sections and body elements. </span><span class="kobospan" id="kobo.713.2">A section is identified by a title. </span><span class="kobospan" id="kobo.713.3">The underlines are used to organize the sections into a properly nested hierarchy.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.714.1">A properly nested document might have the following sequence of underline characters:</span></p>
<pre class="programlisting" id="listing-26"><code class="calibre13"><span class="kobospan" id="kobo.715.1">TITLE 
 
===== 
 
 
 
SOMETHING 
 
---------- 
 
 
 
MORE 
 
^^^^^ 
 
 
 
EXTRA 
 
^^^^^ 
 
 
 
LEVEL 2 
 
------- 
 
 
 
LEVEL 3 
 
^^^^^^^^</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.716.1">When an HTML file is created</span><span id="dx1-112018"/><span class="kobospan" id="kobo.717.1"> from the documentation</span><span id="dx1-112019"/><span class="kobospan" id="kobo.718.1"> it will have </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.719.1">&lt;h1&gt;</span></span></span></span><span class="kobospan" id="kobo.720.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.721.1">&lt;h2&gt;</span></span></span></span><span class="kobospan" id="kobo.722.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.723.1">&lt;h3&gt;</span></span></span></span><span class="kobospan" id="kobo.724.1"> tags for the various levels. </span><span class="kobospan" id="kobo.724.2">Creating a LaTeX file requires some additional configuration choices, but the common </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.725.1">Article</span></span></span></span><span class="kobospan" id="kobo.726.1"> template means the resulting document will use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.727.1">\section</span></span></span></span><span class="kobospan" id="kobo.728.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.729.1">\subsection</span></span></span></span><span class="kobospan" id="kobo.730.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.731.1">\subsubsection</span></span></span></span><span class="kobospan" id="kobo.732.1"> headings. </span><span class="kobospan" id="kobo.732.2">These final presentation choices aren’t our primary concern when writing; the most important point is to use proper underlines to reflect the desired organization.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.733.1">There are several different kinds of body elements the RST parser can recognize. </span><span class="kobospan" id="kobo.733.2">We’ve shown a few. </span><span class="kobospan" id="kobo.733.3">A more complete list includes:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.734.1">Paragraphs of text</span></span><span class="kobospan" id="kobo.735.1">: These might use inline markup for different kinds of emphasis or highlighting.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.736.1">Literal blocks</span></span><span class="kobospan" id="kobo.737.1">: These are introduced with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.738.1">::</span></span></span></span><span class="kobospan" id="kobo.739.1"> and indented with four spaces. </span><span class="kobospan" id="kobo.739.2">They may also be introduced with the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.740.1">..</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.741.1"> parsed-literal::</span></span></span></span><span class="kobospan" id="kobo.742.1"> directive. </span><span class="kobospan" id="kobo.742.2">A </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.743.1">doctest </span></span><span class="kobospan" id="kobo.744.1">block is indented</span><span id="dx1-112020"/><span class="kobospan" id="kobo.745.1"> with four spaces and includes the Python </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.746.1">&gt;&gt;&gt;</span></span></span></span><span class="kobospan" id="kobo.747.1"> prompt.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.748.1">Lists, tables, and block quotes</span></span><span class="kobospan" id="kobo.749.1">: We’ll look at these later. </span><span class="kobospan" id="kobo.749.2">These can contain other body elements.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.750.1">Footnotes</span></span><span class="kobospan" id="kobo.751.1">: These are special paragraphs. </span><span class="kobospan" id="kobo.751.2">When rendered, they may be displayed at the bottom of a page or at the end of a section. </span><span class="kobospan" id="kobo.751.3">These can also contain other body elements.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.752.1">Hyperlink targets, substitution definitions, and RST</span></span> <span class="cmbx-10x-x"><span class="kobospan" id="kobo.753.1">comments</span></span><span class="kobospan" id="kobo.754.1">: These are more specialized</span><span id="dx1-112021"/><span class="kobospan" id="kobo.755.1"> text items</span><span id="dx1-112022"/><span class="kobospan" id="kobo.756.1"> that we won’t look at closely here.</span></p></li>
</ul>
<p class="normal1"><span id="x1-112023r199"/></p>
</section>
<section data-number="0.5.4.4" id="theres-more...-8">
<h2 class="likechapterhead" data-number="0.5.4.4"><span><span class="kobospan" id="kobo.757.1">2.4.4 </span></span> <span id="x1-1130004"/><span class="kobospan" id="kobo.758.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.759.1">In the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.760.1">Including descriptions and documentation </span></span><span class="kobospan" id="kobo.761.1">recipe, we looked at several different kinds of body elements we might use:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.762.1">Paragraphs of text</span></span><span class="kobospan" id="kobo.763.1">: This is a block of text surrounded by blank lines. </span><span class="kobospan" id="kobo.763.2">Within these, we can make use of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.764.1">inline </span></span><span class="kobospan" id="kobo.765.1">markup to emphasize words or phrases. </span><span class="kobospan" id="kobo.765.2">We’ll look at inline markup in the </span><a href="ch006_split_000.xhtml#x1-1090004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.766.1">Writing better</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.767.1">docstrings with RST markup</span></span></a><span class="kobospan" id="kobo.768.1"> recipe.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.769.1">Lists</span></span><span class="kobospan" id="kobo.770.1">: These are paragraphs that begin with something that looks like a number or a bullet. </span><span class="kobospan" id="kobo.770.2">We might have paragraphs like this.</span></p>
<pre class="programlisting" id="listing-27"><code class="calibre13"><span class="kobospan" id="kobo.771.1">It helps to have bullets because: 
 
-  They can help clarify 
 
-  They can help organize</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.772.1">Other characters can be used at the start of the line, but </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.773.1">-</span></span></span></span><span class="kobospan" id="kobo.774.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.775.1">*</span></span></span></span><span class="kobospan" id="kobo.776.1"> seem to be the most common choices.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.777.1">Numbered lists</span></span><span class="kobospan" id="kobo.778.1">: There are a variety of patterns that are recognized. </span><span class="kobospan" id="kobo.778.2">This includes leading digits or letters followed by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.779.1">.</span></span></span></span><span class="kobospan" id="kobo.780.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.781.1">)</span></span></span></span><span class="kobospan" id="kobo.782.1">. </span><span class="kobospan" id="kobo.782.2">Using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.783.1">#</span></span></span></span><span class="kobospan" id="kobo.784.1"> instead of a digit or letter will continue from the previous paragraph value.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.785.1">Literal blocks</span></span><span class="kobospan" id="kobo.786.1">: A code sample is presented literally, without looking for RST elements. </span><span class="kobospan" id="kobo.786.2">The text for this must be indented. </span><span class="kobospan" id="kobo.786.3">A handy prefix is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.787.1">::</span></span></span></span><span class="kobospan" id="kobo.788.1">. </span><span class="kobospan" id="kobo.788.2">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.789.1">..</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.790.1"> code-block::</span></span></span></span><span class="kobospan" id="kobo.791.1"> directive is also possible.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.792.1">Directives</span></span><span class="kobospan" id="kobo.793.1">: A directive is a paragraph that generally looks like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.794.1">..</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.795.1"> directive::</span></span></span></span><span class="kobospan" id="kobo.796.1">. </span><span class="kobospan" id="kobo.796.2">It may have some content that’s indented to be contained within the directive. </span><span class="kobospan" id="kobo.796.3">It might look like this:</span></p>
<pre class="programlisting" id="listing-28"><code class="calibre13"><span class="kobospan" id="kobo.797.1">.. </span><span class="kobospan" id="kobo.797.2"> important:: 
 
 
 
    Do not flip the bozo bit.</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.798.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.799.1">..</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.800.1"> important::</span></span></span></span><span class="kobospan" id="kobo.801.1"> text is the directive. </span><span class="kobospan" id="kobo.801.2">This is followed by text indented within the directive.</span></p></li>
</ul>
<section data-number="0.5.4.4.1" id="using-directives">
<h3 class="likesubsubsectionhead" data-number="0.5.4.4.1"><span id="x1-1140004"/><span class="kobospan" id="kobo.802.1">Using directives</span></h3>
<p class="normal"><span class="kobospan" id="kobo.803.1">Docutils has several</span><span id="dx1-114001"/><span class="kobospan" id="kobo.804.1"> built-in directives. </span><span class="kobospan" id="kobo.804.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.805.1">Sphinx </span></span><span class="kobospan" id="kobo.806.1">tool adds a large number</span><span id="dx1-114002"/><span class="kobospan" id="kobo.807.1"> of additional directives with a variety of features.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.808.1">Some of the most commonly used directives are the admonitions: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.809.1">attention</span></span></span></span><span class="kobospan" id="kobo.810.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.811.1">caution</span></span></span></span><span class="kobospan" id="kobo.812.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.813.1">danger</span></span></span></span><span class="kobospan" id="kobo.814.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.815.1">error</span></span></span></span><span class="kobospan" id="kobo.816.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.817.1">hint</span></span></span></span><span class="kobospan" id="kobo.818.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.819.1">important</span></span></span></span><span class="kobospan" id="kobo.820.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.821.1">note</span></span></span></span><span class="kobospan" id="kobo.822.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.823.1">tip</span></span></span></span><span class="kobospan" id="kobo.824.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.825.1">warning</span></span></span></span><span class="kobospan" id="kobo.826.1">, and a generic </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.827.1">admonition</span></span></span></span><span class="kobospan" id="kobo.828.1">. </span><span class="kobospan" id="kobo.828.2">These are compound body elements because they have nested text within them. </span><span class="kobospan" id="kobo.828.3">Above, we provided an example of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.829.1">important</span></span></span></span><span class="kobospan" id="kobo.830.1"> admonition.</span></p>
</section>
<section data-number="0.5.4.4.2" id="using-inline-markup">
<h3 class="likesubsubsectionhead" data-number="0.5.4.4.2"><span id="x1-1150004"/><span class="kobospan" id="kobo.831.1">Using inline markup</span></h3>
<p class="normal"><span class="kobospan" id="kobo.832.1">Within a paragraph, we have several forms</span><span id="dx1-115001"/><span class="kobospan" id="kobo.833.1"> of inline markup we can use:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.834.1">We can surround a word or phrase with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.835.1">*</span></span></span></span><span class="kobospan" id="kobo.836.1"> for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.837.1">*emphasis*</span></span></span></span><span class="kobospan" id="kobo.838.1">. </span><span class="kobospan" id="kobo.838.2">This is commonly typeset as </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.839.1">italic</span></span><span class="kobospan" id="kobo.840.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.841.1">We can surround a word or phrase with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.842.1">**</span></span></span></span><span class="kobospan" id="kobo.843.1"> for </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.844.1">**strong**</span></span></span></span><span class="kobospan" id="kobo.845.1">. </span><span class="kobospan" id="kobo.845.2">This is commonly typeset as </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.846.1">bold</span></span><span class="kobospan" id="kobo.847.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.848.1">We surround references with single back-ticks, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.849.1">‘</span></span></span></span><span class="kobospan" id="kobo.850.1">. </span><span class="kobospan" id="kobo.850.2">Links are followed by an underscore, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.851.1">_</span></span></span></span><span class="kobospan" id="kobo.852.1">. </span><span class="kobospan" id="kobo.852.2">We might use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.853.1">‘section</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.854.1"> title‘_</span></span></span></span><span class="kobospan" id="kobo.855.1"> to refer to a specific section within a document. </span><span class="kobospan" id="kobo.855.2">We don’t generally need to put any markup around URLs. </span><span class="kobospan" id="kobo.855.3">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.856.1">Docutils </span></span><span class="kobospan" id="kobo.857.1">tools recognize</span><span id="dx1-115002"/><span class="kobospan" id="kobo.858.1"> these. </span><span class="kobospan" id="kobo.858.2">Sometimes we want a word or phrase to be shown and the URL concealed. </span><span class="kobospan" id="kobo.858.3">We can use this: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.859.1">‘the</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.860.1"> \textbf{Sphinx}</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.861.1"> documentation</span></span></span></span> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.862.1">&lt;http://www.sphinx-doc.org/en/stable/&gt;‘_</span></span></span></span><span class="kobospan" id="kobo.863.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.864.1">We can surround code-related words with a double back-tick, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.865.1">‘‘</span></span></span></span><span class="kobospan" id="kobo.866.1">, to make them look like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.867.1">‘‘code‘‘</span></span></span></span><span class="kobospan" id="kobo.868.1">. </span><span class="kobospan" id="kobo.868.2">This will be typeset as </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.869.1">code</span></span></span></span><span class="kobospan" id="kobo.870.1">.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.871.1">There’s also a more general technique</span><span id="dx1-115003"/><span class="kobospan" id="kobo.872.1"> called a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.873.1">role</span></span><span class="kobospan" id="kobo.874.1">. </span><span class="kobospan" id="kobo.874.2">A role starts with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.875.1">:word:</span></span></span></span><span class="kobospan" id="kobo.876.1"> as the role name, followed by the applicable word or phrase in single </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.877.1">‘</span></span></span></span><span class="kobospan" id="kobo.878.1"> back-ticks. </span><span class="kobospan" id="kobo.878.2">A text role looks like this: </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.879.1">:strong:‘this‘</span></span></span></span><span class="kobospan" id="kobo.880.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.881.1">There are a number of standard role names, including </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.882.1">:emphasis:</span></span></span></span><span class="kobospan" id="kobo.883.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.884.1">:literal:</span></span></span></span><span class="kobospan" id="kobo.885.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.886.1">:code:</span></span></span></span><span class="kobospan" id="kobo.887.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.888.1">:math:</span></span></span></span><span class="kobospan" id="kobo.889.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.890.1">:pep-reference:</span></span></span></span><span class="kobospan" id="kobo.891.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.892.1">:rfc-reference:</span></span></span></span><span class="kobospan" id="kobo.893.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.894.1">:strong:</span></span></span></span><span class="kobospan" id="kobo.895.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.896.1">:subscript:</span></span></span></span><span class="kobospan" id="kobo.897.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.898.1">:superscript:</span></span></span></span><span class="kobospan" id="kobo.899.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.900.1">:title-reference:</span></span></span></span><span class="kobospan" id="kobo.901.1">. </span><span class="kobospan" id="kobo.901.2">Some of these are also available with simpler markup like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.902.1">*emphasis*</span></span></span></span><span class="kobospan" id="kobo.903.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.904.1">**strong**</span></span></span></span><span class="kobospan" id="kobo.905.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.906.1">Also, we can define new roles with a directive. </span><span class="kobospan" id="kobo.906.2">If we want to do very sophisticated processing, we can provide the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.907.1">Docutils </span></span><span class="kobospan" id="kobo.908.1">tool with class definitions</span><span id="dx1-115004"/><span class="kobospan" id="kobo.909.1"> for handling new roles. </span><span class="kobospan" id="kobo.909.2">This allows us to tweak</span><span id="dx1-115005"/><span class="kobospan" id="kobo.910.1"> the way our document is processed. </span><span id="x1-115006r200"/></p>
</section>
</section>
<section data-number="0.5.4.5" id="see-also-13">
<h2 class="likechapterhead" data-number="0.5.4.5"><span><span class="kobospan" id="kobo.911.1">2.4.5 </span></span> <span id="x1-1160005"/><span class="kobospan" id="kobo.912.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.913.1">For more information</span><span id="dx1-116001"/><span class="kobospan" id="kobo.914.1"> on RST syntax, see </span><a class="url" href="http://docutils.sourceforge.net"><span class="url1"><span class="kobospan" id="kobo.915.1">http://docutils.sourceforge.net</span></span></a><span class="kobospan" id="kobo.916.1">. </span><span class="kobospan" id="kobo.916.2">This includes a description of the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.917.1">Docutils </span></span><span class="kobospan" id="kobo.918.1">tool.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.919.1">For information</span><span id="dx1-116002"/><span class="kobospan" id="kobo.920.1"> on </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.921.1">Sphinx Python Documentation Generator</span></span><span class="kobospan" id="kobo.922.1">, see </span><a class="url" href="http://www.sphinx-doc.org/en/stable/"><span class="url1"><span class="kobospan" id="kobo.923.1">http://www.sphinx-doc.org/en/stable/</span></span></a><span class="kobospan" id="kobo.924.1">.</span></p></li>
</ul>
<p class="normal1"><span id="x1-116003r196"/></p>
</section>
</section>
<section data-number="0.5.5" id="designing-complex-if-elif-chains">
<h1 class="unnumbered" data-number="0.5.5"><span><span class="kobospan" id="kobo.925.1">2.5 </span></span> <span id="x1-1170005"/><span class="kobospan" id="kobo.926.1">Designing complex if...elif chains</span></h1>
<p class="normal"><span class="kobospan" id="kobo.927.1">In most cases, our scripts will involve</span><span id="dx1-117001"/><span class="kobospan" id="kobo.928.1"> a number of choices. </span><span class="kobospan" id="kobo.928.2">Sometimes the choices are simple, and we can judge the quality of the design with a glance at the code. </span><span class="kobospan" id="kobo.928.3">In other cases, the choices are more complicated, and it’s not easy to determine whether or not our </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.929.1">if</span></span></span></span><span class="kobospan" id="kobo.930.1"> statements are designed properly to handle all of the conditions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.931.1">In the simplest case, we have one condition, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.932.1">C</span></span><span class="kobospan" id="kobo.933.1">, and its inverse, </span><span><span class="kobospan" id="kobo.934.1">¬</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.935.1">C</span></span><span class="kobospan" id="kobo.936.1">. </span><span class="kobospan" id="kobo.936.2">These are the two conditions for an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.937.1">if...else</span></span></span></span><span class="kobospan" id="kobo.938.1"> statement. </span><span class="kobospan" id="kobo.938.2">One condition, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.939.1">C</span></span><span class="kobospan" id="kobo.940.1">, is stated in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.941.1">if</span></span></span></span><span class="kobospan" id="kobo.942.1"> clause; the inversion condition, </span><span><span class="kobospan" id="kobo.943.1">¬</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.944.1">C</span></span><span class="kobospan" id="kobo.945.1">, is implied in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.946.1">else</span></span></span></span><span class="kobospan" id="kobo.947.1"> clause.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.948.1">This follows the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.949.1">Law of the Excluded Middle</span></span><span class="kobospan" id="kobo.950.1">: we’re claiming there’s no missing</span><span id="dx1-117002"/><span class="kobospan" id="kobo.951.1"> alternative between the two conditions, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.952.1">C </span></span><span class="kobospan" id="kobo.953.1">and </span><span><span class="kobospan" id="kobo.954.1">¬</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.955.1">C</span></span><span class="kobospan" id="kobo.956.1">. </span><span class="kobospan" id="kobo.956.2">For a complex condition, though, this can be difficult to visualize.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.957.1">If we have something like:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.958.1">
 
 
if weather == Weather.RAIN and plan == Plan.GO_OUT: 
 
    bring("umbrella") 
 
else: 
 
    bring("sunglasses")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.959.1">It may not be immediately</span><span id="dx1-117008"/><span class="kobospan" id="kobo.960.1"> obvious, but we’ve omitted a number of possible alternatives. </span><span class="kobospan" id="kobo.960.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.961.1">weather</span></span></span></span><span class="kobospan" id="kobo.962.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.963.1">plan</span></span></span></span><span class="kobospan" id="kobo.964.1"> variables have four different combinations of values. </span><span class="kobospan" id="kobo.964.2">One of the conditions is stated explicitly, the other three are assumed:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.965.1">weather</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.966.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.967.1"> RAIN</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.968.1"> and</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.969.1"> plan</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.970.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.971.1"> GO_OUT</span></span></span></span><span class="kobospan" id="kobo.972.1">. </span><span class="kobospan" id="kobo.972.2">Bringing an umbrella seems right.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.973.1">weather</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.974.1"> !=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.975.1"> RAIN</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.976.1"> and</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.977.1"> plan</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.978.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.979.1"> GO_OUT</span></span></span></span><span class="kobospan" id="kobo.980.1">. </span><span class="kobospan" id="kobo.980.2">Bringing sunglasses seems appropriate.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.981.1">weather</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.982.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.983.1"> RAIN</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.984.1"> and</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.985.1"> plan</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.986.1"> !=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.987.1"> GO_OUT</span></span></span></span><span class="kobospan" id="kobo.988.1">. </span><span class="kobospan" id="kobo.988.2">If we’re staying in, then neither accessory seems right.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.989.1">weather</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.990.1"> !=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.991.1"> RAIN</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.992.1"> and</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.993.1"> plan</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.994.1"> !=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.995.1"> GO_OUT</span></span></span></span><span class="kobospan" id="kobo.996.1">. </span><span class="kobospan" id="kobo.996.2">Again, the accessory question seems moot if we’re not going out.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.997.1">How can we be sure we haven’t missed anything? </span><span class="kobospan" id="kobo.997.2">How can we be sure we have not conflated too many things into a condition that’s assumed instead of being stated? </span><span id="x1-117009r203"/></p>
<section data-number="0.5.5.1" id="getting-ready-14">
<h2 class="likechapterhead" data-number="0.5.5.1"><span><span class="kobospan" id="kobo.998.1">2.5.1 </span></span> <span id="x1-1180001"/><span class="kobospan" id="kobo.999.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1000.1">Let’s look at a concrete example of an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1001.1">if...elif</span></span></span></span><span class="kobospan" id="kobo.1002.1"> chain. </span><span class="kobospan" id="kobo.1002.2">In the</span><span id="dx1-118001"/><span class="kobospan" id="kobo.1003.1"> casino game of </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1004.1">Craps</span></span><span class="kobospan" id="kobo.1005.1">, there are a number of rules that apply to a roll of two dice. </span><span class="kobospan" id="kobo.1005.2">These rules apply on the first</span><span id="dx1-118002"/><span class="kobospan" id="kobo.1006.1"> roll of the game, called the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1007.1">come-out</span></span><span class="kobospan" id="kobo.1008.1"> roll:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1009.1">2, 3, or 12 is </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1010.1">craps</span></span><span class="kobospan" id="kobo.1011.1">, which is a loss for most bets.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1012.1">7 or 11 is a winner for most bets.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1013.1">The remaining numbers establish a </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1014.1">point</span></span><span class="kobospan" id="kobo.1015.1">. </span><span class="kobospan" id="kobo.1015.2">The dice-rolling continues based on another set of rules.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1016.1">We’ll use this set of three conditions as an example for looking at this recipe because it has a potentially vague clause in it. </span><span id="x1-118003r206"/></p>
</section>
<section data-number="0.5.5.2" id="how-to-do-it...-14">
<h2 class="likechapterhead" data-number="0.5.5.2"><span><span class="kobospan" id="kobo.1017.1">2.5.2 </span></span> <span id="x1-1190002"/><span class="kobospan" id="kobo.1018.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1019.1">When we write an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1020.1">if</span></span></span></span><span class="kobospan" id="kobo.1021.1"> statement, even when</span><span id="dx1-119001"/><span class="kobospan" id="kobo.1022.1"> it appears trivial, we need to be sure that all conditions are covered.</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-119003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1023.1">Enumerate the conditions we know. </span><span class="kobospan" id="kobo.1023.2">In our example, we have three rules: the (2, 3, 12) rule, the (7, 11) rule, and a vague statement of ”the remaining numbers.” </span><span class="kobospan" id="kobo.1023.3">This can form a first draft of an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1024.1">if</span></span></span></span><span class="kobospan" id="kobo.1025.1"> statement.</span></p>
</div></li>
<li class="calibre7"><div id="x1-119005x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1026.1">Determine the universe of all possible alternatives. </span><span class="kobospan" id="kobo.1026.2">For this example, there are 11 alternative outcomes: the numbers from 2 to 12, inclusive.</span></p>
</div></li>
<li class="calibre7"><div id="x1-119007x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1027.1">Compare the various </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1028.1">if</span></span></span></span><span class="kobospan" id="kobo.1029.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1030.1">elif</span></span></span></span><span class="kobospan" id="kobo.1031.1"> conditions, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1032.1">C</span></span><span class="kobospan" id="kobo.1033.1">, with the universe of alternatives, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1034.1">U</span></span><span class="kobospan" id="kobo.1035.1">. </span><span class="kobospan" id="kobo.1035.2">There are three possible design patterns:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1036.1">We have more </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1037.1">if</span></span></span></span><span class="kobospan" id="kobo.1038.1"> conditions in the code than are possible in the universe of alternatives, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1039.1">C </span></span><span><span class="kobospan" id="kobo.1040.1">⊂ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1041.1">U</span></span><span class="kobospan" id="kobo.1042.1">. </span><span class="kobospan" id="kobo.1042.2">The most common cause is failing to completely enumerate all possible alternatives in the universe. </span><span class="kobospan" id="kobo.1042.3">We might, for example, have modeled dice using 0 to 5 instead of 1 to 6. </span><span class="kobospan" id="kobo.1042.4">The universe of alternatives appears to be the values from 0 to 10, yet there are conditions for 11 and 12.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1043.1">We have gaps in the conditions in our code, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1044.1">U </span></span><span><span class="kobospan" id="kobo.1045.1">∖ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1046.1">C</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1047.1">≠</span></span><span><span class="kobospan" id="kobo.1048.1">∅</span></span><span class="kobospan" id="kobo.1049.1">. </span><span class="kobospan" id="kobo.1049.2">The most common cause of alternatives in the universe without a clearly-stated </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1050.1">if</span></span></span></span><span class="kobospan" id="kobo.1051.1"> condition is failing to fully understand the conditions in the code. </span><span class="kobospan" id="kobo.1051.2">We might, for example, have enumerated the values as two tuples instead of sums. </span><span class="kobospan" id="kobo.1051.3">The numbers 2, 3 and 12 are defined by a number of pairs, including (1, 1), (1, 2), and (6, 6). </span><span class="kobospan" id="kobo.1051.4">It’s possible to overlook the condition (2, 1), leaving this untested by any clause of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1052.1">if</span></span></span></span><span class="kobospan" id="kobo.1053.1"> statement.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1054.1">We can prove there’s a match between conditions expressed in the code and the universe of alternatives, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1055.1">U </span></span><span><span class="kobospan" id="kobo.1056.1">≡ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1057.1">C</span></span><span class="kobospan" id="kobo.1058.1">. </span><span class="kobospan" id="kobo.1058.2">This is ideal. </span><span class="kobospan" id="kobo.1058.3">The universe of all possible alternatives matches all the conditions in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1059.1">if</span></span></span></span><span class="kobospan" id="kobo.1060.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1061.1">elif</span></span></span></span><span class="kobospan" id="kobo.1062.1"> clauses of the statement.</span></p></li>
</ul>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1063.1">In this example, it’s easy to enumerate all of the possible alternatives. </span><span class="kobospan" id="kobo.1063.2">In other cases, it can take some careful reasoning to understand any gaps or omissions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1064.1">In this example, we have a vague term, </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1065.1">remaining numbers</span></span><span class="kobospan" id="kobo.1066.1">, which we can replace with the list of values (4, 5, 6, 8, 9, 10). </span><span class="kobospan" id="kobo.1066.2">Supplying a list removes any possible gaps and doubts.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1067.1">When there are exactly two alternatives, we can write a condition expression for one of the alternatives. </span><span class="kobospan" id="kobo.1067.2">The other condition can be implied; an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1068.1">if</span></span></span></span><span class="kobospan" id="kobo.1069.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1070.1">else</span></span></span></span><span class="kobospan" id="kobo.1071.1"> will work.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1072.1">When we have more than two alternatives, we can use this recipe to write a chain of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1073.1">if</span></span></span></span><span class="kobospan" id="kobo.1074.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1075.1">elif</span></span></span></span><span class="kobospan" id="kobo.1076.1"> statements, one statement per alternative:</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-119009x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1077.1">Write an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1078.1">if</span></span></span></span><span class="kobospan" id="kobo.1079.1"> ... </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1080.1">elif</span></span></span></span><span class="kobospan" id="kobo.1081.1"> ... </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1082.1">elif</span></span></span></span><span class="kobospan" id="kobo.1083.1"> chain that covers</span><span id="dx1-119010"/><span class="kobospan" id="kobo.1084.1"> all of the known alternatives. </span><span class="kobospan" id="kobo.1084.2">For our example, it might start like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1085.1">
dice = die_1 + die_2 
 
if dice in (2, 3, 12): 
 
    game.craps() 
 
elif dice in (7, 11): 
 
    game.winner() 
 
elif dice in (4, 5, 6, 8, 9, 10): 
 
    game.point(dice)                                                                

                                                                     
     </span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-119020x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1086.1">Add an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1087.1">else</span></span></span></span><span class="kobospan" id="kobo.1088.1"> clause that raises an exception, like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1089.1">
else: 
 
    raise Exception(’Design Problem’)</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1090.1">This extra </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1091.1">else</span></span></span></span><span class="kobospan" id="kobo.1092.1"> gives us a way to positively identify when a logic problem is found. </span><span class="kobospan" id="kobo.1092.2">We can be sure that any design error we made will lead to a conspicuous problem when the program runs. </span><span class="kobospan" id="kobo.1092.3">Ideally, we’ll find any problems while we’re unit testing.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1093.1">In this case, it is clear that all 11 alternatives are covered by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1094.1">if</span></span></span></span><span class="kobospan" id="kobo.1095.1"> statement conditions. </span><span class="kobospan" id="kobo.1095.2">The extra </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1096.1">else</span></span></span></span><span class="kobospan" id="kobo.1097.1"> can’t ever be used. </span><span class="kobospan" id="kobo.1097.2">Not all real-world problems have this kind of easy proof that all the alternatives are covered by conditions. </span><span class="kobospan" id="kobo.1097.3">It can help to provide a noisy failure mode. </span><span id="x1-119024r207"/></p>
</section>
<section data-number="0.5.5.3" id="how-it-works...-14">
<h2 class="likechapterhead" data-number="0.5.5.3"><span><span class="kobospan" id="kobo.1098.1">2.5.3 </span></span> <span id="x1-1200003"/><span class="kobospan" id="kobo.1099.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1100.1">Our goal is to be sure that our program works reliably. </span><span class="kobospan" id="kobo.1100.2">While testing helps, we can still have the same wrong assumptions when doing design and creating test cases.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1101.1">While rigorous logic is essential, we can still make mistakes. </span><span class="kobospan" id="kobo.1101.2">Further, someone doing ordinary software maintenance might introduce an error. </span><span class="kobospan" id="kobo.1101.3">Adding a new feature to a complex </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1102.1">if</span></span></span></span><span class="kobospan" id="kobo.1103.1"> statement is a potential source of problems.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1104.1">This </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1105.1">Else-Raise </span></span><span class="kobospan" id="kobo.1106.1">design pattern forces us to be explicit</span><span id="dx1-120001"/><span class="kobospan" id="kobo.1107.1"> for each and every condition. </span><span class="kobospan" id="kobo.1107.2">Nothing is assumed. </span><span class="kobospan" id="kobo.1107.3">As we noted previously, any error in our logic will be uncovered if the exception gets raised.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1108.1">Crashing with an exception is sensible behavior in the presence of a design problem. </span><span class="kobospan" id="kobo.1108.2">While an alternative is to write a message to an error log, a program with this kind of profound design flaw should be viewed</span><span id="dx1-120002"/><span class="kobospan" id="kobo.1109.1"> as fatally broken. </span><span id="x1-120003r210"/></p>
</section>
</section>
</section>


<section data-number="0.5" id="chapter-2-statements-and-syntax">
<section data-number="0.5.5" id="designing-complex-if-elif-chains">
<section data-number="0.5.5.4" id="theres-more...-9">
<h2 class="likechapterhead" data-number="0.5.5.4"><span><span class="kobospan" id="kobo.1110.1">2.5.4 </span></span> <span id="x1-1210004"/><span class="kobospan" id="kobo.1111.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1112.1">In many cases, we can derive an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1113.1">if...elif...elif</span></span></span></span><span class="kobospan" id="kobo.1114.1"> chain from an examination of the desired post condition at some point in the program’s processing. </span><span class="kobospan" id="kobo.1114.2">For example, we may need a statement that establishes something like </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1115.1">m </span></span><span class="kobospan" id="kobo.1116.1">is equal to the larger of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1117.1">a </span></span><span class="kobospan" id="kobo.1118.1">or </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1119.1">b</span></span><span class="kobospan" id="kobo.1120.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1121.1">(For the sake of working through the logic, we’ll avoid Python’s handy </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1122.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1123.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1124.1"> max(a,</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1125.1"> b)</span></span></span></span><span class="kobospan" id="kobo.1126.1">, and focus on the way we can compute a result from exclusive choices.)</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1127.1">We can formalize the final condition like this:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1128.1"><img alt="(m = a ∨m = b)∧ m ≥ a∧ m ≥ b " class="calibre9" src="../media/file12.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1129.1">We can work backward from this final condition, by writing the goal as an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1130.1">assert</span></span></span></span><span class="kobospan" id="kobo.1131.1"> statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1132.1"># do something 
 
assert (m == a or m == b) and m &gt;= a and m &gt;= b</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1133.1">Once we have the goal stated, we can identify statements that lead to that goal. </span><span class="kobospan" id="kobo.1133.2">Clearly, assignment statements like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1134.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1135.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1136.1"> a</span></span></span></span><span class="kobospan" id="kobo.1137.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1138.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1139.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1140.1"> b</span></span></span></span><span class="kobospan" id="kobo.1141.1"> would be appropriate, but each of these works only under limited conditions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1142.1">We can derive the precondition that shows when these statements should be used. </span><span class="kobospan" id="kobo.1142.2">The preconditions for an assignment statement will be written in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1143.1">if</span></span></span></span><span class="kobospan" id="kobo.1144.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1145.1">elif</span></span></span></span><span class="kobospan" id="kobo.1146.1"> expressions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1147.1">We need to use the statement </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1148.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1149.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1150.1"> a</span></span></span></span><span class="kobospan" id="kobo.1151.1"> when </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1152.1">a</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1153.1"> &gt;=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1154.1"> b</span></span></span></span><span class="kobospan" id="kobo.1155.1">. </span><span class="kobospan" id="kobo.1155.2">Similarly, we need to use the statement </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1156.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1157.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1158.1"> b</span></span></span></span><span class="kobospan" id="kobo.1159.1"> when </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1160.1">b</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1161.1"> &gt;=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1162.1"> a</span></span></span></span><span class="kobospan" id="kobo.1163.1">. </span><span class="kobospan" id="kobo.1163.2">Rearranging logic into code gives us this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1164.1">if a &gt;= b: 
 
    m = a 
 
elif b &gt;= a: 
 
    m = b 
 
else: 
 
    raise Exception(’Design Problem’) 
 
 
 
assert (m == a or m == b) and m &gt;= a and m &gt;= b</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1165.1">Note that our universe of conditions, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1166.1">U </span></span><span class="kobospan" id="kobo.1167.1">= </span><span><span class="kobospan" id="kobo.1168.1">{</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1169.1">a </span></span><span><span class="kobospan" id="kobo.1170.1">≥ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1171.1">b,b </span></span><span><span class="kobospan" id="kobo.1172.1">≥ </span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1173.1">a</span></span><span><span class="kobospan" id="kobo.1174.1">}</span></span><span class="kobospan" id="kobo.1175.1">, is complete; there’s no other possible relationship. </span><span class="kobospan" id="kobo.1175.2">Also notice that in the edge case of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1176.1">a </span></span><span class="kobospan" id="kobo.1177.1">= </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1178.1">b</span></span><span class="kobospan" id="kobo.1179.1">, we don’t actually care which assignment statement is used. </span><span class="kobospan" id="kobo.1179.2">Python will process the decisions in order and will execute </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1180.1">m</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1181.1"> =</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1182.1"> a</span></span></span></span><span class="kobospan" id="kobo.1183.1">. </span><span class="kobospan" id="kobo.1183.2">The fact that this choice is consistent shouldn’t have any impact on our design</span><span id="dx1-121013"/><span class="kobospan" id="kobo.1184.1"> of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1185.1">if...elif...elif</span></span></span></span><span class="kobospan" id="kobo.1186.1"> chain. </span><span class="kobospan" id="kobo.1186.2">We can design the conditions without regard to the order of evaluation of the clauses. </span><span id="x1-121014r211"/></p>
</section>
<section data-number="0.5.5.5" id="see-also-14">
<h2 class="likechapterhead" data-number="0.5.5.5"><span><span class="kobospan" id="kobo.1187.1">2.5.5 </span></span> <span id="x1-1220005"/><span class="kobospan" id="kobo.1188.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1189.1">This is somewhat similar</span><span id="dx1-122001"/><span class="kobospan" id="kobo.1190.1"> to the syntactic problem of the ”dangling else.” </span><span class="kobospan" id="kobo.1190.2">See </span><a class="url" href="https://docs.oracle.com/javase/specs/jls/se9/html/jls-14.html"><span class="url1"><span class="kobospan" id="kobo.1191.1">https://docs.oracle.com/javase/specs/jls/se9/html/jls-14.html</span></span></a><span class="kobospan" id="kobo.1192.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1193.1">This isn’t the same problem; Python’s indentation removes the ”dangling else” syntax problem. </span><span class="kobospan" id="kobo.1193.2">This is an adjacent semantic problem of trying to be sure that all conditions are properly accounted for in a complex </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1194.1">if...elif...elif</span></span></span></span><span class="kobospan" id="kobo.1195.1"> chain.</span></p></li>
</ul>
<p class="normal1"><span id="x1-122002r204"/></p>
</section>
</section>
<section data-number="0.5.6" id="saving-intermediate-results-with-the-walrus-operator">
<h1 class="unnumbered" data-number="0.5.6"><span><span class="kobospan" id="kobo.1196.1">2.6 </span></span> <span id="x1-1230006"/><span class="kobospan" id="kobo.1197.1">Saving intermediate results with the := ”walrus” operator</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1198.1">Sometimes we’ll have a complex</span><span id="dx1-123001"/><span class="kobospan" id="kobo.1199.1"> condition where</span><span id="dx1-123002"/><span class="kobospan" id="kobo.1200.1"> we want to preserve an expensive intermediate result for later use. </span><span class="kobospan" id="kobo.1200.2">Imagine a condition that involves a complex calculation; the cost of computing is high measured in time, input-output operations, memory resources, or all three.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1201.1">An example includes doing repetitive searches using the Regular Expression (</span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1202.1">re</span></span></span></span><span class="kobospan" id="kobo.1203.1">) package. </span><span class="kobospan" id="kobo.1203.2">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1204.1">match()</span></span></span></span><span class="kobospan" id="kobo.1205.1"> method can do quite a bit of computation before returning either a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1206.1">Match</span></span></span></span><span class="kobospan" id="kobo.1207.1"> object or a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1208.1">None</span></span></span></span><span class="kobospan" id="kobo.1209.1"> object to show the pattern wasn’t found. </span><span class="kobospan" id="kobo.1209.2">Once this computation is completed, we may have several uses for the result, and we emphatically do </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1210.1">not </span></span><span class="kobospan" id="kobo.1211.1">want to perform the computation again. </span><span class="kobospan" id="kobo.1211.2">Often, the initial use is the simple check to see if the result is a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1212.1">Match</span></span></span></span><span class="kobospan" id="kobo.1213.1"> object or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1214.1">None</span></span></span></span><span class="kobospan" id="kobo.1215.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1216.1">This is an example where it can be helpful to assign a name to the value of an expression and also use the expression in an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1217.1">if</span></span></span></span><span class="kobospan" id="kobo.1218.1"> statement. </span><span class="kobospan" id="kobo.1218.2">We’ll look at how to use the ”assignment expression” or ”walrus” operator. </span><span class="kobospan" id="kobo.1218.3">It’s called the walrus because the assignment expression operator, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1219.1">:=</span></span></span></span><span class="kobospan" id="kobo.1220.1">, looks like the face of a walrus to some people. </span><span id="x1-123003r214"/></p>
<section data-number="0.5.6.1" id="getting-ready-15">
<h2 class="likechapterhead" data-number="0.5.6.1"><span><span class="kobospan" id="kobo.1221.1">2.6.1 </span></span> <span id="x1-1240001"/><span class="kobospan" id="kobo.1222.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1223.1">Here’s a summation where—eventually—each term becomes so small that there’s no point in continuing to add it to the overall total:</span></p>
<div class="math-display">
<span class="kobospan" id="kobo.1224.1"><img alt=" ∑ (--1---)2 0≤n&lt;∞ 2n+ 1 " class="calibre9" src="../media/file13.png"/></span>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1225.1">In effect, this is something like the following summation function:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1226.1">&gt;&gt;&gt; s = sum((1 / (2 * n + 1)) ** 2 for n in range(0, 20_000))</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1227.1">What’s not clear is the question of how many terms are required. </span><span class="kobospan" id="kobo.1227.2">In the example, we’ve summed 20,000 values. </span><span class="kobospan" id="kobo.1227.3">But what if 16,000 are enough to provide an accurate answer?</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1228.1">We don’t want to write a summation like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1229.1">&gt;&gt;&gt; b = 0 
 
&gt;&gt;&gt; for n in range(0, 20_000): 
 
... </span><span class="kobospan" id="kobo.1229.2">    if (1 / ( 2 * n + 1)) ** 2 &gt;= 0.000_000_001: 
 
... </span><span class="kobospan" id="kobo.1229.3">        b = b + (1 / (2 * n + 1)) ** 2</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1230.1">This example repeats an expensive computation, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1231.1">(1/(2*n+1))**2</span></span></span></span><span class="kobospan" id="kobo.1232.1">. </span><span class="kobospan" id="kobo.1232.2">We can avoid processing that includes this kind of time-wasting overhead by using the walrus operator. </span><span id="x1-124008r216"/></p>
</section>
<section data-number="0.5.6.2" id="how-to-do-it...-15">
<h2 class="likechapterhead" data-number="0.5.6.2"><span><span class="kobospan" id="kobo.1233.1">2.6.2 </span></span> <span id="x1-1250002"/><span class="kobospan" id="kobo.1234.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-125002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1235.1">First we isolate an expensive operation</span><span id="dx1-125003"/><span class="kobospan" id="kobo.1236.1"> that’s part of a conditional</span><span id="dx1-125004"/><span class="kobospan" id="kobo.1237.1"> test. </span><span class="kobospan" id="kobo.1237.2">In this example, the variable term is used to hold the expensive result:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1238.1">&gt;&gt;&gt; p = 0 
 
&gt;&gt;&gt; for n in range(0, 20_000): 
 
... </span><span class="kobospan" id="kobo.1238.2">    term = (1 / (2 * n + 1)) ** 2 
 
... </span><span class="kobospan" id="kobo.1238.3">    if term &gt;= 0.000_000_001: 
 
... </span><span class="kobospan" id="kobo.1238.4">        p = p + term</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-125012x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1239.1">Rewrite the assignment statement to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1240.1">:=</span></span></span></span><span class="kobospan" id="kobo.1241.1"> assignment operator. </span><span class="kobospan" id="kobo.1241.2">This replaces the simple condition of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1242.1">if</span></span></span></span><span class="kobospan" id="kobo.1243.1"> statement.</span></p>
</div></li>
<li class="calibre7"><div id="x1-125014x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1244.1">Add an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1245.1">else</span></span></span></span><span class="kobospan" id="kobo.1246.1"> condition to break out of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1247.1">for</span></span></span></span><span class="kobospan" id="kobo.1248.1"> statement if no more terms are needed. </span><span class="kobospan" id="kobo.1248.2">Here’s the results of these two steps:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1249.1">&gt;&gt;&gt; q = 0 
 
&gt;&gt;&gt; for n in range(0, 20_000): 
 
... </span><span class="kobospan" id="kobo.1249.2">    if (term := (1 / (2 * n + 1)) ** 2) &gt;= 0.000_000_001: 
 
... </span><span class="kobospan" id="kobo.1249.3">        q = q + term 
 
... </span><span class="kobospan" id="kobo.1249.4">    else: 
 
... </span><span class="kobospan" id="kobo.1249.5">        break</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1250.1">Note that we changed the summation variable. </span><span class="kobospan" id="kobo.1250.2">In the previous step of the recipe, it was </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1251.1">p</span></span></span></span><span class="kobospan" id="kobo.1252.1">. </span><span class="kobospan" id="kobo.1252.2">In this step, it’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1253.1">q</span></span></span></span><span class="kobospan" id="kobo.1254.1">. </span><span class="kobospan" id="kobo.1254.2">This permits easy side-by-side comparisons to be sure the results are still correct.</span></p>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1255.1">The assignment expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1256.1">:=</span></span></span></span><span class="kobospan" id="kobo.1257.1"> lets us do two things in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1258.1">if</span></span></span></span><span class="kobospan" id="kobo.1259.1"> statement. </span><span id="x1-125022r219"/></p>
</section>
<section data-number="0.5.6.3" id="how-it-works...-15">
<h2 class="likechapterhead" data-number="0.5.6.3"><span><span class="kobospan" id="kobo.1260.1">2.6.3 </span></span> <span id="x1-1260003"/><span class="kobospan" id="kobo.1261.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1262.1">The assignment expression operator </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1263.1">:=</span></span></span></span><span class="kobospan" id="kobo.1264.1"> saves an intermediate result. </span><span class="kobospan" id="kobo.1264.2">The operator’s result value is the same as the right-hand side operand. </span><span class="kobospan" id="kobo.1264.3">This means that the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1265.1">a</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1266.1"> +</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1267.1"> (b</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1268.1"> :=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1269.1"> c+d)</span></span></span></span><span class="kobospan" id="kobo.1270.1"> is the same as the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1271.1">a+(c+d)</span></span></span></span><span class="kobospan" id="kobo.1272.1">. </span><span class="kobospan" id="kobo.1272.2">The difference between the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1273.1">a</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1274.1"> +</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1275.1"> (b</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1276.1"> :=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1277.1"> c+d)</span></span></span></span><span class="kobospan" id="kobo.1278.1"> and the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1279.1">a+(c+d)</span></span></span></span><span class="kobospan" id="kobo.1280.1"> is the side-effect of setting the value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1281.1">b</span></span></span></span><span class="kobospan" id="kobo.1282.1"> variable partway through the evaluation.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1283.1">An assignment expression can be used in almost any kind of context where expressions are permitted in Python. </span><span class="kobospan" id="kobo.1283.2">The most common cases are </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1284.1">if</span></span></span></span><span class="kobospan" id="kobo.1285.1"> statements. </span><span class="kobospan" id="kobo.1285.2">Another good idea is inside a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1286.1">while</span></span></span></span><span class="kobospan" id="kobo.1287.1"> condition.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1288.1">They’re also forbidden in a few places. </span><span class="kobospan" id="kobo.1288.2">They cannot be used as the operator in an expression statement. </span><span class="kobospan" id="kobo.1288.3">We’re specifically prohibited from writing </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1289.1">a</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1290.1"> :=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1291.1"> 2</span></span></span></span><span class="kobospan" id="kobo.1292.1"> as a statement: there’s a perfectly good assignment statement for this purpose</span><span id="dx1-126001"/><span class="kobospan" id="kobo.1293.1"> and an assignment expression, while similar</span><span id="dx1-126002"/><span class="kobospan" id="kobo.1294.1"> in intent, is potentially confusing. </span><span id="x1-126003r222"/></p>
</section>
<section data-number="0.5.6.4" id="theres-more...-10">
<h2 class="likechapterhead" data-number="0.5.6.4"><span><span class="kobospan" id="kobo.1295.1">2.6.4 </span></span> <span id="x1-1270004"/><span class="kobospan" id="kobo.1296.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1297.1">We can do some more optimization of our infinite summation example, shown earlier in this recipe. </span><span class="kobospan" id="kobo.1297.2">The use of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1298.1">for</span></span></span></span><span class="kobospan" id="kobo.1299.1"> statement and a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1300.1">range()</span></span></span></span><span class="kobospan" id="kobo.1301.1"> object seems simple. </span><span class="kobospan" id="kobo.1301.2">The problem is that we want to end the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1302.1">for</span></span></span></span><span class="kobospan" id="kobo.1303.1"> statement early—when the terms being added are so small that they have no significant change in the final sum.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1304.1">We can combine the early exit with the term computation:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1305.1"> &gt;&gt;&gt; r = 0 
 
&gt;&gt;&gt; n = 0 
 
&gt;&gt;&gt; while (term := (1 / (2 * n + 1)) ** 2) &gt;= 0.000_000_001: 
 
... </span><span class="kobospan" id="kobo.1305.2">    r += term 
 
... </span><span class="kobospan" id="kobo.1305.3">    n += 1</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1306.1">We’ve used a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1307.1">while</span></span></span></span><span class="kobospan" id="kobo.1308.1"> statement with the assignment expression operator. </span><span class="kobospan" id="kobo.1308.2">This will compute a value using </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1309.1">(1/(2*n+1))**2</span></span></span></span><span class="kobospan" id="kobo.1310.1">, and assign this to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1311.1">term</span></span></span></span><span class="kobospan" id="kobo.1312.1"> variable. </span><span class="kobospan" id="kobo.1312.2">If the value is significant, we’ll add it to the sum, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1313.1">r</span></span></span></span><span class="kobospan" id="kobo.1314.1">, and increment the value for the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1315.1">n</span></span></span></span><span class="kobospan" id="kobo.1316.1"> variable. </span><span class="kobospan" id="kobo.1316.2">If the value assigned to </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1317.1">term</span></span></span></span><span class="kobospan" id="kobo.1318.1"> is too small to be significant, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1319.1">while</span></span></span></span><span class="kobospan" id="kobo.1320.1"> statement will end.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1321.1">Here’s another example, showing how to compute running sums of a collection of values. </span><span class="kobospan" id="kobo.1321.2">This looks forward to concepts in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1322.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1323.1"> </span></span><a href="ch008_split_000.xhtml#x1-2240004" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1324.1">4</span></span></a><span class="kobospan" id="kobo.1325.1">. </span><span class="kobospan" id="kobo.1325.2">Specifically, this shows a list comprehension built using the assignment expression operator:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1326.1">&gt;&gt;&gt; data = [11, 13, 17, 19, 23, 29] 
 
&gt;&gt;&gt; total = 0 
 
&gt;&gt;&gt; running_sum = [(total := total + d) for d in data] 
 
&gt;&gt;&gt; total 
 
112 
 
&gt;&gt;&gt; running_sum 
 
[11, 24, 41, 60, 83, 112]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1327.1">We’ve started with some data, in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1328.1">data</span></span></span></span><span class="kobospan" id="kobo.1329.1"> variable. </span><span class="kobospan" id="kobo.1329.2">This might be minutes of exercise each day for most of a week. </span><span class="kobospan" id="kobo.1329.3">The value of the final </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1330.1">running_sum</span></span></span></span><span class="kobospan" id="kobo.1331.1"> variable is a list object, built by evaluating the expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1332.1">(total</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1333.1"> :=</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1334.1"> total</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1335.1"> +</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1336.1"> d)</span></span></span></span><span class="kobospan" id="kobo.1337.1"> for each value, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1338.1">d</span></span></span></span><span class="kobospan" id="kobo.1339.1">, in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1340.1">data</span></span></span></span><span class="kobospan" id="kobo.1341.1"> variable. </span><span class="kobospan" id="kobo.1341.2">Because the assignment expression changes the value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1342.1">total</span></span></span></span><span class="kobospan" id="kobo.1343.1"> variable, the resulting list is the result of each new value being accumulated. </span><span id="x1-127015r223"/></p>
</section>
<section data-number="0.5.6.5" id="see-also-15">
<h2 class="likechapterhead" data-number="0.5.6.5"><span><span class="kobospan" id="kobo.1344.1">2.6.5 </span></span> <span id="x1-1280005"/><span class="kobospan" id="kobo.1345.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1346.1">For details on assignment expression, see </span><a href="https://www.python.org/dev/peps/pep-0572/" class="url"><span class="kobospan" id="kobo.1347.1">PEP-572</span></a><span class="kobospan" id="kobo.1348.1">, where the feature was first described.</span></p></li>
</ul>
<p class="normal1"><span id="x1-128001r215"/></p>
</section>
</section>
<section data-number="0.5.7" id="avoiding-a-potential-problem-with-break-statements">
<h1 class="unnumbered" data-number="0.5.7"><span><span class="kobospan" id="kobo.1349.1">2.7 </span></span> <span id="x1-1290007"/><span class="kobospan" id="kobo.1350.1">Avoiding a potential problem with break statements</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1351.1">The common way to understand</span><span id="dx1-129001"/><span class="kobospan" id="kobo.1352.1"> a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1353.1">for</span></span></span></span><span class="kobospan" id="kobo.1354.1"> statement is that it creates a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1355.1">for all</span></span><span class="kobospan" id="kobo.1356.1"> condition. </span><span class="kobospan" id="kobo.1356.2">At the end of the statement, we can assert that, for all items in a collection, the processing in the body of the statement has been done.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1357.1">This isn’t the only meaning a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1358.1">for</span></span></span></span><span class="kobospan" id="kobo.1359.1"> statement can have. </span><span class="kobospan" id="kobo.1359.2">When the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1360.1">break</span></span></span></span><span class="kobospan" id="kobo.1361.1"> statement is used inside the body of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1362.1">for</span></span></span></span><span class="kobospan" id="kobo.1363.1"> statement, it changes the semantics to </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1364.1">there exists</span></span><span class="kobospan" id="kobo.1365.1">. </span><span class="kobospan" id="kobo.1365.2">When the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1366.1">break</span></span></span></span><span class="kobospan" id="kobo.1367.1"> statement leaves the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1368.1">for</span></span></span></span><span class="kobospan" id="kobo.1369.1"> (or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1370.1">while</span></span></span></span><span class="kobospan" id="kobo.1371.1">) statement, we can assert there exists at least one item that caused the enclosing statement to end.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1372.1">There’s a side issue here. </span><span class="kobospan" id="kobo.1372.2">What if the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1373.1">for</span></span></span></span><span class="kobospan" id="kobo.1374.1"> statement ends without executing the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1375.1">break</span></span></span></span><span class="kobospan" id="kobo.1376.1"> statement? </span><span class="kobospan" id="kobo.1376.2">Either way, we’re at the statement after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1377.1">for</span></span></span></span><span class="kobospan" id="kobo.1378.1"> statement. </span><span class="kobospan" id="kobo.1378.2">The condition that’s true upon leaving a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1379.1">for</span></span></span></span><span class="kobospan" id="kobo.1380.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1381.1">while</span></span></span></span><span class="kobospan" id="kobo.1382.1"> statement with a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1383.1">break</span></span></span></span><span class="kobospan" id="kobo.1384.1"> statement can be ambiguous. </span><span class="kobospan" id="kobo.1384.2">We can’t </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1385.1">easily </span></span><span class="kobospan" id="kobo.1386.1">tell; this recipe gives some design guidance.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1387.1">The problem is magnified</span><span id="dx1-129002"/><span class="kobospan" id="kobo.1388.1"> when we have multiple </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1389.1">break</span></span></span></span><span class="kobospan" id="kobo.1390.1"> statements, each with its own condition. </span><span class="kobospan" id="kobo.1390.2">How can we minimize the problems created by having these complicated conditions for leaving a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1391.1">for</span></span></span></span><span class="kobospan" id="kobo.1392.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1393.1">while</span></span></span></span><span class="kobospan" id="kobo.1394.1"> statement? </span><span id="x1-129003r226"/></p>
<section data-number="0.5.7.1" id="getting-ready-16">
<h2 class="likechapterhead" data-number="0.5.7.1"><span><span class="kobospan" id="kobo.1395.1">2.7.1 </span></span> <span id="x1-1300001"/><span class="kobospan" id="kobo.1396.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1397.1">When parsing configuration files, we often need to find the first occurrence of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1398.1">:</span></span></span></span><span class="kobospan" id="kobo.1399.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1400.1">=</span></span></span></span><span class="kobospan" id="kobo.1401.1"> character in a string. </span><span class="kobospan" id="kobo.1401.2">The </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1402.1">property file </span></span><span class="kobospan" id="kobo.1403.1">format uses a property name</span><span id="dx1-130001"/><span class="kobospan" id="kobo.1404.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1405.1">:</span></span></span></span><span class="kobospan" id="kobo.1406.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1407.1">=</span></span></span></span><span class="kobospan" id="kobo.1408.1"> followed by a value.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1409.1">Finding the punctuation mark is an example of a </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1410.1">there exists </span></span><span class="kobospan" id="kobo.1411.1">modification to a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1412.1">for</span></span></span></span><span class="kobospan" id="kobo.1413.1"> statement. </span><span class="kobospan" id="kobo.1413.2">We don’t want to process </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1414.1">all </span></span><span class="kobospan" id="kobo.1415.1">characters; we want to know where the leftmost </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1416.1">:</span></span></span></span><span class="kobospan" id="kobo.1417.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1418.1">=</span></span></span></span><span class="kobospan" id="kobo.1419.1"> character is found.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1420.1">Here’s the sample data we’re going use as an example:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1421.1">&gt;&gt;&gt; sample_1 = "some_name = the_value"</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1422.1">Here’s a small </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1423.1">for</span></span></span></span><span class="kobospan" id="kobo.1424.1"> statement to locate the leftmost </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1425.1">:</span></span></span></span><span class="kobospan" id="kobo.1426.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1427.1">=</span></span></span></span><span class="kobospan" id="kobo.1428.1"> character in the sample string value:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1429.1">&gt;&gt;&gt; for position in  range(len(sample_1)): 
 
... </span><span class="kobospan" id="kobo.1429.2">    if sample_1[position] in ’=:’: 
 
... </span><span class="kobospan" id="kobo.1429.3">        break 
 
&gt;&gt;&gt; print(f"name={sample_1[:position]!r}", 
 
... </span><span class="kobospan" id="kobo.1429.4">    f"value={sample_1[position+1:]!r}") 
 
name=’some_name ’ value=’ the_value’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1430.1">When the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1431.1">=</span></span></span></span><span class="kobospan" id="kobo.1432.1"> character is found, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1433.1">break</span></span></span></span><span class="kobospan" id="kobo.1434.1"> statement ends the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1435.1">for</span></span></span></span><span class="kobospan" id="kobo.1436.1"> statement. </span><span class="kobospan" id="kobo.1436.2">The value of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1437.1">position</span></span></span></span><span class="kobospan" id="kobo.1438.1"> variable shows where the desired character was found.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1439.1">What about the following edge case?</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1440.1">&gt;&gt;&gt; sample_2 = "name_only" 
 
&gt;&gt;&gt; for position in range(len(sample_2)): 
 
... </span><span class="kobospan" id="kobo.1440.2">    if sample_2[position] in ’=:’: 
 
... </span><span class="kobospan" id="kobo.1440.3">        break 
 
&gt;&gt;&gt; print(f"name={sample_2[:position]!r}", 
 
... </span><span class="kobospan" id="kobo.1440.4">    f"value={sample_2[position+1:]!r}") 
 
name=’name_onl’ value=’’</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1441.1">The result is awkwardly wrong: the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1442.1">y</span></span></span></span><span class="kobospan" id="kobo.1443.1"> character got dropped from the value of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1444.1">name</span></span></span></span><span class="kobospan" id="kobo.1445.1">. </span><span class="kobospan" id="kobo.1445.2">Why did this happen? </span><span class="kobospan" id="kobo.1445.3">And, more importantly, how can we make the condition at the end of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1446.1">for</span></span></span></span><span class="kobospan" id="kobo.1447.1"> statement clearer? </span><span id="x1-130019r228"/></p>
</section>
<section data-number="0.5.7.2" id="how-to-do-it...-16">
<h2 class="likechapterhead" data-number="0.5.7.2"><span><span class="kobospan" id="kobo.1448.1">2.7.2 </span></span> <span id="x1-1310002"/><span class="kobospan" id="kobo.1449.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1450.1">Every statement establishes</span><span id="dx1-131001"/><span class="kobospan" id="kobo.1451.1"> a post-condition. </span><span class="kobospan" id="kobo.1451.2">When designing a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1452.1">for</span></span></span></span><span class="kobospan" id="kobo.1453.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1454.1">while</span></span></span></span><span class="kobospan" id="kobo.1455.1"> statement, we need to articulate the condition that should be true at the end of the statement. </span><span class="kobospan" id="kobo.1455.2">Ideally, the post-condition is something simple like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1456.1">text[position]</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1457.1"> in</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1458.1"> ’=:’</span></span></span></span><span class="kobospan" id="kobo.1459.1">. </span><span class="kobospan" id="kobo.1459.2">However, in the case where there’s no </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1460.1">=</span></span></span></span><span class="kobospan" id="kobo.1461.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1462.1">:</span></span></span></span><span class="kobospan" id="kobo.1463.1"> in the given text, the overly simple post-condition can’t be true.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1464.1">At the end of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1465.1">for</span></span></span></span><span class="kobospan" id="kobo.1466.1"> statement, one of these two things are true:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1467.1">Either the character with the index of </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1468.1">position</span></span></span></span><span class="kobospan" id="kobo.1469.1"> is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1470.1">:</span></span></span></span><span class="kobospan" id="kobo.1471.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1472.1">=</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1473.1">Or all characters have been examined and no character is </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1474.1">:</span></span></span></span><span class="kobospan" id="kobo.1475.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1476.1">=</span></span></span></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1477.1">Our application code needs to handle both cases.</span></p>
<ol class="calibre4">
<li class="calibre7"><div id="x1-131003x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1478.1">Write the obvious post-condition. </span><span class="kobospan" id="kobo.1478.2">We sometimes call this the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1479.1">happy-path </span></span><span class="kobospan" id="kobo.1480.1">condition because it’s the one that’s true when nothing unusual has happened:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1481.1">assert text[position] in ’=:’  # We found a = or :</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-131007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1482.1">Create the overall post-condition by adding the conditions for the edge cases. </span><span class="kobospan" id="kobo.1482.2">In this example, we have two additional conditions:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1483.1">There’s no </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1484.1">=</span></span></span></span><span class="kobospan" id="kobo.1485.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1486.1">:</span></span></span></span><span class="kobospan" id="kobo.1487.1">.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1488.1">There are no characters at all. </span><span class="kobospan" id="kobo.1488.2">This means the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1489.1">len()</span></span></span></span><span class="kobospan" id="kobo.1490.1"> is zero, and the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1491.1">for</span></span></span></span><span class="kobospan" id="kobo.1492.1"> statement never actually did anything. </span><span class="kobospan" id="kobo.1492.2">This also means the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1493.1">position</span></span></span></span><span class="kobospan" id="kobo.1494.1"> variable will never be created.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1495.1">In this example, then, we have discovered a total of three conditions:</span></p>
<ul class="calibre17">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1496.1">len(text)</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1497.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1498.1"> 0</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1499.1">not(’=’</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1500.1"> in</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1501.1"> text</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1502.1"> or</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1503.1"> ’:’</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1504.1"> in</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1505.1"> text)</span></span></span></span><span class="kobospan" id="kobo.1506.1">, which can be stated in a number of ways. </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1507.1">not(text[position]</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1508.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1509.1"> ’:’</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1510.1"> or</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1511.1"> text[position]</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1512.1"> ==</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1513.1"> ’=’)</span></span></span></span><span class="kobospan" id="kobo.1514.1"> might be most clear.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1515.1">text[position]</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1516.1"> in</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1517.1"> ’=:’</span></span></span></span></p></li>
</ul>
</div></li>
<li class="calibre7"><div id="x1-131009x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1518.1">A </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1519.1">while</span></span></span></span><span class="kobospan" id="kobo.1520.1"> statement can be redesigned to have the complete set of post conditions in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1521.1">while</span></span></span></span><span class="kobospan" id="kobo.1522.1"> clause. </span><span class="kobospan" id="kobo.1522.2">This can eliminate the need for a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1523.1">break</span></span></span></span><span class="kobospan" id="kobo.1524.1"> statement. </span><span class="kobospan" id="kobo.1524.2">Proper initialization of variables is still required.</span></p>
</div></li>
<li class="calibre7"><div id="x1-131011x4" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1525.1">When a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1526.1">for</span></span></span></span><span class="kobospan" id="kobo.1527.1"> statement</span><span id="dx1-131012"/><span class="kobospan" id="kobo.1528.1"> is being used, proper initialization of variables is required. </span><span class="kobospan" id="kobo.1528.2">Add </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1529.1">if</span></span></span></span><span class="kobospan" id="kobo.1530.1"> statements for the various terminating conditions after the body of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1531.1">for</span></span></span></span><span class="kobospan" id="kobo.1532.1"> statement. </span><span class="kobospan" id="kobo.1532.2">Here’s the resulting </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1533.1">for</span></span></span></span><span class="kobospan" id="kobo.1534.1"> statement and a complicated </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1535.1">if</span></span></span></span><span class="kobospan" id="kobo.1536.1"> statement to examine all of the possible post conditions:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1537.1">&gt;&gt;&gt; position = -1 
 
&gt;&gt;&gt; for position in range(len(sample_2)): 
 
... </span><span class="kobospan" id="kobo.1537.2">    if sample_2[position] in ’=:’: 
 
... </span><span class="kobospan" id="kobo.1537.3">        break 
 
... 
 
&gt;&gt;&gt; if position == -1: 
 
... </span><span class="kobospan" id="kobo.1537.4">    print(f"name=None value=None") 
 
... </span><span class="kobospan" id="kobo.1537.5">elif not(sample_2[position] == ’:’ or sample_2[position] == ’=’): 
 
... </span><span class="kobospan" id="kobo.1537.6">    print(f"name={sample_2!r} value=None") 
 
... </span><span class="kobospan" id="kobo.1537.7">else: 
 
... </span><span class="kobospan" id="kobo.1537.8">    print(f"name={sample_2[:position]!r}", 
 
... </span><span class="kobospan" id="kobo.1537.9">        f"value={sample_2[position+1:]!r}") 
 
name=’name_only’ value=None</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1538.1">In the statements after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1539.1">for</span></span></span></span><span class="kobospan" id="kobo.1540.1"> statement, we’ve enumerated all of the terminating conditions explicitly. </span><span id="x1-131027r232"/></p>
</section>
<section data-number="0.5.7.3" id="how-it-works...-16">
<h2 class="likechapterhead" data-number="0.5.7.3"><span><span class="kobospan" id="kobo.1541.1">2.7.3 </span></span> <span id="x1-1320003"/><span class="kobospan" id="kobo.1542.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1543.1">This approach forces us to work out the post-condition carefully so that we can be absolutely sure that we know all the reasons the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1544.1">for</span></span></span></span><span class="kobospan" id="kobo.1545.1"> or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1546.1">while</span></span></span></span><span class="kobospan" id="kobo.1547.1"> statement ended.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1548.1">The idea here is to forego any assumptions or intuition. </span><span class="kobospan" id="kobo.1548.2">With a little bit of discipline, we can be sure of the post-conditions. </span><span class="kobospan" id="kobo.1548.3">It’s imperative to be explicit about the condition that’s true when a statement works. </span><span class="kobospan" id="kobo.1548.4">This is the goal of our software, and we can work backward from the goal by choosing the simplest</span><span id="dx1-132001"/><span class="kobospan" id="kobo.1549.1"> statements that will make the goal conditions true. </span><span id="x1-132002r235"/></p>
</section>
<section data-number="0.5.7.4" id="theres-more...-11">
<h2 class="likechapterhead" data-number="0.5.7.4"><span><span class="kobospan" id="kobo.1550.1">2.7.4 </span></span> <span id="x1-1330004"/><span class="kobospan" id="kobo.1551.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1552.1">We can also use an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1553.1">else</span></span></span></span><span class="kobospan" id="kobo.1554.1"> clause</span><span id="dx1-133001"/><span class="kobospan" id="kobo.1555.1"> on a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1556.1">for</span></span></span></span><span class="kobospan" id="kobo.1557.1"> statement to determine if the statement finished normally or a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1558.1">break</span></span></span></span><span class="kobospan" id="kobo.1559.1"> statement was executed. </span><span class="kobospan" id="kobo.1559.2">We can use something like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1560.1">&gt;&gt;&gt; for position in  range(len(sample_2)): 
 
... </span><span class="kobospan" id="kobo.1560.2">    if sample_2[position] in ’=:’: 
 
... </span><span class="kobospan" id="kobo.1560.3">        name, value = sample_2[:position], sample_2[position+1:] 
 
... </span><span class="kobospan" id="kobo.1560.4">        break 
 
... </span><span class="kobospan" id="kobo.1560.5">else: 
 
... </span><span class="kobospan" id="kobo.1560.6">    if len(sample_2) &gt; 0: 
 
... </span><span class="kobospan" id="kobo.1560.7">        name, value = sample_2, None 
 
... </span><span class="kobospan" id="kobo.1560.8">    else: 
 
... </span><span class="kobospan" id="kobo.1560.9">        name, value = None, None 
 
&gt;&gt;&gt; print(f"{name=!r} {value=!r}") 
 
name=’name_only’ value=None</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1561.1">Using an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1562.1">else</span></span></span></span><span class="kobospan" id="kobo.1563.1"> clause in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1564.1">for</span></span></span></span><span class="kobospan" id="kobo.1565.1"> statement is sometimes confusing, and we don’t recommend it. </span><span class="kobospan" id="kobo.1565.2">It’s not clear if this version is substantially better than any of the alternatives. </span><span class="kobospan" id="kobo.1565.3">It’s too easy to forget the reason why the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1566.1">else</span></span></span></span><span class="kobospan" id="kobo.1567.1"> is executed because it’s used so rarely. </span><span id="x1-133014r236"/></p>
</section>
<section data-number="0.5.7.5" id="see-also-16">
<h2 class="likechapterhead" data-number="0.5.7.5"><span><span class="kobospan" id="kobo.1568.1">2.7.5 </span></span> <span id="x1-1340005"/><span class="kobospan" id="kobo.1569.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1570.1">A classic article on this topic is by David Gries, </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1571.1">A note on a standard</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1572.1">strategy for developing loop invariants and loops</span></span><span class="kobospan" id="kobo.1573.1">. </span><span class="kobospan" id="kobo.1573.2">See </span><a class="url" href="http://www.sciencedirect.com/science/article/pii/0167642383900151"><span class="url1"><span class="kobospan" id="kobo.1574.1">http://www.sciencedirect.com/science/article/pii/0167642383900151</span></span></a></p></li>
</ul>
<p class="normal1"><span id="x1-134001r227"/></p>
</section>
</section>
<section data-number="0.5.8" id="leveraging-exception-matching-rules">
<h1 class="unnumbered" data-number="0.5.8"><span><span class="kobospan" id="kobo.1575.1">2.8 </span></span> <span id="x1-1350008"/><span class="kobospan" id="kobo.1576.1">Leveraging exception matching rules</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1577.1">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1578.1">try</span></span></span></span><span class="kobospan" id="kobo.1579.1"> statement lets us capture</span><span id="dx1-135001"/><span class="kobospan" id="kobo.1580.1"> an exception. </span><span class="kobospan" id="kobo.1580.2">When an exception</span><span id="dx1-135002"/><span class="kobospan" id="kobo.1581.1"> is raised, we have a number of choices for handling it:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1582.1">Ignore it</span></span><span class="kobospan" id="kobo.1583.1">: If we do nothing, the program stops. </span><span class="kobospan" id="kobo.1583.2">We can do this in two ways—don’t use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1584.1">try</span></span></span></span><span class="kobospan" id="kobo.1585.1"> statement in the first place, or don’t have a matching </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1586.1">except</span></span></span></span><span class="kobospan" id="kobo.1587.1"> clause in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1588.1">try</span></span></span></span><span class="kobospan" id="kobo.1589.1"> statement.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1590.1">Log it</span></span><span class="kobospan" id="kobo.1591.1">: We can write a message and use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1592.1">raise</span></span></span></span><span class="kobospan" id="kobo.1593.1"> statement to let the exception propagate after writing to a log. </span><span class="kobospan" id="kobo.1593.2">The expectation is that this will stop the program.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1594.1">Recover from it</span></span><span class="kobospan" id="kobo.1595.1">: We can write an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1596.1">except</span></span></span></span><span class="kobospan" id="kobo.1597.1"> clause to do some recovery action to undo any effects of the partially completed </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1598.1">try</span></span></span></span><span class="kobospan" id="kobo.1599.1"> clause.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1600.1">Silence it</span></span><span class="kobospan" id="kobo.1601.1">: If we do nothing (that is, use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1602.1">pass</span></span></span></span><span class="kobospan" id="kobo.1603.1"> statement), then processing is resumed after the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1604.1">try</span></span></span></span><span class="kobospan" id="kobo.1605.1"> statement. </span><span class="kobospan" id="kobo.1605.2">This silences the exception, but does not correct the underlying problem, or supply alternative results as a recovery attempt.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1606.1">Rewrite it</span></span><span class="kobospan" id="kobo.1607.1">: We can raise a different exception. </span><span class="kobospan" id="kobo.1607.2">The original exception becomes a context for the newly raised exception.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1608.1">What about nested contexts? </span><span class="kobospan" id="kobo.1608.2">In this case, an exception could be ignored by an inner </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1609.1">try</span></span></span></span><span class="kobospan" id="kobo.1610.1"> but handled by an outer context. </span><span class="kobospan" id="kobo.1610.2">The basic set of options for each </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1611.1">try</span></span></span></span><span class="kobospan" id="kobo.1612.1"> context is the same. </span><span class="kobospan" id="kobo.1612.2">The overall behavior of the software depends on the nested definitions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1613.1">The design of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1614.1">try</span></span></span></span><span class="kobospan" id="kobo.1615.1"> statement depends on the way that Python exceptions form a class hierarchy. </span><span class="kobospan" id="kobo.1615.2">For details, see the </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1616.1">Exception hierarchy </span></span><span class="kobospan" id="kobo.1617.1">section of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1618.1">Python</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1619.1">Standard Library</span></span><span class="kobospan" id="kobo.1620.1">. </span><span class="kobospan" id="kobo.1620.2">For example, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1621.1">ZeroDivisionError</span></span></span></span><span class="kobospan" id="kobo.1622.1"> exception is also an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1623.1">ArithmeticError</span></span></span></span><span class="kobospan" id="kobo.1624.1"> and an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1625.1">Exception</span></span></span></span><span class="kobospan" id="kobo.1626.1">. </span><span class="kobospan" id="kobo.1626.2">For another example, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1627.1">FileNotFoundError</span></span></span></span><span class="kobospan" id="kobo.1628.1"> exception is also an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1629.1">OSError</span></span></span></span><span class="kobospan" id="kobo.1630.1"> as well as an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1631.1">Exception</span></span></span></span><span class="kobospan" id="kobo.1632.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1633.1">This hierarchy can lead to confusion if we’re trying to handle detailed exceptions as well as generic exceptions. </span><span id="x1-135003r238"/></p>
<section data-number="0.5.8.1" id="getting-ready-17">
<h2 class="likechapterhead" data-number="0.5.8.1"><span><span class="kobospan" id="kobo.1634.1">2.8.1 </span></span> <span id="x1-1360001"/><span class="kobospan" id="kobo.1635.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1636.1">Let’s say we’re going to make</span><span id="dx1-136001"/><span class="kobospan" id="kobo.1637.1"> use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1638.1">shutil</span></span></span></span><span class="kobospan" id="kobo.1639.1"> module to copy a file from one place to another. </span><span class="kobospan" id="kobo.1639.2">Most of the exceptions that might be raised indicate a problem too serious to work around. </span><span class="kobospan" id="kobo.1639.3">However, in the specific event of a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1640.1">FileNotFoundError</span></span></span></span><span class="kobospan" id="kobo.1641.1"> exception, we’d like to attempt a recovery action.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1642.1">Here’s a rough outline of what we’d like to do:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1643.1">&gt;&gt;&gt; from pathlib import Path 
 
&gt;&gt;&gt; import shutil 
 
 
 
&gt;&gt;&gt; source_dir = Path.cwd()/"data" 
 
&gt;&gt;&gt; target_dir = Path.cwd()/"backup" 
 
&gt;&gt;&gt; for source_path in source_dir.glob(’**/*.csv’): 
 
... </span><span class="kobospan" id="kobo.1643.2">    source_name = source_path.relative_to(source_dir) 
 
... </span><span class="kobospan" id="kobo.1643.3">    target_path = target_dir / source_name 
 
... </span><span class="kobospan" id="kobo.1643.4">    shutil.copy(source_path, target_path)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1644.1">We have two directory paths, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1645.1">source_dir</span></span></span></span><span class="kobospan" id="kobo.1646.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1647.1">target_dir</span></span></span></span><span class="kobospan" id="kobo.1648.1">. </span><span class="kobospan" id="kobo.1648.2">We’ve used the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1649.1">glob()</span></span></span></span><span class="kobospan" id="kobo.1650.1"> method to locate all of the files under </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1651.1">source_dir</span></span></span></span><span class="kobospan" id="kobo.1652.1"> that have </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1653.1">*.csv</span></span></span></span><span class="kobospan" id="kobo.1654.1"> files.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1655.1">The expression </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1656.1">source_path.relative_to(source_dir)</span></span></span></span><span class="kobospan" id="kobo.1657.1"> gives us the tail end of the filename, the portion after the directory. </span><span class="kobospan" id="kobo.1657.2">We use this to build a new, similar path under the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1658.1">target_dir</span></span></span></span><span class="kobospan" id="kobo.1659.1"> directory. </span><span class="kobospan" id="kobo.1659.2">This assures that a file named </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1660.1">wc1.csv</span></span></span></span><span class="kobospan" id="kobo.1661.1"> in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1662.1">source_dir</span></span></span></span><span class="kobospan" id="kobo.1663.1"> directory will have a similar name in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1664.1">target_dir</span></span></span></span><span class="kobospan" id="kobo.1665.1"> directory.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1666.1">The problems arise with handling exceptions raised by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1667.1">shutil.copy()</span></span></span></span><span class="kobospan" id="kobo.1668.1"> function. </span><span class="kobospan" id="kobo.1668.2">We need a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1669.1">try</span></span></span></span><span class="kobospan" id="kobo.1670.1"> statement so that we can recover from certain kinds of errors. </span><span class="kobospan" id="kobo.1670.2">We’ll see this kind of error if we try to run this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1671.1">Traceback (most recent call last): 
 
... 
 
FileNotFoundError: [Errno 2] No such file or directory: ...</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1672.1">(We’ve replaced some details with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1673.1">...</span></span></span></span><span class="kobospan" id="kobo.1674.1"> because they’ll be different on your computer.)</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1675.1">This exception is raised when the backup directory hasn’t been created. </span><span class="kobospan" id="kobo.1675.2">It will also happen when there are subdirectories inside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1676.1">source_dir</span></span></span></span><span class="kobospan" id="kobo.1677.1"> directory tree that don’t also exist in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1678.1">target_dir</span></span></span></span><span class="kobospan" id="kobo.1679.1"> tree. </span><span class="kobospan" id="kobo.1679.2">How do we create a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1680.1">try</span></span></span></span><span class="kobospan" id="kobo.1681.1"> statement that handles these exceptions and creates the missing directories? </span><span id="x1-136016r240"/></p>
</section>
<section data-number="0.5.8.2" id="how-to-do-it...-17">
<h2 class="likechapterhead" data-number="0.5.8.2"><span><span class="kobospan" id="kobo.1682.1">2.8.2 </span></span> <span id="x1-1370002"/><span class="kobospan" id="kobo.1683.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-137002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1684.1">Write the code we want to use indented</span><span id="dx1-137003"/><span class="kobospan" id="kobo.1685.1"> in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1686.1">try</span></span></span></span><span class="kobospan" id="kobo.1687.1"> block:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1688.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1688.2">    shutil.copy(source_path, target_path)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-137008x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1689.1">Include the most specific exception classes first in an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1690.1">except</span></span></span></span><span class="kobospan" id="kobo.1691.1"> clause. </span><span class="kobospan" id="kobo.1691.2">In this case, we have a meaningful response to the specific </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1692.1">FileNotFoundError</span></span></span></span><span class="kobospan" id="kobo.1693.1"> exception.</span></p>
</div></li>
<li class="calibre7"><div id="x1-137010x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1694.1">Include any more general exceptions later. </span><span class="kobospan" id="kobo.1694.2">In this case, we’ll report any generic </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1695.1">OSError</span></span></span></span><span class="kobospan" id="kobo.1696.1"> exception that’s encountered. </span><span class="kobospan" id="kobo.1696.2">This leads to the following:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1697.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1697.2">    target = shutil.copy(source_path, target_path) 
 
... </span><span class="kobospan" id="kobo.1697.3">except FileNotFoundError: 
 
... </span><span class="kobospan" id="kobo.1697.4">    target_path.parent.mkdir(exist_ok=True, parents=True) 
 
... </span><span class="kobospan" id="kobo.1697.5">    target = shutil.copy(source_path, target_path) 
 
... </span><span class="kobospan" id="kobo.1697.6">except OSError as ex: 
 
... </span><span class="kobospan" id="kobo.1697.7">    print(f"Copy {source_path} to {target_path} error {ex}")</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1698.1">We’ve matched exceptions with the most specific first and the more generic after that.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1699.1">We handled the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1700.1">FileNotFoundError</span></span></span></span><span class="kobospan" id="kobo.1701.1"> exception by creating the missing directories. </span><span class="kobospan" id="kobo.1701.2">Then we tried the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1702.1">copy()</span></span></span></span><span class="kobospan" id="kobo.1703.1"> again, knowing it would now work properly.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1704.1">We logged any other exceptions of the class </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1705.1">OSError</span></span></span></span><span class="kobospan" id="kobo.1706.1">. </span><span class="kobospan" id="kobo.1706.2">For example, if there’s a permission problem, that error will be written to a log and the next file will be tried. </span><span class="kobospan" id="kobo.1706.3">Our objective is to try and copy all of the files. </span><span class="kobospan" id="kobo.1706.4">Any files that cause problems will be logged, but the overall copying process will continue.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1707.1">And, yes, the line of code to copy the files is repeated in two distinct contexts. </span><span class="kobospan" id="kobo.1707.2">The first repetition is when there has been no error. </span><span class="kobospan" id="kobo.1707.3">The second is after attempted recovery from the initial error. </span><span class="kobospan" id="kobo.1707.4">To an extent, this</span><span id="dx1-137019"/><span class="kobospan" id="kobo.1708.1"> feels like breaking the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1709.1">Don’t Repeat Yourself </span></span><span class="kobospan" id="kobo.1710.1">principle. </span><span class="kobospan" id="kobo.1710.2">Let’s look at the alternative, which doesn’t seem as good.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1711.1">To meet the </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1712.1">DRY </span></span><span class="kobospan" id="kobo.1713.1">standard, we could try to nest this operation in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1714.1">for</span></span></span></span><span class="kobospan" id="kobo.1715.1"> statement. </span><span class="kobospan" id="kobo.1715.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1716.1">break</span></span></span></span><span class="kobospan" id="kobo.1717.1"> statement is used if things work, otherwise, multiple attempts can be made. </span><span class="kobospan" id="kobo.1717.2">The extra complication of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1718.1">for</span></span></span></span><span class="kobospan" id="kobo.1719.1"> statement seems to be worse than the repetition.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1720.1">A common compromise is to write a one-line function that reduces the repetition to the name of the function. </span><span class="kobospan" id="kobo.1720.2">This has the advantage of making it possible to change to another of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1721.1">shutil</span></span></span></span><span class="kobospan" id="kobo.1722.1"> copy functions in one place. </span><span id="x1-137020r243"/></p>
</section>
<section data-number="0.5.8.3" id="how-it-works...-17">
<h2 class="likechapterhead" data-number="0.5.8.3"><span><span class="kobospan" id="kobo.1723.1">2.8.3 </span></span> <span id="x1-1380003"/><span class="kobospan" id="kobo.1724.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1725.1">Python’s matching rules</span><span id="dx1-138001"/><span class="kobospan" id="kobo.1726.1"> for exceptions are intended to be simple:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1727.1">Process </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1728.1">except</span></span></span></span><span class="kobospan" id="kobo.1729.1"> clauses in order.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1730.1">Match the actual exception against the exception class (or tuple of exception classes). </span><span class="kobospan" id="kobo.1730.2">A match means that the actual exception object (or any of the base classes of the exception object) is of the given class in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1731.1">except</span></span></span></span><span class="kobospan" id="kobo.1732.1"> clause.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1733.1">These rules show why we put the most specific exception classes first and the more general exception classes last. </span><span class="kobospan" id="kobo.1733.2">A generic exception class like </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1734.1">Exception</span></span></span></span><span class="kobospan" id="kobo.1735.1"> will match almost every kind of exception. </span><span class="kobospan" id="kobo.1735.2">We don’t want this first, because no other clauses will be checked.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1736.1">There’s an even more generic class, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1737.1">BaseException</span></span></span></span><span class="kobospan" id="kobo.1738.1"> class. </span><span class="kobospan" id="kobo.1738.2">There’s no good reason to ever handle exceptions of this class. </span><span class="kobospan" id="kobo.1738.3">If we do, we will be catching </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1739.1">SystemExit</span></span></span></span><span class="kobospan" id="kobo.1740.1"> and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1741.1">KeyboardInterrupt</span></span></span></span><span class="kobospan" id="kobo.1742.1"> exceptions; this interferes with the ability to kill a misbehaving application. </span><span class="kobospan" id="kobo.1742.2">We only use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1743.1">BaseException</span></span></span></span><span class="kobospan" id="kobo.1744.1"> class as a superclass when defining new exception classes that exist outside the normal exception hierarchy. </span><span id="x1-138002r246"/></p>
</section>
<section data-number="0.5.8.4" id="theres-more...-12">
<h2 class="likechapterhead" data-number="0.5.8.4"><span><span class="kobospan" id="kobo.1745.1">2.8.4 </span></span> <span id="x1-1390004"/><span class="kobospan" id="kobo.1746.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1747.1">Our example includes a nested context in which a second exception can be raised. </span><span class="kobospan" id="kobo.1747.2">Consider this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1748.1">except</span></span></span></span><span class="kobospan" id="kobo.1749.1"> clause snippet (taken out of context):</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1750.1">... </span><span class="kobospan" id="kobo.1750.2">except FileNotFoundError: 
 
... </span><span class="kobospan" id="kobo.1750.3">    target_path.parent.mkdir(exist_ok=True, parents=True) 
 
... </span><span class="kobospan" id="kobo.1750.4">    target = shutil.copy(source_path, target_path)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1751.1">If the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1752.1">mkdir()</span></span></span></span><span class="kobospan" id="kobo.1753.1"> method or </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1754.1">shutil.copy()</span></span></span></span><span class="kobospan" id="kobo.1755.1"> functions actually raise exceptions while handling the original </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1756.1">FileNotFoundError</span></span></span></span><span class="kobospan" id="kobo.1757.1"> exception, it won’t be handled. </span><span class="kobospan" id="kobo.1757.2">Any exceptions raised within an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1758.1">except</span></span></span></span><span class="kobospan" id="kobo.1759.1"> clause can crash the program as a whole. </span><span class="kobospan" id="kobo.1759.2">Handling these nested exceptions can involve nested </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1760.1">try</span></span></span></span><span class="kobospan" id="kobo.1761.1"> statements.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1762.1">We can rewrite the exception clause to include a nested</span><span id="dx1-139005"/> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1763.1">try</span></span></span></span><span class="kobospan" id="kobo.1764.1"> during recovery:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1765.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1765.2">    target = shutil.copy(source_path, target_path ) 
 
... </span><span class="kobospan" id="kobo.1765.3">except FileNotFoundError: 
 
... </span><span class="kobospan" id="kobo.1765.4">    try: 
 
... </span><span class="kobospan" id="kobo.1765.5">        target_path.parent.mkdir(exist_ok=True, parents=True) 
 
... </span><span class="kobospan" id="kobo.1765.6">        target = shutil.copy(source_path, target_path) 
 
... </span><span class="kobospan" id="kobo.1765.7">    except OSError as ex2: 
 
... </span><span class="kobospan" id="kobo.1765.8">        print(f"{target_path.parent} problem: {ex2}") 
 
... </span><span class="kobospan" id="kobo.1765.9">except OSError as ex: 
 
... </span><span class="kobospan" id="kobo.1765.10">    print(f"Copy {source_path} to {target_path} error {ex}")</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1766.1">In this example, a nested context writes one message for an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1767.1">OSError</span></span></span></span><span class="kobospan" id="kobo.1768.1"> exception. </span><span class="kobospan" id="kobo.1768.2">In the outer context, a slightly different error message is used to log a similar error. </span><span class="kobospan" id="kobo.1768.3">In both cases, processing can continue. </span><span class="kobospan" id="kobo.1768.4">The distinct error messages can make it slightly easier to debug the problems. </span><span id="x1-139017r247"/></p>
</section>
<section data-number="0.5.8.5" id="see-also-17">
<h2 class="likechapterhead" data-number="0.5.8.5"><span><span class="kobospan" id="kobo.1769.1">2.8.5 </span></span> <span id="x1-1400005"/><span class="kobospan" id="kobo.1770.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1771.1">In the </span><a href="ch006_split_001.xhtml#x1-1410009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1772.1">Avoiding a potential problem with an except: clause</span></span></a><span class="kobospan" id="kobo.1773.1"> recipe, we look at some additional considerations when designing exception handling statements.</span></p></li>
</ul>
<p class="normal1"><span id="x1-140001r239"/></p>
</section>
</section>
<section data-number="0.5.9" id="avoiding-a-potential-problem-with-an-except-clause">
<h1 class="unnumbered" data-number="0.5.9"><span><span class="kobospan" id="kobo.1774.1">2.9 </span></span> <span id="x1-1410009"/><span class="kobospan" id="kobo.1775.1">Avoiding a potential problem with an except: clause</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1776.1">There are some common mistakes</span><span id="dx1-141001"/><span class="kobospan" id="kobo.1777.1"> in exception handling. </span><span class="kobospan" id="kobo.1777.2">These can cause programs to become unresponsive.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1778.1">One of the mistakes we can make is to use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1779.1">except:</span></span></span></span><span class="kobospan" id="kobo.1780.1"> clause with no named exception class to match. </span><span class="kobospan" id="kobo.1780.2">There are a few other mistakes that we can make if we’re not cautious about the exceptions we try to handle.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1781.1">This recipe will show some common exception handling errors that we can avoid. </span><span id="x1-141002r250"/></p>
<section data-number="0.5.9.1" id="getting-ready-18">
<h2 class="likechapterhead" data-number="0.5.9.1"><span><span class="kobospan" id="kobo.1782.1">2.9.1 </span></span> <span id="x1-1420001"/><span class="kobospan" id="kobo.1783.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1784.1">When code can raise a variety of exceptions, it’s sometimes tempting to try and match as many as possible. </span><span class="kobospan" id="kobo.1784.2">Matching too many exception classes can interfere with stopping a misbehaving Python program. </span><span class="kobospan" id="kobo.1784.3">We’ll extend the idea of </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1785.1">what not</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.1786.1">to do </span></span><span class="kobospan" id="kobo.1787.1">in this recipe. </span><span id="x1-142001r252"/></p>
</section>
<section data-number="0.5.9.2" id="how-to-do-it...-18">
<h2 class="likechapterhead" data-number="0.5.9.2"><span><span class="kobospan" id="kobo.1788.1">2.9.2 </span></span> <span id="x1-1430002"/><span class="kobospan" id="kobo.1789.1">How to do it...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1790.1">We need to avoid using the bare </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1791.1">except:</span></span></span></span><span class="kobospan" id="kobo.1792.1"> clause. </span><span class="kobospan" id="kobo.1792.2">Instead, use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1793.1">except</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1794.1"> Exception:</span></span></span></span><span class="kobospan" id="kobo.1795.1"> to match the most general kind of exception that an application can reasonably handle.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1796.1">Handling too many exception classes can interfere with our ability to stop a misbehaving Python program. </span><span class="kobospan" id="kobo.1796.2">When we hit </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1797.1">Ctrl </span></span><span class="kobospan" id="kobo.1798.1">+ </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.1799.1">C</span></span><span class="kobospan" id="kobo.1800.1">, or send a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1801.1">SIGINT</span></span></span></span><span class="kobospan" id="kobo.1802.1"> signal via the OS’s </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1803.1">kill</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1804.1"> -2</span></span></span></span><span class="kobospan" id="kobo.1805.1"> command, we generally want the program to stop. </span><span class="kobospan" id="kobo.1805.2">We rarely want the program to write a message and keep running. </span><span class="kobospan" id="kobo.1805.3">If we use a bare </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1806.1">except:</span></span></span></span><span class="kobospan" id="kobo.1807.1"> clause, we can accidentally silence important exceptions.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1808.1">There are a few other classes of exceptions that we should be wary of attempting to handle:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1809.1">SystemError</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1810.1">RuntimeError</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1811.1">MemoryError</span></span></span></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1812.1">Generally, these exceptions mean things are going badly somewhere in Python’s internals. </span><span class="kobospan" id="kobo.1812.2">Rather than silence these exceptions, or attempt some recovery, we should allow the program to fail, find the root cause, and fix it.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1813.1">Further, if we capture any of these exceptions, we can interfere with the way these internal exceptions are handled:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1814.1">SystemExit</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1815.1">KeyboardInterrupt</span></span></span></span></p></li>
<li class="calibre7"><p class="normal2"><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1816.1">GeneratorExit</span></span></span></span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1817.1">Trying to handle these exceptions can cause a program to become unresponsive at exactly the time we need to stop it. </span><span id="x1-143001r253"/></p>
</section>
<section data-number="0.5.9.3" id="how-it-works...-18">
<h2 class="likechapterhead" data-number="0.5.9.3"><span><span class="kobospan" id="kobo.1818.1">2.9.3 </span></span> <span id="x1-1440003"/><span class="kobospan" id="kobo.1819.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1820.1">There are three techniques</span><span id="dx1-144001"/><span class="kobospan" id="kobo.1821.1"> we should avoid:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1822.1">Don’t match the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1823.1">BaseException</span></span></span></span><span class="kobospan" id="kobo.1824.1"> class in an </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1825.1">except</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1826.1"> BaseException:</span></span></span></span><span class="kobospan" id="kobo.1827.1"> clause.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1828.1">Don’t use </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1829.1">except:</span></span></span></span><span class="kobospan" id="kobo.1830.1"> with no exception class. </span><span class="kobospan" id="kobo.1830.2">This matches all exceptions, including exceptions we should avoid trying to handle.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1831.1">Don’t match exceptions from which there’s no sensible recovery.</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1832.1">If we handle too many kinds of exceptions, we may exacerbate a problem, transforming it into a larger and more mysterious problem by way of flawed exception handling.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1833.1">It’s a noble aspiration to write a program that never crashes. </span><span class="kobospan" id="kobo.1833.2">Interfering with some of Python’s internal exceptions, however, doesn’t create a more reliable program. </span><span class="kobospan" id="kobo.1833.3">Instead, it creates a program where a clear failure is masked and made into an obscure problem. </span><span id="x1-144002r254"/></p>
</section>
<section data-number="0.5.9.4" id="see-also-18">
<h2 class="likechapterhead" data-number="0.5.9.4"><span><span class="kobospan" id="kobo.1834.1">2.9.4 </span></span> <span id="x1-1450004"/><span class="kobospan" id="kobo.1835.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1836.1">In the </span><a href="ch006_split_001.xhtml#x1-1350008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1837.1">Leveraging exception matching rules</span></span></a><span class="kobospan" id="kobo.1838.1"> recipe, we look at some considerations when designing exception-handling statements.</span></p></li>
</ul>
<p class="normal1"><span id="x1-145001r251"/></p>
</section>
</section>
<section data-number="0.5.10" id="concealing-an-exception-root-cause">
<h1 class="unnumbered" data-number="0.5.10"><span><span class="kobospan" id="kobo.1839.1">2.10 </span></span> <span id="x1-14600010"/><span class="kobospan" id="kobo.1840.1">Concealing an exception root cause</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1841.1">Exceptions contain a root cause. </span><span class="kobospan" id="kobo.1841.2">The default behavior</span><span id="dx1-146001"/><span class="kobospan" id="kobo.1842.1"> of internally raised exceptions is to use an implicit </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1843.1">__context__</span></span></span></span><span class="kobospan" id="kobo.1844.1"> attribute to include the root cause of an exception. </span><span class="kobospan" id="kobo.1844.2">In some cases, we may want to deemphasize</span><span id="dx1-146002"/><span class="kobospan" id="kobo.1845.1"> the root cause because it’s misleading or unhelpful for debugging.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1846.1">This technique is almost always paired with an application or library that defines a unique exception. </span><span class="kobospan" id="kobo.1846.2">The idea is to show the unique exception without the clutter of an irrelevant exception from outside the application or library. </span><span id="x1-146003r255"/></p>
<section data-number="0.5.10.1" id="getting-ready-19">
<h2 class="likechapterhead" data-number="0.5.10.1"><span><span class="kobospan" id="kobo.1847.1">2.10.1 </span></span> <span id="x1-1470001"/><span class="kobospan" id="kobo.1848.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1849.1">Assume we’re writing some complex string processing. </span><span class="kobospan" id="kobo.1849.2">We’d like to treat a number of different kinds of detailed exceptions as a single generic error so that users of our software are insulated from the implementation details. </span><span class="kobospan" id="kobo.1849.3">We can attach details to the generic error. </span><span id="x1-147001r257"/></p>
</section>
<section data-number="0.5.10.2" id="how-to-do-it...-19">
<h2 class="likechapterhead" data-number="0.5.10.2"><span><span class="kobospan" id="kobo.1850.1">2.10.2 </span></span> <span id="x1-1480002"/><span class="kobospan" id="kobo.1851.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-148002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1852.1">To create a new exception, we can do this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1853.1">&gt;&gt;&gt; class MyAppError(Exception): 
 
... </span><span class="kobospan" id="kobo.1853.2">    pass</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1854.1">This creates a new, unique class of exception that our library or application can use.</span></p>
</div></li>
<li class="calibre7"><div id="x1-148007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1855.1">When handling exceptions, we can conceal the root cause exception like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1856.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1856.2">    None.some_method(42)  # Raises an exception 
 
... </span><span class="kobospan" id="kobo.1856.3">except AttributeError as exception: 
 
... </span><span class="kobospan" id="kobo.1856.4">    raise MyAppError("Some Known Problem") from None</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1857.1">In this example, we raise a new instance of the module’s unique </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1858.1">MyAppError</span></span></span></span><span class="kobospan" id="kobo.1859.1"> exception class. </span><span class="kobospan" id="kobo.1859.2">The new exception will not have any connection with the root cause </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1860.1">AttributeError</span></span></span></span><span class="kobospan" id="kobo.1861.1"> exception. </span><span id="x1-148013r258"/></p>
</section>
<section data-number="0.5.10.3" id="how-it-works...-19">
<h2 class="likechapterhead" data-number="0.5.10.3"><span><span class="kobospan" id="kobo.1862.1">2.10.3 </span></span> <span id="x1-1490003"/><span class="kobospan" id="kobo.1863.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1864.1">The Python exception classes</span><span id="dx1-149001"/><span class="kobospan" id="kobo.1865.1"> all have a place to record the cause of the exception. </span><span class="kobospan" id="kobo.1865.2">We can set this </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1866.1">__cause__</span></span></span></span><span class="kobospan" id="kobo.1867.1"> attribute using the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1868.1">raise</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1869.1"> Visible</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1870.1"> from</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1871.1"> RootCause</span></span></span></span><span class="kobospan" id="kobo.1872.1"> statement. </span><span class="kobospan" id="kobo.1872.2">This is done implicitly using the exception context.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1873.1">Here’s how it looks when this exception is raised:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1874.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1874.2">    None.some_method(42) 
 
... </span><span class="kobospan" id="kobo.1874.3">except AttributeError as exception: 
 
... </span><span class="kobospan" id="kobo.1874.4">    raise MyAppError("Some Known Problem") from None 
 
Traceback (most recent call last): 
 
... 
 
MyAppError: Some Known Problem</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1875.1">The underlying cause has been concealed. </span><span class="kobospan" id="kobo.1875.2">If we omit the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1876.1">from</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1877.1"> None</span></span></span></span><span class="kobospan" id="kobo.1878.1"> in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1879.1">raise</span></span></span></span><span class="kobospan" id="kobo.1880.1"> statement, then the exception will include two parts and will be quite a bit more complex. </span><span class="kobospan" id="kobo.1880.2">When the root cause is shown, the output looks more like this:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1881.1">Traceback (most recent call last): 
 
  File "&lt;doctest recipe_09.txt[3]&gt;", line 2, in &lt;module&gt; 
 
    None.some_method(42) 
 
    ^^^^^^^^^^^^^^^^ 
 
AttributeError: ’NoneType’ object has no attribute ’some_method’ 
 
 
 
During handling of the above exception, another exception occurred: 
 
 
 
Traceback (most recent call last): 
 
  File ... 
 
    exec... 
 
  File ... 
 
    raise... 
 
MyAppError: Some Known Problem</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1882.1">This shows the underlying </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1883.1">AttributeError</span></span></span></span><span class="kobospan" id="kobo.1884.1"> exception. </span><span class="kobospan" id="kobo.1884.2">This may be an implementation detail that’s unhelpful and better left off the printed display of the exception.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1885.1">The more useful part of the exception (with some details replaced by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1886.1">...</span></span></span></span><span class="kobospan" id="kobo.1887.1">) follows the initial (and possibly irrelevant) root cause</span><span id="dx1-149025"/><span class="kobospan" id="kobo.1888.1"> information. </span><span id="x1-149026r261"/></p>
</section>
<section data-number="0.5.10.4" id="theres-more...-13">
<h2 class="likechapterhead" data-number="0.5.10.4"><span><span class="kobospan" id="kobo.1889.1">2.10.4 </span></span> <span id="x1-1500004"/><span class="kobospan" id="kobo.1890.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1891.1">There are a number of internal attributes</span><span id="dx1-150001"/><span class="kobospan" id="kobo.1892.1"> of an exception. </span><span class="kobospan" id="kobo.1892.2">These include </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1893.1">__cause__</span></span></span></span><span class="kobospan" id="kobo.1894.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1895.1">__context__</span></span></span></span><span class="kobospan" id="kobo.1896.1">, </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1897.1">__traceback__</span></span></span></span><span class="kobospan" id="kobo.1898.1">, and </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1899.1">__suppress_context__</span></span></span></span><span class="kobospan" id="kobo.1900.1">. </span><span class="kobospan" id="kobo.1900.2">The overall exception context is in the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1901.1">__context__</span></span></span></span><span class="kobospan" id="kobo.1902.1"> attribute. </span><span class="kobospan" id="kobo.1902.2">The cause, if provided via a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1903.1">raise</span></span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1904.1"> from</span></span></span></span><span class="kobospan" id="kobo.1905.1"> statement, is in </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1906.1">__cause__</span></span></span></span><span class="kobospan" id="kobo.1907.1">. </span><span class="kobospan" id="kobo.1907.2">The context for the exception is available but can be suppressed from being printed. </span><span id="x1-150002r264"/></p>
</section>
<section data-number="0.5.10.5" id="see-also-19">
<h2 class="likechapterhead" data-number="0.5.10.5"><span><span class="kobospan" id="kobo.1908.1">2.10.5 </span></span> <span id="x1-1510005"/><span class="kobospan" id="kobo.1909.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1910.1">In the </span><a href="ch006_split_001.xhtml#x1-1350008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1911.1">Leveraging exception matching rules</span></span></a><span class="kobospan" id="kobo.1912.1"> recipe, we look at some considerations when designing exception-handling statements.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1913.1">In the </span><a href="ch006_split_001.xhtml#x1-1410009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.1914.1">Avoiding a potential problem with an except: clause</span></span></a><span class="kobospan" id="kobo.1915.1"> recipe, we look at some additional considerations when designing exception-handling statements.</span></p></li>
</ul>
<p class="normal1"><span id="x1-151001r256"/></p>
</section>
</section>
<section data-number="0.5.11" id="managing-a-context-using-the-with-statement">
<h1 class="unnumbered" data-number="0.5.11"><span><span class="kobospan" id="kobo.1916.1">2.11 </span></span> <span id="x1-15200011"/><span class="kobospan" id="kobo.1917.1">Managing a context using the with statement</span></h1>
<p class="normal"><span class="kobospan" id="kobo.1918.1">There are many instances</span><span id="dx1-152001"/><span class="kobospan" id="kobo.1919.1"> where our scripts</span><span id="dx1-152002"/><span class="kobospan" id="kobo.1920.1"> will be entangled with external resources. </span><span class="kobospan" id="kobo.1920.2">The most common examples are disk files and network connections to external hosts. </span><span class="kobospan" id="kobo.1920.3">A common bug is retaining these entanglements forever, tying up these resources uselessly. </span><span class="kobospan" id="kobo.1920.4">These are sometimes</span><span id="dx1-152003"/><span class="kobospan" id="kobo.1921.1"> called a memory </span><span class="cmbx-10x-x"><span class="kobospan" id="kobo.1922.1">leak </span></span><span class="kobospan" id="kobo.1923.1">because the available memory is reduced each time a new file is opened without closing a previously used file.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1924.1">We’d like to isolate each entanglement so that we can be sure that the resource is acquired and released properly. </span><span class="kobospan" id="kobo.1924.2">The idea is to create a context in which our script uses an external resource. </span><span class="kobospan" id="kobo.1924.3">At the end of the context, our program is no longer bound to the resource and we want to be guaranteed that the resource is released. </span><span id="x1-152004r265"/></p>
<section data-number="0.5.11.1" id="getting-ready-20">
<h2 class="likechapterhead" data-number="0.5.11.1"><span><span class="kobospan" id="kobo.1925.1">2.11.1 </span></span> <span id="x1-1530001"/><span class="kobospan" id="kobo.1926.1">Getting ready</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1927.1">Let’s say we want to write lines of data to a file in CSV format. </span><span class="kobospan" id="kobo.1927.2">When we’re done, we want to be sure that the file is closed and the various OS resources—including buffers and file handles—are released. </span><span class="kobospan" id="kobo.1927.3">We can do this in a context manager, which guarantees that the file will be properly closed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1928.1">Since we’ll be working with CSV files, we can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1929.1">csv</span></span></span></span><span class="kobospan" id="kobo.1930.1"> module to handle the details of the formatting:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1931.1">&gt;&gt;&gt; import csv</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1932.1">We’ll also use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1933.1">pathlib</span></span></span></span><span class="kobospan" id="kobo.1934.1"> module to locate the files we’ll be working with:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1935.1">&gt;&gt;&gt; from pathlib import Path</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1936.1">For the purposes of having something to write, we’ll use this silly data source:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1937.1">&gt;&gt;&gt; some_source = [ 
 
... </span><span class="kobospan" id="kobo.1937.2">    [2,3,5], 
 
... </span><span class="kobospan" id="kobo.1937.3">    [7,11,13], 
 
... </span><span class="kobospan" id="kobo.1937.4">    [17,19,23]]</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1938.1">We’ll also need a working</span><span id="dx1-153010"/><span class="kobospan" id="kobo.1939.1"> directory. </span><span class="kobospan" id="kobo.1939.2">In the examples, we’re using</span><span id="dx1-153011"/> <span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1940.1">data</span></span></span></span><span class="kobospan" id="kobo.1941.1"> under the current working directory. </span><span class="kobospan" id="kobo.1941.2">We can create this directory using a terminal window command, or we can create it from within Python:</span></p>
<div class="tipbox" id="tcolobox-7">
<span id="x1-153013x1"/>
<div class="note">
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1942.1"> 
 
&gt;&gt;&gt; Path.cwd().mkdir("data", exists=ok=True)</span></code></pre>
</div>
</div>
<p class="normal1"><span class="kobospan" id="kobo.1943.1">This will give us a context in which to learn about the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1944.1">with</span></span></span></span><span class="kobospan" id="kobo.1945.1"> statement. </span><span id="x1-153014r267"/></p>
</section>
<section data-number="0.5.11.2" id="how-to-do-it...-20">
<h2 class="likechapterhead" data-number="0.5.11.2"><span><span class="kobospan" id="kobo.1946.1">2.11.2 </span></span> <span id="x1-1540002"/><span class="kobospan" id="kobo.1947.1">How to do it...</span></h2>
<ol class="calibre2">
<li class="calibre7"><div id="x1-154002x1" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1948.1">Create the context by opening the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1949.1">Path</span></span></span></span><span class="kobospan" id="kobo.1950.1">, or creating the network connection with </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1951.1">urllib.request.urlopen()</span></span></span></span><span class="kobospan" id="kobo.1952.1">. </span><span class="kobospan" id="kobo.1952.2">Other common contexts include creating archives like zip files and tar files. </span><span class="kobospan" id="kobo.1952.3">Here’s the essential context creation for an open file:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1953.1">&gt;&gt;&gt; target_path = Path.cwd() / "data" / "test.csv" 
 
&gt;&gt;&gt; with target_path.open(’w’, newline=’’) as target_file:</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-154007x2" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1954.1">Include all the processing, indented within the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1955.1">with</span></span></span></span><span class="kobospan" id="kobo.1956.1"> statement:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1957.1">&gt;&gt;&gt; target_path = Path.cwd() / "data" / "test.csv" 
 
&gt;&gt;&gt; with target_path.open(’w’, newline=’’) as target_file: 
 
... </span><span class="kobospan" id="kobo.1957.2">    writer = csv.writer(target_file) 
 
... </span><span class="kobospan" id="kobo.1957.3">    writer.writerow([’column’, ’data’, ’heading’]) 
 
... </span><span class="kobospan" id="kobo.1957.4">    writer.writerows(some_source)</span></code></pre>
</div></li>
<li class="calibre7"><div id="x1-154015x3" class="calibre14">
<p class="normal2"><span class="kobospan" id="kobo.1958.1">When we use a file as a context manager, the file is automatically closed at the end of the indented context block. </span><span class="kobospan" id="kobo.1958.2">Even if an exception is raised, the file is still closed properly. </span><span class="kobospan" id="kobo.1958.3">Outdent the processing that is done after the context is finished and the resources are released:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1959.1">&gt;&gt;&gt; target_path = Path.cwd() / "data" / "test.csv" 
 
&gt;&gt;&gt; with target_path.open(’w’, newline=’’) as target_file: 
 
... </span><span class="kobospan" id="kobo.1959.2">    writer = csv.writer(target_file) 
 
... </span><span class="kobospan" id="kobo.1959.3">    _ = writer.writerow([’column’, ’data’, ’heading’]) 
 
... </span><span class="kobospan" id="kobo.1959.4">    writer.writerows(some_source) 
 
&gt;&gt;&gt; print(f’finished writing {target_path.name}’) 
 
finished writing test.csv</span></code></pre>
</div></li>
</ol>
<p class="normal1"><span class="kobospan" id="kobo.1960.1">The statements outside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1961.1">with</span></span></span></span><span class="kobospan" id="kobo.1962.1"> context will be executed after the context is closed. </span><span class="kobospan" id="kobo.1962.2">The named resource — the file opened by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1963.1">target_path.open()</span></span></span></span><span class="kobospan" id="kobo.1964.1"> — will be properly closed.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1965.1">(We assign the result of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1966.1">writerow()</span></span></span></span><span class="kobospan" id="kobo.1967.1"> method of a writer to the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1968.1">_</span></span></span></span><span class="kobospan" id="kobo.1969.1"> variable. </span><span class="kobospan" id="kobo.1969.2">This is a trick required to avoid showing this result. </span><span class="kobospan" id="kobo.1969.3">It’s the number </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1970.1">21</span></span></span></span><span class="kobospan" id="kobo.1971.1">, telling us how many characters were written.)</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1972.1">Even if an exception</span><span id="dx1-154024"/><span class="kobospan" id="kobo.1973.1"> is raised</span><span id="dx1-154025"/><span class="kobospan" id="kobo.1974.1"> inside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1975.1">with</span></span></span></span><span class="kobospan" id="kobo.1976.1"> context, the file is still properly closed. </span><span class="kobospan" id="kobo.1976.2">The context manager is notified of the exception. </span><span class="kobospan" id="kobo.1976.3">It can close the file and allow the exception to propagate. </span><span id="x1-154026r271"/></p>
</section>
<section data-number="0.5.11.3" id="how-it-works...-20">
<h2 class="likechapterhead" data-number="0.5.11.3"><span><span class="kobospan" id="kobo.1977.1">2.11.3 </span></span> <span id="x1-1550003"/><span class="kobospan" id="kobo.1978.1">How it works...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.1979.1">A context manager is notified of three significant events surrounding the indented block of code:</span></p>
<ul class="calibre11">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.1980.1">Entry to the context</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1981.1">Normal exit from the context with no exception</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.1982.1">Exit from the context because of an exception</span></p></li>
</ul>
<p class="normal1"><span class="kobospan" id="kobo.1983.1">The context manager will—under all conditions—disentangle our program from external resources. </span><span class="kobospan" id="kobo.1983.2">Files can be closed. </span><span class="kobospan" id="kobo.1983.3">Network connections can be dropped. </span><span class="kobospan" id="kobo.1983.4">Database transactions can be committed or rolled back. </span><span class="kobospan" id="kobo.1983.5">Locks can be released.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1984.1">We can experiment with this by including</span><span id="dx1-155001"/><span class="kobospan" id="kobo.1985.1"> a manual exception</span><span id="dx1-155002"/><span class="kobospan" id="kobo.1986.1"> inside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1987.1">with</span></span></span></span><span class="kobospan" id="kobo.1988.1"> statement. </span><span class="kobospan" id="kobo.1988.2">This can show that the file was properly closed:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1989.1">&gt;&gt;&gt; try: 
 
... </span><span class="kobospan" id="kobo.1989.2">    with target_path.open(’w’, newline=’’) as target_file: 
 
... </span><span class="kobospan" id="kobo.1989.3">        writer = csv.writer(target_file) 
 
... </span><span class="kobospan" id="kobo.1989.4">        _ = writer.writerow([’column’, ’data’, ’heading’]) 
 
... </span><span class="kobospan" id="kobo.1989.5">        _ = writer.writerow(some_source[0]) 
 
... </span><span class="kobospan" id="kobo.1989.6">        raise Exception("Testing") 
 
... </span><span class="kobospan" id="kobo.1989.7">except Exception as exc: 
 
... </span><span class="kobospan" id="kobo.1989.8">    print(f"{target_file.closed=}") 
 
... </span><span class="kobospan" id="kobo.1989.9">    print(f"{exc=}") 
 
target_file.closed=True 
 
exc=Exception(’Testing’) 
 
&gt;&gt;&gt; print(f"finished writing {target_path.name}") 
 
finished writing test.csv</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1990.1">In this example, we’ve wrapped the real work in a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1991.1">try</span></span></span></span><span class="kobospan" id="kobo.1992.1"> statement. </span><span class="kobospan" id="kobo.1992.2">This allows us to raise an exception after writing the first line of data to the CSV file. </span><span class="kobospan" id="kobo.1992.3">Because the exception handling is outside the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1993.1">with</span></span></span></span><span class="kobospan" id="kobo.1994.1"> context, the file is closed properly. </span><span class="kobospan" id="kobo.1994.2">All resources are released and the part that was written is properly accessible and usable by other programs.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1995.1">The output confirms the expected file state:</span></p>
<pre class="programlisting"><code class="calibre13"><span class="kobospan" id="kobo.1996.1">target_file.closed=True 
 
exc=Exception(’Testing’)</span></code></pre>
<p class="normal1"><span class="kobospan" id="kobo.1997.1">This shows us that the file was properly closed. </span><span class="kobospan" id="kobo.1997.2">It also shows us the message associated with the exception to confirm that it was the exception we raised manually. </span><span class="kobospan" id="kobo.1997.3">This kind of technique allows us to work with expensive resources like database connections and network connections and be sure these don’t ”leak.”</span></p>
<p class="normal1"><span class="kobospan" id="kobo.1998.1">Resource leak is a common description used when resources are not released properly back to the OS. </span><span class="kobospan" id="kobo.1998.2">It’s as if a pool is slowly drained away, and the application stops working because there are no more available OS network sockets or file handles. </span><span class="kobospan" id="kobo.1998.3">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.1999.1">with</span></span></span></span><span class="kobospan" id="kobo.2000.1"> statement can be used to properly disentangle</span><span id="dx1-155020"/><span class="kobospan" id="kobo.2001.1"> our Python application</span><span id="dx1-155021"/><span class="kobospan" id="kobo.2002.1"> from OS resources. </span><span id="x1-155022r275"/></p>
</section>
<section data-number="0.5.11.4" id="theres-more...-14">
<h2 class="likechapterhead" data-number="0.5.11.4"><span><span class="kobospan" id="kobo.2003.1">2.11.4 </span></span> <span id="x1-1560004"/><span class="kobospan" id="kobo.2004.1">There’s more...</span></h2>
<p class="normal"><span class="kobospan" id="kobo.2005.1">Python offers us a number of context managers. </span><span class="kobospan" id="kobo.2005.2">We noted that an open file is a context, as is an open network connection created by </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2006.1">urllib.request.urlopen()</span></span></span></span><span class="kobospan" id="kobo.2007.1">.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.2008.1">For all file operations, and all network connections, we should always use a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2009.1">with</span></span></span></span><span class="kobospan" id="kobo.2010.1"> statement as a context manager. </span><span class="kobospan" id="kobo.2010.2">It’s very difficult to find an exception to this rule.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.2011.1">It turns out that the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2012.1">decimal</span></span></span></span><span class="kobospan" id="kobo.2013.1"> module makes use of a context manager to allow localized changes to the way decimal arithmetic is performed. </span><span class="kobospan" id="kobo.2013.2">We can use the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2014.1">decimal.localcontext()</span></span></span></span><span class="kobospan" id="kobo.2015.1"> function as a context manager to change rounding rules or precision for calculations isolated by a </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2016.1">with</span></span></span></span><span class="kobospan" id="kobo.2017.1"> statement.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.2018.1">We can define our own context managers, also. </span><span class="kobospan" id="kobo.2018.2">The </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2019.1">contextlib</span></span></span></span><span class="kobospan" id="kobo.2020.1"> module contains functions and decorators that can help us create context managers around resources that don’t explicitly offer them.</span></p>
<p class="normal1"><span class="kobospan" id="kobo.2021.1">When working with locks, the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2022.1">with</span></span></span></span><span class="kobospan" id="kobo.2023.1"> statement</span><span id="dx1-156001"/><span class="kobospan" id="kobo.2024.1"> context manager is the ideal way to acquire and release a lock. </span><span class="kobospan" id="kobo.2024.2">See </span><a class="url" href="https://docs.python.org/3/library/threading.html#with-locks"><span class="url1"><span class="kobospan" id="kobo.2025.1">https://docs.python.org/3/library/threading.html#with-locks</span></span></a><span class="kobospan" id="kobo.2026.1"> for the relationship between a lock object created by the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2027.1">threading</span></span></span></span><span class="kobospan" id="kobo.2028.1"> module and a context manager. </span><span id="x1-156002r278"/></p>
</section>
<section data-number="0.5.11.5" id="see-also-20">
<h2 class="likechapterhead" data-number="0.5.11.5"><span><span class="kobospan" id="kobo.2029.1">2.11.5 </span></span> <span id="x1-1570005"/><span class="kobospan" id="kobo.2030.1">See also</span></h2>
<ul class="calibre16">
<li class="calibre12"><p class="normal2"><span class="kobospan" id="kobo.2031.1">See </span><a href="https://www.python.org/dev/peps/pep-0343/" class="url"><span class="kobospan" id="kobo.2032.1">PEP-343</span></a><span class="kobospan" id="kobo.2033.1"> for the origins of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2034.1">with</span></span></span></span><span class="kobospan" id="kobo.2035.1"> statement.</span></p></li>
<li class="calibre7"><p class="normal2"><span class="kobospan" id="kobo.2036.1">Numerous recipes in </span><span class="cmti-10x-x"><span class="kobospan" id="kobo.2037.1">Chapter</span></span><span class="cmti-10x-x"><span class="kobospan" id="kobo.2038.1"> </span></span><a href="ch013_split_000.xhtml#x1-5020009" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.2039.1">9</span></span></a><span class="kobospan" id="kobo.2040.1">, will make use of this technique. </span><span class="kobospan" id="kobo.2040.2">The recipes </span><a href="ch015_split_000.xhtml#x1-6320003" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.2041.1">Reading delimited files with the CSV module</span></span></a><span class="kobospan" id="kobo.2042.1">, </span><a href="ch015_split_001.xhtml#x1-6440005" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.2043.1">Reading complex</span></span> <span class="cmti-10x-x"><span class="kobospan" id="kobo.2044.1">formats using regular expressions</span></span></a><span class="kobospan" id="kobo.2045.1">, and </span><a href="ch015_split_001.xhtml#x1-6660008" class="url"><span class="cmti-10x-x"><span class="kobospan" id="kobo.2046.1">Reading HTML documents</span></span></a><span class="kobospan" id="kobo.2047.1">, among others, will make use of the </span><span class="obeylines-h"><span><span class="cmtt-10x-x"><span class="kobospan" id="kobo.2048.1">with</span></span></span></span><span class="kobospan" id="kobo.2049.1"> statement.</span></p></li>
</ul>
<p class="normal1"><span id="x1-157001r266"/></p>
</section>
</section>
<section data-number="0.5.14" id="join-our-community-discord-space-2">
<h1 class="unnumbered" data-number="0.5.14"><span id="x1-16000013"/><span class="kobospan" id="kobo.2050.1">Join our community Discord space</span></h1>
<p class="normal"><span class="kobospan" id="kobo.2051.1">Join our Python Discord workspace to discuss and find out more about the book: </span><a href="https://packt.link/dHrHU" class="url"><span class="url1"><span class="kobospan" id="kobo.2052.1">https://packt.link/dHrHU</span></span></a></p>
<p class="normal1"><span class="kobospan" id="kobo.2053.1"><img alt="PIC" src="../media/file1.png" class="calibre9"/></span> <span id="x1-160001r157"/></p>
</section>
</section>
</body></html>