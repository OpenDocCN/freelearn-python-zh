<html><head></head><body>
		<div id="_idContainer040">
			<h1 id="_idParaDest-117" class="chapter-number"><a id="_idTextAnchor118"/>4</h1>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor119"/>Application Models</h1>
			<p>This chapter will guide you through some small enhancements to an existing add-on module. You already registered your add-on module in the Odoo instance in <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>,<em class="italic"> Creating Odoo Add-On Modules</em>. Now, you will explore the database aspects of the module in more depth. You will learn how to create a new model (database table), add new fields, and apply constraints. You will also discover how to use inheritance in Odoo to modify existing models. In this chapter, you will use the same module that you created in the <span class="No-Break">previous chapter.</span></p>
			<p>This chapter covers the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Defining the model representation <span class="No-Break">and order</span></li>
				<li>Adding data fields to <span class="No-Break">a model</span></li>
				<li>Adding a float field with <span class="No-Break">configurable precision</span></li>
				<li>Adding a monetary field to <span class="No-Break">a model</span></li>
				<li>Adding relational fields to <span class="No-Break">a model</span></li>
				<li>Adding a hierarchy to <span class="No-Break">a model</span></li>
				<li>Adding constraint validations to <span class="No-Break">a model</span></li>
				<li>Adding computed fields to <span class="No-Break">a model</span></li>
				<li>Exposing related fields stored in <span class="No-Break">other models</span></li>
				<li>Adding dynamic relations using <span class="No-Break">reference fields</span></li>
				<li>Adding features to a model <span class="No-Break">using inheritance</span></li>
				<li>Using abstract models for reusable <span class="No-Break">model features</span></li>
				<li>Copying the model definition <span class="No-Break">using inheritance</span></li>
			</ul>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor120"/>Technical requirements</h1>
			<p>Before proceeding with the examples in this chapter, make sure you have the module that we developed in <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, and that it is properly installed <span class="No-Break">and configured.</span></p>
			<h1 id="_idParaDest-120"><a id="_idTextAnchor121"/>Defining the model representation and order</h1>
			<p>A model <a id="_idIndexMarker180"/>refers to a representation of a database table. A model defines the structure and behavior of a database table, including fields, relationships, and various methods. Models are defined in Python code using Odoo’s <strong class="bold">object-relational mapping</strong> (<strong class="bold">ORM</strong>) system. ORM allows developers to interact with <a id="_idIndexMarker181"/>the database using Python classes and methods, rather than writing raw <span class="No-Break">SQL queries.</span></p>
			<p>Model attributes are the features of a model that will be defined when we create a new model; otherwise, we use the attributes of the model that already exists. Models use structural attributes with an underscore prefix to define <span class="No-Break">their behavior.</span></p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor122"/>Getting ready</h2>
			<p>The <strong class="source-inline">my_hostel</strong> instance should already contain a Python file called <strong class="source-inline">models/hostel.py</strong>, which defines a basic model. We will edit it to add new <span class="No-Break">class-level attributes.</span></p>
			<h2 id="_idParaDest-122"><a id="_idTextAnchor123"/>How to do it...</h2>
			<p>By utilizing these attributes effectively, developers can create well-organized, reusable, and maintainable code in Odoo, leading to a more efficient and robust application. The following are the attributes that can be used on <span class="No-Break">a model:</span></p>
			<ol>
				<li><strong class="source-inline">_name </strong>: The <strong class="source-inline">name</strong> attribute is the most important one, as it determines the internal global identifier and the database table name. The model name is expressed in dot notation within the module namespace. For instance, <strong class="source-inline">name="hostel.hostel"</strong> will create the <strong class="source-inline">hostel_hostel</strong> table in <span class="No-Break">the database:</span><pre class="source-code">
_name = 'hostel.hostel'</pre></li>				<li><strong class="source-inline">_table</strong>: We can define the SQL table name utilized by the model if  ‘<strong class="source-inline">_auto</strong>’ <span class="No-Break">is enabled:</span><pre class="source-code">
_name = 'project.task.stage.personal'
_table = 'project_task_user_rel'</pre></li>				<li><strong class="source-inline">_description</strong>:  To assign a descriptive title to the model that reflects its purpose <a id="_idIndexMarker182"/>and functionality, insert the following <span class="No-Break">code snippet:</span><pre class="source-code">
_description = 'Information about hostel'</pre></li>			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If you don’t use <strong class="source-inline">_description</strong> for your model, Odoo will show a warning in <span class="No-Break">the logs.</span></p>
			<ol>
				<li value="4"><strong class="source-inline">_order</strong>: The default field for ordering the search results is ‘<strong class="source-inline">id</strong>’. However, this can be changed so that we can use the fields of our choice, by providing an <strong class="source-inline">_order</strong> attribute with a string containing a comma-separated list of field names. A field name can be followed by the <strong class="source-inline">desc</strong> keyword to sort it in descending order. To order the records by <strong class="source-inline">id</strong> in descending order, followed by names in ascending order, use the following <span class="No-Break">code syntax:</span><pre class="source-code">
_order = "id desc, name"</pre></li>			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">Only fields stored in the database can be used. Non-stored computed fields can’t be used to sort records. The syntax for the <strong class="source-inline">_order</strong> string is similar to the <strong class="source-inline">SQL ORDER BY</strong> clauses, although it’s stripped down. For instance, special clauses, such as <strong class="source-inline">NULLS FIRST</strong>, are <span class="No-Break">not allowed.</span></p>
			<ol>
				<li value="5"><strong class="source-inline">_rec_name</strong>: This is used to set the field that’s used as a representation or title for the records. The default field for <strong class="source-inline">rec_name</strong> is the name field. <strong class="source-inline">_rec_name</strong> is the <a id="_idIndexMarker183"/>display name of the record used by Odoo’s <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>) to represent that record. If you want to change <strong class="source-inline">rec_name</strong> and set <strong class="source-inline">hostel_code</strong> as a representative of the model, use the following <span class="No-Break">code syntax:</span><pre class="source-code">
_rec_name = 'hostel_code'
hostel_code = fields.Char(string="Code", required=True)</pre></li>			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If your model doesn’t have a name field and you haven’t specified <strong class="source-inline">_rec_name</strong> either, your display name will be a combination of the model name and record ID, like this – <strong class="source-inline">(</strong><span class="No-Break"><strong class="source-inline">hostel.hostel, 1)</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="6"><strong class="source-inline">_rec_names_search</strong>: This is used to search specific records by mentioned field values. It is similar to using the <strong class="source-inline">name_search</strong> function. You can directly use this <a id="_idIndexMarker184"/>attribute instead of using the <strong class="source-inline">name_search</strong> method. To do so, use the following <span class="No-Break">code syntax:</span><pre class="source-code">
_rec_names_search = ['name', 'co<a id="_idTextAnchor124"/>de']</pre></li>			</ol>
			<h2 id="_idParaDest-123"><a id="_idTextAnchor125"/>There’s more…</h2>
			<p>All models <a id="_idIndexMarker185"/>have a <strong class="source-inline">display_name</strong> field that shows the record representation in a human-readable format, which has been automatically added to all models since version 8.0. The default <strong class="source-inline">_compute_display_name()</strong> method uses the <strong class="source-inline">_rec_name</strong> attribute to determine which field contains the data for the display name. To customize the display name, you can override the <strong class="source-inline">_compute_display_name()</strong> method and provide your logic. The method should return a list of tuples, each containing the record ID and the Unicode <span class="No-Break">string representation.</span></p>
			<p>For example, to have the hostel name and hostel code in the representation, such as <strong class="source-inline">Youth Hostel (YHG015)</strong>, we can define <span class="No-Break">the following:</span></p>
			<p>Take a look at the following example. This will add a release date to the <span class="No-Break">record’s name:</span></p>
			<pre class="source-code">
@api.depends('hostel_code')
    def _compute_display_name(self):
        for record in self:
            name = record.name
            if record.hostel_code:
                name = f'{name} ({record.hostel_code})'
            record.display_name = name</pre>			<p>After adding <a id="_idIndexMarker186"/>the preceding code, your <strong class="source-inline">display_name</strong> record will be updated. Suppose you have a record with the name <strong class="source-inline">Bell House Hostel</strong> and its code is <strong class="source-inline">BHH101</strong>; then, the preceding <strong class="source-inline">_compute_display_name()</strong> method will generate a name such as <strong class="source-inline">Bell House </strong><span class="No-Break"><strong class="source-inline">Hostel (BHH101)</strong></span><span class="No-Break">.</span></p>
			<p>When we’re done, our <strong class="source-inline">hostel.py</strong> file should appear <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
from odoo import fields, models
class Hostel(models.Model):
_name = 'hostel.hostel'
_description = "Information about hostel"
_order = "id desc, name"
_rec_name = 'hostel_code'
name = fields.Char(string="hostel Name", required=True)
hostel_code = fields.Char(string="Code", required=True)
street = fields.Char('Street')
street2 = fields.Char('Street2')
zip = fields.Char('Zip', change_default=True)
city = fields.Char('City')
state_id = fields.Many2one("res.country.state", string='State')
country_id = fields.Many2one('res.country', string='Country')
phone = fields.Char('Phone',required=True)
mobile = fields.Char('Mobile',required=True)
email = fields.Char('Email')
@api.depends('hostel_code')
    def _compute_display_name(self):
        for record in self:
            name = record.name
            if record.hostel_code:
                name = f'{name} ({record.hostel_code})'
            record.display_name = name</pre>			<p>Your <strong class="source-inline">&lt;form&gt;</strong> view <a id="_idIndexMarker187"/>in the <strong class="source-inline">hostel.xml</strong> file will look <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
&lt;form string="Hostel"&gt;
  &lt;sheet&gt;
    &lt;div class="oe_title"&gt;
      &lt;h3&gt;
        &lt;table&gt;
          &lt;tr&gt;
            &lt;td style="padding-right:10px;"&gt;
            &lt;field name="name" required="1" 
            placeholder="Name" /&gt;&lt;/td&gt;
            &lt;td style="padding-right:10px;"&gt;
            &lt;field name="hostel_code" placeholder="Code" 
            /&gt;&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/table&gt;
      &lt;/h3&gt;
    &lt;/div&gt;
    &lt;group&gt;
      &lt;group&gt;
        &lt;label for="street" string="Address"/&gt;
          &lt;div class="o_address_format"&gt;
            &lt;field name="street" placeholder="Street..." 
            class="o_address_street"/&gt;
            &lt;field name="street2" placeholder="Street 2..." 
            class="o_address_street"/&gt;
            &lt;field name="city" placeholder="City" 
            class="o_address_city"/&gt;
            &lt;field name="state_id" class="o_address_state" 
            placeholder="State" options='{"no_open": 
            True}'/&gt;
            &lt;field name="zip" placeholder="ZIP" 
            class="o_address_zip"/&gt;
            &lt;field name="country_id" placeholder="Country"
            class="o_address_country" options='{"no_open": 
            True, "no_create": True}'/&gt;
          &lt;/div&gt;
      &lt;/group&gt;
      &lt;group&gt;
        &lt;field name="phone" widget="phone"/&gt;
          &lt;field name="mobile" widget="phone"/&gt;
            &lt;field name="email" widget="email" 
            context="{'gravatar_image': True}"/&gt;
      &lt;/group&gt;
    &lt;/group&gt;
  &lt;/sheet&gt;
&lt;/form&gt;</pre>			<p>We should <a id="_idIndexMarker188"/>then upgrade the module to activate these changes <span class="No-Break">in Odoo.</span></p>
			<p>To update the module, execute <span class="No-Break">the following:</span></p>
			<pre class="source-code">
Activate developer mode -&gt;Apps -&gt; Update App List</pre>			<p>Then, search for the <strong class="source-inline">my_hostel</strong> module and upgrade it via the dropdown, as shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="image/B20997_04_1.jpg" alt="Figure 4.1 – The option to update the module"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.1 – The option to update the module</p>
			<p>Alternatively, you can <a id="_idIndexMarker189"/>also use the <strong class="source-inline">-u my_hostel</strong> command in the <span class="No-Break">comma<a id="_idTextAnchor126"/>nd line.</span></p>
			<h1 id="_idParaDest-124"><a id="_idTextAnchor127"/>Adding data fields to a model</h1>
			<p>A field represents a column in a database table and defines the structure of the data that can be <a id="_idIndexMarker190"/>stored in that column. Fields in Odoo models are used to specify the attributes and characteristics of the data that the model will store. Each field has a data type (e.g., <strong class="source-inline">Char</strong>, <strong class="source-inline">Integer</strong>, <strong class="source-inline">Float</strong>, or <strong class="source-inline">Date</strong>) and various attributes that determine how the <span class="No-Break">field behaves.</span></p>
			<p>In this section, you will explore the various data types that fields can support and how to add them to<a id="_idTextAnchor128"/> <span class="No-Break">a model.</span></p>
			<h2 id="_idParaDest-125"><a id="_idTextAnchor129"/>Getting ready</h2>
			<p>This recipe assumes that you have an instance ready with the <strong class="source-inline">my_hostel</strong> add-on module available, as described in <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo </em><span class="No-Break"><em class="italic">Add-On<a id="_idTextAnchor130"/> Modules</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-126"><a id="_idTextAnchor131"/>How to do it...</h2>
			<p>The <strong class="source-inline">my_hostel</strong> add-on module should already have <strong class="source-inline">models/hostel.py</strong>, defining a basic model. We will edit it to add <span class="No-Break">new fields:</span></p>
			<ol>
				<li>Use the <a id="_idIndexMarker191"/>minimal syntax to add fields to the <span class="No-Break"><strong class="source-inline">Hostel</strong></span><span class="No-Break"> model:</span><pre class="source-code">
from odoo import models, fields
class Hostel(models.Model):
    # …
    email = fields.Char('Email')
    hostel_floors = fields.Integer(string="Total Floors")
    image = fields.Binary('Hostel Image')
    active = fields.Boolean("Active", default=True,
    help="Activate/Deactivate hostel record")
    type = fields.Selection([("male", "Boys"), ("female", "Girls"),
    ("common", "Common")], "Type", help="Type of Hostel",
    required=True, default="common")
    other_info = fields.Text("Other Information",
    help="Enter more information")
    description = fields.Html('Description')
    hostel_rating = fields.Float('Hostel Average Rating', digits=(14, 4))</pre><p class="list-inset">We have added new fields to the model. We still need to add these fields to the form view <a id="_idIndexMarker192"/>in order to reflect these changes in the user interface. Refer to the following code to add fields to the <span class="No-Break">form view:</span></p><pre class="source-code">&lt;field name="image" widget="image" class="oe_avatar"/&gt;
  &lt;group&gt;
    &lt;group&gt;
    &lt;label for="street" string="Address"/&gt;
    &lt;div class="o_address_format"&gt;
      &lt;field name="street" placeholder="Street..." class="o_address_street"/&gt;
      &lt;field name="street2" placeholder="Street 2..." class="o_address_street"/&gt;
      &lt;field name="city" placeholder="City" class="o_address_city"/&gt;
      &lt;field name="state_id" class="o_address_state" 
      placeholder="State" options='{"no_open": True}'/&gt;
      &lt;field name="zip" placeholder="ZIP" class="o_address_zip"/&gt;
      &lt;field name="country_id" placeholder="Country"
      class="o_address_country" options='{"no_open": True,
       "no_create": True}'/&gt;
    &lt;/div&gt;
    &lt;field name="phone" widget="phone"/&gt;
    &lt;field name="mobile" widget="phone"/&gt;
    &lt;field name="email" widget="email" context="{'gravatar_image': True}"/&gt;
    &lt;/group&gt;
    &lt;group&gt;
      &lt;field name="hostel_floors"/&gt;
      &lt;field name="active"/&gt;
      &lt;field name="type"/&gt;
      &lt;field name="hostel_rating"/&gt;
      &lt;field name="other_info"/&gt;
    &lt;/group&gt;
  &lt;/group&gt;
  &lt;group&gt;
    &lt;field name="description"/&gt;
  &lt;/group&gt;</pre></li>			</ol>
			<p>Upgrading the <a id="_idIndexMarker193"/>module will make these changes effective in the <span class="No-Break">Odoo m<a id="_idTextAnchor132"/>odel.</span></p>
			<h2 id="_idParaDest-127"><a id="_idTextAnchor133"/>How it works...</h2>
			<p>To add fields <a id="_idIndexMarker194"/>to models, you need to define an attribute of the corresponding type in their Python classes. The available types of non-relational fields <a id="_idIndexMarker195"/>are <span class="No-Break">as follows:</span></p>
			<ul>
				<li><strong class="bold">Char</strong>: Stores <span class="No-Break">string values.</span></li>
				<li><strong class="bold">Text</strong>: Stores multiline <span class="No-Break">string values.</span></li>
				<li><strong class="bold">Selection</strong>: Stores one value from a list of predefined values and descriptions. This has a list of values and description pairs. The value that is selected is what gets stored in the database, and it can be a string or an integer. The description is <span class="No-Break">automatically translatable.</span></li>
			</ul>
			<p class="callout-heading">Note</p>
			<p class="callout">Odoo does not display the description if the value is zero for integer keys. The <strong class="source-inline">Selection</strong> field also accepts a function reference as its <strong class="source-inline">selection</strong> attribute instead of a list. This allows you to dynamically generate lists of options. You can find an example relating to this in the <em class="italic">Adding dynamic relations using reference fields</em> recipe in this chapter, where a <strong class="source-inline">selection</strong> attribute is <span class="No-Break">also used.</span></p>
			<ul>
				<li><strong class="bold">Html</strong>: Stores rich text in the <span class="No-Break">HTML format.</span></li>
				<li><strong class="bold">Binary</strong>: Stores binary files, such as images <span class="No-Break">or documents.</span></li>
				<li><strong class="bold">Boolean</strong>: Stores <span class="No-Break"><strong class="source-inline">True</strong></span><span class="No-Break">/</span><span class="No-Break"><strong class="source-inline">False</strong></span><span class="No-Break"> values.</span></li>
				<li><strong class="bold">Date</strong>: Stores date values as Python date objects. Use <strong class="source-inline">fields.Date.today()</strong> to set the default value to the <span class="No-Break">current date.</span></li>
				<li><strong class="bold">Datetime</strong>: Stores <strong class="source-inline">datetime</strong> values as Python datetime objects in UTC time. Use <strong class="source-inline">fields.Date.now()</strong> to set the default value to the <span class="No-Break">current time.</span></li>
				<li><strong class="bold">Integer</strong>: Stores <span class="No-Break">integer values.</span></li>
				<li><strong class="bold">Float</strong>: Stores numeric values with optional precision (total digits and <span class="No-Break">decimal digits).</span></li>
				<li><strong class="bold">Monetary</strong>: Stores an amount in a specific currency. This will be explained further in the <em class="italic">Adding a monetary field to a model</em> recipe in <span class="No-Break">this chapter.</span></li>
			</ul>
			<p><em class="italic">Step 1</em> of this recipe shows the minimal syntax to add to each field type. The field definitions can be <a id="_idIndexMarker196"/>expanded to add other optional attributes, as <a id="_idTextAnchor134"/>shown in <em class="italic">step 2</em>. Here’s an explanation of the field attributes that <span class="No-Break">were used:</span></p>
			<ul>
				<li><strong class="source-inline">string</strong> is the field’s title and is used in UI view labels. It is optional. If not set, a label will be derived from the field name by adding a title case and replacing the underscores <span class="No-Break">with spaces.</span></li>
				<li><strong class="source-inline">translate</strong>, when set to <strong class="source-inline">True</strong>, makes the field translatable. It can hold a different value, depending on the user <span class="No-Break">interface language.</span></li>
				<li><strong class="source-inline">default</strong> is the default value. It can also be a function that is used to calculate the default value – for example, <strong class="source-inline">default=_compute_default</strong>, where <strong class="source-inline">_compute_default</strong> is a method that was defined on the model before the <span class="No-Break">field definition.</span></li>
				<li><strong class="source-inline">help</strong> is an explanation text that’s displayed in the <span class="No-Break">UI tooltips.</span></li>
				<li><strong class="source-inline">groups</strong> makes the field available only to some security groups. It is a string containing a comma-separated list of XML IDs for security groups. This is addressed in more detail in <a href="B20997_10.xhtml#_idTextAnchor549"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <span class="No-Break"><em class="italic">Security Access</em></span><span class="No-Break">.</span></li>
				<li><strong class="source-inline">copy</strong> flags whether the field value is copied when the record is duplicated. By default, it is <strong class="source-inline">True</strong> for non-relational and <strong class="source-inline">Many2one</strong> fields, and <strong class="source-inline">False</strong> for <strong class="source-inline">One2many</strong> and <span class="No-Break">computed fields.</span></li>
				<li><strong class="source-inline">index</strong>, when set to <strong class="source-inline">True</strong>, creates a database index for the field, which sometimes allows for faster searches. It replaces the deprecated <span class="No-Break"><strong class="source-inline">select=1</strong></span><span class="No-Break"> attribute.</span></li>
				<li>The <strong class="source-inline">readonly</strong> flag makes the field read-only by default in the <span class="No-Break">user interface.</span></li>
				<li>The <strong class="source-inline">required</strong> flag makes the field mandatory by default in the <span class="No-Break">user interface.</span></li>
				<li>The various whitelists that are mentioned here are defined <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">odoo/fields.py</strong></span><span class="No-Break">.</span></li>
				<li>The <strong class="source-inline">company_dependent</strong> flag makes the field store different values for each company. It replaces the deprecated <strong class="source-inline">Property</strong> <span class="No-Break">field type.</span></li>
				<li>The value isn’t stored on the model table. It is registered as `<strong class="source-inline">ir.property</strong>`. When the value of the <strong class="source-inline">company_dependent</strong> field is needed, an `<strong class="source-inline">ir.property</strong>` is searched and linked to the current company (and the current record if one property exists). If the value is changed on the record, it either modifies the existing property for the current record (if one exists) or creates a new <a id="_idIndexMarker197"/>one for the current company and <strong class="source-inline">res_id</strong>. If the value is changed on the company side, it will impact all records on which the value hasn’t <span class="No-Break">been changed.</span></li>
				<li><strong class="source-inline">group_operator</strong> is an aggregate function used to display results in the group <span class="No-Break">by mode.</span><p class="list-inset">Possible values for this attribute include <strong class="source-inline">count</strong>, <strong class="source-inline">count_distinct</strong>, <strong class="source-inline">array_agg</strong>, <strong class="source-inline">bool_and</strong>, <strong class="source-inline">bool_or</strong>, <strong class="source-inline">max</strong>, <strong class="source-inline">min</strong>, <strong class="source-inline">avg</strong>, and <strong class="source-inline">sum</strong>. Integer, float, and monetary field types have the default <strong class="source-inline">sum</strong> value for this attribute. This field is used by the <strong class="source-inline">:meth:~odoo.models.Model.read_group</strong> method to group rows based on <span class="No-Break">this field.</span></p><p class="list-inset">The supported aggregate functions are <span class="No-Break">as follows:</span></p><ul><li><strong class="source-inline">array_agg</strong>: Concatenates all values, including nulls, into <span class="No-Break">an array</span></li><li><strong class="source-inline">count</strong>: Counts the number <span class="No-Break">of rows</span></li><li><strong class="source-inline">count_distinct</strong>: Counts the number of <span class="No-Break">distinct rows</span></li><li><strong class="source-inline">bool_and</strong>: Returns <strong class="source-inline">true</strong> if all values are <strong class="source-inline">true</strong>, and <span class="No-Break"><strong class="source-inline">false</strong></span><span class="No-Break"> otherwise</span></li><li><strong class="source-inline">bool_or</strong>: Returns <strong class="source-inline">true</strong> if at least one value is <strong class="source-inline">true</strong>, and <span class="No-Break"><strong class="source-inline">false</strong></span><span class="No-Break"> otherwise</span></li><li><strong class="source-inline">max</strong>: Returns the maximum value of <span class="No-Break">all values</span></li><li><strong class="source-inline">min</strong>: Returns the minimum value of <span class="No-Break">all values</span></li><li><strong class="source-inline">avg</strong>: Returns the average (arithmetic mean) of <span class="No-Break">all values</span></li><li><strong class="source-inline">sum</strong>: Returns the sum of <span class="No-Break">all values</span></li></ul></li>
				<li><strong class="source-inline">Store</strong>: This is for whether the field is stored in the database (the default is <strong class="source-inline">True</strong>, and <strong class="source-inline">False</strong> for <span class="No-Break">computed fields).</span></li>
				<li><strong class="source-inline">group_expand</strong>: This function <a id="_idIndexMarker198"/>is used to expand <strong class="source-inline">read_group</strong> results when grouping on the <span class="No-Break">current field:</span><pre class="source-code">
   .. code-block:: python
        @api.model
        def _read_group_selection_field(self, values, domain, order):
            return ['choice1', 'choice2', ...] # available selection choices.
         @api.model
        def _read_group_many2one_field(self, records, domain, order):
            return records + self.search([custom_domain])</pre></li>				<li>The <strong class="source-inline">sanitize</strong> flag is employed within HTML fields to systematically remove potentially insecure tags from their content. Activation of this flag results in a comprehensive cleansing of the input. For users seeking more nuanced control over HTML sanitization, there are additional attributes available. It is important to note that these attributes are effective only when the sanitize flag <span class="No-Break">is enabled.</span></li>
			</ul>
			<p>If you need <a id="_idIndexMarker199"/>finer control in HTML sanitization, there are a few more attributes that you can use, which only work if <strong class="source-inline">sanitize</strong> <span class="No-Break">is enabled:</span></p>
			<ul>
				<li><strong class="source-inline">sanitize_tags=True</strong>, to remove tags that are not part of a whitelist (this is <span class="No-Break">the default)</span></li>
				<li><strong class="source-inline">sanitize_attributes=True</strong>, to remove attributes of the tags that are not part of <span class="No-Break">a whitelist</span></li>
				<li><strong class="source-inline">sanitize_style=True</strong>, to remove style properties that are not part of <span class="No-Break">a whitelist</span></li>
				<li><strong class="source-inline">strip_style=True</strong>, to remove all <span class="No-Break">style elements</span></li>
				<li><strong class="source-inline">strip_class=True</strong>, to remove the <span class="No-Break">class attributes</span></li>
			</ul>
			<p>Finally, we updated the form view according to the newly added fields in the model. We placed all fields in form view, but you can place them anywhere you want. Form views are explained in more detail in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-128"><a id="_idTextAnchor135"/>There’s more...</h2>
			<p>The <strong class="source-inline">Date</strong> and <strong class="source-inline">Datetime</strong> field objects expose a few utility methods that can be convenient for Date <span class="No-Break">and Datetime:</span></p>
			<p>For <strong class="source-inline">Date</strong>, we have <a id="_idIndexMarker200"/><span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="source-inline">fields.Date.to_date(string_value)</strong> parses the string into a <span class="No-Break">date object.</span></li>
				<li><strong class="source-inline">fields.Date.to_string(date_value)</strong> converts the Python Date object to <span class="No-Break">a string.</span></li>
				<li><strong class="source-inline">fields.Date.today()</strong> returns the current day in a string format. This is appropriate for use with <span class="No-Break">default values.</span></li>
				<li><strong class="source-inline">fields.Date.context_today(record, timestamp)</strong> returns the day of the timestamp (or the current day, if the timestamp is omitted) in a string format, according to the time zone of the record’s (or record <span class="No-Break">set’s) context.</span></li>
			</ul>
			<p>For <strong class="source-inline">Datetime</strong>, we have <a id="_idIndexMarker201"/><span class="No-Break">the following:</span></p>
			<ul>
				<li><strong class="source-inline">fields.Datetime.to_datetime(string_value)</strong> parses the string into a <span class="No-Break">datetime object.</span></li>
				<li><strong class="source-inline">fields.Datetime.to_string(datetime_value)</strong> converts the datetime object to <span class="No-Break">a string.</span></li>
				<li><strong class="source-inline">fields.Datetime.now()</strong> returns the current day and time in a string format. This is appropriate to use for <span class="No-Break">default values.</span></li>
				<li><strong class="source-inline">fields.Datetime.context_timestamp(record, timestamp) </strong>converts a timestamp-naive datetime object into a time zone-aware datetime object. using the time zone in the context of a record. This is not suitable for default values but can be used for instances when you’re sending data to an <span class="No-Break">external system.</span></li>
			</ul>
			<p>In addition <a id="_idIndexMarker202"/>to the <a id="_idIndexMarker203"/>basic fields, there are also few <a id="_idIndexMarker204"/>relational fields such as <strong class="source-inline">Many2one</strong>, <strong class="source-inline">One2many</strong>, and <strong class="source-inline">Many2many</strong>. These are covered in the <em class="italic">Adding relational fields to a model</em> recipe in <span class="No-Break">this chapter.</span></p>
			<p>You can also create fields with values that are computed automatically by using the <strong class="source-inline">compute</strong> field attribute to define the computation function. This is covered in the <em class="italic">Adding computed fields to a model</em> recipe of <span class="No-Break">this chapter.</span></p>
			<p>Some fields are added by default in Odoo models, so you should avoid using these names for your fields. These are <span class="No-Break">as follows:</span></p>
			<ul>
				<li><strong class="source-inline">id</strong> (the record’s automatically <span class="No-Break">generated identifier)</span></li>
				<li><strong class="source-inline">create_date</strong> (the record <span class="No-Break">creation timestamp)</span></li>
				<li><strong class="source-inline">create_uid</strong> (the user who created <span class="No-Break">the record)</span></li>
				<li><strong class="source-inline">write_date</strong> (the last recorded <span class="No-Break">timestamp edit)</span></li>
				<li><strong class="source-inline">write_uid</strong> (the user who last edited <span class="No-Break">the record)</span></li>
			</ul>
			<p>The automatic creation of these log fields can be disabled by setting the <strong class="source-inline">_log_access=False</strong> <span class="No-Break">model attribute.</span></p>
			<p>Another special column that can be added to a model is <strong class="source-inline">active</strong>. It must be a <strong class="source-inline">Boolean</strong> field, allowing users <a id="_idIndexMarker205"/>to mark records as inactive. It is used to enable the <strong class="source-inline">archive</strong>/<strong class="source-inline">unarchive</strong> feature on the records. Its definition is <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
active = fields.Boolean('Active', default=True)</pre>			<p>By default, only records with <strong class="source-inline">active</strong> set to <strong class="source-inline">True</strong> are visible. To retrieve them, we need to use a domain filter with <strong class="source-inline">[('active', '=', False)]</strong>. Alternatively, if the <strong class="source-inline">'active_test': False</strong> value is added to the environment’s context, ORM will not filter out <span class="No-Break">inactive records.</span></p>
			<p>In some cases, you may not be able to modify the context to get both the active and the inactive records. If so, you can use the <strong class="source-inline">['|', ('active', '=', True), ('active', '=', </strong><span class="No-Break"><strong class="source-inline">False)]</strong></span><span class="No-Break"> domain.</span></p>
			<p class="callout-heading">Tip</p>
			<p class="callout"><strong class="source-inline">[('active', 'in' (True, False))]</strong> does not work as you might expect. Odoo explicitly looks for an <strong class="source-inline">('active', '=', False)</strong> clause in the domain. It will default to restricting the search<a id="_idTextAnchor136"/> to active <span class="No-Break">records only.</span></p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor137"/>Adding a float field with configurable precision</h1>
			<p>When <a id="_idIndexMarker206"/>using <strong class="source-inline">float</strong> fields, we may want to <a id="_idIndexMarker207"/>let the end user configure the decimal precision that will be used. In this recipe, we will add a <strong class="source-inline">hostel_rating</strong> field to the <strong class="source-inline">hostel</strong> model, with user-confi<a id="_idTextAnchor138"/>gurable <span class="No-Break">decimal precision.</span></p>
			<h2 id="_idParaDest-130"><a id="_idTextAnchor139"/>Getting ready</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on module<a id="_idTextAnchor140"/> from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-131"><a id="_idTextAnchor141"/>How to do it...</h2>
			<p>Perform the following steps to apply dynamic decimal precision to the model’s <span class="No-Break"><strong class="source-inline">hostel_rating</strong></span><span class="No-Break"> field:</span></p>
			<ol>
				<li>Create a <a id="_idIndexMarker208"/>data folder and add a <strong class="source-inline">data.xml</strong> file. Inside this file, add the following record for the decimal precision <a id="_idIndexMarker209"/>model. This will add a <span class="No-Break">new configuration.</span><pre class="source-code">
&lt;record forcecreate="True" id="decimal_point" model="decimal.precision"&gt;
&lt;field name="name"&gt;Rating Value&lt;/field&gt;
&lt;field name="digits"&gt;3&lt;/field&gt;
&lt;/record&gt;</pre></li>				<li>Activate <strong class="bold">Developer Mode</strong> from the link in the <strong class="bold">Settings</strong> menu (refer to the <em class="italic">Activating the Odoo developer tools</em> recipe in <a href="B20997_01.xhtml#_idTextAnchor020"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Installing the Odoo Development Environment</em>). This will enable the <strong class="bold">Settings</strong> | <span class="No-Break"><strong class="bold">Technical</strong></span><span class="No-Break"> menu.</span></li>
				<li>Access the decimal precision configurations. To do this, open the <strong class="bold">Settings</strong> top menu and select <strong class="bold">Technical</strong> | <strong class="bold">Database Structure</strong> | <strong class="bold">Decimal Accuracy</strong>. We should see a list of the currently <span class="No-Break">defined settings.</span></li>
			</ol>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="image/B20997_04_2.jpg" alt="Figure 4.2 – Creating new decimal precision"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.2 – Creating new decimal precision</p>
			<ol>
				<li value="4">To add <a id="_idIndexMarker210"/>the <strong class="source-inline">model</strong> field using <a id="_idIndexMarker211"/>this decimal precision setting, edit the <strong class="source-inline">models/hostel.py</strong> file by adding the <span class="No-Break">following code:</span><pre class="source-code">
class Hostel(models.Model):
    hostel_rating = fields.Float('Hostel Average Rating',
    # digits=(14, 4) # Method 1: Optional precision (total, decimals),
    digits='Rating Value' # Method 2
)</pre></li>			</ol>
			<h2 id="_idParaDest-132"><a id="_idTextAnchor142"/>How it works...</h2>
			<p>When you add a string value to the <strong class="source-inline">digits</strong> attribute of the field, Odoo looks up that string in the decimal accuracy model’s <strong class="source-inline">Usage</strong> field and returns a tuple, with 16-digit precision and the number of decimals that were defined in the configuration. Using the field definition, instead of having it hardcoded, we allow the end user to configure<a id="_idTextAnchor143"/> it according to <span class="No-Break">their needs.</span></p>
			<h1 id="_idParaDest-133"><a id="_idTextAnchor144"/>Adding a monetary field to a model</h1>
			<p>To work <a id="_idIndexMarker212"/>with monetary values and currencies in a model, we can use Odoo to provide special support for working with monetary values and currencies in its models, through the use of specific field types and features. Odoo’s special support for monetary values and currencies simplifies the handling of financial data, ensuring accuracy, consistency, and compliance with <a id="_idTextAnchor145"/><span class="No-Break">currency-related requirements.</span></p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor146"/>Getting ready</h2>
			<p>We will use the same <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor147"/>How to do it…</h2>
			<p>We need to add a currency field along with a monetary field to store the currency for <span class="No-Break">the amounts.</span></p>
			<p>We will add <strong class="source-inline">models/hostel_room.py</strong>, to add the <span class="No-Break">necessary fields:</span></p>
			<ol>
				<li>Create the field to store the currency for <span class="No-Break">the amounts:</span><pre class="source-code">
class HostelRoom(models.Model):
    _name = "hostel.room"
    …#
    currency_id = fields.Many2one('res.currency', string='Currency')</pre></li>				<li>Add the monetary field to store <span class="No-Break">the amount:</span><pre class="source-code">
class HostelRoom(models.Model):
    _name = "hostel.room"
    …#
    rent_amount = fields.Monetary('Rent Amount', help="Enter rent amount per month") # optional attribute: currency_field='currency_id' incase currency field have another name then 'currency_id'</pre><p class="list-inset">Create a security file for the new model and a form view to show it in the UI. Upgrade <a id="_idIndexMarker213"/>the add-on module to apply the changes. The monetary field will appear <span class="No-Break">like this:</span></p></li>			</ol>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="image/B20997_04_3.jpg" alt="Figure 4.3 – The currenc﻿y symbol in the monetary field"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 4.3 – The currenc<a id="_idTextAnchor148"/>y symbol in the monetary field</p>
			<h2 id="_idParaDest-136"><a id="_idTextAnchor149"/>How it works…</h2>
			<p>Odoo can display <strong class="source-inline">monetary</strong> fields correctly in the user interface because they have a second field that indicates their currency. This field is similar to a <span class="No-Break">float field.</span></p>
			<p>The currency field is usually named <strong class="source-inline">currency_id</strong>, but we can use any other name as long as we specify it with the optional <span class="No-Break"><strong class="source-inline">currency_field</strong></span><span class="No-Break"> parameter.</span></p>
			<p>If your currency information is stored in a field named <strong class="source-inline">currency_id</strong>, you don’t need to specify the <strong class="source-inline">currency_field</strong> attribute for the <span class="No-Break">monetary field.</span></p>
			<p>This is helpful when you have to store amounts in different currencies in the same record. For example, if you want to have the currency of the sale order and the company, you can <a id="_idIndexMarker214"/>create two fields as <strong class="source-inline">fields.Many2one(res.currency)</strong> and use one for <span class="No-Break">each amount.</span></p>
			<p>The currency definition (the <strong class="source-inline">decimal_precision</strong> field of the <strong class="source-inline">res.currency model</strong>) determines the de<a id="_idTextAnchor150"/>cimal precision for <span class="No-Break">the amount.</span></p>
			<h1 id="_idParaDest-137"><a id="_idTextAnchor151"/>Adding relational fields to a model</h1>
			<p>Relational <a id="_idIndexMarker215"/>fields are used to represent relations between Odoo models. There are three types <span class="No-Break">of relations:</span></p>
			<ul>
				<li><strong class="source-inline">many-to-one</strong>, or <span class="No-Break"><strong class="source-inline">m2o</strong></span><span class="No-Break"> for</span></li>
				<li><strong class="source-inline">one-to-many</strong>, or <strong class="source-inline">o2m</strong> <span class="No-Break">for short</span></li>
				<li><strong class="source-inline">many-to-many</strong>, or <strong class="source-inline">m2m</strong> <span class="No-Break">for short</span></li>
			</ul>
			<p>To illustrate this, let’s consider the hostel room model. A room belongs to a single hostel, so the relation between the hostel and the room is <strong class="source-inline">m2o</strong>. However, a hostel can have multiple rooms, so the opposite relationship <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">o2m</strong></span><span class="No-Break">.</span></p>
			<p>We can also have a <strong class="source-inline">m2m</strong> relationship. For instance, a room can offer various amenities and amenities can be available in different rooms. This is a<a id="_idTextAnchor152"/> bidirectional <span class="No-Break"><strong class="source-inline">m2m</strong></span><span class="No-Break"> relationship.</span></p>
			<h2 id="_idParaDest-138"><a id="_idTextAnchor153"/>Getting ready</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on <a id="_idTextAnchor154"/>module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-139"><a id="_idTextAnchor155"/>How to do it...</h2>
			<p>We will edit the <strong class="source-inline">models/hostel_room.py</strong> file to add <span class="No-Break">these fields:</span></p>
			<ol>
				<li>Add the <strong class="source-inline">m2o</strong> field for the hostel in <span class="No-Break"><strong class="source-inline">Hostel Room</strong></span><span class="No-Break">:</span><pre class="source-code">
class HostelRoom(models.Model):
    
# ...
    hostel_id = fields.Many2one("hostel.hostel", "hostel", help="Name of hostel")</pre></li>				<li>We want to create a <strong class="source-inline">o2m</strong> field for a student that links to <span class="No-Break">a room.</span></li>
				<li>First, we need a new model for hostel students. We will make a<strong class="source-inline"> hostel_student.py</strong> file and add some basic fields to the hostel student model. Then, we will add a <strong class="source-inline">room_id</strong> <strong class="source-inline">m2o</strong> field to connect the student and <span class="No-Break">room models.</span></li>
				<li>Finally, we will <a id="_idIndexMarker216"/>add an <strong class="source-inline">o2m</strong> field, <strong class="source-inline">student_ids</strong>, of the <strong class="source-inline">hostel.student</strong> model to the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
class HostelStudent(models.Model):
    _name = "hostel.student"
    name = fields.Char("Student Name")
    gender = fields.Selection([("male", "Male"),
    ("female", "Female"), ("other", "Other")],
    string="Gender", help="Student gender")
    active = fields.Boolean("Active", default=True,
    help="Activate/Deactivate hostel record")
    <strong class="bold">room_id = fields.Many2one("hostel.room", "Room",</strong>
<strong class="bold">    </strong><strong class="bold">help="Select hostel room")</strong>
class HostelRoom(models.Model):
    _name = "hostel.room"
    # ...
    student_ids = fields.One2many("hostel.student", "<strong class="bold">room_id</strong>",
    string="Students", help="Enter students")</pre></li>				<li>We will <a id="_idIndexMarker217"/>create a new file, <strong class="source-inline">hostel_amenities.py</strong>. Add the following code to <span class="No-Break">the file:</span><pre class="source-code">
class HostelAmenities(models.Model):
    _name = "hostel.amenities"
    _description = "Hostel Amenities"
    name = fields.Char("Name", help="Provided Hostel Amenity")
    active = fields.Boolean("Active",
    help="Activate/Deactivate whether the amenity should be given or not")</pre><p class="list-inset">Now, we will <a id="_idIndexMarker218"/>add an <strong class="source-inline">m2m</strong> field of amenities to the <strong class="source-inline">hostel.room</strong> model. Add the following code <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">hostel_room.py</strong></span><span class="No-Break">:</span></p><pre class="source-code">class HostelRoom(models.Model):
    _name = "hostel.room"
    # ...
    hostel_amenities_ids = fields.Many2many("hostel.amenities",
    "hostel_room_amenities_rel", "room_id", "amenitiy_id",
    string="Amenities", domain="[('active', '=', True)]",
    help="Select hostel room amenities")</pre></li>			</ol>
			<p>Now, upgrade the add-on module, and the new fields should be available in the model. They won’t be visible in the views until they are added to them. We will add new fields to the <span class="No-Break"><strong class="source-inline">hostel_room.xml</strong></span><span class="No-Break"> file.</span></p>
			<p>We can confirm their addition by inspecting the <strong class="source-inline">model</strong> fields in <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Database St<a id="_idTextAnchor156"/>ructure</strong> | <strong class="bold">Models</strong> in <span class="No-Break"><strong class="bold">Developer</strong></span><span class="No-Break"> mode.</span></p>
			<h2 id="_idParaDest-140"><a id="_idTextAnchor157"/>How it works…</h2>
			<p>An <strong class="source-inline">m2o</strong> field stores the database ID of another record in a column of the model’s table. This creates a foreign key constraint in the database, which ensures that the stored ID is a valid reference <a id="_idIndexMarker219"/>to a record in another table. By default, these relationship fields do not have a database index, but you can add one by setting the <span class="No-Break"><strong class="source-inline">index=True</strong></span><span class="No-Break"> attribute.</span></p>
			<p>You can also specify what happens when the record that is referenced by an <strong class="source-inline">m2o</strong> field is deleted. The <strong class="source-inline">ondelete</strong> attribute controls this behavior. For instance, what should happen to students when their room record is deleted? The default option is <strong class="source-inline">'set null'</strong>, which means the field will have an empty value. Another option is <strong class="source-inline">'restrict'</strong>, which means the related record cannot be deleted. A third option is <strong class="source-inline">'cascade'</strong>, which means the linked record will be deleted <span class="No-Break">as well.</span></p>
			<p>You can also use <strong class="source-inline">context</strong> and <strong class="source-inline">domain</strong> for other relational fields. These attributes are mainly useful on the client side, and they provide default values for the views of the related records that are accessed through <span class="No-Break">a field:</span></p>
			<ul>
				<li><strong class="source-inline">context</strong> sets some <a id="_idIndexMarker220"/>variables in the client context when you click on a field to see the related record’s view. For example, you can use it to set default values for new records that are created in <span class="No-Break">that view.</span></li>
				<li><strong class="source-inline">domain</strong> is a filter <a id="_idIndexMarker221"/>that limits the list of related records that you can <span class="No-Break">choose from.</span></li>
			</ul>
			<p>You can learn more about <strong class="source-inline">context</strong> and <strong class="source-inline">domain</strong> in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></p>
			<p>An <strong class="source-inline">o2m</strong> field is the opposite of an <strong class="source-inline">m2o</strong> field, and it lets you access a list of related records from a model. Unlike other fields, it does not have a column in the database table. It is just a convenient way to display these related records in views. To use an <strong class="source-inline">o2m</strong> field, you need to have a corresponding <strong class="source-inline">m2o field</strong> in the other model. In our example, we added an <strong class="source-inline">o2m</strong> field to the room model. The  <strong class="source-inline">student_ids</strong> <strong class="source-inline">o2m</strong> field has a reference to the <strong class="source-inline">room_id</strong> field of the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model.</span></p>
			<p>A <strong class="source-inline">m2m</strong> field does not have a column in the model’s table. Instead, it uses another table in the database to store the relationship between two models. This table has two columns for the IDs of the related records. When you link a room and its amenity with an <strong class="source-inline">m2m</strong> field, a new record is created in this table with the room’s ID and the <span class="No-Break">amenity’s ID.</span></p>
			<p>Odoo creates the relationship table for you. By default, the name of the relationship table is made from the names of the two models, sorted alphabetically, with a <strong class="source-inline">_rel</strong> suffix. You can change this name with the <span class="No-Break"><strong class="source-inline">relation</strong></span><span class="No-Break"> attribute.</span></p>
			<p>You should use the <strong class="source-inline">relation</strong> attribute when the names of the two models are too long for the default name. PostgreSQL has a limit of 63 characters for database identifiers. So, if the <a id="_idIndexMarker222"/>names of the two models are more than 23 characters each, you should set a shorter name with the <strong class="source-inline">relation</strong> attribute. We will<a id="_idTextAnchor158"/> explain this more in the <span class="No-Break">next section.</span></p>
			<h2 id="_idParaDest-141"><a id="_idTextAnchor159"/>There’s more...</h2>
			<p>You can also use the <strong class="source-inline">auto_join</strong> attribute for <strong class="source-inline">m2o</strong> fields. This attribute lets ORM use SQL joins <a id="_idIndexMarker223"/>on this field. This means that ORM does not check the user access control and record access rules for this field. This can help with performance issues in some cases, but it is better to <span class="No-Break">avoid it.</span></p>
			<p>We have seen the simplest way to define the relational fields. Now, let’s look at the attributes that are specific to <span class="No-Break">these fields.</span></p>
			<p>These are <a id="_idIndexMarker224"/>the attributes for the <span class="No-Break"><strong class="source-inline">o2m</strong></span><span class="No-Break"> field:</span></p>
			<ul>
				<li> <strong class="source-inline">comodel_name</strong>: This is the name of the model that the field relates to. You need this attribute for all relational fields. You can write it without the keyword, as the <span class="No-Break">first argument.</span></li>
				<li><strong class="source-inline">inverse_name</strong>: This is only for the <strong class="source-inline">o2m</strong> fields. It is the name of the <strong class="source-inline">m2o</strong> field in the other model that links back to <span class="No-Break">this model.</span></li>
				<li><strong class="source-inline">limit</strong>: This is for the <strong class="source-inline">o2m</strong> and <strong class="source-inline">m2m</strong> fields. It sets a maximum number of records to read and display in the <span class="No-Break">user interface.</span></li>
			</ul>
			<p>These are <a id="_idIndexMarker225"/>the attributes for the <span class="No-Break"><strong class="source-inline">m2m</strong></span><span class="No-Break"> field:</span></p>
			<ul>
				<li><strong class="source-inline">comodel_name</strong>: This is the name of the model that the field relates to. It is the same as for the <span class="No-Break"><strong class="source-inline">o2m</strong></span><span class="No-Break"> field.</span></li>
				<li><strong class="source-inline">relation</strong>: This is the name of the table in the database that stores the relationship. You can use this attribute to change the <span class="No-Break">default name.</span></li>
				<li><strong class="source-inline">column1</strong>: This is the name of column 1 in the relation table that links to <span class="No-Break">this model.</span></li>
				<li><strong class="source-inline">column2</strong>: This is the <a id="_idIndexMarker226"/>name of column 2 in the relation table that links to the <span class="No-Break">other model.</span></li>
			</ul>
			<p>Odoo typically handles the creation and management of these attributes automatically. It can identify and utilize an existing relation table for an inverse <strong class="source-inline">m2m</strong> field. However, there are specific scenarios where manual intervention <span class="No-Break">is required.</span></p>
			<p>When dealing with multiple <strong class="source-inline">m2m</strong> fields between the same two models, it becomes necessary to assign distinct relation table names for <span class="No-Break">each field.</span></p>
			<p>In cases where <a id="_idIndexMarker227"/>the names of the two models exceed PostgreSQL’s limit of 63 characters for database object names, you must set these attributes yourself. The default relation table name is typically <strong class="source-inline">&lt;model1&gt;_&lt;model2&gt;rel</strong>. However, this table includes a primary key index with a longer name (<strong class="source-inline">&lt;model1&gt;&lt;model2&gt;rel&lt;model1&gt;id&lt;model2&gt;_id_key</strong>), which also needs to adhere to the 63-character limit. Therefore, if the combined names of the two models surpass this limit, you<a id="_idTextAnchor160"/> must opt for a shorter relation <span class="No-Break">table name.</span></p>
			<h1 id="_idParaDest-142"><a id="_idTextAnchor161"/>Adding a hierarchy to a model</h1>
			<p>You can use an <strong class="source-inline">m2o</strong> field to represent hierarchies, where each record has a parent record and <a id="_idIndexMarker228"/>many child records in the same model. However, Odoo also provides improved support for this type of field by using the <strong class="source-inline">nested set model</strong> (<a href="https://en.wikipedia.org/wiki/Nested_set_model">https://en.wikipedia.org/wiki/Nested_set_model</a>). When activated, queries using the <strong class="source-inline">child_of</strong> operator in their domain filters will run <span class="No-Break">significantly faster.</span></p>
			<p>Staying with the <strong class="source-inline">Hostel</strong> example, we will build a hierarchical category<a id="_idTextAnchor162"/> tree that can be used to <span class="No-Break">categorize hostels.</span></p>
			<h2 id="_idParaDest-143"><a id="_idTextAnchor163"/>Getting ready</h2>
			<p>We will continue using the <strong class="source-inline">my_h<a id="_idTextAnchor164"/>ostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-144"><a id="_idTextAnchor165"/>How to do it...</h2>
			<p>We will add a new Python file, <strong class="source-inline">models/hostel_categ.py</strong>, for the category tree, <span class="No-Break">as follows:</span></p>
			<ol>
				<li>To load the new Python code file, add the following line <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">models/__init__.py</strong></span><span class="No-Break">:</span><pre class="source-code">
from . import <strong class="bold">hostel_categ</strong></pre></li>				<li>To create <a id="_idIndexMarker229"/>the <strong class="source-inline">Hostel Category</strong> model with the parent and child relationships, create the <strong class="source-inline">models/hostel_categ.py</strong> file with the <span class="No-Break">following code:</span><pre class="source-code">
from odoo import models, fields, api
class HostelCategory(models.Model):
    _name = "hostel.category"
    name = fields.Char('Category')
    parent_id = fields.Many2one(
        'hostel.category',
        string='Parent Category',
        ondelete='restrict',
        index=True)
    parent_path = fields.Char(index=True)
    child_ids = fields.One2many(
        'hostel.category', 'parent_id',
        string='Child Categories')</pre></li>				<li>To enable the <a id="_idIndexMarker230"/>special hierarchy support, also add the <span class="No-Break">following code:</span><pre class="source-code">
_parent_store = True
_parent_name = "parent_id" # optional if field is 'parent_id'
parent_path = fields.Char(index=True, unaccent=False)</pre></li>				<li>To add a check to prevent looping relations, add the following line to <span class="No-Break">the model:</span><pre class="source-code">
from odoo.exceptions import ValidationError
...
@api.constrains('parent_id')
def _check_hierarchy(self):
    if not self._check_recursion():
        raise models.ValidationError(
            'Error! You cannot create recursive categories.')</pre></li>				<li>Now, we need to assign a category to a hostel. To do this, we will add a new <strong class="source-inline">m2o</strong> field to the <span class="No-Break"><strong class="source-inline">hostel.hostel</strong></span><span class="No-Break"> model:</span><pre class="source-code">
category_id = fields.Many2one('hostel.category')</pre></li>			</ol>
			<p>Finally, a module upgrade will make these <span class="No-Break">changes effective.</span></p>
			<p>To display the <strong class="source-inline">hostel.category</strong> model in the user interface, you will need to add menus, views, and security rules. For more details, refer to <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>. Alternatively, you can access all code <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter04"><span class="No-Break">https://github.com/PacktPublishing/Odoo-17-Development-Cookbook-Fifth-Edition/tree/main/Chapter04</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-145"><a id="_idTextAnchor166"/>How it works…</h2>
			<p>We want to create a new model with hierarchical relations. This means that each record can have a <a id="_idIndexMarker231"/>parent record and many child records in the same model. Here are the steps to <span class="No-Break">do this:</span></p>
			<ol>
				<li>We create an <strong class="source-inline">m2o</strong> field to reference the parent record. We use <strong class="source-inline">index=True</strong> to make this field indexed in the database for faster queries. We also use <strong class="source-inline">ondelete='cascade'</strong> or <strong class="source-inline">ondelete='restrict'</strong> to control what happens when the parent record <span class="No-Break">is deleted.</span></li>
				<li>We create a <strong class="source-inline">o2m</strong> field to access all the child records of a record. This field does not add anything to the database, but it is a convenient way to get the child records. We add a special support for hierarchies by using <strong class="source-inline">parent_store=True</strong> in the model attribute. This makes the queries using the <strong class="source-inline">child_of</strong> operator faster, but it also makes the write operations slower. We also add a helper field called <strong class="source-inline">parent_path</strong> to store data for hierarchical searches. If we use a different name from <strong class="source-inline">parent_id</strong> for the parent field, we need to specify it with <strong class="source-inline">parent_name</strong> in the <span class="No-Break">model attribute.</span></li>
				<li>We prevent cyclic dependencies in the hierarchy by using the <strong class="source-inline">_check_recursion</strong> method from <strong class="source-inline">models.Model</strong>. This avoids us having a record that is both an ancestor and a descendant of another record, which can cause <span class="No-Break">infinite loops.</span></li>
				<li>We add a <strong class="source-inline">category_id</strong> field with <strong class="source-inline">Many2one</strong> type to the hostel.hostel model, so that we can assign a category to ea<a id="_idTextAnchor167"/>ch hostel. This is just to complete <span class="No-Break">our example.</span></li>
			</ol>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor168"/>There’s more…</h2>
			<p>You should use this technique for hierarchies that do not change much but are read and queried a lot. This is because the nested set model in the database needs to update the <strong class="source-inline">parent_path</strong> column (and the related database indexes) for all records when a category is added, deleted, or moved. This can be slow and costly, especially when there are many <span class="No-Break">concurrent transactions.</span></p>
			<p>If you have a hierarchy that changes a lot, you might get better performance by using the standard <strong class="source-inline">parent_id</strong> and <strong class="source-inline">child_ids</strong> relations<a id="_idTextAnchor169"/>hips. This way, you can avoid <span class="No-Break">table-level locks.</span></p>
			<h1 id="_idParaDest-147"><a id="_idTextAnchor170"/>Adding constraints validations to a model</h1>
			<p>We want <a id="_idIndexMarker232"/>to make sure that our models do not have invalid or inconsistent data. Odoo has two kinds of constraints to <span class="No-Break">do this:</span></p>
			<ul>
				<li><strong class="source-inline">Database-level constraints</strong>: These are the constraints that PostgreSQL <a id="_idIndexMarker233"/>supports. The most common ones are the <strong class="source-inline">UNIQUE</strong> constraints, which prevent duplicate values. We can also use <strong class="source-inline">CHECK</strong> and <strong class="source-inline">EXCLUDE</strong> constraints for other conditions. These constraints are fast and reliable, but they are limited by what PostgreSQL <span class="No-Break">can do.</span></li>
				<li><strong class="source-inline">Server-level constraints</strong>: These are the constraints that we write in Python <a id="_idIndexMarker234"/>code. We can use these constraints when the database-level ones are not enough for our needs. These constraints are more flexible and powerful, but they are slower and <span class="No-Break">more complex.</span></li>
			</ul>
			<h2 id="_idParaDest-148"><a id="_idTextAnchor171"/>Getting ready</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on module from the previous recipe. We will use the hostel room model and add some constraints to it. We will use the hostel room model from <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter </em></span><span class="No-Break"><em class="italic">3</em></span></a>, <em class="italic">Creating Odoo Add-On Modules</em>, and add some constraints <span class="No-Break">to it.</span></p>
			<p>We will use a <strong class="source-inline">UNIQUE</strong> constraint to ensure that room numbers are not repeated. We will also add a Python model co<a id="_idTextAnchor172"/>nstraint to check that the rent amount <span class="No-Break">is positive.</span></p>
			<h2 id="_idParaDest-149"><a id="_idTextAnchor173"/>How to do it...</h2>
			<ol>
				<li>SQL constraints are defined through the <strong class="source-inline">_sql_constraints</strong> model attribute. This attribute is assigned a list of triples containing strings <strong class="source-inline">(name</strong>, <strong class="source-inline">sql_definition</strong>, <strong class="source-inline">message)</strong>, where <strong class="source-inline">name</strong> is a valid SQL constraint name, <strong class="source-inline">sql_definition</strong> is a <strong class="source-inline">table_constraint</strong> expression, and <strong class="source-inline">message</strong> is the error <a id="_idIndexMarker235"/>message. We can add the following code to the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model:</span><pre class="source-code">
_sql_constraints = [
   ("room_no_unique", "unique(room_no)", "Room number must be unique!")]</pre></li>				<li>A Python constraint is a method that checks a condition on a set of records. We use the <strong class="source-inline">constrains()</strong> decorator to mark the method as a constraint and to indicate which fields are involved in the condition. The constraint is automatically checked when any of these fields are changed. The method should raise an exception if the condition is <span class="No-Break">not met:</span><pre class="source-code">
from odoo.exceptions import ValidationError
...
 @api.constrains("rent_amount")
     def _check_rent_amount(self):
        """Constraint on negative rent amount"""
        if self.rent_amount &lt; 0:
        raise ValidationError(_("Rent Amount Per Month should not be a negative value!"))</pre><p class="list-inset">You need <a id="_idIndexMarker236"/>to upgrade the add-on module and restart the server after you make these changes to the <span class="No-Break">code file.</span></p></li>			</ol>
			<p class="callout-heading">Note</p>
			<p class="callout">If you add SQL constraints to the existing model through model inheritance, make sure you don’t have rows that violate the constraints. If you have such rows, then SQL constraints will not be added, and an error will be generated in <span class="No-Break">the log.</span></p>
			<p class="callout">For more <a id="_idIndexMarker237"/>information on PostgreSQL constraints in general and table constraints in particular, take a look <span class="No-Break">at </span><a href="http://www.postgresql.org/docs/current/static/ddl-constraints.html"><span class="No-Break">http://www.postgresql.org/docs/current/static/ddl-constraints.html</span></a><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-150"><a id="_idTextAnchor174"/>How it works…</h2>
			<p>We can use Python code to validate our models and prevent invalid data. To do this, we use <span class="No-Break">two things:</span></p>
			<p>A method that checks a condition on a set of records. We use the <strong class="source-inline">constrains()</strong> decorator to mark the method as a constraint and to indicate which fields are involved in the condition. The constraint is automatically checked when any of these fields <span class="No-Break">are changed.</span></p>
			<p>A <strong class="source-inline">ValidationError</strong> exception that we raise when the condition is not met. This exception shows<a id="_idTextAnchor175"/> an error message to the user and stops <span class="No-Break">the operation.</span></p>
			<h1 id="_idParaDest-151"><a id="_idTextAnchor176"/>Adding computed fields to a model</h1>
			<p>We may <a id="_idIndexMarker238"/>want to create a field that depends on the values of other fields in the same record or in related records. For instance, we can calculate the total amount by multiplying a unit price by a quantity. In Odoo models, we can use computed fields to <span class="No-Break">do this.</span></p>
			<p>To demonstrate how computed fields work, we will add one to the Hostel Room model that computes the availability of rooms based on <span class="No-Break">student occupancy.</span></p>
			<p>We can also make computed fields editable and searchable. <a id="_idTextAnchor177"/>We will show you how to do this in our example <span class="No-Break">as well.</span></p>
			<h2 id="_idParaDest-152"><a id="_idTextAnchor178"/>Getting ready</h2>
			<p>We will continue usin<a id="_idTextAnchor179"/>g the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-153"><a id="_idTextAnchor180"/>How to do it...</h2>
			<p>We will <a id="_idIndexMarker239"/>modify the <strong class="source-inline">models/hostel_room.py</strong> code file to include a new field and the methods that implement <span class="No-Break">its logic:</span></p>
			<ol>
				<li>A computed field’s value usually relies on the values of other fields in the same record. ORM requires the developer to declare those dependencies on the <strong class="source-inline">compute</strong> method using the <strong class="source-inline">depends()</strong> decorator. ORM uses the given dependencies to recompute the field whenever any of its dependencies change. Start by adding the new fields to the <strong class="source-inline">Hostel </strong><span class="No-Break"><strong class="source-inline">Rooms</strong></span><span class="No-Break"> model:</span><pre class="source-code">
student_per_room = fields.Integer("Student Per Room", required=True,help="Students allocated per room")'
availability = fields.Float(compute="_compute_check_availability",string="Availability", help="Room availability in hostel")
@api.depends("student_per_room", "student_ids")
def _compute_check_availability(self):
    """Method to check room availability"""
    for rec in self:
rec.availability = rec.student_per_room - len(rec.student_ids.ids)</pre></li>				<li>By default, computed fields are read-only because the user should not enter <span class="No-Break">a value.</span><p class="list-inset">However, in some cases, it might be helpful to allow the user to set a value directly. For example, in our hostel student scenario, we will add an admission date, discharge date, and duration. We would like the user to be able to enter either the <a id="_idIndexMarker240"/>duration or the discharge date and have the other value <span class="No-Break">updated accordingly:</span></p><pre class="source-code">
admission_date = fields.Date("Admission Date",
    help="Date of admission in hostel",
    default=fields.Datetime.today)
discharge_date = fields.Date("Discharge Date",
    help="Date on which student discharge")
duration = fields.Integer("Duration",  compute="_compute_check_duration", inverse="_inverse_duration", help="Enter duration of living")
@api.depends("admission_date", "discharge_date")
def _compute_check_duration(self):
    """Method to check duration"""
    for rec in self:
        if rec.discharge_date and rec.admission_date:
            rec.duration = (rec.discharge_date - rec.admission_date).days
def _inverse_duration(self):
    for stu in self:
        if stu.discharge_date and stu.admission_date:
            duration = (stu.discharge_date - stu.admission_date).days
            if duration != stu.duration:
                stu.discharge_date = (stu.admission_date + timedelta(days=stu.duration)).strftime('%Y-%m-%d')</pre><p class="list-inset">A compute <a id="_idIndexMarker241"/>method assigns a value to the field, while an inverse method assigns values to the <span class="No-Break">field’s dependencies.</span></p><p class="list-inset">Note that the inverse method is invoked when the record is saved, while the compute method is invoked whenever any of its <span class="No-Break">dependencies change.</span></p></li>				<li>Computed fields are not stored in the database by default. One solution is to store the field with the <span class="No-Break"><strong class="source-inline">store=True</strong></span><span class="No-Break"> attribute:</span><pre class="source-code">
availability = fields.Float(compute="_compute_check_availability", store=True, string="Availability", help="Room availability in hostel")</pre><p class="list-inset">As computed fields are not stored in the database by default, it is not possible to search on a computed field unle<a id="_idTextAnchor181"/>ss we use the <strong class="source-inline">store=True</strong> attribute or add a <span class="No-Break"><strong class="source-inline">search</strong></span><span class="No-Break"> method.</span></p></li>			</ol>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor182"/>How it works...</h2>
			<p>A computed <a id="_idIndexMarker242"/>field looks like a regular field, except that it has a <strong class="source-inline">compute</strong> attribute that specifies the name of the method that computes <span class="No-Break">its value.</span></p>
			<p>However, computed fields are not the same as regular fields internally. Computed fields are calculated on the fly at runtime, and because of that, they are not stored in the database, so you cannot search or write on them by default. You need to do some extra work to enable writing and search support for them. Let’s see how to <span class="No-Break">do it.</span></p>
			<p>The computation method is calculated on the fly at runtime, but ORM uses caching to avoid recalculating it unnecessarily every time its value is accessed. So, it needs to know what other fields it relies on. It uses the <strong class="source-inline">@depends</strong> decorator to determine when its cached values should be invalidated <span class="No-Break">and recalculated.</span></p>
			<p>Make sure that the compute method always assigns a value to the computed field. Otherwise, an error will occur. This can happen when you have conditions in your code that sometimes fail to assign a value to the computed field. This can be hard <span class="No-Break">to debug.</span></p>
			<p>Write support can be added by implementing the <strong class="source-inline">inverse</strong> method. This uses the value assigned to the computed field to update the source fields. Of course, this only works for simple calculations. However, there are still cases where it can be helpful. In our example, we make it possible to set the discharge date by editing the duration days, since <strong class="source-inline">Duration</strong> is a <span class="No-Break">computed field.</span></p>
			<p>The <strong class="source-inline">inverse</strong> attribute is optional; if you don’t want to make the computed field editable, you can <span class="No-Break">skip it.</span></p>
			<p>It is also possible to make a non-stored computed field searchable by setting the <strong class="source-inline">search</strong> attribute to the method name (similar to <strong class="source-inline">compute</strong> and <strong class="source-inline">inverse</strong>). Like <strong class="source-inline">inverse</strong>, <strong class="source-inline">search</strong> is also optional; if you don’t want to make the computed field searchable, you can <span class="No-Break">skip it.</span></p>
			<p>However, this method is not supposed to perform the actual search. Instead, it receives the operator <a id="_idIndexMarker243"/>and value used to search on the field as parameters and is supposed to return a domain, with the alternative search conditions <span class="No-Break">to use.</span></p>
			<p>The optional <strong class="source-inline">store=True</strong> flag stores the field in the database. In this case, after being computed, the field values are stored in the database, and from then on, they are retrieved in the same way as regular fields, instead of being recomputed at runtime. Thanks to the <strong class="source-inline">@api.depends</strong> decorator, ORM will know when these stored values need to be recomputed and updated. You can think of it as a persistent cache. It also has the benefit of making the field usable for search conditions, including sorting and grouping by operations. If you use <strong class="source-inline">store=True</strong> in your compute field, you no longer need to implement the <strong class="source-inline">search</strong> method because the field is stored in a database, and you can search/sort based <span class="No-Break">on it.</span></p>
			<p>The <strong class="source-inline">compute_sudo=True</strong> flag is for cases where the computations need to be done with higher privileges. This might be needed when the computation needs to use data that may not be accessible to the <span class="No-Break">end user.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">The default value of <strong class="source-inline">compute_sudo</strong> changed in Odoo v13. Before Odoo v13, the value of <strong class="source-inline">compute_sudo</strong> was <strong class="source-inline">False</strong>, but in v13, the default value of <strong class="source-inline">compute_sudo</strong> depends on the store attribute. If the <strong class="source-inline">store</strong> attribute is <strong class="source-inline">True</strong>, then <strong class="source-inline">compute_sudo</strong> is <strong class="source-inline">True</strong>; otherwise, it is <strong class="source-inline">False</strong>. However, you can always override it <a id="_idTextAnchor183"/>by explicitly setting <strong class="source-inline">compute_sudo</strong> in your <span class="No-Break">field definition.</span></p>
			<h2 id="_idParaDest-155"><a id="_idTextAnchor184"/>There’s more...</h2>
			<p>Odoo v13 introduced <a id="_idIndexMarker244"/>a new caching mechanism for ORM. Previously, the cache was based on the environment, but now, in Odoo v13, there is one global cache. So, if you have a computed field that relies on context values, then you may get the wrong values sometimes. To solve this problem, you need to use the <strong class="source-inline">@api.depends_context</strong> decorator. Refer to the <span class="No-Break">following example:</span></p>
			<pre class="source-code">
    @api.depends('price')
    @api.depends_context('company_id')
    def _compute_value(self):
        company_id = self.env.context.get('company_id')
       ...
       # other computation</pre>			<p>You can see in <a id="_idIndexMarker245"/>the preceding example that our computation uses <strong class="source-inline">company_id</strong> from the context. By using <strong class="source-inline">company_id</strong> in the <strong class="source-inline">depends_context</strong> decorator, we ensure that the field value will <a id="_idTextAnchor185"/>be recomputed based on the value of <strong class="source-inline">company_id</strong> in <span class="No-Break">the context.</span></p>
			<h1 id="_idParaDest-156"><a id="_idTextAnchor186"/>Exposing related fields stored in other models</h1>
			<p>Odoo clients <a id="_idIndexMarker246"/>can only read data from the server for the fields that belong to the model they are querying. They cannot access data from related tables using dot notation as server-side <span class="No-Break">code can.</span></p>
			<p>However, we can make the data from related tables available to the clients by adding it as related fields. This is what<a id="_idTextAnchor187"/> we will do to get the hostel of the room in the <span class="No-Break">student model.</span></p>
			<h2 id="_idParaDest-157"><a id="_idTextAnchor188"/>Getting ready</h2>
			<p>We will conti<a id="_idTextAnchor189"/>nue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor190"/>How to do it...</h2>
			<p>Edit the <strong class="source-inline">models/hostel_student.py</strong> file to add the new <span class="No-Break"><strong class="source-inline">related</strong></span><span class="No-Break"> field.</span></p>
			<p>Ensure that we have a field for the hostel room, and then, we add a new relation field to link the student with <span class="No-Break">their hostel:</span></p>
			<pre class="source-code">
class HostelStudent(models.Model):
    _name = "hostel.student"
    # ...
    hostel_id = fields.Many2one("hostel.hostel", related='room_id.hostel_id')</pre>			<p>Finally, we need to upgrade the<a id="_idTextAnchor191"/> add-on module for the new field to be available in <span class="No-Break">the model.</span></p>
			<h2 id="_idParaDest-159"><a id="_idTextAnchor192"/>How it works...</h2>
			<p>A related field is a special type of field that references another field from a different record. To create <a id="_idIndexMarker247"/>a related field, we need to specify the <strong class="source-inline">related</strong> attribute and give it a string that shows the path of fields to follow. For example, we can create a related field that shows the hostel o<a id="_idTextAnchor193"/>f the room of a student by following the <span class="No-Break"><strong class="source-inline">room_id.hostel_id</strong></span><span class="No-Break"> path.</span></p>
			<h2 id="_idParaDest-160"><a id="_idTextAnchor194"/>There’s more...</h2>
			<p>Related fields are, in fact, computed fields. They just provide a convenient shortcut syntax to read field values from related models. As they are computed fields, this means that the <strong class="source-inline">store</strong> attribute is also available. As a shortcut, they also have all the attributes from the referenced field, such as <strong class="source-inline">name</strong> and <strong class="source-inline">translatable</strong>, <span class="No-Break">as required.</span></p>
			<p>Additionally, they support a <strong class="source-inline">related_sudo</strong> flag, similar to <strong class="source-inline">compute_sudo</strong>; when set to <strong class="source-inline">True</strong>, the field chain is traversed without checking the user <span class="No-Break">access rights.</span></p>
			<p>Using related fields in a <strong class="source-inline">create()</strong> method can affect performance, as the computation of these fields is delayed until the end of their creation. So, if you have an <strong class="source-inline">o2m</strong> relationship, such as in the <strong class="source-inline">sale.order</strong> and <strong class="source-inline">sale.order.line</strong> models, and you have a related field on the line model referring to a field on the order model, you should explicitly read the field on the order model during record creation, instead of using the<a id="_idTextAnchor195"/> related field shortcut, especially if there are a lot <span class="No-Break">of lines.</span></p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor196"/>Adding dynamic relations using reference fields</h1>
			<p>With relational fields, we need to decide the relation’s target model (or co-model) beforehand. However, sometimes, we may need to leave that decision to the user and first choose <a id="_idIndexMarker248"/>the model we want and <a id="_idIndexMarker249"/>then the record we want to l<a id="_idTextAnchor197"/>ink <span class="No-Break">it to.</span></p>
			<p>With Odoo, this can be achieved using <span class="No-Break">reference fields.</span></p>
			<h2 id="_idParaDest-162"><a id="_idTextAnchor198"/>Getting ready</h2>
			<p>We will co<a id="_idTextAnchor199"/>ntinue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-163"><a id="_idTextAnchor200"/>How to do it...</h2>
			<p>Edit the <strong class="source-inline">models/hostel.py</strong> file to add the new <span class="No-Break">related field:</span></p>
			<ol>
				<li>First, we need to add a helper method to dynamically build a list of selectable <span class="No-Break">target models:</span><pre class="source-code">
from odoo import models, fields, api
class Hostel(models.Model):
_name = 'hostel.hostel'
    # ...
    @api.model
    def _referencable_models(self):
        models = self.env['ir.model'].search([
            ('field_id.name', '=', 'message_ids')])
        return [(x.model, x.name) for x in models]</pre></li>				<li>Then, we need to add the reference field and use the previous function to provide a list of <span class="No-Break">selectable models:</span><pre class="source-code">
    ref_doc_id = fields.Reference(
        selection='_referencable_models',
        string='Reference Document')</pre></li>			</ol>
			<p>Since we are changing the model’<a id="_idTextAnchor201"/>s structure, a module upgrade is needed to activate <span class="No-Break">these changes.</span></p>
			<h2 id="_idParaDest-164"><a id="_idTextAnchor202"/>How it works...</h2>
			<p>Reference fields are similar to <strong class="source-inline">m2o</strong> fields, except that they allow the user to select the model to <span class="No-Break">link to.</span></p>
			<p>The target <a id="_idIndexMarker250"/>model is selectable from a <a id="_idIndexMarker251"/>list that’s provided by the <strong class="source-inline">selection</strong> attribute. The <strong class="source-inline">selection</strong> attribute <a id="_idIndexMarker252"/>must be a list of two-element tuples, where the first is the model’s internal identifier and the second is a text description <span class="No-Break">for it.</span></p>
			<p>Here’s <span class="No-Break">an example:</span></p>
			<pre class="source-code">
[('res.users', 'User'), ('res.partner', 'Partner')]</pre>			<p>However, rather than providing a fixed list, we can use the most common models. For simplicity, we used all the models that have the messaging feature. Using the <strong class="source-inline">_referencable_models</strong> method, we provided a model <span class="No-Break">list dynamically.</span></p>
			<p>Our recipe started by providing a function to browse all the model records that can be referenced, to dynamically build a list that will be provided to the <strong class="source-inline">selection</strong> attribute. Although both forms are allowed, we declared the function name inside quotes, instead of directly referencing the function without quotes. This is more flexible, and it allows for the referenced function to be defined only later in code, for example, which is something that is not possible when using a <span class="No-Break">direct reference.</span></p>
			<p>The function needs the <strong class="source-inline">@api.model</strong> decorator because it operates on the model level, not on the record <span class="No-Break">set level.</span></p>
			<p>While this feature looks nice, it comes with a significant execution overhead. Displaying the reference fields for a large number of records (for instance, in a list view) can create heavy database loads, as each value has to be looked up in a separate query. It is also unable to take advantage of database referential integrity, unlike regular <span class="No-Break">relation fields.</span></p>
			<h1 id="_idParaDest-165"><a id="_idTextAnchor203"/>Adding features to a model using inheritance</h1>
			<p>Odoo boasts a robust feature that significantly enhances its flexibility and functionality, which is <a id="_idIndexMarker253"/>particularly beneficial for businesses seeking tailored solutions. This feature enables the integration of module add-ons, allowing them to augment the capabilities of existing modules without the need to <a id="_idIndexMarker254"/>alter their underlying codebase. This is achieved through the addition or modification of fields and methods, as well as the extension of current methods with supplementary logic. This modular approach not only facilitates a customizable and scalable system but also ensures that upgrades and maintenance remain streamlined, preventing the complexities typically associated with <span class="No-Break">custom modifications.</span></p>
			<p>The official documentation describes three kinds of inheritance <span class="No-Break">in Odoo:</span></p>
			<ul>
				<li>Class <span class="No-Break">inheritance (extension)</span></li>
				<li><span class="No-Break">Prototype inheritance</span></li>
				<li><span class="No-Break">Delegation inheritance</span></li>
			</ul>
			<p>We will see each one of these in a separate recipe. In this recipe, we will see class inheritance (extension). This is used to add new fields or methods to <span class="No-Break">existing models.</span></p>
			<p>We’ll expand the existing partner model, <strong class="source-inline">res.partner</strong>, to include it in a computed field that calculates how many hostel rooms are assigned to each user. This will help dete<a id="_idTextAnchor204"/>rmine which section each room is assigned to and which user <span class="No-Break">occupies it.</span></p>
			<h2 id="_idParaDest-166"><a id="_idTextAnchor205"/>Getting ready</h2>
			<p>We wi<a id="_idTextAnchor206"/>ll continue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-167"><a id="_idTextAnchor207"/>How to do it...</h2>
			<p>We will extend the built-in partner model. If you remember, we already inherited the <strong class="source-inline">res.parnter</strong> model in the <em class="italic">Adding relational fields to a model</em> recipe in this chapter. To keep the explanation as simple as possible, we will reuse the <strong class="source-inline">res.partner</strong> model in the <strong class="source-inline">models/hostel_book.py</strong> <span class="No-Break">code file:</span></p>
			<ol>
				<li>First, we will ensure that the <strong class="source-inline">authored_book_ids</strong> inverse relation is in the partner model and add the <span class="No-Break">computed field:</span><pre class="source-code">
class ResPartner(models.Model):
   _inherit = "res.partner"
   is_hostel_rector = fields.Boolean("Hostel Rector", help="Activate if the following person is hostel rector")
   assign_room_ids = fields.Many2many('library.book',string='Authored Books')
   count_assign_room = fields.Integer( 'Number of Authored Books', compute="_compute_count_room")</pre></li>				<li>Next, add the <a id="_idIndexMarker255"/>method that’s needed to <a id="_idIndexMarker256"/>compute the <span class="No-Break">book count:</span><pre class="source-code">
@api.depends('assign_room_ids')
   def _compute_count_room(self):
       for partner in self:
           partner.count_assign_room = len(partner.assign_room_ids)</pre></li>				<li>Finally, w<a id="_idTextAnchor208"/>e need to upgrade the add-on module for the modifications to <span class="No-Break">take effect.</span></li>
			</ol>
			<h2 id="_idParaDest-168"><a id="_idTextAnchor209"/>How it works...</h2>
			<p>When a model class is defined with the <strong class="source-inline">_inherit</strong> attribute, it adds modifications to the inherited model, rather than <span class="No-Break">replacing it.</span></p>
			<p>This means that fields defined in the inheriting class are added or changed on the parent model. At the database layer, ORM adds fields to the same <span class="No-Break">database table.</span></p>
			<p>Fields are also incrementally modified. This means that if the field already exists in the superclass, only the attributes declared in the inherited class are modified; the other ones are kept as they are in the <span class="No-Break">parent class.</span></p>
			<p>Methods defined in the inheriting class replace methods in the parent class. If you don’t invoke the <a id="_idIndexMarker257"/>parent method with the <strong class="source-inline">super</strong> call, the parent’s version of the method will not be executed, and we will lose the features. So, whenever you add a new logic by inheriting existing methods, you should include <a id="_idIndexMarker258"/>a statement with <strong class="source-inline">super</strong> to call its version in the parent class. This is discussed in more detail in <a href="B20997_05.xhtml#_idTextAnchor238"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Basic </em><span class="No-Break"><em class="italic">Server-Side Development</em></span><span class="No-Break">.</span></p>
			<p>This recipe will add new fields to the existing model. If you also want to add these new fields to existing views (the user interface), refer to the <em class="italic">Changing existing views –</em> <em class="italic">view inheritance</em> recipe in <a href="B20997_09.xhtml#_idTextAnchor446"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <span class="No-Break"><em class="italic">Backend Views</em></span><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-169"><a id="_idTextAnchor210"/>Copying the model definition using inheritance</h1>
			<p>We saw <a id="_idIndexMarker259"/>class inheritance (extension) in the <a id="_idIndexMarker260"/>previous recipe. Now, we will see <strong class="bold">prototype inheritance</strong>, which is <a id="_idIndexMarker261"/>used to copy the entire definition of the<a id="_idTextAnchor211"/> existing model. In this recipe, we will make a copy of the <span class="No-Break"><strong class="source-inline">hostel.room</strong></span><span class="No-Break"> model.</span></p>
			<h2 id="_idParaDest-170">Getting read<a id="_idTextAnchor212"/>y</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-171"><a id="_idTextAnchor213"/>How to do it...</h2>
			<p>Prototype inheritance is executed by using the <strong class="source-inline">_name</strong> and <strong class="source-inline">_inherit</strong> class attributes at the same time. Perform the following steps to generate a copy of the <span class="No-Break"><strong class="source-inline">hotel.room</strong></span><span class="No-Break"> model:</span></p>
			<ol>
				<li>Add a new file called <strong class="source-inline">hostel_room_copy.py</strong> to the <strong class="source-inline">/</strong><span class="No-Break"><strong class="source-inline">my_hostel/models/</strong></span><span class="No-Break"> directory.</span></li>
				<li>Add the following content to the <span class="No-Break"><strong class="source-inline">hostel_room_copy.py</strong></span><span class="No-Break"> file:</span><pre class="source-code">
from odoo import fields, models, api, _
class HostelRoomCopy(models.Model):
   _name = "hostel.room.copy"
   _inherit="hostel.room"
   _description = "Hostel Room Information Copy"</pre></li>				<li>Import a new file reference into the <strong class="source-inline">/my_library/models/__init__.py</strong> file. Following the changes, your<strong class="source-inline"> __init__.py</strong> file will look <span class="No-Break">like this:</span><pre class="source-code">
from . import hostel_room
from . import hostel_room_copy</pre></li>				<li>Finally, we need <a id="_idIndexMarker262"/>to upgrade the add-on <a id="_idIndexMarker263"/>module for the modifications to <span class="No-Break">take effect.</span></li>
				<li>To check the new model’s definition, go to the <strong class="bold">Settings</strong> | <strong class="bold">Technical</strong> | <strong class="bold">Database Structure</strong> | <strong class="bold">Models</strong> menu. You will see a new entry for the <strong class="source-inline">hostel.room.copy</strong> <span class="No-Break">model here.</span></li>
			</ol>
			<p class="callout-heading"> Tip</p>
			<p class="callout">In order to see menus and views for the new model, you need to add the XML definition of views and menus. To learn more about views and menus, refer to th<a id="_idTextAnchor214"/>e <em class="italic">Adding menu items and views recipe</em> in <a href="B20997_03.xhtml#_idTextAnchor083"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Creating Odoo </em><span class="No-Break"><em class="italic">Add-On Modules</em></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-172"><a id="_idTextAnchor215"/>How it works...</h2>
			<p>By using <strong class="source-inline">_name</strong> with the <strong class="source-inline">_inherit</strong> class attribute at the same time, you can copy the definition of the model. When you use both attributes in the model, Odoo will copy the model definition of <strong class="source-inline">_inherit</strong> and create a new model with the <span class="No-Break"><strong class="source-inline">_name</strong></span><span class="No-Break"> attribute.</span></p>
			<p>In our example, Odoo will copy the definition of the <strong class="source-inline">Hostel.room</strong> model and create a new model, <strong class="source-inline">hostel.room.copy</strong>. The new <strong class="source-inline">hostel.room.copy</strong> model has its own database table with its own data that is totally independent from the <strong class="source-inline">hostel.room</strong> parent model. Since it still inherits from the partner model, any subsequent modifications to it will also affect the <span class="No-Break">new model.</span></p>
			<p>Prototype inheritance copies all the properties of the parent class. It copies fields, attributes, and methods. If you want to modify them in the child class, you can simply do so by adding <a id="_idIndexMarker264"/>a new definition to the child <a id="_idIndexMarker265"/>class. For example, the <strong class="source-inline">hostel.room </strong>model has the <strong class="source-inline">_name_get</strong> method. If you want to use a different version of <strong class="source-inline">_name_get</strong> in the child, you need to redefine the method in the <span class="No-Break"><strong class="source-inline">hostel.room.copy</strong></span><span class="No-Break"> model.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Prototype inheritance <a id="_idIndexMarker266"/>does not work if you use the same model name in the <strong class="source-inline">_inherit</strong> and <strong class="source-inline">_name</strong> attributes. If you do use the same model name in the <strong class="source-inline">_inh<a id="_idTextAnchor216"/>erit</strong> and <strong class="source-inline">_name</strong> attributes, it will just behave like a normal <span class="No-Break">extension inheritance.</span></p>
			<h2 id="_idParaDest-173"><a id="_idTextAnchor217"/>There’s more…</h2>
			<p>In the official documentation, this is called prototype inheritance, but in practice, it is rarely used. The reason for this is that delegation inheritance usually answers to that need in a <a id="_idIndexMarker267"/>more efficient way, without the need to <strong class="bold">duplicate data structures</strong>. For more information on this, you can refer<a id="_idTextAnchor218"/> to the next recipe, Using delegation inheritance to copy features to <span class="No-Break">another model.</span></p>
			<h1 id="_idParaDest-174"><a id="_idTextAnchor219"/>Using delegation inheritance to copy features to another model</h1>
			<p>The third type of inheritance is Delegation inheritance. Instead of <strong class="source-inline">_inherit</strong>, it uses the <strong class="source-inline">_inherits</strong> class attribute. There are cases where, rather than modifying an existing model, we want to create a new model based on an existing one to use the features it already has. We can copy a model’s definitions with prototype inheritance, but this will generate duplicate data structures. If you want to copy a model’s definitions without duplicating data structures, then the answer lies in Odoo’s delegation inheritance, which uses the <strong class="source-inline">_inherits</strong> model attribute (note the <span class="No-Break">additional </span><span class="No-Break"><strong class="source-inline">s</strong></span><span class="No-Break">).</span></p>
			<p>Traditional inheritance is quite different from the similarly named concept in object-oriented programming. Delegation inheritance, in turn, is similar, in that a new model can be created to include the features from a parent model. It also supports polymorphic inheritance, where we inherit from two or more <span class="No-Break">other models.</span></p>
			<p>We operate a hostel that accommodates both rooms and students. To better manage our accommodations, it’s essential to integrate student-related information into our system. Specifically, for each student, we require comprehensive identification and address details, similar to those captured in the partner model. Additionally, it’s crucial to maintain records related to room allocation, including the start and end dates of each student’s stay and their <span class="No-Break">card number.</span></p>
			<p>Directly adding <a id="_idIndexMarker268"/>these fields to the existing partner <a id="_idIndexMarker269"/>model isn’t an ideal approach, as it would unnecessarily clutter the model with student-specific data that is irrelevant for non-student partners. A more effective solution would be to enhance the partner model by creating a new model that inherits from it and introduces the additional fields required to manage student information. This approach ensures a cleaner, mo<a id="_idTextAnchor220"/>re organized, and functionally efficient system to cater to our hostel’s <span class="No-Break">unique needs.</span></p>
			<h2 id="_idParaDest-175">Gett<a id="_idTextAnchor221"/>ing ready</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-176"><a id="_idTextAnchor222"/>How to do it...</h2>
			<p>The new library member model should be in its own Python code file, but to keep the explanation as simple as possible, we will reuse the <span class="No-Break"><strong class="source-inline">models/hostel_student.py</strong></span><span class="No-Break"> file:</span></p>
			<ol>
				<li>Add the new model, inheriting <span class="No-Break">from </span><span class="No-Break"><strong class="source-inline">res.partner</strong></span><span class="No-Break">:</span><pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _inherits = {'res.partner': 'partner_id'}
   _description = "Hostel Student Information"
   ………
   partner_id = fields.Many2one('res.partner', ondelete='cascade')</pre></li>				<li>Next, we will add the fields that are specific to <span class="No-Break">each student:</span><pre class="source-code">
gender = fields.Selection([("male", "Male"),
       ("female", "Female"), ("other", "Other")],
       string="Gender", help="Student gender")
   room_id = fields.Many2one("hostel.room", "Room",
       help=<a id="_idTextAnchor223"/>"Select hostel room")</pre></li>			</ol>
			<p>Now, we should upgrade the add-on module to activate <span class="No-Break">the changes.</span></p>
			<h2 id="_idParaDest-177"><a id="_idTextAnchor224"/>How it works...</h2>
			<p>The <strong class="source-inline">_inherits</strong> model attribute sets the parent models that we want to inherit from. In this case, we just have one – <strong class="source-inline">res.partner</strong>. Its value is a key-value dictionary, where the <a id="_idIndexMarker270"/>keys are the inherited models and the <a id="_idIndexMarker271"/>values are the field names that were used to link to them. These are <strong class="source-inline">m2o</strong> fields that we must also define in the model. In our example, <strong class="source-inline">partner_id</strong> is the field that will be used to link with the <strong class="source-inline">Partner</strong> <span class="No-Break">parent model.</span></p>
			<p>To better understand how this works, let’s look at what happens at a database level when we create a <span class="No-Break">new member:</span></p>
			<ul>
				<li>A new record is created in the <span class="No-Break"><strong class="source-inline">res_partner</strong></span><span class="No-Break"> table.</span></li>
				<li>A new record is created in the <span class="No-Break"><strong class="source-inline">hostel_student</strong></span><span class="No-Break"> table.</span></li>
				<li>The <strong class="source-inline">partner_id</strong> field of the <strong class="source-inline">hostel_student</strong> table is set to the ID of the <strong class="source-inline">res_partner</strong> record that is created <span class="No-Break">for it</span></li>
			</ul>
			<p>The member record is automatically linked to a new partner record. It’s just an <strong class="source-inline">m2o</strong> relationship, but the delegation mechanism adds some magic so that the partner’s fields are seen as if they belong to the member record, and a new partner record is also automatically created with the <span class="No-Break">new member.</span></p>
			<p>You may be interested to know that this automatically created partner record has nothing special about it. It’s a regular partner, and if you browse the partner model, you will be able to find that record (without the additional member data, of course). All members are partners, but only some partners are also members. So, what happens if you delete a partner record that is also a member? You decide by choosing the <strong class="source-inline">ondelete</strong> value for the relation field. For <strong class="source-inline">partner_id</strong>, we used <strong class="source-inline">cascade</strong>. This means that deleting the partner will also delete the corresponding member. We could have used the <a id="_idIndexMarker272"/>more conservative setting, <strong class="source-inline">restrict</strong>, to prohibit deleting the partner while it has a linked member. In this case, only deleting the member <span class="No-Break">will work.</span></p>
			<p>It’s important <a id="_idIndexMarker273"/>to note that delegation inheritance only works for fields, not for methods. So, if the partne<a id="_idTextAnchor225"/>r model has a <strong class="source-inline">do_something()</strong> method, the members model will not automatically <span class="No-Break">inherit it.</span></p>
			<h2 id="_idParaDest-178"><a id="_idTextAnchor226"/>There’s more...</h2>
			<p>There is a shortcut for this inheritance delegation. Instead of creating an <strong class="source-inline">_inherits</strong> dictionary, you can use the <strong class="source-inline">delegate=True</strong> attribute in the <strong class="source-inline">m2o</strong> field definition. This will work exactly like the <strong class="source-inline">_inherits</strong> option. The main advantage is that this is simpler. In the given example, we performed the same inheritance delegation as in the previous one, but in this case, instead of creating an <strong class="source-inline">_inherits</strong> dictionary, we used the <strong class="source-inline">delegate=True</strong> option in the <span class="No-Break"><strong class="source-inline">partner_id</strong></span><span class="No-Break"> field:</span></p>
			<pre class="source-code">
class HostelStudent(models.Model):
   _name = "hostel.student"
   _description = "Hostel Student Information"
   partner_id = fields.Many2one('res.partner', ondelete='cascade', delegate=True)</pre>			<p>A noteworthy case of delegation inheritance is the users model, <strong class="source-inline">res.users</strong>. It inherits from partners (<strong class="source-inline">res.partner</strong>). This means that some of the fields that you can see on the user are actually stored in the partner model (notably, the <strong class="source-inline">name</strong> field). When a new user is created, we also get a new, automatically <span class="No-Break">created partner.</span></p>
			<p>We should also mention that traditional inheritance with <strong class="source-inline">_inherit</strong> can also copy features into a new model, although in a less eff<a id="_idTextAnchor227"/>icient way. This was discussed in the <em class="italic">Adding features to a model using </em><span class="No-Break"><em class="italic">inheritance</em></span><span class="No-Break"> recipe.</span></p>
			<h1 id="_idParaDest-179"><a id="_idTextAnchor228"/>Using abstract models for reusable model features</h1>
			<p>Sometimes, there is a particular feature that we want to be able to add to several different <a id="_idIndexMarker274"/>models. Repeating the same code in different files is a bad programming practice; it would be better to implement it once and <span class="No-Break">reuse it.</span></p>
			<p>Abstract <a id="_idIndexMarker275"/>models allow us to create a generic model that implements some features that can then be inherited by regular models, in order to make that <span class="No-Break">feature available.</span></p>
			<p>As an example, we will implement a simple archive feature. This adds the <strong class="source-inline">active</strong> field to the model (if it doesn’t exist already) and makes an archive method available to toggle the <strong class="source-inline">active</strong> flag. This works because <strong class="source-inline">active</strong> is a magic field. If it is present in a model by default, the records with <strong class="source-inline">active<a id="_idTextAnchor229"/>=False</strong> will be filtered out from the queries. We will then add it to the <strong class="source-inline">hostel </strong><span class="No-Break"><strong class="source-inline">room</strong></span><span class="No-Break"> model.</span><a id="_idTextAnchor230"/></p>
			<h2 id="_idParaDest-180"><a id="_idTextAnchor231"/>Getting ready</h2>
			<p>We will continue using the <strong class="source-inline">my_hostel</strong> add-on module from the <span class="No-Break">previous recipe.</span></p>
			<h2 id="_idParaDest-181"><a id="_idTextAnchor232"/>How to do it...</h2>
			<p>The archive feature certainly deserves its own add-on module, or at least its own Python code file. However, to keep the explanation as simple as possible, we will cram it into the <span class="No-Break"><strong class="source-inline">models/hostel_room.py</strong></span><span class="No-Break"> file:</span></p>
			<ol>
				<li>Add the abstract model for the archive feature. It must be defined in the library book model, where it will <span class="No-Break">be used:</span><pre class="source-code">
class BaseArchive(models.AbstractModel):
   _name = 'base.archive'
   active = fields.Boolean(default=True)
   def do_archive(self):
       for record in self:
           record.active = not record.active</pre></li>				<li>Now, we will edit the Hostel Room model to inherit the <span class="No-Break">archive model:</span><pre class="source-code">
class HostelRoom(models.Model):
   _name = "hostel.room"
   _inherit = ['base.arch<a id="_idTextAnchor233"/>ive']</pre></li>			</ol>
			<p>An upgrade of the add-on module is required in order for the changes to <span class="No-Break">be activated.</span></p>
			<h2 id="_idParaDest-182"><a id="_idTextAnchor234"/>How it works...</h2>
			<p>An abstract <a id="_idIndexMarker276"/>model is created by a class based on <strong class="source-inline">models.AbstractModel</strong>, instead of the usual <strong class="source-inline">models.Model</strong>. It has all the attributes and capabilities of regular models; the difference <a id="_idIndexMarker277"/>is that ORM will not create an actual representation for it in the database. This means that it can’t have any data stored in it. It only serves as a template for a reusable feature that will be added to <span class="No-Break">regular models.</span></p>
			<p>Our archive abstract model is quite simple. It just adds the <strong class="source-inline">active</strong> field and a method to toggle the value of the <strong class="source-inline">active</strong> flag, which we expect to be used later, via a button on the user interface. When a model class is defined with the <strong class="source-inline">_inherit</strong> attribute, it inherits the attribute methods of those classes, and the attribute methods that are defined in the current class add modifications to those <span class="No-Break">inherited features.</span></p>
			<p>The mechanism at play here is the same as that of a regular model extension (as per the <em class="italic">Adding features to a model using inheritance</em> recipe). You may have noticed that <strong class="source-inline">_inherit</strong> uses a list of model identifiers instead of a string with one model identifier. In fact, <strong class="source-inline">_inherit</strong> can have both forms. Using the list form allows us to inherit from multiple (usually <strong class="source-inline">Abstract</strong>) classes. In this case, we inheri<a id="_idTextAnchor235"/>t<a id="_idTextAnchor236"/> just one, so a text string would be fine. A list was used instead, for <span class="No-Break">illustration purposes.</span></p>
			<h2 id="_idParaDest-183"><a id="_idTextAnchor237"/>There’s more...</h2>
			<p>A noteworthy <a id="_idIndexMarker278"/>built-in abstract <a id="_idIndexMarker279"/>model is <strong class="source-inline">mail.thread</strong>, which is provided by the <strong class="source-inline">mail (Discuss)</strong> add-on module. On models, it enables the discussion features that power the message wall that’s seen at the bottom of <span class="No-Break">many forms.</span></p>
			<p>Other than <strong class="source-inline">AbstractModel</strong>, a third model type is available – <strong class="source-inline">models.TransientModel</strong>. This has a database representation like <strong class="source-inline">models.Model</strong>, but the records that are created there are supposed to be temporary and regularly purged by a server-scheduled job. Other than that, transient models work just like <span class="No-Break">regular models.</span></p>
			<p><strong class="source-inline">models.TransientModel</strong> is useful for more complex user interactions, known as <strong class="bold">wizards</strong>. A wizard is <a id="_idIndexMarker280"/>used to request inputs from the user. In <a href="B20997_08.xhtml#_idTextAnchor388"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Advanced Server-Side Development Techniques</em>, we will explore how to use these for advanced <span class="No-Break">user interaction.</span></p>
		</div>
	</body></html>