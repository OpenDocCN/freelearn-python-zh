<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Testing on Mobile</h1></div></div></div><p>With the ever increasing number of mobile users all over the world, the adoption of smartphones and tablets has increased quite significantly. Mobile apps have penetrated consumer and enterprise markets replacing desktops and laptops with smart devices. Small businesses and large-scale enterprises have a great potential to use mobile as a channel to connect with users. There is a lot of effort being taken to build mobile-friendly websites and native applications to serve customers and employees. Testing these apps on various mobile platforms available in the market has become crucial. This chapter will teach you more on <a id="id467" class="indexterm"/>how to test mobile apps using Selenium WebDriver and more specifically using <strong>Appium</strong>.</p><p>In this chapter, you will learn about:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Testing mobile apps with Appium</li><li class="listitem" style="list-style-type: disc">Installing and setting up Appium</li><li class="listitem" style="list-style-type: disc">Creating and running tests for iOS on iPhone simulator</li><li class="listitem" style="list-style-type: disc">Creating and running tests for Android on a real device</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec38"/>Introducing Appium</h1></div></div></div><p>Appium is an open <a id="id468" class="indexterm"/>source test automation framework for testing native and hybrid mobile apps on iOS, Android, and Firefox OS platforms using the JSON wire protocol used by the Selenium WebDriver tests to communicate with the Selenium Server. Appium will replace the <code class="literal">iPhoneDriver</code> and <code class="literal">AndroidDriver</code> APIs in Selenium 2 used for testing mobile web applications.</p><p>Appium allows us to use and extend the existing Selenium WebDriver framework to build mobile tests. As it uses Selenium WebDriver to drive the tests, we can use any language to create tests for which the Selenium client library exists. Here is the Appium coverage map with support for different platforms and application types:</p><div><img src="img/3506OS_07_01.jpg" alt="Introducing Appium"/></div><p>Appium supports testing of the following types of apps:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Native apps</strong>: Native <a id="id469" class="indexterm"/>apps are platform-specific apps built using the platform-supported languages and frameworks. For example, apps for <a id="id470" class="indexterm"/>iPhone and iPad are developed using Objective-C with iOS SDK; similarly, Android apps are developed using Java with Android SDK. In terms of performance, native apps are fast and more reliable. They use the native framework for the user interface.</li><li class="listitem" style="list-style-type: disc"><strong>Mobile web apps</strong>: Mobile web apps are server-side apps, built with any server-side <a id="id471" class="indexterm"/>technology such as PHP, Java, or ASP.NET, and use frameworks such as jQuery Mobile, Sencha Touch, and so on to <a id="id472" class="indexterm"/>render a user interface that mimics the native UI.</li><li class="listitem" style="list-style-type: disc"><strong>Hybrid apps</strong>: Similar <a id="id473" class="indexterm"/>to the native apps, hybrid apps run on the device and are written with web technologies (HTML5, CSS, and JavaScript). Hybrid apps use the device's browser engine to render the <a id="id474" class="indexterm"/>HTML and process the JavaScript locally inside a native container using WebView. This enables the app to access device capabilities that are not accessible in mobile web apps, such as the camera, accelerometer, sensors, and local storage.</li></ul></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec46"/>Prerequisites for Appium</h2></div></div></div><p>Before you get <a id="id475" class="indexterm"/>started with learning more about Appium, you will need some tools for iOS and Android platforms.</p><div><div><h3 class="title"><a id="note14"/>Note</h3><p>Appium is built on Node.js and comes as a Node.js package as well as standalone GUI on Mac OS X and Windows. We will use Appium standalone GUI which comes with <a id="id476" class="indexterm"/>built-in Node.js on Mac OS X.</p></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec20"/>Setting up Xcode for iOS</h3></div></div></div><p>We need <a id="id477" class="indexterm"/>Xcode 4.6.3 or higher, installed on Mac OS X, for testing apps for the iOS platform. While writing this book, Xcode 5.1 was used. You <a id="id478" class="indexterm"/>can get Xcode from the App Store or developer portal at <a class="ulink" href="https://developer.apple.com/xcode/">https://developer.apple.com/xcode/</a>.</p><p>After installing <a id="id479" class="indexterm"/>Xcode, launch it from the <strong>Applications</strong> menu and navigate to <strong>Preferences</strong> | <strong>Downloads</strong>, and install <strong>Command Line Tools</strong> and additional iOS SDKs for testing applications on different versions of the iOS platform, as shown in the following screenshot:</p><div><img src="img/3506OS_07_02.jpg" alt="Setting up Xcode for iOS"/></div><p>For running tests on a real device, you need a provision profile installed on the device and USB debugging enabled on it.</p><p>Try to launch the iPhone simulator and verify that it works. You can launch the simulator by navigating to <strong>Xcode</strong> | <strong>Open Developer Tool</strong> | <strong>iOS Simulator</strong>. Launch Safari in the simulator and <a id="id480" class="indexterm"/>open the mobile web app version of the sample application <a class="ulink" href="http://demo.magentocommerce.com">http://demo.magentocommerce.com</a> in Safari as shown <a id="id481" class="indexterm"/>in the following screenshot:</p><div><img src="img/3506OS_07_03.jpg" alt="Setting up Xcode for iOS"/></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec21"/>Setting up Android SDK</h3></div></div></div><p>We will need the <a id="id482" class="indexterm"/>Android SDK installed for testing Android apps. Android SDK is available for download at <a class="ulink" href="http://developer.android.com/sdk/">http://developer.android.com/sdk/</a>. This will get us the latest version of the SDK. After the installation, please make sure <code class="literal">ANDROID_HOME</code> is added to the path. Complete installation steps <a id="id483" class="indexterm"/>are available at <a class="ulink" href="http://developer.android.com/sdk/installing/index.html?pkg=tools">http://developer.android.com/sdk/installing/index.html?pkg=tools</a>.</p><div><div><h3 class="title"><a id="note15"/>Note</h3><p>For detailed and latest installation requirements visit <a class="ulink" href="http://appium.io/getting-started.html#requirements">http://appium.io/getting-started.html#requirements</a>.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec22"/>Setting up the Appium Python client package</h3></div></div></div><p>The <a id="id484" class="indexterm"/>Appium Python client was fully compliant with the Selenium 3.0 specification draft at the time of writing this <a id="id485" class="indexterm"/>book. It offers some helpers to make mobile testing in Python easier with Appium. This can be installed using the following command:</p><div><pre class="programlisting">
<strong>pip install Appium-Python-Client</strong>
</pre></div><div><div><h3 class="title"><a id="note16"/>Note</h3><p>More <a id="id486" class="indexterm"/>information on the Appium Python client package is available at <a class="ulink" href="https://pypi.python.org/pypi/Appium-Python-Client">https://pypi.python.org/pypi/Appium-Python-Client</a>.</p></div></div></div></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec39"/>Installing Appium</h1></div></div></div><p>Before <a id="id487" class="indexterm"/>we start testing mobile apps with Appium, we need to download and install Appium. We will use the Appium GUI version. If you wish to run tests for iOS on iPhone or iPad, then you need to set up Appium on a Mac OS X machine. For testing Android applications, you can set up the environment on a Windows or Linux machine. Setting up Appium is fairly easy with the new Appium app for Mac OS X. You can download the latest Appium binaries from <a class="ulink" href="http://appium.io/">http://appium.io/</a>. Follow the given steps to install Appium:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>Download Appium</strong> button on the front page and you will be directed to the download page.<div><img src="img/3506OS_07_04.jpg" alt="Installing Appium"/></div></li><li class="listitem">Select the version specific to the operating system you are using from the list as shown <a id="id488" class="indexterm"/>in the following screenshot:<div><img src="img/3506OS_07_05.jpg" alt="Installing Appium"/></div><div><div><h3 class="title"><a id="note17"/>Note</h3><p>In the following examples, we will be using Appium on Mac OS X.</p></div></div></li><li class="listitem">You can install Appium on Mac by launching the installer and copying Appium to the <code class="literal">Applications</code> folder.<p>When you launch Appium from the <code class="literal">Applications</code> menu for the first time, it will ask for authorization to run the iOS simulators.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>By default, Appium starts at <code class="literal">http://127.0.0.1:4723</code> or localhost. This is the URL to which your test should direct the test commands. We will be testing the mobile version of the sample application that we used in the book on iPhone Safari browser.</p></div></div></li><li class="listitem">On the main <a id="id489" class="indexterm"/>window of Appium, click on the Apple icon to open iOS settings:<div><img src="img/3506OS_07_06.jpg" alt="Installing Appium"/></div></li><li class="listitem">On the <strong>iOS Settings</strong> dialog, select the <strong>Force Device</strong> checkbox and specify <strong>iPhone 4s</strong> in the iOS section. Also, select the <strong>Use Mobile Safari</strong> checkbox as shown in the following screenshot:<div><img src="img/3506OS_07_07.jpg" alt="Installing Appium"/></div></li><li class="listitem">Click on the <a id="id490" class="indexterm"/><strong>Launch</strong> button in the Appium window to start the Appium server.</li></ol></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec47"/>Appium Inspector</h2></div></div></div><p>Appium also <a id="id491" class="indexterm"/>comes with a spy tool called <strong>Appium Inspector</strong>. We can launch the Appium Inspector by clicking on the magnifying glass icon on Appium's main window.</p><p>The Inspector provides a lot of options to analyze the app under test. One of the main features it offers is how the UI elements are used in the app, the structure or hierarchy of the elements, and the properties of these elements, which we can use in defining the locator strings.</p><p>You can also simulate various gestures on the app and see their effect on the simulator. It also offers an ability <a id="id492" class="indexterm"/>to record the steps you perform on the app.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec40"/>Testing on iOS</h1></div></div></div><p>Appium drives <a id="id493" class="indexterm"/>automation using various native automation frameworks and provides an API based on Selenium's WebDriver JSON wire protocol. For automating iOS applications, it uses the UI Automation feature offered as part of Apple Instruments.</p><p>Appium works as an HTTP server and receives the commands from test scripts over the JSON wire protocol. Appium sends these commands to Apple Instruments so that the commands can be executed on the app launched in a simulator or real device. While doing so, Appium translates the JSON commands into UI Automation JavaScript commands that are understood by the Instruments. The Instruments take care of launching and closing the app in the simulator or device. This process is shown in the following diagram:</p><div><img src="img/3506OS_07_08.jpg" alt="Testing on iOS"/></div><p>When a command is executed against the app on the simulator or device, the target app sends the response back to the Instruments, which then sends it back to Appium in the JavaScript response format. Appium translates the UI Automation JavaScript responses into Selenium WebDriver JSON wire protocol responses and sends them back to the test script.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec48"/>Writing a test for iOS</h2></div></div></div><p>Now, we <a id="id494" class="indexterm"/>have the Appium running; let's create a test that will check the search <a id="id495" class="indexterm"/>functionality in the iPhone Safari browser. Create a new test, <code class="literal">SearchProductsOnIPhone</code>, with the following code:</p><div><pre class="programlisting">import unittest
from appium import webdriver


class SearchProductsOnIPhone(unittest.TestCase):
    def setUp(self):
        desired_caps = {}
        # platform
        desired_caps['device'] = 'iPhone Simulator'
        # platform version
        desired_caps['version'] = '7.1'
        # mobile browser
        desired_caps['app'] = 'safari'

        # to connect to Appium server use RemoteWebDriver
        # and pass desired capabilities
        self.driver = \
            webdriver.Remote("http://127.0.0.1:4723/wd/hub", desired_caps)
        self.driver.get("http://demo.magentocommerce.com/")
        self.driver.implicitly_wait(30)
        self.driver.maximize_window()

    def test_search_by_category(self):

        # click on search icon
        self.driver.find_element_by_xpath("//a[@href='#header-search']").click()
        # get the search textbox
        self.search_field = self.driver.find_element_by_name("q")
        self.search_field.clear()

        # enter search keyword and submit
        self.search_field.send_keys("phones")
        self.search_field.submit()

        # get all the anchor elements which have product names # displayed currently on result page using # find_elements_by_xpath method
        products = self.driver\
            .find_elements_by_xpath("//div[@class='category-products']/ul/li")

        # check count of products shown in results
        self.assertEqual(2, len(products))

    def tearDown(self):
        # close the browser window
        self.driver.quit()

if __name__ == '__main__':
    unittest.main(verbosity=2)</pre></div><p>We need <code class="literal">RemoteWebDriver</code> to run the tests with Appium. However, for Appium to use the desired <a id="id496" class="indexterm"/>platform, we need to pass a set of desired capabilities as shown <a id="id497" class="indexterm"/>in the following code:</p><div><pre class="programlisting">desired_caps = {}
# platform
desired_caps['device'] = 'iPhone Simulator'
# platform version
desired_caps['version'] = '7.1'
# mobile browser
desired_caps['app'] = 'safari'</pre></div><p>The <code class="literal">desired_caps['device']</code> capability is used by Appium to decide on which the platform the test script should get executed. In this example, we used <code class="literal">iPhone Simulator</code>. For running tests on iPad, we can specify the iPad Simulator.</p><p>When running tests on a real device, we need to specify the value <code class="literal">iPhone</code> or <code class="literal">iPad</code> for device capability. Appium will pick the device that is connected to the Mac via USB.</p><p>The <code class="literal">desired_caps['version']</code> capability is the version of iPhone/iPad simulator that we want to use. In this example, iOS 7.1 simulator is used, which was the latest the version of iOS at the time of writing this book.</p><p>The last desired capability we used is <code class="literal">desired_caps['app']</code>, which is used by Appium to launch the target app. In this case, it will launch the Safari browser.</p><p>Finally, we need to connect to the Appium server using <code class="literal">RemoteWebDriver</code> and the desired capabilities that we need. This is done by creating an instance of <code class="literal">Remote</code> as shown in following code:</p><div><pre class="programlisting">self.driver = webdriver.Remote("http://127.0.0.1:4723/wd/hub", desired_caps)</pre></div><p>The rest of the test uses the Selenium API to interact with the mobile web version of the application. Run the test normally. You will see that Appium establishes a session with test scripts and launches the iPhone Simulator with the Safari app. Appium will execute all the test steps by <a id="id498" class="indexterm"/>running commands on the Safari app in the simulator <a id="id499" class="indexterm"/>window.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec41"/>Testing on Android</h1></div></div></div><p>Appium drives <a id="id500" class="indexterm"/>the automation of Android applications using the UI Automator bundled with Android SDK. The process is quite similar to testing on iOS.</p><p>Appium works as an <a id="id501" class="indexterm"/>HTTP server and receives the commands from test scripts over JSON wire protocol. Appium sends these commands to the UI Automator so that they can be executed on the app launched in an emulator or real device. While doing so, Appium translates the JSON commands into the UI Automator Java commands that are understood by Android SDK. This process is shown in the following diagram:</p><div><img src="img/3506OS_07_09.jpg" alt="Testing on Android"/></div><p>When a command is executed against the app on the emulator or device, the target app sends the response back to the UI Automator, which sends it back to Appium. It translates the UI Automator responses into Selenium WebDriver JSON wire protocol responses and sends them back to the test script.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec49"/>Writing a test for Android</h2></div></div></div><p>Testing <a id="id502" class="indexterm"/>apps on Android is pretty much similar to what we did for iOS. For Android, we will use a real device instead of an emulator (a simulator is called an emulator in the Android community). We will use the same application for testing in Chrome for Android.</p><p>For this <a id="id503" class="indexterm"/>example, I am using Samsung Galaxy S III handset. We need to install the Chrome browser on the device. You can get Google Chrome on the Play Store. Next, we need to connect the device to the machine where the Appium server is running.</p><p>Now, we will work on Android. Here, we will try to execute our test scripts on the Android real device. We need to make sure we have installed Chrome on our Android device and connect our device to our machine. Let's run the following command to get a list of emulators or devices connected to the machine:</p><div><pre class="programlisting">
<strong>./adb devices</strong>
</pre></div><p>
<strong>Android Debug </strong>
<a id="id504" class="indexterm"/>
<strong>Bridge</strong> (<strong>adb</strong>) is a command-line tool available in Android SDK that lets you communicate with an emulator instance or the connected real device.</p><p>The previous <a id="id505" class="indexterm"/>command will display a list of all the Android devices that are connected to the host. In this example, we have connected to a real device that is listed as shown in the following screenshot:</p><div><img src="img/3506OS_07_10.jpg" alt="Writing a test for Android"/></div><p>Let's use the test that we created for iOS and modify it for Android. We will create a new test, <code class="literal">SearchProductsOnAndroid</code>. Copy the following code to the newly created test:</p><div><pre class="programlisting">import unittest
from appium import webdriver


class SearchProductsOnAndroid(unittest.TestCase):
    def setUp(self):
        desired_caps = {}
        # platform
        desired_caps['device'] = 'Android'
        # platform version
        desired_caps['version'] = '4.3'
        # mobile browser
        desired_caps['app'] = 'Chrome'

        # to connect to Appium server use RemoteWebDriver
        # and pass desired capabilities
        self.driver = \
            webdriver.Remote("http://127.0.0.1:4723/wd/hub", desired_caps)
        self.driver.get("http://demo.magentocommerce.com/")
        self.driver.implicitly_wait(30)

    def test_search_by_category(self):

        # click on search icon
        self.driver.find_element_by_xpath("//a[@href='#header-search']").click()
        # get the search textbox
        self.search_field = self.driver.find_element_by_name("q")
        self.search_field.clear()

        # enter search keyword and submit
        self.search_field.send_keys("phones")
        self.search_field.submit()

        # get all the anchor elements which have product names # displayed currently on result page using # find_elements_by_xpath method
        products = self.driver\
            .find_elements_by_xpath("//div[@class='category-products']/ul/li")

        # check count of products shown in results
        self.assertEqual(2, len(products))

    def tearDown(self):
        # close the browser window
        self.driver.quit()

if __name__ == '__main__':
    unittest.main(verbosity=2)</pre></div><p>In this example, we assigned the <code class="literal">desired_caps['device']</code> capability value to Android, which will be used by the Appium to run tests on Android.</p><p>Next, we mentioned the Android Version 4.3 (Jelly Bean) in the <code class="literal">desired_caps['version']</code> capability. As we want to run tests in Chrome for Android, we mentioned Chrome in the <code class="literal">desired_caps['app']</code> capability.</p><p>Appium will use the first device from the list of devices that adb returns. It will use the desired capabilities <a id="id506" class="indexterm"/>that we mentioned, launch the Chrome browser <a id="id507" class="indexterm"/>on the device, and start executing the test script commands, as shown in the following screenshot:</p><div><img src="img/3506OS_07_11.jpg" alt="Writing a test for Android"/></div><p>Here is the screenshot of the test running on a real device:</p><div><img src="img/3506OS_07_12.jpg" alt="Writing a test for Android"/></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec42"/>Using Sauce Labs</h1></div></div></div><p>We looked at <a id="id508" class="indexterm"/>Sauce Labs for cross-browser testing in <a class="link" href="ch06.html" title="Chapter 6. Cross-browser Testing">Chapter 6</a>, <em>Cross-browser Testing</em>. Sauce also provides support for testing mobile applications using Appium. In fact, the Appium project is developed and supported by Sauce Labs. With minimal changes to the desired capabilities, we can run mobile tests in Sauce Labs with the following code:</p><div><pre class="programlisting">import unittest
from appium import webdriver


class SearchProductsOnIPhone(unittest.TestCase):
    SAUCE_USERNAME = 'upgundecha'
    SUACE_KEY = 'c6e7132c-ae27-4217-b6fa-3cf7df0a7281'

    def setUp(self):

        desired_caps = {}
        desired_caps['browserName'] = "Safari"
        desired_caps['platformVersion'] = "7.1"
        desired_caps['platformName'] = "iOS"
        desired_caps['deviceName'] = "iPhone Simulator"

        sauce_string = self.SAUCE_USERNAME + ':' + self.SUACE_KEY

        self.driver = \
            webdriver.Remote('http://' + sauce_string + '@ondemand.saucelabs.com:80/wd/hub', desired_caps)
        self.driver.get('http://demo.magentocommerce.com/')
        self.driver.implicitly_wait(30)
        self.driver.maximize_window()

    def test_search_by_category(self):
        # click on search icon
        self.driver.find_element_by_xpath("//a[@href='#header-search']").click()
        # get the search textbox
        self.search_field = self.driver.find_element_by_name("q")
        self.search_field.clear()

        # enter search keyword and submit
        self.search_field.send_keys("phones")
        self.search_field.submit()

        # get all the anchor elements which have
        # product names displayed
        # currently on result page using 
        # find_elements_by_xpath method
        products = self.driver\
            .find_elements_by_xpath("//div[@class='category-products']/ul/li")

        # check count of products shown in results
        self.assertEqual(2, len(products))

    def tearDown(self):
        # close the browser window
        self.driver.quit()

if __name__ == '__main__':
    unittest.main(verbosity=2)</pre></div><p>After running the mobile tests, we can see the results and video recording in the Sauce Labs dashboard. This saves a lot of effort and time in setting up Appium in the local environment with Sauce <a id="id509" class="indexterm"/>offering various combinations of SDKs and settings.</p></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec43"/>Summary</h1></div></div></div><p>In this chapter, we recognized the need for testing apps on mobile devices. We looked at Appium, which is becoming a core feature of Selenium for testing mobile apps. We installed and set up Appium for testing a mobile version of the sample app.</p><p>We tested the mobile web application on the iPhone simulator and on the Android device. Using Appium, we can test various types of mobile applications and use any programming language that has a <code class="literal">WebDriver</code> client library.</p><p>In the next chapter, you will learn some good practices such as using <code class="literal">PageObjects</code> and data-driven tests with Selenium WebDriver.</p></div></div>
</body></html>