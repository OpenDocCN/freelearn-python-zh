# 第一章. 开始使用 Maya

本章将涵盖您从本书其余部分获得最大收益所需的所有内容，并让您对 MEL 和 Python 之间的差异有所了解，如下所示：

+   使用脚本编辑器来调查功能

+   从脚本编辑器运行代码

+   导入 Maya 的内置 Python 功能

+   访问特定命令的文档

+   理解创建、查询和编辑标志

+   将自定义文件夹添加到您的脚本路径

+   编写和运行外部脚本

+   使用 Python 调用 MEL 脚本

# 简介

在本章中，我们将介绍使用 Maya 和 Python 进行脚本编写的基础知识。如果您已经为 Maya 编写了一段时间的脚本，那么本章中涵盖的内容可能很多都是您熟悉的。如果您是 Maya 脚本编写的新手，本章将帮助您了解完成本书其余部分所需的所有知识。

# 使用脚本编辑器来调查功能

脚本编辑器是您了解 Maya 基于脚本的功能的主要工具，同时也是测试完整脚本之外的小段代码的好地方。脚本编辑器最有用的一个方面是，它会显示您在 Maya 界面中执行的操作对应的命令。

这是了解您日常 Maya 任务中涉及的命令的最好方法之一。例如，让我们用它来找出如何使用**Maya 嵌入式语言**（**MEL**）制作多边形立方体：

## 如何操作...

1.  通过转到**窗口** | **通用编辑器** | **脚本编辑器**来打开脚本编辑器。

1.  您可能会注意到，即使您最近才打开 Maya，显示的文本也已经很多。为了使内容更容易查看，请从**脚本编辑器**窗口的菜单中选择**编辑** | **清除历史记录**。

1.  现在尝试通过按住空格键打开热键框，然后转到**创建** | **多边形原形** | **立方体**来制作一个多边形立方体。

1.  使用交互式创建工具来指定多边形立方体的尺寸。

1.  观察脚本编辑器上半部分的结果。您应该看到如下内容：

    ```py
    setToolTo CreatePolyCubeCtx;
    polyCube -ch on -o on -w 5.502056 -h 3.41434 -d 7.451427 -sw 5 -sd 5 -cuv 4 ;
    // Result: pCube1 polyCube1 //
    ```

## 它是如何工作的...

Maya 提供的输出以 MEL 命令的形式呈现，这些命令对应于您刚刚执行的操作。这可以是一个很好的方法来找出您在自己的脚本中需要使用哪些命令。在这种情况下，是`polyCube`命令，它将创建一个多边形立方体。Maya 中的每个命令都有两种形式——MEL 版本和相应的 Python 命令。

脚本编辑器以 MEL 语法显示命令，通常呈现如下形式：

```py
commandName -option1Name option1Value -option2Name option2Value;
```

MEL 语法借鉴了批处理脚本，其中它依赖于选项名称（通常称为“标志”）及其对应值的字符串。相应的 Python 命令通常具有以下语法：

```py
commandName(option1Name=option1Value, option1Name=option1Value)
```

如您所见，MEL 和 Python 版本相当相似，但有一些关键差异：

+   在 MEL 版本中，标志名用破折号表示，其值直接跟在后面，而在 Python 中，选项使用“optionName=value”语法

+   Python 将所有标志括在括号中，而 MEL 则不这样做

+   MEL 需要在每一行的末尾使用分号（;），而 Python 则不需要

MEL 和 Python 之间另一个很大的区别是它们处理空白字符（空格、制表符和换行符）的方式。MEL，像大多数语言一样，不关心空白字符；语句以分号结束，代码块由匹配的括号对定义。

然而，Python 使用空白字符来控制程序流程。这对于初学者来说可能是 Python 最奇怪的地方之一，但对于编程新手来说则不然。在 Python 中，代码块是通过缩进来定义的。你可以使用制表符或空格，但关键是要保持一致。在 Python 中，每次你在行首增加制表符（或空格）的数量，就相当于添加了一个开括号，每次减少这个数量，就相当于添加了一个闭括号。这通常会很令人困惑，因为你的程序结构是由可能实际上看不见的字符定义的。如果你是 Python 新手并且难以跟踪你的空白字符，你可能想要更改你的编辑器设置以显示空白字符。大多数程序员友好的文本编辑器都包括这样的选项，这可以大有帮助。

每个命令的具体选项列表可以在内置的 Python 文档中找到，通过在 Maya 中转到**帮助** | **Python 命令参考**可以访问。对于大多数命令，你都会找到一个长长的选项列表。

要使事情更加复杂，每个选项都有短名和长名。例如，polyCube 允许你指定 X 轴上的细分数量。你可以使用长名“subdivisionsX”或短名“sx”来设置它。

例如，以下所有操作都将导致创建一个 1x1x1 的多边形立方体，X 轴上有五个细分。

MEL 的版本有：

```py
polyCube -sx 5;
polyCube -subdivisionsX 5; 
```

Python 的版本有：

```py
maya.cmds.polyCube(sx=5)
maya.cmds.polyCube(subdivsionsX=5)
```

随意使用短版本或长版本来指定你的参数。你也可以混合使用，为一些参数使用短名，为其他参数使用长名。

在实践中，通常最好为常见的参数（你可能会记住的参数）使用短名，为不太常见/较少使用的参数使用长名。记住，尽管你的代码现在看起来完全合理，但当你 6 个月（或 6 年！）后再次查看时，它可能看起来很混乱。通过在必要时使用长名（并包括注释）来简化你未来的工作。

## 还有更多...

你可能想知道为什么 Maya 提供了两种不同的脚本编写方法，MEL 和 Python。这是一个简单的向后兼容性问题。MEL 是第一个出现的，在 Python 支持添加到 Maya 之前就已经可用。当时，你必须使用 MEL 来完成日常任务，如果 MEL 不能满足你的需求，你必须深入研究 C++ API（这在非 Windows 系统上相当复杂且难以操作）。Python 统一了这两种方法，但 MEL 仍然得到支持，以便旧脚本可以继续使用。也有可能你使用 MEL 的性能会比 Python 更好，因为 Python 功能是 MEL 的包装器。尽管如此，Python 是一个更易于工作的语言，所以这通常是一个值得的权衡。

注意，脚本编辑器默认不会显示你做的所有操作。在正常情况下，Maya 会根据你最可能感兴趣的内容显示稍微过滤后的输出。这通常是好事，但有时你可能希望禁用它。要显示 *所有* 输出，转到脚本编辑器并选择 **历史** | **回显所有命令**。这将导致 Maya 将 *所有* 输出都发送到脚本编辑器。这通常意味着比你想看到的输出多得多，但有时可能很有帮助。在实践中，你通常希望在尝试在脚本中复制特定功能时才开启这个选项，并且默认输出没有给你任何关于 Maya 正在做什么的洞察。

## 参见

如果你已经将 Maya 设置为使用交互模式来创建原始形状，你一定在脚本编辑器中看到以下输出：

```py
setToolTo CreatePolyCubeCtx;
```

上下文是获取用户输入的另一种方式，我们将在 第十章，*高级主题* 中有更多关于它们的讨论。

# 从脚本编辑器运行代码

脚本编辑器不仅是一个查看与你在 Maya UI 中采取的操作对应的命令的好方法，而且也是一个方便地编写小段代码的方式。虽然你当然会想使用文本编辑器来编写你的脚本，但仍然重要的是要熟悉使用脚本编辑器来运行小段代码，无论是为了在将其包含到更大的脚本之前测试它，还是为了获取有关当前场景的更多信息。

## 准备工作

确保脚本编辑器已打开，并且你已经切换到输入（底部）部分的 Python 选项卡。

## 如何做到这一点...

在输入部分输入以下内容：

```py
import maya.cmds

maya.cmds.polyCube()
```

一旦完成，可以通过在脚本编辑器顶部点击执行按钮，或者直接按 *Control* + *Enter* 来执行它。

你的代码将从输入部分消失，一个新的多边形立方体将被创建，结果将被粘贴到脚本编辑器的输出（“历史”）部分。

为了防止你的代码自动消失，首先使用 Command-A（选择所有内容）将其突出显示，然后按 *Command* + *Enter*。这将导致 Maya 只运行所选代码而不清除输入部分。

## 它是如何工作的...

虽然`polyCube`命令实际执行工作，但我们必须首先导入 Maya 的 Python 库，然后才能使用它。为此，我们必须首先使用 `import maya.cmds`。

脚本编辑器是尝试小段代码的好方法，但成功的代码被删除的事实可能会相当令人沮丧。对于任何真正的脚本开发，你将想要使用一个程序员友好的文本编辑器。

## 还有更多...

脚本编辑器的一个方便之处在于，你可以将编辑器中的代码保存到架子上。为此，在输入部分输入一些代码，然后从 **脚本编辑器** 菜单中选择 **文件** | **保存脚本到架子上...**。Maya 将要求你为脚本提供名称，然后（经过一段时间后），在 "自定义" 架子上将出现一个新按钮。按下该按钮将执行相应的代码。

虽然你的大多数脚本工作将涉及编写单独的脚本，但有时从脚本编辑器的历史（顶部）部分复制粘贴命令到输入（底部）部分并将它们全部保存到架子上是有用的。这有点像在 Photoshop 中录制动作，可以是一种快速而简单的方法来为常用功能创建新的快捷方式。

# 导入 Maya 的内置 Python 功能

Python 是一种非常有用的语言，但它实际上并没有提供很多开箱即用的功能，除了一些用于操作简单数据的基本命令。为了真正做一些有趣的事情，你通常需要通过一个或多个库来扩展 Python 的内置功能，包括提供访问 Maya 功能的库。

## 如何做到这一点...

首先，让我们导入 Python 的主要 Maya 脚本库 `maya.cmds`：

```py
import maya.cmds as cmds
```

一旦我们做了这件事，我们就可以使用 `cmds` 而不是 `maya.cmds`。例如，如果我们有这段代码：

```py
maya.cmds.polyCube()
```

我们可以改用以下方法：

```py
cmds.polyCube()
```

这可能看起来像是一个微小的变化，但在整个脚本的过程中，它可以为你节省大量的输入。输入越少，错误就越少，所以这样做是非常值得的。

现在我们已经做了这件事，让我们看看 `cmds` 提供了什么，通过列出其内容。Python 提供了一种方便的方法来通过 `dir()` 命令显示任何对象的内容。让我们使用它来获取 `maya.cmds` 中所有命令的列表：

```py
commandList = dir(cmds)
for command in commandList:
    print(command)
```

运行前面的代码，你会看到一个长长的列表，列出了 `maya.cmds` 库中定义的所有内容。这确实是一个很长的列表。你将看到的多数命令都在官方文档中有介绍，但了解如何使用 dir 来调查特定的库是很好的。

你也可以使用 dir 来调查特定的命令。例如，尝试以下代码：

```py
props = dir(cmds.polyCube)
for prop in props:
    print(prop)
```

运行前面的代码，你会看到 polyCube 命令本身的全部属性。然而，结果可能会看起来有点奇怪，因为它们都与生成多边形立方体无关。这是因为 `maya.cmds.[commandName]` 是一个内置函数。所以，如果你使用 `dir()` 进一步调查它，你只会看到与 Python 函数共有的功能。有关命令的详细信息，请参阅 Maya 命令的内置文档，可以通过访问 **帮助** | **Maya 脚本参考** | **Python 命令参考** 来获取。

## 它是如何工作的...

就像 Python 功能的任何其他特定子领域一样，暴露 Maya 工具集给 Python 的命令是库的一部分。为了使用它们，你必须首先导入库。几乎你写的每个脚本都将需要“maya.cmds”库，并且你可能会偶尔需要包含额外的库以获得额外的功能，例如与 web 服务器通信或读取特定的文件格式。

虽然你可以直接使用 `import maya.cmds`，但这会需要输入很多额外的字符。通过使用 `import [library] as [shortName]` 语法，你可以告诉 Python 使用一个自定义名称作为 `maya.cmds` 的别名。你可以使用几乎任何你想要的名字（例如 `import maya.cmds as MyUncleFred` 也可以正常工作），但在实践中，你希望使用既简短又具有描述性的名称。同时，你还需要确保不要覆盖 Python 的任何内置库。例如，你可以这样做：

```py
import maya.cmds as math
```

这会将 `maya.cmds` 重命名为 math，如果你想要使用数学库中定义的任何函数，这将会造成麻烦。不要这样做。

为了这本书的连贯性和与 Maya 文档的一致性，我们将使用“cmds”作为“maya.cmds”的简称。

## 还有更多...

maya.cmds 库只是可以用来将 Maya 与 Python 交互的几个库之一。Python 在 Maya 中的支持有一个很好的特点，那就是将旧的方法（既有用于日常任务的 MEL，也有用于更大规模插件的 C++ API）统一在 Python 的旗帜下。`maya.cmds` 库处理 MEL 组件，但对于之前通过 C++ API 访问的函数，你将想要使用 maya.OpenMaya。

它（maya.cmds）是围绕许多 Maya 用户已经习惯的 MEL 命令的一个轻量级包装器，并且它有一个好处，那就是由 Autodesk 正式支持。然而，这并不是访问 MEL 命令的唯一方式。还有一个第三方库 PyMEL（通过导入 `pymel.core` 访问）。PyMEL 的好处是更加“Pythonic”并提供更简洁的语法，但它不是由 Autodesk 直接支持的。它还在内置功能之上引入了额外的抽象层，这可能会导致性能下降。

# 访问特定命令的文档

Maya 是一个复杂的工具，它提供了一系列丰富的功能，每个功能都有相应的命令，可以通过脚本调用。每个命令都有自己的参数集，从易于理解到相当晦涩。

在编写 Maya 脚本（以及任何其他类型的编程）时，能够找到适当的文档并理解如何理解它至关重要。

## 如何做到这一点...

假设我们想要有关特定命令的更多信息，比如创建多边形立方体的命令。

查看命令帮助的一种方法是通过 Maya 的基于 Web 的命令帮助，您可以通过在 Maya 中转到**帮助** | **Python 命令参考**来访问它。从那里，您可以点击“多边形”子部分或使用搜索框。

获取命令文档的另一种方法。您也可以直接从脚本编辑器窗口访问命令的文档。首先，使用 Maya 的界面执行相应的操作，例如调用热键并选择**创建** | **多边形原语** | **立方体**。

这将在**脚本编辑器**的输出部分显示相应的 MEL 命令，在本例中为“polyCube”。在脚本编辑器中，突出显示相关行，然后转到**帮助** | **所选命令的帮助**。这将打开一个浏览器窗口，显示该命令的文档。请注意，它将默认显示命令的 MEL 版本；对于 Python 版本，请点击窗口右上角的“Python”链接。

最后，您可以通过 Python 直接使用帮助命令检索有关命令的信息。尝试运行以下命令：

```py
print(cmds.help('polyCube'))
```

这将生成一个列表，列出给定命令可用的标志，以及 Maya 期望每个标志的值类型，例如：

```py
  -sx -subdivisionsX        Int
```

这意味着有一个名为“sx”或“subdivisionsX”的标志，它期望一个整数值。

## 它是如何工作的...

在您开发脚本时，您可能只想在浏览器窗口中打开 Python 命令参考。好的参考文档对于编写好的软件至关重要，您应该习惯于随时将参考文档放在手边。

## 还有更多...

您还可以使用帮助命令直接调用给定命令的基于 Web 的文档，例如：

```py
cmds.help('polyCube', doc=True, language='python')
```

这将打开包含 polyCube 命令 Python 版本文档的网页。这绝对是一种访问帮助的笨拙方式，但如果您想为脚本用户提供一种直接从脚本的用户界面引用相关文档的简单方法，这可能是有用的。

# 理解创建、查询和编辑标志

关于 Maya 脚本的一个有点奇怪的地方是，同一个命令可以用多达三种不同的方式使用——创建、查询和编辑模式，具体细节因每个命令标志而异。这是由于 Python 功能性是围绕较老的基于 MEL 的脚本系统的一个包装，当你刚开始时可能会觉得有点困惑。尽管如此，了解三种模式之间的区别以及如何使用它们是很重要的。

## 准备工作

通过访问 **帮助** | **Python 命令参考** 打开 Python 命令参考，并导航到 polyCube 命令的文档。

此外，请确保在 Maya 中打开脚本编辑器并处于 Python 选项卡。或者，你可以通过 Maya 的命令行运行示例命令；只需确保你在 Python 模式下运行而不是 MEL（点击 **MEL** 切换到 Python，点击 **Python** 返回 MEL）。

## 如何做到这一点...

首先，看一下属性列。你会看到每个标志都列出了 "C"、"E"、"Q" 和 "M" 的某种组合。这些指的是命令可以运行的不同方式，并具有以下含义：

+   **C**: "创建"标志仅在首次运行命令时相关，例如在最初创建多边形原形时

+   **Q**: "查询"标志在命令执行后可以查询，可以用来检索场景中某物的信息

+   **E**: "编辑"标志可以在事后编辑

+   **M**: "多重"标志可以在命令的单个实例中使用多次（例如，在创建曲线时指定多个点）

对于许多标志，你会看到创建、查询和编辑的全套功能，但通常至少有几个标志在一种或多种模式下不可访问。

让我们看看创建、编辑和查询在 polyCube 命令中的表现。

首先，让我们创建一个新的立方体并将结果存储在一个变量中，这样我们以后就可以使用它：

```py
myCube = cmds.polyCube()
```

现在，让我们通过使用编辑模式来改变创建后的立方体的某些属性：

```py
cmds.polyCube(myCube, edit=True, subdivisionsX=5)
```

这将导致我们使用第一个命令创建的立方体从默认状态（在 *x* 轴上没有细分）变为有五个细分。

现在，让我们使用查询模式将新的细分数量存储到一个变量中：

```py
numberDivisions = cmds.polyCube(myCube, query=True, subdivisionsX=True)
print(numberDivisions)
```

你应该看到输出为 "5.0"。请注意，尽管多边形立方体的细分数量必须是整数，但 Maya 显示的是 "5.0"。

## 它是如何工作的...

对于查询和编辑模式，需要注意的是，你像平常一样运行命令（例如 `cmds.polyCube`），但有以下三个关键区别：

+   将对象名称作为第一个参数包含在内。这可以是直接作为字符串的名称 `("pCube1"，例如)`，或者是一个变量。

+   将 `edit=True` 或 `query=True` 作为参数包含在内。

+   额外的参数，具体取决于你是在查询模式还是编辑模式下运行命令。

对于编辑模式，你需要指定你想要更改的属性名称以及新的值。对于查询模式，你只需要包含属性名称和 "=True"。想象一下，你是在说你想知道属性的值是 `True`。请注意，你一次只能查询一个标志。如果你需要查询多个值，请多次运行命令，每次更改传递的标志。

## 更多...

尽管许多最常用的属性可以在所有三种模式下使用，但有许多例子表明它们不能，主要是因为这样做没有意义。例如，在创建新对象时设置或关闭构造历史记录是完全合理的，并且在事后查询它也是合理的，但使用编辑模式来启用没有构造历史记录的对象的构造历史记录意味着什么？这将需要重建对象的整个历史，该对象自创建以来可能已经被以各种方式操作过。因此，"constructionHistory"（或"ch"）标志只提供创建和查询选项。

你可能会觉得这有点笨拙，如果我们只是想设置新创建的立方体的细分数量，你是对的。然而，了解不同的命令模式很重要，这不仅是为了事后获取信息，而且因为它是构建用户界面元素和从它们获取信息的重要部分。

## 参见

我们将在本书的其余部分广泛使用查询模式来从用户界面元素中检索信息，从第二章 *创建用户界面* 开始。

# 将自定义文件夹添加到你的脚本路径

为了编写可重用的脚本，你需要将你的脚本保存到外部文件中，而为了做到这一点，你需要确保 Maya 知道它们的位置。

## 如何做到...

Maya 维护一个搜索脚本的位置列表，用于你在使用导入（Python）或源（MEL）命令时。如果你想查看完整的列表，你可以使用以下代码：

```py
import sys

pathList = sys.path
for path in pathList:
    print(path)
```

这将为你提供一个路径列表，包括以下内容：

```py
/Users/[username]/Library/Preferences/Autodesk/maya/[maya version]/prefs/scripts
/Users/[username]/Library/Preferences/Autodesk/maya/[maya version]/scripts
/Users/[username]/Library/Preferences/Autodesk/maya/scripts
```

将你的脚本保存到这些文件夹中的任何一个，Maya 都可以找到它们。如果你愿意将所有脚本保存到这些文件夹中的任何一个，那是完全可以的。

然而，你可能想要将额外的文件夹添加到列表中。例如，你可能想在 `我的文档` 目录中的一个文件夹中保存你的脚本，可能像这样：

```py
/Users/adrian/Documents/MayaScripting/examples/
```

注意，这是一个典型的 Macintosh 示例。在 Windows 机器上，它看起来可能更像是：

```py
\Documents and Settings\[username]\MyDocuments\MayaScripting\examples
```

无论哪种方式，我们都需要告诉 Maya 去那里查找要执行的脚本。我们可以有几种方法来做这件事，但本着本书的主题，我们将使用 Python 来完成。

在脚本编辑器中运行以下代码：

```py
import sys
sys.path.append('/Users/adrian/Documents/MayaScripting/examples')
```

这通过将 `/Users/adrian/Documents/MayaScripting/examples` 替换为你想要使用的任何文件夹来完成。

完成此操作后，你将能够导入该目录中存储的脚本。然而，每次启动 Maya 都必须输入前面的代码会相当令人沮丧。幸运的是，Maya 提供了一种方法，让我们在启动时执行自定义 Python 代码。

要使代码在 Maya 打开时执行，将其保存为名为 `userSetup.py` 的文件，并将其保存到以下位置（对于 Mac）：

```py
~/Library/Preferences/Autodesk/maya/<version>/scripts
```

或者对于 Windows，你可以保存到以下位置：

```py
<drive>:\Documents and Settings\<username>\My Documents\maya\<version>\scripts
```

## 它是如何工作的...

`userSetup.py` 中包含的所有代码将在 Maya 启动时运行。

虽然上述操作不会改变 Maya 搜索脚本的基路径列表，但它会在 Maya 启动时将你的自定义文件夹添加到列表中，这在实际操作中效果相同。

## 还有更多...

你还可以通过创建 Maya.env 文件并将其保存到以下位置（在 Mac 机器上）来添加到你的路径中：

```py
/Users/<username>/Library/Preferences/Autodesk/maya/version 
```

或者

```py
/Users/<username>/Library/Preferences/Autodesk/maya
```

在 Windows 机器上，保存到以下位置：

```py
drive:\Documents and Settings\username\My Documents\maya\version 
```

或者

```py
drive:\Documents and Settings\username\My Documents\maya
```

关于 `Maya.env` 文件语法的具体信息，请参阅 Maya 的文档。然而，如果不小心编辑 `Maya.env`，可能会导致崩溃和系统不稳定，所以我建议依靠 `userSetup.py`。

# 编写和运行外部脚本

在这个菜谱中，我们将编写和运行我们的第一个实际脚本，作为一个外部 Python 文件。

## 准备工作

脚本编辑器窗口有点名不副实。虽然它是测试短代码片段的好方法，但对于任何类型的真实脚本开发来说都有些笨拙。为此，你需要有一个面向程序员的文本编辑器设置。市面上有很多选择，如果你正在阅读这本书，你很可能已经有一个你喜欢的编辑器了。无论是什么，确保它是面向编写代码的，并且以纯文本格式保存文件。

## 如何操作...

首先，我们需要一个脚本。在你的编辑器中创建一个新文件，并添加以下代码：

```py
import maya.cmds as cmds

print("Imported the script!")
def makeObject():
    cmds.polyCube()
    print("Made a cube!")
```

现在将脚本保存为 `myScript.py`。完成此操作后，切换回 Maya，并从脚本编辑器或命令行运行以下内容：

```py
import myScript
```

这将导致 Maya 读取该文件，你将在脚本编辑器输出中看到以下内容：

```py
Imported the script!
```

然而，你将看不到一个新的立方体。这是因为我们（简单）脚本的实际功能是在名为 "makeObject" 的函数中定义的。

Maya 将你导入的每个 Python 文件视为其自己的模块，文件名即为模块名。一旦我们导入了一个文件，我们就可以通过调用 [moduleName].[function name] 来调用其中的函数。对于前面提到的示例，这意味着：

```py
myScript.makeObject()
```

运行它，你应该会看到一个新创建的立方体出现在脚本编辑器的输出中，以及 "Made a cube!"。

现在，让我们尝试修改我们的脚本。首先，删除我们刚刚创建的立方体，然后切换到你的文本编辑器，并将脚本更改为以下内容：

```py
import maya.cmds as cmds

def makeObject():
    cmds.polySphere()
    print("Made a sphere!")
```

切换回 Maya，再次使用以下命令运行脚本：

```py
myScript.makeObject()
```

你会发现，尽管我们想要一个漂亮的球体，但最终我们还是得到了一个立方体。那是因为当你要求 Maya 执行它已经执行过的脚本时，它将默认重新运行之前运行的相同代码。为了确保我们得到最新的脚本版本，我们首先需要运行以下代码：

```py
reload(myScript)
```

这将强制 Maya 重新加载文件。请注意，重新加载的参数不是文件名本身（在这种情况下是 `myScript.py`），而是该文件定义的模块名（"myScript"）。

完成这些操作后，你再次尝试：

```py
myScript.makeObject()
```

这次，你会看到一个正确的多边形球体，正如我们预期的。

## 它是如何工作的...

似乎导入脚本并调用其函数是一个不必要的额外步骤，你确实可以让脚本自动执行代码（如通过调用 print("Imported Script!") 所演示的）。然而，将所有功能封装在函数中是一种更好的实践，因为它使得处理大型脚本变得更加容易。

如果你希望在脚本每次运行时都执行某些功能，最好定义一个名为 "main" 的函数，并在脚本的最后一行调用它。看看以下示例：

```py
import maya.cmds as cmds

def makeObject():
    cmds.polyCube()
    print("Made a cube!")

makeObject()
```

这将定义 `makeObject()` 函数，然后在脚本的最后一行执行它。

在编写脚本时，每次都需要重新加载、导入和运行脚本会变得非常繁琐。一个简单的方法是将以下内容输入到脚本编辑器中：

```py
import myScript
reload(myScript)
myScript.myCommand()
```

完成这些操作后，使用 **文件** | **保存脚本到架...** 来为自己提供一个按钮，以便轻松重新运行脚本的最新版本。请注意，前面的代码中既包含了导入也包含了重新加载。这是为了确保代码在第一次运行以及后续运行时都能正常工作。"导入" 命令确保模块至少被加载过一次（对于新脚本或在重启 Maya 时是必要的），而 "重新加载" 命令确保我们运行的是最新版本（如果我们已经对脚本进行了修改且 Maya 仍在运行）。

## 还有更多...

如果你有一个定义了大量功能的脚本，并且你不想每次都输入模块名，你可以使用我们用于 `maya.cmds` 的相同技巧来简化一些。具体来说，你可以使用 "as" 语法来提供一个更短的名字。例如，我可能做过以下操作：

```py
import myScript as ms
ms.makeObject()
```

这将产生完全相同的效果。

# 使用 Python 调用 MEL 脚本

Maya 提供了两种不同的语言，可以通过脚本创建自定义功能——即 Maya 内嵌语言（MEL）脚本和 Python。在实践中，你只会想使用其中一种，而在两种中，Python 提供了更好、更灵活的体验。

然而，拥有在 Maya 添加 Python 功能之前编写的遗留脚本并不罕见。虽然“正确”的解决方案是使用 Python 重写这些脚本，但并不总是有足够的时间这样做。在这些情况下，有时能够从 Python 脚本中调用遗留的、基于 MEL 的功能会很有帮助。

## 准备工作

虽然 Python 无疑是创建新功能更好的方式，但有时您可能有一些用 MEL 编写的旧脚本，您希望将其结合进来。

最佳选择是将脚本重写为 Python，但如果脚本复杂或您没有时间，可能更容易在 Python 脚本中调用 MEL 功能。这样，您可以在不重新发明轮子的同时结合遗留功能。

## 如何做到这一点...

对于这个配方，您需要 MEL 脚本。如果您没有现成的，打开一个新文件并输入以下内容：

```py
global proc myMELScript()
{
    polyCube;
    print("Hello from MEL!");
}
```

将此保存为`myMELScript.mel`到您的`maya/scripts`目录中。虽然我们不会深入探讨 MEL 的细节，但请注意，文件名与我们要定义的函数同名。大多数 MEL 脚本都会遵循这个约定。还要注意，在每行末尾包含分号。虽然 Python 不需要它们，但 MEL（以及许多其他语言）需要。

一旦您有了这个，创建一个新文件并将其命名为`runMEL.py`。输入以下内容：

```py
import maya.cmds as cmds
import maya.mel as mel

def runMEL():
    print("Running MEL from Python")
    mel.eval("source myMELScript;")
    mel.eval("myMELScript;")

runMEL()
```

保存脚本并使用以下命令运行：

```py
import runMEL
```

因为我们的脚本最后一行调用了 runMEL 命令，它将自动生效。您应该在脚本编辑器中看到一个新的立方体，以及以下输出：

```py
Running MEL from Python
Hello from MEL!
```

## 它是如何工作的...

在这个例子中，我们导入了`maya.cmds`和`maya.mel`。`maya.mel`库提供了将 Python 与 MEL 接口的支持，其中最有用的命令之一是 eval 函数，它接受任意字符串并尝试将其作为 MEL 命令运行。在先前的例子中，我们这样做两次，第一个命令是：

```py
source myMEL;
```

源命令与重新加载执行相同的功能，即确保 Maya 将重新读取整个源文件，而不是重新运行可能过时的版本。这通常不会有什么影响，因为只有在您正在修改 MEL 脚本时才需要这样做（而且希望您不会这样做，最好使用 Python！），但以防万一，包含它是好事。

一旦我们这样做，我们实际上会使用以下命令运行 MEL 脚本：

```py
myMEL;
```
