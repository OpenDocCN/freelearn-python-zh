# 第一章：了解 Grok

Grok 是用 Python 编程语言编写的 Web 应用程序框架。目前，对于 Python Web 开发框架有很多不错的选择，Grok 可能是其中最不为人知的一个。本书通过开发一个完整的 Web 应用程序来详细介绍 Grok。在这个过程中，本书将让我们了解为什么 Grok 是构建 Web 应用程序的一个非常好的选择，无论它们是小型简单还是大型复杂。在本章中，我们将从以下内容开始：

+   使 Grok 成为 Python Web 开发有吸引力的选项的原因

+   Grok 如何利用 Zope 工具包以及为什么这使得 Grok 强大且灵活

+   Grok 最重要的概念是什么以及为什么它们有用

+   Grok 与其他 Web 开发框架的比较

# 为什么选择 Grok？

Grok 是一个现代 Web 框架，这意味着：

+   它提供了一种敏捷的开发流程，强调快速生成可工作的代码，但始终关注清晰性和可测试性。它不需要广泛的配置。

+   它提供了一套开发应用程序的约定，包括文件系统布局和代码结构。Grok 的设计鼓励开发者共享标准，并为他们在组织代码时提供了一套良好的实践。这使得经验不足的开发者可以从一开始就变得高效。

Grok 支持与关系数据库的强大集成，包括使用许多对象关系映射器，并且通过使用自己的面向对象数据库提供了一种透明的方式来存储 Python 对象。Grok 为开发强大、可扩展和安全的 Web 应用程序提供了坚实的基础，而不会过于复杂。这在很大程度上是因为它在其核心使用了**Zope 工具包**，这是一个旨在供项目重用以开发 Web 应用程序或框架的库集合。这个库集合使用了一种称为**Zope 组件架构**（**ZCA**）的通用组件开发模型。

ZCA 是在 Zope 社区中开发的，该社区已经使用 Python 开发 Web 应用程序超过十年。Grok 基于这一经验，提供了一种强大的经验和敏捷的结合。当使用 Grok 时，您将获得：

+   一个核心框架已经发展了十多年，始终在学习新的经验教训并寻求改进，基于在所有类型的生产环境中部署的项目的大量经验。

+   一种灵活、前瞻性的架构，允许开发者在长时间内创建可以演变和扩展的应用程序，甚至可以由其他开发者进行，有时甚至不需要触及原始代码。

+   一个实用、知识渊博的开发社区，这个社区已经存在很长时间，并且愿意提供关于如何最好地学习和利用框架的建议。

+   一系列集成功能，例如国际化、表单生成和验证、安全性、编目和模板化。

+   一大批现成的组件，可以用作构建您自己应用程序的基石。与 Zope 3 本身一样，这些组件通常经过彻底测试，具有良好的 API 文档。

Grok 为 Web 开发者提供了我们应用程序的一系列有用功能，这些功能可以轻松地作为依赖项集成到我们的代码中。

# 区分 Grok 概念

Grok 与其他现代 Web 开发框架有许多共同之处，但它也提供了一些非常独特的功能，使其与众不同。在这里，我们将简要介绍其中三个：

+   组件架构

+   对象数据库

+   对象发布和遍历的概念

## Zope 组件架构

Grok 的一个显著特点是它使用组件架构，旨在使开发者能够创建独立组件，这些组件可以自由重用和交换。

组件仅仅是执行特定功能的对象。在 ZCA 中，这种功能通过接口正式声明，接口是描述对象各种方法和属性的类。实现与某个其他组件相同接口的组件可以轻松地替换它，这为开发者提供了以不同方式组合组件和用较新或更好的实现替换任何特定组件的选项。

ZCA 包括两种类型的组件：适配器和实用工具。**适配器** 是扩展另一个组件以提供额外数据、功能或展示能力的组件。**实用工具** 是提供某种服务的独立组件，例如数据库连接、加密或邮件投递。在 Grok 中，术语 **内容组件** 用于定义与这些适配器和实用工具交互的代码。

例如，用于描述现代 Web 框架的常见范例被称为 **模型/视图/控制器**，或简称 **MVC**。*模型* 是内容本身，通常存储在关系型数据库中，以及定义如何修改它的业务规则；*视图* 是用户看到的 HTML 页面，以及与之交互的页面；*控制器* 是从视图中收集动态数据并将其推送到模型进行处理的代码，以组装包含结果的新 HTML 页面。

在 MVC 术语中，模型是提供数据的组件，在 Grok 中被称为内容组件。视图和控制器都是作用于该组件的适配器，前者提供展示能力，后者提供额外的功能。

使用 ZCA 为 Grok 开发者提供了几个优势，我们得到了一个扩展其他对象的标准方式，甚至可以用来从外部添加功能，而无需触及它们的代码。此外，我们能够创建可重用的组件，并使用在其他地方开发的现有组件。除此之外，我们还得到了一个全局注册表，我们可以用它轻松地创建自己的组件注册表，从而避免代码重复。

这可能听起来有些抽象，所以想象一个实际的 Web 应用程序，其中我们有一些类型的对象代表商店目录中的项目。假设这个应用程序是由第三方开发的，但我们需要添加一个网页来显示每个项目的特定信息，具体取决于浏览目录的用户位于世界的哪个地方。在 Grok 中，我们可以通过创建一个独立包中的新视图并使用 ZCA 通过一行代码将其与原始对象连接起来，轻松地做到这一点。根本不需要触及第三方应用程序。

## 对象数据库

大多数 Python Web 框架使用关系数据库来存储它们的对象数据，对于复杂的数据结构来说，这可能意味着数据分散在不同的表中，然后通过使用复杂的查询将它们连接起来。由于 Python 是一种面向对象的语言，因此直接存储对象更有意义，Zope 3 通过使用其自己的对象数据库 ZODB 来实现这一点。

**ZODB**是一个具有负载均衡能力的事务性对象存储，并且是 Zope 从最初就定义的概念之一。它允许开发者几乎透明地处理他们的对象并将它们持久化（只需从持久化类继承即可）。无需担心在读取时组合对象以及在写入时拆分它们。

ZODB 是 Grok 中可以独立在任何 Python 环境中使用的组件之一。

## 对象发布和遍历

在其他 Web 框架中，URL 通常被映射到代码中，这些代码调用正确的模板或返回请求的结果。在 Grok 中，URL 被映射到对象上，这意味着任何对象都可以有一个相应的视图。

如果你将 ZODB 存储视为一棵树，你可以可视化 Grok 如何解析 URL，从树的根节点开始，然后到分支，再到子分支，直到达到要显示的对象实例。这个过程称为“遍历”。

遍历机制“只需工作”，这意味着在实践中，你可以有任意长度的嵌套层次结构，只要为你的所有对象类提供默认视图（在 Grok 中称为索引视图），就无需担心。

相比之下，许多 Python 网络框架使用“URL 路由”的概念，这需要使用某种正则表达式语法将已知的路径分配给数据库对象，该语法涉及数据库中的对象属性，如 ID，以及一系列可能的操作。从应用程序外部修改这些路由并不容易。

除了默认的遍历机制外，Grok 还允许使用自定义遍历方法，这些方法可以返回任意对象实例和视图。这可以用于遍历关系映射器查询的结果，例如。

# 其他 Grok 功能

Grok 为网络应用开发提供了许多其他有用的功能。这里仅列举其中的一小部分。

## 集成安全模型

Grok 拥有一个非常细粒度的安全模型，基于权限和角色。它允许开发者将特定的权限分配给特定的视图，然后将这些权限映射到不同的角色。它使用 ZCA 允许可插入的组件用于身份验证和授权。

## 简单使用现有的 Python 库和模块

当然，Python 网络框架非常强大，因为它们允许轻松访问可用的众多 Python 库和模块，从 Python 的标准库开始。Grok 允许开发者利用这一软件库，当然，但这还不是最好的部分。使用 ZCA，我们可以在不修改其代码的情况下向从这些模块实例化的对象添加视图和功能，从而使我们更容易地重用它们。

## 静态资源

Grok 为所有静态文件（如图像、CSS 样式表或 JavaScript 文件）保留了一个特殊的目录名称。您可以使用这些资源，就像在其他任何网络开发环境中一样。

## 关系数据库访问

Grok 包含强大的 ZODB，用于透明的对象持久化，但当然，在某些情况下，关系数据库更适合存储某些类型的数据。Grok 还通过使用对象关系映射器（如 SQLAlchemy）提供轻松访问关系数据库的功能，这样我们就可以兼得两者之长了。

## Python 网络服务器网关接口兼容性

Grok 可以配置为 WSGI 应用程序，并与其他 Python 应用程序一起插入到管道中。这使得开发者能够将不同的网络框架和应用程序组合成一个单一站点，从而在可能的情况下使用最佳的应用程序。

# Grok 与其他网络框架的比较

使用过或熟悉其他网络框架的开发者可能想知道 Grok 与它们相比的情况。尽管完整的比较超出了本书的范围，但关于流行框架的几句话可能有所帮助。

## PHP

PHP 允许快速的开发速度，但不鼓励结构化和安全的网络开发实践。Grok 提供了敏捷但结构化程度更高的体验，从一开始就鼓励良好的实践。Grok 还具有清晰的关注点分离。其模板语言 ZPT 专注于展示，与 PHP 不同，PHP 本身将所有内容组合到一个模板中，避免了过多的应用程序逻辑。

## Java 框架

与 Java 框架类似，Grok 是为了开发大型和复杂的应用程序而设计的。来自 Java 网络框架的开发者会发现 Grok 的约定将大大减少配置文件的使用。Grok 使用动态语言，没有编译周期大大加快了开发周期。Python 语言使得从命令行测试事物变得更加容易。

## Ruby on Rails

Grok 受 Ruby on Rails 的启发很大。Rails 是最早将敏捷哲学阐述为两个一般原则的框架之一：*不要重复自己* (DRY) 和 *约定优于配置*。DRY 意味着避免在不同地方重复相同的代码或信息，Rails 在其开发实践中强烈执行这一点。约定优于配置意味着许多框架方面和代码结构有合理的默认值，而不是依赖于显式的配置来工作。Grok 将这些概念铭记在心，并将它们与 Zope 工具包和 Zope 组件架构相结合，提供了一种强大而独特的开发平台。

## Django

Django 是最受欢迎的 Python 网络开发框架之一。其关键卖点之一是为其应用程序自动生成管理界面，这是 Grok 所不具备的。Django 在使用 *约定优于配置* 和 *不要重复自己* 原则方面与 Grok 类似。它还提供了 Python 编程语言的全部功能，并希望成为解决网络开发问题的全栈解决方案。与 Grok 不同，其架构专注于构建基于关系数据库的应用程序，并将第三方组件集成到其堆栈中，同时仍然保持管理界面等功能的运行，这并不容易。

## Pylons

Pylons 更像是一个最小化的网络框架，而 Grok 正在尝试提供一套完整的组件。使用 Pylons 的开发者可能会在 Grok 中找到一个更强大的框架，但会牺牲一些最小化框架所提供的灵活性。

# 摘要

在本章中，我们介绍了 Grok 并说明了为什么它是现代网络应用程序开发的绝佳选择。在下一章中，我们将看到如何将 Grok 应用到实践中，并将构建我们的第一个简单应用程序并使其运行。
