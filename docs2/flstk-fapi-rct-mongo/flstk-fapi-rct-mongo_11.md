# 11

# 有用资源及项目想法

在本章的最后部分，你将了解**FastAPI、React 和 MongoDB**（**FARM**）堆栈组件以及一些推荐的操作来理解构成这个灵活堆栈的技术。

对于构建数据驱动或数据密集型应用，本章在处理 FARM 堆栈时提供了一些实用建议，以及 FARM 堆栈或非常相似的堆栈可能适用和有帮助的项目想法。你还将学习如何在不断变化的网络开发和数据分析领域中找到自己的道路。这对于来自最多样化背景的人来说将是有帮助的，但他们的工作或新发现的热情驱使他们通过数据驱动世界找到一条道路。

本章将涵盖以下主题：

+   MongoDB 注意事项

+   FastAPI 和 Python 注意事项

+   React 实践

+   初学者项目想法

# MongoDB 注意事项

在*第二章*，*使用 MongoDB 设置数据库*中，你被介绍到 MongoDB 以帮助你开始更简单的项目。然而，MongoDB 是一个由企业级公司使用的复杂生态系统。因此，深入了解其特性和模式将对你作为开发者有益，并帮助你理解 NoSQL 范式。

在使用 MongoDB 时，第一步之一是理解数据建模或模式设计。你的数据模型应该反映你的应用程序如何看待数据及其流动，从你提出的查询开始。有一些高级设计模式适用于 MongoDB 模式，但超出了本书的范围。

*第二章*，*使用 MongoDB 设置数据库*，涵盖了 MongoDB 文档建模的一些流行最佳实践。以下列表提供了更多建议：

+   如果对象打算一起使用，应该在同一份文档中组合。引用“*一起访问的数据，应该保持在一起*”可能有助于你的模式设计。

+   当将对象分离到不同的文档中时，尽量不使 JOIN 变得必要，尽管通过 MongoDB 聚合框架可以实现简单的 LEFT JOIN。

+   数据使用案例的频率应该决定模式。最频繁的数据流应该是最容易访问的。

来自关系型数据库世界的人，建模关系通常归结为**嵌入**和**引用**之间的选择。在前面章节中你处理过的简单应用中，当你用用户创建 CRUD 应用程序时，你选择了引用用户 ID，因为这是最简单的事情。

然而，这也许同样适用于现实世界的场景。存在许多经验法则。例如，如果一个*一对多*关系的多个方面可能包含数百个项目，嵌入可能不是最佳选择。

广泛的 MongoDB 文档指出，在 *一对一*、*一对少* 和 *一对多* 的关系中应首选 *嵌入*，而在 *一对一非常多的多* 和 *多对多* 情况下应使用 *引用*。

注意

要了解使用真实世界示例的数据建模基础知识，请查看以下文档：[`www.mongodb.com/developer/products/mongodb/mongodb-schema-design-best-practices/`](https://www.mongodb.com/developer/products/mongodb/mongodb-schema-design-best-practices/)。

此外，Python 驱动程序，如 **PyMongo** 和其异步对应物 **Motor**，与 MongoDB 无缝协作。借助 Python 丰富的数据结构系统和数据处理能力，相对容易地更改和混合事物，更改模式，并尝试不同类型的文档，直到找到特定用例的最佳解决方案。

这里有两个可能包含在你的某些应用程序中的有趣项目：

+   **Beanie** ([`roman-right.github.io/beanie/`](https://roman-right.github.io/beanie/)) 是一个基于 Motor 和 Pydantic 的异步 Python 对象文档映射器，用于 MongoDB，可以加快 CRUD 应用程序的开发。你已经学习了如何使用 Beanie 进行后端开发。请参阅 *第九章*，*FastAPI 和 Beanie 的第三方服务集成*。

+   **Mongita** ([`github.com/scottrogowski/mongita`](https://github.com/scottrogowski/mongita)) 可以被视为 MongoDB 的 SQLite。它可以用作需要本地保存数据的轻量级嵌入式数据库，或者在设置 MongoDB 或 Atlas 之前进行原型设计。

# FastAPI 和 Python 考虑事项

Python 包含数据与文本处理、Web 开发、数据科学、机器学习、数值计算、可视化以及计算几乎所有的可能方面。

Python 的最佳实践也适用于 FastAPI。然而，由于 FastAPI 将简单的 Python 函数（甚至受 Django 基于类的视图启发的类）转换为 REST API 端点，你不需要做任何额外的事情。FastAPI 以一种有利于开发者的方式构建，在编写 API 时为你提供必要的灵活性和流畅性。

以下列表提供了应成为你的 FastAPI 开发过程一部分的通用考虑事项：

+   使用 **Git** 和 **GitHub** 并学习一个简单的流程。学习一个流程并一直使用，直到你习惯它并切换，比一次性学习所有命令要容易得多，尤其是如果你是唯一一个试图自动化或 *REST-ify* 业务流程的开发者。

+   将你的环境变量保存在 `.env` 文件中，但也要在别处备份它们（API 密钥、外部服务凭证等）。

+   学习 Python 的类型提示系统。它与 Pydantic 密切相关，并为您的整体代码添加了一层鲁棒性。它也是编写 FastAPI 应用程序的一个基本组成部分。

+   正确构建应用程序的结构。在单个文件中创建一个功能丰富的应用程序非常容易且诱人。这尤其适用于您没有明确的规范时，但您应该抵制这种冲动。请参考 FastAPI 文档中关于构建大型应用程序的结构（[`fastapi.tiangolo.com/tutorial/bigger-applications`](https://fastapi.tiangolo.com/tutorial/bigger-applications)）。

主要思想是将应用程序分解为路由器和 Pydantic 模型，使它们有各自的目录。例如，书中有一个 `/routers` 目录，因此您也应该有一个 `/models` 目录。这些目录应该各自有一个空的 `__init__.py` 文件，使它们成为 Python 模块。您可以将外部服务工具保存在一个单独的文件中，或者在一个 `/helpers` 目录中。您可以根据应用程序的复杂度进行细化。请记住，您最终会得到一个 ASGI 应用程序，这是您选择的服务器（如 Uvicorn 或其他服务器）唯一引用的端点。

# 测试 FastAPI 应用程序

测试是确保您的应用程序按预期运行所必需的。本章不会涵盖**测试驱动开发**（**TDD**），其中测试是在实际代码之前编写的。然而，当与异步 MongoDB Python 驱动程序 Motor 和 FastAPI 一起工作时，您可能会遇到一些特定的问题。

对您的 API 进行单元测试是必不可少的，并且设置起来很简单。每个端点都应该进行测试，并且每个端点都应该执行它们被分配的任务。虽然 Python 中的单元测试已经有了几个成熟的框架，如 `unittest` 和 `pytest`，但有一些 FastAPI 特定的点值得提及。

FastAPI 文档（[`fastapi.tiangolo.com/tutorial/testing/`](https://fastapi.tiangolo.com/tutorial/testing/））建议您使用 Starlette 提供的 `TestClient` 类。弗朗索瓦·沃龙在他的优秀书籍《使用 FastAPI 构建数据科学应用》中，推荐使用 `HTTPX`（一个类似于 `Requests` 的异步 HTTP 库，由 Starlette 团队开发）和 `pytest-asyncio`，使整个过程完全异步。

包含 Pydantic 使得测试 FastAPI 应用程序成为一种愉快的体验，并强制执行某些倾向于产生更稳定软件的实践。另一方面，FastAPI 的自动文档是一个非常有帮助的工具，可以节省您的时间，并减少在代码编辑器和客户端之间频繁切换。

# React 实践

在 *第一章*，*Web 开发和 FARM 栈* 中，你选择 React 作为前端是因为它的简单性和灵活性。如果你是一个视觉学习者，尝试由 *Academind GMBH* 和其主要作者 Maximilian Schwarzmüller 提供的视频课程，名为 *React – The Complete Guide*。

对 JavaScript 和 ES6 的深入了解是成为更好的 React 开发者的最佳基础，但深入了解一些基本的 React 概念也很重要，探索 Hooks 机制、组件生命周期和组件层次结构。

你应该熟悉其他 Hooks；在这本书中，你将了解两到三个最受欢迎的 Hooks，但还有很多。了解 Hooks 如何以及为什么以这种方式工作将使你成为更好的 React 开发者。

截至 2024 年，React 函数式组件通常比旧的基于类的组件更受欢迎，因为它们更简洁、易于维护和灵活。

# 其他主题

本节强调了在使用 FARM 栈时一些其他重要的要点，这些要点可能会很有用。虽然你可以为几乎任何类型的网络应用选择使用 FARM 栈，但这个栈可能更适合某些类型的应用，而不太适合其他类型的。

## 身份验证和授权

*第六章*，*身份验证和授权*，专注于使用 FastAPI 实现基于 JWT 的身份验证解决方案及其在 React 中的后续应用。然而，正如该章节中提到的，这可能不是最佳或可行的解决方案，对于某些用例来说。你可能需要回退到第三方提供商，如 Firebase、Auth0 或 Cognito。在承诺使用第三方解决方案之前，务必充分了解其优缺点、潜在锁定后果以及价格因素，尤其是如果你计划扩展应用程序的话。

## 数据可视化和 FARM 栈

*第一章*，*Web 开发和 FARM 栈*，描述了一些相当简单的可视化，但通过格式化良好的细粒度 JSON 响应和 React 作为前端，几乎任何事都是可能的。这种根据你的需求实际塑造数据的能力为你提供了一个巨大的游乐场，你可以在这里测试、尝试和尝试不同的解决方案，也许是通过迭代，直到你达到满意的类型的数据可视化。

存在着广泛的可视化需求，并不一定需要尝试制作类似 Shirley Wu D3.js 的艺术品，其中简单的双色堆叠柱状图就能完成任务。然而，有了快速的后端和 MongoDB 可以容纳你抛给它的几乎任何类型的数据结构，你将准备好应对任何任务。D3.js 的 `Observable` 包装器有一个非常有趣的接口，并抽象了 D3.js 的许多机制，因此这可能是一个良好的起点。

## 关系数据库

如果您的用例需要关系数据库的复杂性，例如 SQL 和它们的严格结构，您不需要完全放弃 FARM 栈。鉴于 FastAPI 的模块化和本书探讨的一些部署选项，您可以插入一个关系数据库，如 Postgres 或 MySQL，探索 SQLAlchemy 或一些异步数据库 Python 驱动程序的文档，并简单地添加所述功能，同时管理用户，例如通过 MongoDB。

# 一些启动项目想法

本节列出了一些项目想法，以帮助您探索 FARM 栈的可能性，磨练您的技能，但最重要的是发挥您的创造力。这些示例项目想法将帮助您探索 FARM 栈的一些功能，例如构建文档自动化流程、创建数据仪表板应用程序以及构建投资组合网站。

## 传统的投资组合网站

这个项目展示了 FastAPI、React 和 MongoDB 完全能够处理包括关于页面、服务、画廊、联系表单等内容在内的简单投资组合网站。

以下步骤概述了您可能如何创建此类应用程序：

1.  创建一个漂亮的设计（或者尝试在 Tailwind CSS 中重新创建它）。

1.  如果您想要快速实现，可以插入 React-Router 或 Next.js。

1.  使用服务器端生成和图像优化。

1.  对于内容，定义几个 Pydantic 模型：博客文章、投资组合项目、文章等。然后，创建简单的路由，通过 `GET` 请求提供服务。

1.  由于这是一个开发者博客，您甚至不需要创建身份验证系统以及 `POST` 或 `PUT` 路由：与文本相关的内容将直接输入到 MongoDB（Atlas 或 Compass）中，而图像将放入 **Cloudinary** 的单独文件夹中，并通过 API 直接查询。

1.  集成 **Markdown**，一种强大的文本预处理器，可以将简单的文本（Markdown）转换为有效的 HTML。Python 和 ES6/React 都有处理 Markdown 的优秀库，因此您将能够找到一个好的组合。

## React-admin 库存

另一个项目想法是创建一个基于 React-admin ([`marmelab.com/react-admin/`](https://marmelab.com/react-admin/)) 的库存系统，使用 Auth0 或 Firebase 进行身份验证，并有一个面向公众的界面。React-admin 提供了一个类似于 Django 使用的管理界面，它基于 CRUD 动词：每个暴露 `POST`、`PUT`、`GET` 和 `DELETE` 操作接口的资源（或项目）都可以进行编辑、删除和读取，并且可以创建新的实例。

探索这个包，并尝试思考一些你可能想要管理的集合类型。有一些优秀的工具，例如 **Airtable**，它提供了可以从你的 FastAPI 路由中调用的 REST API。

## 使用 Plotly Dash 或 Streamlit 创建探索性数据分析应用程序

使用 Plotly Dash 或 Streamlit，你可以构建可以用来玩转数据的应用程序。要查看这些工具的实际效果，请按照以下步骤操作：

1.  选择一个你熟悉的数据集。

1.  创建一个程序化接受数据并彻底测试的输入管道。这些数据可能来自网络或更好的 API 爬虫，或者来自上传 JSON 或 CSV 文件的输入文件。

1.  清洗数据，预处理它，并将其插入到 MongoDB 数据存储中。

1.  接下来，根据数据的结构，找出一些有用的过滤器和管理控制，这类似于 Tableau 或 Looker Studio 等企业工具。如果你已经熟悉这样的数据，你将知道可以期待什么。

1.  然后，你可以打开一个**Jupyter**笔记本，安装几个可视化库，看看会出现哪些类型的相关性或分组。

1.  在找到一些有趣的 pandas 驱动的数据处理之后，你只需将它们提取到单独的功能中，进行测试，并将它们集成到 FastAPI 端点中，就可以用 D3.js 或 Chart.js 进行可视化。

1.  最后，你可以部署你的应用程序，并与管理你团队的朋友分享，向他们展示支持你草案决策的数据。

之前，你已经看到了如何轻松地嵌入使用 scikit-learn 构建的机器学习模型。接下来，你可以尝试嵌入使用 Keras 的神经网络模型，或者尝试一些简单的线性回归。

注意

了解数据可视化和探索框架，如 Streamlit ([`streamlit.io/`](https://streamlit.io/)) 或 Dash ([`dash.plotly.com/`](https://dash.plotly.com/))，将有助于你构建和部署你的数据仪表板应用程序。

## 文档自动化管道

你是否一直被结构相同的重复性文档所包围？以下是你能做的事情：

1.  尝试想象一个基于`docx-tpl`包的文档服务器，这个包允许你定义一个 Word 模板，按照应有的格式进行格式化，然后传递一个包含所有需要在文档中的数据的上下文，例如文本、图像、表格、段落和标题，同时保持最初定义的样式。使用 Excel 可以实现类似的甚至更强大的自动化。你可以使用 pandas 进行复杂的计算、数据透视和将不同的文档合并成一个。

1.  在创建模板后，考虑一些执行`POST`请求并将发布的数据保存到 MongoDB 数据库中的 FastAPI 端点，包括数据（例如，文档的标题、作者、数据或其他细节），然后触发 DOCX 或 XLSX 文档渲染。

1.  将文件保存为可识别的名称（可能通过添加当前时间或 UUID 库来实现唯一性）在目录中，并确保这个目录可以通过 FastAPI 直接（通过静态文件功能）提供服务。如果你计划处理大量的重文档，甚至整个 Nginx 服务器块也可能适用。

1.  这些文件可以供所有团队成员访问，或者通过 cron 命令行工具或类似的方式直接通过邮件发送。

# 摘要

本章提供了一些指导方针，以帮助您巩固您的 FARM 栈知识，同时提供了一些您可以自定义并用作自己项目起点的项目想法。使用它们，您可以创建众多简单以及一些复杂的应用程序，以展示该栈的能力和灵活性。关于使用 FARM 栈可以轻松实现的内容，您还可以探索其他功能，例如使用 Next.js 进行服务器端渲染和图像优化，发送电子邮件，以及执行数据可视化。

FARM 栈作为专业开发团队和数据整理者或只需通过网络应用讲述故事的自由职业者的首选栈，拥有未来。通过采用其组件，您可以构建高度交互和响应式的应用程序，以满足各种需求。

在本书中，您已经学习了所有知识和动手实践示例，现在您应该对自己的使用 FARM 栈构建完整功能的应用程序的旅程充满信心。正如任何技术或工具一样，您练习得越多，您就会变得越好！
