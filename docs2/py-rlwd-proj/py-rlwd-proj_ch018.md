# 第十四章

项目 4.2：创建报告

一种分享美观结果简单的方法是使用 Jupyter notebook 的 **Markdown** 单元创建演示文稿。本章将创建一个可以分享和展示的“幻灯片集”。我们可以在此基础上使用额外的包如 **Jupyter book** 或 **Quarto** 来创建 PDF 报告。

在本章中，我们将查看数据分析的两个重要工作成果：

+   直接从 Jupyter Lab 笔记本构建幻灯片。

+   由笔记本数据和数据分析构建的 PDF 报告。

本章的项目将升级前一章创建的分析笔记本，以创建可以与同事分享的演示文稿。我们将首先查看分析师可能需要生成的报告类型。

## 14.1 描述

书中的前十二章创建了一个获取和清理原始数据的管道。一旦数据可用，我们现在可以对干净的数据进行更多分析工作。

目标是将原始数据转换为信息，甚至可能提供洞察力，帮助利益相关者做出适当的决策。分析结果需要共享才能具有价值。Jupyter Notebook 是创建可读、有用的演示和报告的坚实基础。

我们将首先将分析笔记本转换为幻灯片。然后你可以使用这个幻灯片集与利益相关者讨论我们的关键点，提供有助于他们理解的信息的视觉辅助。这些在企业环境中很常见。（有些人可能会认为它们太常见，包含太多错误类型的细节。）

我们将首先查看在 Jupyter Lab 中创建幻灯片和演示。

### 14.1.1 幻灯片和演示

Jupyter Notebook 可以导出为演示文稿文件。底层演示文稿将是一个基于 HTML 的个人页面仓库。**Reveal.js** 项目用于控制页面间的导航。有关此引擎如何工作的更多详细信息，请参阅 [`revealjs.com`](https://revealjs.com)。

在笔记本中，每个单元都有属性。右侧栏是属性检查器窗口，让我们管理这些属性。其中一个属性是幻灯片类型。这允许分析师标记单元格以包含在演示中。我们将在 *准备* *幻灯片* 中查看技术细节。

有大量关于创建有用、信息丰富演示的指南和教程。作者喜欢关注三个关键点：

1.  告诉他们你要告诉他们的内容。呈现一个主题列表（或议程或大纲）。这通常使用 **Markdown** 列表。

1.  告诉他们。这应该从一般观察到演示的具体细节。这可能是一段 **Markdown** 文本和图表的混合体。

1.  告诉他们你已经告诉他们的内容。呈现你信息的总结以及你希望他们采取的行动。这也会经常使用 **Markdown** 列表。

在这里重要的是使用幻灯片演示文稿来包含关键词和短语，以帮助观众记住关键点和行动号召。这通常意味着利用**Markdown**文本以粗体或斜体字体强调单词。这也可能意味着使用各种类型的**Markdown**列表。

另一个重要部分是避免在试图将太多要点塞进一个页面时产生的视觉杂乱。当有很多细节时，演示可能不是管理所有信息的最佳方法。报告文档可能比演示更有用。文档可以为简短的演示提供补充细节。

### 14.1.2 报告

演示和报告之间有一个模糊的界限。演示通常较短，侧重于关键词和短语。报告通常较长，用完整的句子书写。一个组织良好的包含完整句子的演示可以被视为简短的报告。一个包含简短段落和大量图表的报告看起来可能像演示。

**Markdown**格式提供了许多功能，可以创建高质量的排版文档。从**Markdown**到 HTML 再到浏览器或 PDF 渲染引擎的技术堆栈涉及多个转换步骤，以将笔记本单元格中的简单 Unicode 文本转换为丰富详细的渲染。这个堆栈是 Jupyter Lab 的第一流部分，可以通过像**Quarto**或**Jupyter**{**Book**}这样的工具来利用，以创建报告。

并非所有出版物使用的排版约定都通过**Markdown**源文件提供。例如，一些出版物风格指南可能包括一个具有较窄边距的摘要部分，有时字体也较小。这在**Markdown**语言中可能具有挑战性。一些作者可能会使用一个更简单的布局，缺乏所有关于边距和字体大小的视觉提示。

HTML 和 CSS 的力量如此之大，以至于愿意掌握技术堆栈的作者可以拥有大量的排版能力。鼓励读者探索**Markdown**、HTML 和 CSS 的能力。读者还被建议设定现实的目标；在结合**Markdown**和 CSS 以实现不会增强报告信息的排版效果时，可能会投入大量时间。

通常将每个段落放入单独的单元格中效果很好。这不是一个严格的规定：有时一组段落应该放入一个单元格中。

最高级标题通常应该单独放在单元格中。这可以使重新组织这些标题下的内容更容易。一些较低级别的标题应该与它们的介绍段落放在同一个单元格中，因为标题和单元格的内容不太可能分开。

我们可能有一个包含一级标题的单元格，看起来像这样：

```py
# Title of our document
```

这个单元格只有标题，没有后续文本。下一个单元格可能有一个子标题，介绍文档。

一个低级别的单元格可能看起来像这样：

```py
## Conclusion

The various **Anscombe Quartet** series all have consistent
means and standard deviations.
```

此单元格包含二级标题以及该文档本节的开头文字。它使用 `**` **Markdown** 语法来显示某个短语应该有强烈的强调，通常使用粗体字体来实现。

在接下来的几节中，我们将讨论向 Jupyter 环境添加工具的技术方法，以便分析师可以创建演示文稿或报告。

## 14.2 总体方法

我们将讨论在 Jupyter Notebook 中创建演示文稿和报告的一般技术步骤。对于演示文稿，不需要额外的工具。对于一些简单的报告，**文件**菜单提供了将笔记本保存和导出为纯 Markdown、PDF 文件或 LaTeX 文档的功能。对于更复杂的报告，使用辅助工具来创建更精美的最终文档可能会有所帮助。

### 14.2.1 准备幻灯片

基于 HTML 的 **Reveal.js** 演示文稿是 Jupyter Notebook 的一个一流功能。**文件**菜单提供了将笔记本保存和导出为 Reveal.js 幻灯片的选项。这将创建一个 HTML 文件，作为演示文稿显示。

在 Jupyter 中，属性检查器用于设置单元格的幻灯片类型。页面右上角有一个两个齿轮交叉的图标，用于在右侧边栏中显示属性检查器。在**视图**菜单下，显示右侧边栏的选项也会显示属性检查器。

每个单元格都有几种**幻灯片类型**的选择。最重要的两个选择是“幻灯片”和“跳过”。

“幻灯片”将作为演示文稿的一部分显示。“跳过”单元格将从演示文稿中删除；这对于计算和数据准备来说非常好。其他选项允许将单元格组合成单个幻灯片，并拥有辅助演示幻灯片。

创建 **Markdown** 内容并将幻灯片类型设置为“幻灯片”将创建演示文稿的叙事文本部分。这些幻灯片将包括标题页、议程和要点：所有提示和要点都将包含在这些类型的单元格中。

对于数据可视化，我们可以使用 **Seaborn** 或 **PyPlot** 来创建图表。在属性检查器中将单元格输出类型设置为“幻灯片”，以包含可视化。

我们可以使用“跳过”幻灯片类型标记计算、函数定义和 doctest 单元格。这将省略这些细节从演示文稿中。

分析师可以将笔记本与希望查看支持细节的观众成员分享。

**Reveal.js** 拥有大量的功能。其中许多功能通过 HTML 标记实现。例如，自动动画功能将在单元格之间平滑过渡。由于 HTML 标记是 **Markdown** 的一部分，因此需要熟悉 HTML 才能使用最先进的功能。

最后一步是使用 CLI 将笔记本转换为幻灯片。**文件**菜单中的**保存并另存为...**选项，但这样往往会使所有代码都可见。可见的代码可能会分散对可视化基本信息的注意力。

以下命令隐藏了单元格输入值——代码——从演示文稿中：

```py
jupyter nbconvert --to slides --no-input <notebook.ipynb>
```

使用笔记本的名称代替`<notebook.ipynb>`。这将创建一个包含**Reveal.js**代码的 HTML 文件。

整个过程分为三个步骤：

1.  编辑笔记本。

1.  准备演示文稿。（Jupyter Lab 中的终端工具非常适合这个用途。）

1.  查看演示文稿以发现问题。

这与像**Keynote**和**PowerPoint**这样的产品的工作方式不同。当使用 Jupyter Lab 时，将在浏览器窗口和笔记本窗口之间进行一些切换。将窗口放置在显示器的两侧可能会有所帮助。

确保在每次更改笔记本后刷新浏览器窗口。

### 14.2.2 准备报告

创建报告是 Jupyter Lab 的第一等部分。**文件**菜单提供了保存和导出纯 Markdown、PDF 文件或 LaTeX 文档的能力。

类似于**pandoc**这样的工具可以将**Markdown**文件转换为各种期望的格式。对于使用 LaTeX 格式创建输出的情况，需要一个 TeX 渲染包来从源文件创建 PDF 文件。**TeXLive**项目维护了多个用于渲染 LaTeX 的有用工具。对于 macOS 用户，**MacTex**项目提供了所需的二进制文件。在线工具**Overleaf**也很有用，可以处理 LaTeX。

在许多情况下，仅仅将笔记本保存为纯**Markdown**文件是不够的，需要更复杂的处理。我们可以在我们的环境中添加**Jupyter**{**Book**}工具。更多信息请参阅[`jupyterbook.org`](https://jupyterbook.org)。

需要将`jupyter-book`组件添加到`requirements-dev.txt`文件中，以便其他开发者知道安装它。

当使用**conda**管理虚拟环境时，命令可能看起来像以下这样：

```py
% conda install --channel conda-forge jupyter-book
```

当使用其他工具管理虚拟环境时，命令可能看起来像以下这样：

```py
% python -m pip install jupyter-book
```

一个 Jupyter 书可能比单个笔记本文件复杂得多。将会有配置和**目录**（**TOC**）文件来构建整体报告。内容可以以**Markdown**、reStructuredText 和笔记本文件等多种形式提供。此外，还提供了一个**Markdown**语言的扩展版本，**MyST**，可以添加广泛的语义标记功能。

开始的一种方式是使用`jupyter-book`的`create`命令创建一个模板项目。这个模板包括所需的所有`_config.yml`和`_toc.yml`文件。它还包括可能成为项目一部分的各种其他文件的示例。

`_config.yml`文件包含标题和作者信息。这是开始自定义内容以提供正确报告和作者名称的地方。根据报告的发布方式，可能需要更改配置的其他部分。内置假设是上传 HTML 到公共仓库。对于许多报告来说，这是理想的。

然而，对于某些企业项目，向公共仓库报告并链接到公共 GitHub 是不可接受的。在这种情况下，必须更改`_config.yml`文件以正确设置仓库选项，以引用内部仓库。

立即编辑`_toc.yml`文件并开始创建报告的大纲通常很有帮助。通常，数据和笔记本已经存在。受众通常是已知的，受众成员需要吸收的关键点也很明确，这使得分析师可以立即创建大纲和占位符文档。

在某些情况下，分析师可以使用从分析笔记本中提取的笔记来填写大纲。这种内容重构可以帮助将工作笔记本缩减到必要的计算和可视化。叙述性文本可以分离到笔记本外的 MyST 或 Markdown 文件中。

一旦内容以草案形式存在，就可以使用`jupyter-book build`命令创建一本书。这将使用配置和目录文件从各种来源构建完整的文档。默认文档是一个 HTML 页面。

到本书出版日期为止，版本 0.15.1 包含一个警告，即直接 PDF 生成仍在开发中，可能存在错误。创建 PDF 的更可靠方法是使用**Jupyter**{**Book**}创建 LaTeX 文件。可以使用操作系统本地的`LaTeX`命令来构建 PDF。另一种选择是使用`sphinx-jupyterbook-latex`包来包装将 LaTeX 转换为 PDF 的 TeX 工具。

这涉及到许多移动部件，安装过程可能令人望而却步。以下是涉及的一些步骤：

1.  源**Markdown**文本由 Jupyter Book 转换为 LaTeX。

1.  `sphinx-jupyterbook-latex`包可能会执行一些中间工作。

1.  最终的 PDF 是通过操作系统的`latex`命令创建的；这是 MacTeX 或 TeXLive 安装的 TeX 工具。

CLI 构建命令是`jupyter-book build`命令，并附加一个`--builder pdflatex`选项来指定使用 Sphinx 和 TeX 工具来渲染 PDF。

### 14.2.3 创建技术图表

技术图表，包括由 UML 定义的广泛图表，通常很难创建。流行的演示工具如**Keynote**和**PowerPoint**拥有巧妙的绘图工具，内置了大量的形状和选项，可以用于在幻灯片上定位这些形状。

对于演示文稿中的图表创建，有几个选择：

+   使用单独的图形应用程序创建`.PNG`或`.jpg`文件，并将图形融入文档。本书中的许多图表都是使用 PlantUML 创建的，例如。请参阅[`plantuml.com`](https://plantuml.com)。

+   使用`matplotlib`，编写代码创建图像。这可能涉及大量的编程来绘制一些由箭头连接的框。

**PlantWEB**项目提供了一个 Python 接口到 PlantUML 网络服务。这使得分析师可以如下工作：

1.  创建一个包含描述图像的**领域特定语言**（**DSL**）文本的文件。

1.  使用 PlantUML 引擎渲染图像以创建`.jpg`文件。

1.  将图像作为 IPython `SVG`对象导入笔记本。

图像渲染使用 PlantUML 服务器；这需要一个活跃的互联网连接。在分析师可能离线工作的情况下，**PlantWEB**文档建议使用**Docker**在本地 Docker 容器中运行本地服务。这将快速进行图表渲染，无需连接到互联网。

在考虑了创建幻灯片和报告的各种技术因素后，我们可以强调本项目的交付成果。

## 14.3 交付成果

本项目有两个交付成果：

+   一个演示文稿

+   一个报告

演示文稿应该是一个使用**Reveal.js**幻灯片的 HTML 文档。

报告应该是一个来自单个笔记本的 PDF 文档。它应包含可视化图表和一些解释图像的叙述性文本。

关于笔记本的单元测试和验收测试信息，请参阅*第十三章*，*项目 4.1：可视化技术*。本项目应基于前一个项目。它不涉及戏剧性的新编程。相反，它涉及大量组件的集成，以创建有意义的、有用的演示和报告。

## 14.4 摘要

在本章中，我们构建了数据分析的两个重要工作成果：

+   可以用作演示给感兴趣的用户和利益相关者的幻灯片

+   可以分发给利益相关者的 PDF 格式的报告

这两者之间的界限总是模糊的。有些演示文稿有很多细节，本质上是在小页面上呈现的报告。

有些报告充满了图表和项目符号；它们通常看起来像是纵向模式的演示文稿。

通常，演示文稿的细节深度不如详细报告。报告通常设计用于长期保留，并提供背景信息，以及参考文献，以帮助读者填补缺失的知识。这两者都是 Jupyter 笔记本的第一流部分，创建这些内容应该是每位分析师技能的一部分。

本章强调了创建卓越成果所需的额外工具。在下一章中，我们将转换方向，探讨数据建模的一些基本统计知识。

## 14.5 额外内容

这里有一些想法供读者添加到这些项目中。

### 14.5.1 带有 UML 图表的书面报告

在 *创建技术图表* 中，总结了创建 UML 图表的过程。鼓励读者使用 PlantUML 为他们的数据采集和清洗流程创建 C4 图表。然后，这些 `.jpg` 文件可以被纳入报告中作为 Markdown 图像。

关于 C4 模型的更多信息，请参阅 [`c4model.com`](https://c4model.com)。
