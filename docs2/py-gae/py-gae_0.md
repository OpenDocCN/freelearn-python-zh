# 前言

2008 年 4 月，来自世界各地的 10,000 名开发者有幸获得了访问谷歌 App Engine 预览版账户的机会，这是一个旨在让用户在其自身服务所使用的相同基础设施上运行其网络应用程序的工具。在谷歌 Campfire One 事件期间宣布，App Engine 被描述为易于使用、易于扩展且免费入门；这三个设计目标完美地符合典型试图缩短上市时间的科技初创公司的需求。

在当时，其他大型公司已经提供租赁其部分基础设施的服务，以可负担的、按使用付费的方式销售可靠性和可扩展性，而谷歌通过向开发者提供应用程序构建块而不是简单的硬件访问，将 App Engine 提前一步；这是后来许多其他公司效仿的托管模式。这种模式的目标是让开发者专注于代码，忘记失败的机器、网络问题、可扩展性问题以及性能调整；选择 Python 作为 App Engine 支持的第一种编程语言，对于旨在使编写和运行网络应用程序更简单的工具来说是一个自然的选择。

在 2012 年的 Google I/O 事件期间，谷歌宣布，其自身基础设施的几个其他构建块将以谷歌云平台的名义提供，最初作为合作伙伴计划，然后作为通用可用产品。目前，App Engine 不仅是有名的云平台家族成员，而且是一个成熟且维护良好的平台，被广泛采用，拥有庞大的客户成功故事列表。

本书将教你如何使用 App Engine 在 Python 中编写和运行网络应用程序，充分利用谷歌云平台。从简单的应用程序开始，你将不断添加更多功能，每次都借助谷歌基础设施提供的组件和服务。

# 本书涵盖的内容

第一章, *入门*，将帮助你通过一个非常简单的功能型 Python 应用程序在运行服务器上动手实践。本章从对谷歌云基础设施的概述开始，展示了 App Engine 的位置以及它与其他知名云服务相比如何。然后，它引导读者下载和安装 Linux、Windows 和 OS X 的运行时，编写一个 `Hello, World!` 应用程序并将其部署到 App Engine 上。最后一部分介绍了开发和生产服务器的管理控制台。

第二章, *一个更复杂的应用*，教您如何在 App Engine 上实现一个复杂的 Web 应用。它从介绍捆绑的 webapp2 框架和可能的替代方案开始；然后，您将接触用户身份验证和表单处理，以及 Google 的 Datastore 非关系型数据库的介绍。最后一部分展示了如何通过模板渲染制作 HTML 页面，以及如何提供所有用于页面样式的静态文件。 

第三章, *存储和处理用户数据*，将向您展示如何从上一章的应用中添加更多功能。该章节首先向您展示如何让用户使用 Google Cloud Storage 上传文件，以及当这些文件包含图像数据时如何使用 Image API 来操作这些文件。接着，它介绍了用于在请求过程之外执行长时间任务（如图像处理）的任务队列，以及如何安排这类任务的批次。最后一部分展示了如何通过 Mail API 发送和接收电子邮件。

第四章, *提高应用性能*，首先展示了如何使用 Datastore 的高级特性来提高应用性能。然后，它向您展示如何使用 App Engine 提供的缓存，以及如何使用模块将应用拆分成更小的服务。

第五章, *在 Google Cloud SQL 中存储数据*，专注于 Google Cloud SQL 服务。它展示了如何创建和管理数据库实例，以及如何连接和执行查询。然后，它演示了 App Engine 应用如何保存和检索数据，以及如何在开发期间使用本地 MySQL 安装。

第六章, *使用通道实现实时应用*，展示了如何使我们的应用变得实时，换句话说，如何在浏览器页面不重新加载的情况下更新客户端看到的内容。第一部分展示了 Channel API 的工作原理，客户端连接时会发生什么，以及消息从服务器到客户端的往返过程。然后，它展示了如何从前面的章节中添加实时功能到我们的应用中。

第七章, *使用 Django 构建应用*，教您如何使用 Django Web 框架而不是 webapp2 来构建 App Engine 应用。第一部分向您展示如何配置开发环境，然后使用 Django 提供的一些特性重写之前章节中的应用。最后一部分展示了如何将应用部署到生产服务器。

第八章，*使用 Google Cloud Endpoints 公开 REST API*，展示了如何修改我们的应用程序的一部分以通过 REST API 公开数据。第一部分探讨了设置和配置项目所需的所有操作以及如何为我们的 API 实现几个端点。最后一部分探讨了如何为 API 端点添加 OAuth 保护。

# 你需要这本书的什么

为了运行本书中演示的代码，您需要一个 2.7.x 版本的 Python 解释器和 App Engine Python SDK，这些内容在第一章的“下载和安装”部分有描述，*入门*。

此外，为了访问在 App Engine 上运行后的示例应用程序，你需要一个最新的网络浏览器版本，例如 Google Chrome、Mozilla Firefox、Apple Safari 或 Microsoft Internet Explorer。

# 这本书是为谁而写的

如果您是一位希望将技能应用于使用 Google App Engine 和 Google Cloud Platform 工具和服务编写网络应用程序的 Python 程序员，这本书就是为您而写的。需要扎实的 Python 编程知识以及基本了解网络应用程序的结构。不假设您有 Google App Engine 的先验知识，也不需要使用类似工具的经验。

通过阅读这本书，你将熟悉 Google Cloud Platform 提供的功能，特别是关于 Google App Engine、Google Cloud Storage、Google Cloud SQL 和 Google Cloud Endpoints 的最新版本，这些内容在撰写本书时是可用的。

# 习惯用法

在这本书中，您将找到许多不同风格的文本，以区分不同类型的信息。以下是一些这些风格的示例及其含义的解释。

文本中的代码词汇如下所示：“如果用户已经登录，`get_current_user()`方法返回一个`User`对象，否则返回`None`参数”。

代码块设置如下：

```py
import webapp2

class HomePage(webapp2.RequestHandler):
    def get(self):
        self.response.headers['Content-Type'] = 'text/plain'
        self.response.out.write('Hello, World!')

app = webapp2.WSGIApplication([('/', HomePage)], debug=True)
```

**新术语**和**重要词汇**将以粗体显示。你在屏幕上看到的，例如在菜单或对话框中的词汇，在文本中会这样显示：“要创建一个新应用程序，请点击**创建应用程序**按钮。”

### 注意

警告或重要注意事项将以这样的框显示。

### 小贴士

小贴士和技巧会这样显示。

# 读者反馈

我们欢迎读者的反馈。请告诉我们您对这本书的看法——您喜欢什么或可能不喜欢什么。读者的反馈对我们开发您真正能从中获得最大价值的标题非常重要。要发送一般反馈，请简单地发送电子邮件到`<feedback@packtpub.com>`，并在邮件主题中提及书名。如果您在某个主题上有专业知识，并且您有兴趣撰写或为书籍做出贡献，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您是 Packt 图书的骄傲拥有者，我们有一些事情可以帮助您从您的购买中获得最大收益。

# 下载示例代码

您可以从您在 [`www.packtpub.com`](http://www.packtpub.com) 的账户下载您购买的所有 Packt 图书的示例代码文件。如果您在其他地方购买了这本书，您可以访问 [`www.packtpub.com/support`](http://www.packtpub.com/support) 并注册，以便将文件直接通过电子邮件发送给您。

## 下载本书中的彩色图像

我们还为您提供了一个包含本书中使用的截图/图表的彩色图像的 PDF 文件。彩色图像将帮助您更好地理解输出的变化。您可以从以下链接下载此文件：[`www.packtpub.com/sites/default/files/downloads/B03710_8194OS_Graphics.pdf`](https://www.packtpub.com/sites/default/files/downloads/B03710_8194OS_Graphics.pdf)

# 错误清单

尽管我们已经尽一切努力确保我们内容的准确性，但错误仍然会发生。如果您在我们的某本书中找到错误——可能是文本或代码中的错误——如果您能向我们报告这一点，我们将不胜感激。通过这样做，您可以节省其他读者的挫败感，并帮助我们改进本书的后续版本。如果您发现任何错误清单，请通过访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击**错误提交表单**链接，并输入您的错误详细信息来报告它们。一旦您的错误清单得到验证，您的提交将被接受，错误清单将被上传到我们的网站，或添加到该标题的错误清单部分。

要查看之前提交的错误清单，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索字段中输入本书的名称。所需信息将出现在**错误清单**部分。

# 盗版

互联网上对版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视我们版权和许可证的保护。如果您在互联网上发现我们作品的任何非法副本，无论形式如何，请立即提供位置地址或网站名称，以便我们可以寻求补救措施。请通过 `<copyright@packtpub.com>` 联系我们，并提供涉嫌盗版材料的链接。我们感谢您在保护我们的作者以及为我们提供有价值内容的能力方面的帮助。

# 询问

如果您在本书的任何方面遇到问题，可以通过 `<questions@packtpub.com>` 联系我们，我们将尽力解决。
