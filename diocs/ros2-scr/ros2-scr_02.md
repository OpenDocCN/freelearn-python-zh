

# 第一章：ROS 2 简介——什么是 ROS 2？

**机器人操作系统**（**ROS**）可能会让人困惑，正如其名称所示。很难知道它确切是什么，它包含什么，以及它能做什么。此外，为什么你需要 ROS，以及何时应该使用它？

在开始之前，感到困惑是正常的——大多数人都会这样。尽管 ROS 是学习和开发机器人应用的最佳工具之一，但它也伴随着陡峭的学习曲线，第一个障碍就是理解它是什么。

在这个简短的第一章中，我将解释我们将在这本书中使用的术语。然后你会看到 ROS 为什么存在，以及它能为你解决什么问题。之后，我们将深入探讨 ROS 的四个支柱，以了解它是什么。你还会看到一些例子，说明何时以及何时不应使用它。

到本章结束时，你将更好地理解 ROS 背后的全局图景，并对最常见的困惑有清晰的认识。你还将了解在开始使用 ROS 之前你需要哪些先决条件，以及如何遵循这本书以充分利用它。这将帮助你迈出正确的第一步。

在本章中，我们将涵盖以下主题：

+   术语

+   什么是 ROS，何时应该使用它，以及为什么？

+   ROS 1 与 ROS 2 的比较

+   开始使用 ROS 2 的先决条件

+   如何遵循这本书

# 术语

你可能已经看到过 ROS、ROS 1、ROS 2 以及其他各种变体（带或不带空格），这些可能会让人困惑。

让我们澄清一下：

+   ROS 1 是（曾是）ROS 的第一个版本

+   ROS 2 是 ROS 的第二个和更新的版本，并将成为本书的重点

在这本书中，我将使用以下约定：

+   **ROS**：当谈论 ROS 的一般概念、哲学等时

+   **ROS 1**：当具体谈论 ROS 的第一个版本时。然而，这将会非常罕见，因为这里的重点是 ROS 2

+   **ROS 2**：当谈论 ROS 的第二版时

注意

我可能会在某些时候交替使用*ROS*或*ROS 2*，因为我们不会在这里关注 ROS 1。

在未来（当 ROS 1 完全消失时），ROS 2 的名字可能再次变为 ROS，这并非不可能。如果你听说过 Angular，它最初是 AngularJS，之后他们发布了 Angular2，然后几年后，它简单地变成了 Angular。我猜 ROS 也会发生类似的事情，尽管这目前只是我的一个理论。

# 什么是 ROS，何时我们应该使用它，以及为什么？

在我们开始理解 ROS 是什么之前，让我们先了解为什么我们需要它。

## 为什么需要 ROS？

让我们从机器人中经常出现的一个大问题开始。

想象一下，你刚刚在工作中接到了一个新的项目，你需要开发一个机器人应用，或者你正在进行一个新的研究论文。一个非常重要的事情是要考虑到，在现实生活中，任何项目或论文都将有一个特定的持续时间，从几个月到几年不等。

现在，接下来会发生什么？

你开始设计你项目所需的机器人系统，很快就会意识到开发机器人将花费大量时间，因为所有你找到的现有解决方案都不符合你的需求。几周后，你最终确定了规格，并开始构建你的机器人。几个月后，你仍在开发轮控和导航的基本软件。你低估了仅让机器人运行所需的时间。一年或两年后，你意识到到目前为止你所做的一切只是构建了一个机器人系统，而你还没有开始你的应用程序或研究的核心功能。现在是时候加快速度了。

你尽可能地完成机器人，做一些捷径，发布你的论文或展示那个原型。在最佳情况下，你也可以通过开源许可分享你的代码，这样其他人就可以使用它，但可能不会直接使用，因为这只是满足你自身需求的代码，而不是一个包含模块化组件、文档等完整框架或库。

然后，你转向新的项目、新的工作和新的研究。别人会取代你的位置，阅读你的代码，并意识到它并不能帮助他们构建应用程序。因此，他们不得不从头开始。

这里发生的事情是你重新发明了轮子。下一个人会重复同样的循环。这比你想象的要普遍得多。人们不断地重复发明轮子。这就是 ROS 被创造出来的首要原因：在你需要创建机器人时阻止你重新发明轮子。就像你有开源框架、工具和环境来开发网站或移动应用程序一样，为什么不为机器人做同样的事情呢？这就是 ROS 背后的哲学：为机器人应用程序提供一个*标准*，你可以在*任何机器人*上使用它。

在你学习 ROS 之后，你可以将更多时间投入到你想要添加的关键功能上，而不是基础的技能学习。你将能够迅速编程新的机器人，加入现有的项目，并且能够轻松地与团队协作。

## ROS 是什么？

ROS 难以定义，因为它不仅仅是一件事。坦白说，我认为你只有开始理解如何用它编写代码，才能真正理解 ROS 是什么。

我们可以从 ROS 不是什么开始了解。

ROS 不是一个操作系统。它是四个主要部分的组合：

+   框架

+   工具集

+   即插即用的插件

+   在线社区

让我们更深入地探讨这些部分。

### ROS 是一个具有管道的框架

ROS 提供了一套构建应用程序的规则。正如我们将在本书中看到的，你需要创建包，然后在那些包（节点）内部编写程序。创建和编写它们以及创建工具来构建和使用它们都有特定的方式。

任何框架都附带一套特定的规则。令人印象深刻的是，在你创建了一些项目之后，任何新的项目都将更容易、更快地设置。此外，由于每个人都遵循相同的规则，你可以更轻松地在团队中工作或理解和使用他人编写的代码。

使用此框架的直接结果是，你获得了通常被称为**plumbing**的访问权限，这意味着节点之间的底层通信由你管理。想象一下，你正在建造一栋房子，管道或电气系统已经为你准备好了。这将节省你大量的开发时间，而且你也不需要学习如何自己来做（因此，重新发明轮子）。

总结来说，使用 ROS，你可以轻松地将你的应用程序分成不同的子程序（称为**nodes**）。节点之间的通信由你处理。你可以轻松测试一个组件，如果这个组件失败，它将不会影响其他正在运行的组件。ROS 是一个模块化框架。

### 一套工具

ROS 附带一套工具，这些工具可以帮助你更快地开发。其中，你可以找到用于构建应用程序的命令行工具，用于监控通信流程的检查工具，日志功能，图表等等。

你还获得了 3D 可视化工具来查看你的机器人正在做什么，甚至还有一个名为**Gazebo**的完整模拟器，它使用真实物理，这样你就可以在尝试你的机器人之前进行现实模拟。

可用的工具相当多，我们将在本书中了解到其中许多。作为一个例子，有一个（称为**bags**）的功能允许你保存通信流，以便稍后回放。假设你构建了一个移动机器人，需要在下雨时进行测试，然后考虑雨水因素继续开发软件。你可能不会每天都下雨，或者你甚至无法随时接触到机器人。有了这个工具，你可以运行一次实验，保存数据，然后稍后回放以开发针对特定条件的应用程序。

### 功能性 – 插件和堆栈即插即用

这可能是你将节省数百小时的地方。想象两个常见的场景：

+   你开发了一个移动机器人，需要机器人能够在动态环境中自主导航。

+   你开发了一个六轴机械臂，并希望创建运动规划以在所有轴上执行平滑运动。

这看起来相当复杂，需要理解和实现几个算法，以及编写良好优化和高效的代码。这可能是你不得不重新发明轮子并浪费大量宝贵时间的地方。

对于这两种情况，你可以找到现有的插件来为你完成工作。你所需要做的就是安装插件，并配置你的机器人使其兼容。当然，这比说起来要难，但工作量可以按天/周计算，而不是按月/年计算。而且，一旦你学会了如何使用这些插件，你的下一个项目将花费的时间会少得多。

你可以使用许多插件。有些相当简单，而有些则涉及一系列插件，也被称为框架或堆栈。作为 ROS 开发者，你的工作是**粘合**所有这些组件，也许为尚未开发的特性创建新的组件。

### 在线社区

这是 ROS 的第四个支柱，它相当重要：社区。ROS 是一个开源项目，拥有宽松的许可证。我无法就许可证提供任何法律建议，但你可以在商业产品中使用 ROS 而无需重新分发你的代码。

你可以在网上找到所有 ROS 代码，以及即插即用的插件代码。所有这些都可以在 GitHub 上轻松访问。

ROS 项目还得到了一个在线社区的支持，你通常可以在以下区域找到它：

+   **机器人技术问答社区**([`robotics.stackexchange.com/`](https://robotics.stackexchange.com/))：你可以使用这个平台来提问技术问题。如果你熟悉 Stack Overflow，就像大多数开发者一样，那么，这就是机器人领域的 Stack Overflow。

+   **ROS 论坛**([`discourse.ros.org/`](https://discourse.ros.org/))：在这里，你可以了解最新的发展、工作、社区项目、新想法等。我建议你经常检查这个网站，以保持对 ROS 走向的了解。

## 何时使用 ROS

现在你对 ROS 有了更多的了解，那么在你的项目中只要有“机器人”这个词，你就应该使用 ROS 吗？在本节中，我将给你一些提示，说明何时使用 ROS 是有意义的，并通过一些例子来帮助你更好地理解。

首先，如果你因为工作或大学需要学习 ROS 而阅读这本书，那么答案很简单：是的，你将在你的项目中使用 ROS。

但如果你必须自己做出决定，你应该怎么做？

让我们简化机器人技术，并说一个机器人系统包含三类事物：执行器、传感器和控制器。

**执行器**是产生运动的东西（例如，一个旋转轮子的电机）。**传感器**将从环境中读取数据（例如，摄像头、激光扫描或温度传感器）。**控制器**介于两者之间：它从一个或多个传感器（输入）获取可用的数据，并通过算法为机器人的执行器（输出）创建命令。从某种意义上说，控制器是机器人的**大脑**或大脑之一。

对于非常简单的应用，当你只有几个传感器和执行器时，你可能不需要 ROS。

这里有一些例子，说明 ROS 不是必需的：

+   当用户按下按钮时，你只需要使用 Raspberry Pi 板从相机中拍照，并将这张照片发送到网络服务器。没有必要使用 ROS——你只需在脚本中结合几个 Python 库，就完成了。在这里使用 ROS 将是一个过度设计的例子（除非你这样做是为了学习目的）。

+   当检测到运动时，你需要使用红外传感器打开/关闭门，这是一个非常简单的应用，可以很容易地使用基本的微控制器板编程——你可以用 Arduino 这样的板快速原型。

+   你已经用两个轮子和一个红外传感器构建了一个简单的机器人，并想使机器人跟随一条线。这是一个典型的工程项目，通常在工程学院的学生中给出，一个简单的 Arduino 板上的算法就可以完成。

现在，让我们考虑一些需要 ROS 的例子：

+   你有一个新的两轮激光扫描移动机器人，你想从激光扫描中读取数据，绘制环境地图，使机器人自主移动，并相应地控制两个轮子。除此之外，你还想用真实的物理属性在 3D 中模拟机器人。这时 ROS 就会变得非常有用。它不仅可以帮助你使所有组件协同工作，你还可以使用现有的路径规划算法（通过 ROS 插件）和模拟。

+   你需要创建一个包含六轴机械臂，甚至多个机械臂协同工作，以及传送带和移动机器人的系统。

+   你的机器人应用（不一定是单个机器人）包含大量你想要单独开发并模块化添加的传感器和执行器。

+   你想为某个组件创建一个硬件驱动程序，并使其他机器人开发者能够轻松使用这个组件。通过使组件*与 ROS 兼容*，任何了解 ROS 的人都可以轻松将其集成到他们的应用中。

如前所述示例所示，ROS 并非在每次需要编程硬件或创建机器人系统时都是必需的。当然，你可以为任何应用使用它，但这就好比你要为单个静态网页使用完整的网络框架（例如 Django）一样。

从后面的示例中，你可以看到，如果你的系统变得更加复杂，如果你想与其他开发者轻松协作，或者如果你意识到系统的一个大块部分可以用一个即插即用的插件来解决，ROS 可能就是解决方案。

当然，学习它需要时间，你的第一个项目完成时间会更长，但随着经验的积累，你会变得更快。

例如，一个经验丰富的 ROS 开发者可能不到一周就能为机械臂编写自定义代码（包括机器人模型、运动规划和硬件控制），同样，对于具有导航能力的移动机器人也是如此（前提是硬件已经有一个 ROS 驱动程序）。不到一周，你就能得到一个可工作的软件原型。

# ROS 1 与 ROS 2 的比较

为了明确，这本书完全是关于 ROS 2 的，而不是 ROS 1。你将从零基础开始学习 ROS 2。这个部分可能是唯一一次我会这么详细地谈论 ROS 1。

## ROS 的简要故事，以及我们如何到达 ROS 2

ROS 1（最初被称为 ROS）首次开发于 2007 年。它在接下来的几年里迅速获得了人气，并呈指数级增长。

2014 年，宣布了 ROS 2 项目。简单来说，ROS 1 对于工业应用来说有点过于局限（缺乏实时支持、安全性等），并且仅用于研究/教育。为了解决这个问题，开发者决定使 ROS 更加“适合工业”，同时也使它变得更好，这是从 ROS 开始以来学到的所有经验教训。

现在，为什么创建 ROS 2 而不是仅仅对 ROS 进行一些新更改？因为更改太大，它们将完全破坏与旧版本的兼容性。因此，决定从头开始创建一个全新的 ROS，并将其命名为 ROS 2。2014 年，ROS 2 正式宣布，项目开发开始。

2017 年 12 月，发布了第一个 ROS 2 发行版，这意味着 ROS 1 和 ROS 2 开始共存。在这个时候，ROS 2 缺少许多核心功能性和插件，使其不适合严肃的项目。大多数 ROS 开发者仍在使用 ROS 1。

年复一年，ROS 2 得到了更多的发展，插件也越来越多。它的受欢迎程度开始增长。

我认为从 2022 年开始使用 ROS 2（与 ROS 1 相比）是值得的。这可能是个人观点，有些人可能不同意，但从 2022 年和**ROS 2 Humble**（更多关于发行版的内容见*第二章*）的发布开始，我们有了长期稳定发布的版本，所有主要插件和堆栈都能正常工作，这正是编写机器人程序所需要的。

同时，宣布 ROS 1 将在 2025 年 5 月结束。在此日期之后，ROS 1 仍然存在，但将不再提供支持。

2023 年是 ROS 社区从 ROS 1 转向 ROS 2 最显著的年份。现在可以肯定地说，当开发新的 ROS 应用程序时，ROS 2 是必由之路。

所以，如果你之前听说过 ROS 1 和 ROS 2，现在你知道 ROS 2 是你需要学习的，我们可以这样说，ROS 1 是一个过时的项目。但这是真的吗？

## ROS 1 已经过时了吗？

理论上是这样，但在实践中，情况总有些不同。你可能知道，有几家公司仍在使用过时和遗留的技术。原因是将软件更新到新版本通常相当昂贵，也可能存在风险。这就是为什么你仍然会看到银行系统的工作机会要求具备 Cobol 语言技能，这是一种 1960 年代的编程语言，现在已经没有人使用了。

在机器人领域，情况有些相似。一些公司已经发布了使用特定版本的 ROS 1 的机器人，并且当机器人仍在市场上时，公司不会升级，仍然使用和维护之前的版本，这也被称为*遗留版本*。因此，2025 年的最终过渡可能还需要几年时间。

我为什么要写这篇文章？简单来说，就是想让你知道，如果你在一家已经使用 ROS 的机器人公司找到工作，即使 ROS 1 已经正式结束，你可能会遇到一些 ROS 1 项目。然而，请放心，你拥有的所有 ROS 2 知识都可以轻松迁移到 ROS 1，因为核心概念是相同的。

总结来说，对于所有新的学习、项目、研究、教学和创业，ROS 2 是你需要的。我现在将关闭 ROS 1 的这一章节，并专注于 ROS 2。如前所述，我可能会交替使用*ROS*或*ROS 2*，因为我们这里的目标不是 ROS 1。

# 开始使用 ROS 2 的先决条件

要开始使用 ROS 和这本书，你需要了解一些事情。

## 知识先决条件

最好你对以下内容有所了解：

+   **Linux 命令行**：由于我们将使用**Ubuntu**，熟悉 Linux 是强制性的。你不需要成为专家——你只需要了解基础知识。ROS 2 中的许多工具都涉及命令行，所以知道如何打开终端并编写基本命令将极大地帮助你。

+   **Python 编程**：ROS 最常用的两种语言是**Python**和 C++。Python 更容易上手，并且允许你更快地进行原型设计。因此，我们将使用这种语言进行所有详细解释。你需要了解 Python 基础知识，**面向对象编程**（**OOP**）是一个很好的加分项，因为 ROS 2 在各个地方都大量使用 OOP。

+   **可选**：**C++**编程。尽管这本书的重点是 Python，但我仍然想包括我们做的所有事情中的 C++代码。如果你只想学习 Python，你可以忽略 C++代码，但当然，如果你想遵循 C++指令，你需要 C++基础知识（最好是面向对象编程）。

我想强调，如果你有良好的编程和 Linux 基础知识，学习 ROS 2 将会容易得多。学习 ROS 本身就已经相当具有挑战性（尽管有了这本书，目标是降低学习曲线），所以如果你是从零开始学习 ROS、Linux 和 Python，这可能会让你感到不知所措。

如果你正在阅读这些内容而你不知道如何编写 Python 函数或在终端中导航到目录，那么我真心建议你在这里暂停，花些时间学习 Python 和 Linux 基础知识，然后再回到这本书。没有必要花数百小时来做这件事，但投入一些时间确保基础知识正确将帮助你更快地完成这本 ROS 2 书。

## 硬件和软件

你需要一台计算机来阅读本书。关于规格，你不需要任何花哨的东西来开始使用 ROS 2。如果你可以打开带有几个标签的网页浏览器并且有顺畅的体验，那么我可以说你这台计算机足够开始使用了。

然后，稍后，根据你想要用 ROS 做什么，你可能需要一个更好的机器（例如，如果你想要使用大量传感器和图像处理来模拟多个机器人）。然而，可能最好等到你需要额外的性能时再升级。现在，最重要的事情是开始学习 ROS。

对于软件要求，我将在本书的整个过程中提供必要的安装说明。我们将使用的所有软件都是免费使用和开源的。

我们还将使用 Ubuntu 24.04，在其中我们将运行 ROS 2。安装 Ubuntu 是一个要求，但我会给你一个在*第二章*的回顾。

# 如何阅读本书

本书分为三个部分，包括 14 章。

每一章都可以单独阅读，尽管对于某一章，你需要所有之前章节的知识。

如果你是因为想要从头开始而得到这本书，那么很简单：按照书写的顺序阅读本书。我特意设计它，以便你一次学习一个概念，而不必考虑你应该采取什么方向。

然后，随着你的进步，随时可以回到任何章节来消除疑惑。我鼓励你这样做。第一次学习一个概念时，你并不一定能够掌握所有的细微之处。随着你继续阅读本书并使用这个概念以及其他新概念，你经常会遇到“顿悟时刻”，那时一切都会变得清晰。

如果你已经了解一些 ROS 2 基础知识（或者你已经阅读过这本书），那么你可以自由地跳到任何章节。如果一个章节是从我们在前几章中开发的代码库开始的，那么你将能够下载代码并从那里开始。

有一个 GitHub 仓库你可以用来阅读本书：[`github.com/PacktPublishing/ROS-2-from-Scratch`](https://github.com/PacktPublishing/ROS-2-from-Scratch)。我们将编写的所有代码都托管在那里，所以请确保在阅读本书时密切使用这个 GitHub 仓库。我会在本书稍后解释如何使用这个仓库。

# 摘要

在本章的介绍部分，我们澄清了一些关于 ROS（机器人操作系统）最常见的困惑点：它的名称、它是什么以及不是什么、何时使用它以及为什么。你还了解了不同版本的 ROS（ROS 1 和 ROS 2），以及你学习了开始使用 ROS 2 所需具备的先决条件。

现在，你应该对整体情况有了更好的理解，即使一切看起来仍然有些混乱，也不要过于担心——当你使用 ROS 2 的概念和代码时，一切都会变得清晰。

现在，为了能够使用 ROS 2，我们需要安装它。这将是下一章的重点，并帮助你将你的环境 100%准备好用于 ROS 2。
