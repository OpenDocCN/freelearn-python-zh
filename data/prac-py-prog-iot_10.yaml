- en: Turning Things On and Off
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 打开和关闭东西
- en: In the previous chapter, we looked at core electronic circuits and concepts
    that you will use when interfacing digital and analog circuits with your Raspberry
    Pi's GPIO pins.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们讨论了当您将数字和模拟电路与树莓派的GPIO引脚进行接口时将会使用的核心电子电路和概念。
- en: In this chapter, we will cover how to switch *things* on and off that require
    more voltage and current than can be safely used with your Raspberry Pi. When
    it comes to electronics, hundreds of different components can be used for controlling
    and switching. And there are thousands of different ways they can be configured.
    We will be focusing on three common complements—optocouplers, transistors, and
    relays.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍如何打开和关闭*需要比树莓派安全使用的更高电压和电流*的*东西*。在电子领域，可以使用数百种不同的元件来进行控制和开关。它们可以以成千上万种不同的方式进行配置。我们将重点关注三种常见的补充—光耦、晶体管和继电器。
- en: An understanding of how to control and switch electrical circuits on or off
    is a very important topic when interfacing with a Raspberry Pi. As we discussed
    in [Chapter 5](45ff8333-2eb2-47f1-86d9-31ccecf39de5.xhtml), *Connecting your Raspberry
    Pi to the Physical World*, Raspberry Pi GPIO pins are only capable of safely delivering
    a few milliamps of output current and a fixed 3.3-volts. After completing this
    chapter, your knowledge of optocouplers, transistors, and relays will mean you
    can start controlling devices that have different current and voltage requirements.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 当与树莓派进行接口时，了解如何控制和开关电路是一个非常重要的话题。正如我们在[第5章](45ff8333-2eb2-47f1-86d9-31ccecf39de5.xhtml)中讨论的那样，树莓派的GPIO引脚只能安全地提供少量毫安的输出电流和固定的3.3伏特。完成本章后，您对光耦、晶体管和继电器的了解将意味着您可以开始控制具有不同电流和电压要求的设备。
- en: 'Here is what we will cover in this chapter:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是本章的内容：
- en: Exploring a relay driver circuit
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索继电器驱动电路
- en: Determining a load's voltage and current
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定负载的电压和电流
- en: Using an optocoupler as a switch
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用光耦作为开关
- en: Using a transistor as a switch
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用晶体管作为开关
- en: Using a relay as a switch
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用继电器作为开关
- en: Technical requirements
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: 'To perform the exercises in this chapter, you will need the following:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成本章的练习，您将需要以下设备：
- en: Raspberry Pi 4 Model B
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 树莓派4型B
- en: Raspbian OS Buster (with desktop and recommended software)
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 树莓派操作系统Buster（带桌面和推荐软件）
- en: A minimum of Python version 3.5
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 至少Python版本3.5
- en: These requirements are what the code examples in this book are based on. It's
    reasonable to expect that the code examples should work without modification on
    a Raspberry Pi 3 Model B or a different version of Raspbian OS as long as your
    Python version is 3.5 or higher.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这些要求是本书中代码示例的基础。可以合理地期望，只要您的Python版本是3.5或更高，本书中的代码示例应该可以在树莓派3型B或不同版本的Raspbian
    OS上无需修改即可运行。
- en: You will find this chapter's source code in the `chapter07` folder in the GitHub
    repository available here: [https://github.com/PacktPublishing/Practical-Python-Programming-for-IoT](https://github.com/PacktPublishing/Practical-Python-Programming-for-IoT).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在GitHub存储库的`chapter07`文件夹中找到本章的源代码，链接在这里：[https://github.com/PacktPublishing/Practical-Python-Programming-for-IoT](https://github.com/PacktPublishing/Practical-Python-Programming-for-IoT)。
- en: 'You will need to execute the following commands in a Terminal to set up a virtual
    environment and install the Python libraries required for the code in this chapter:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要在终端中执行以下命令来设置虚拟环境并安装本章代码所需的Python库：
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following dependencies are installed from `requirements.txt`:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 以下依赖项已从`requirements.txt`中安装：
- en: '**PiGPIO**: The PiGPIO GPIO library ([https://pypi.org/project/pigpio](https://pypi.org/project/pigpio))'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**PiGPIO**：PiGPIO GPIO库（[https://pypi.org/project/pigpio](https://pypi.org/project/pigpio)）'
- en: 'The electronic components we will need for this chapter''s exercises are as
    follows:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 本章练习所需的电子元件如下：
- en: 1 x 2N7000 MOSFET (sample datasheet: [https://www.alldatasheet.com/datasheet-pdf/pdf/171823/ONSEMI/2N7000.html](https://www.alldatasheet.com/datasheet-pdf/pdf/171823/ONSEMI/2N7000.html))
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x 2N7000 MOSFET（样本数据表：[https://www.alldatasheet.com/datasheet-pdf/pdf/171823/ONSEMI/2N7000.html](https://www.alldatasheet.com/datasheet-pdf/pdf/171823/ONSEMI/2N7000.html)）
- en: 1 x FQP30N06L MOSFET (optional—sample datasheet: [https://www.alldatasheet.com/datasheet-pdf/pdf/52370/FAIRCHILD/FQP30N06L.html](https://www.alldatasheet.com/datasheet-pdf/pdf/52370/FAIRCHILD/FQP30N06L.html))
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x FQP30N06L MOSFET（可选—样本数据表：[https://www.alldatasheet.com/datasheet-pdf/pdf/52370/FAIRCHILD/FQP30N06L.html](https://www.alldatasheet.com/datasheet-pdf/pdf/52370/FAIRCHILD/FQP30N06L.html)）
- en: 1 x PC817 optocoupler (sample datasheet [https://www.alldatasheet.com/datasheet-pdf/pdf/547581/SHARP/PC817X.html](https://www.alldatasheet.com/datasheet-pdf/pdf/547581/SHARP/PC817X.html))
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x PC817光耦（样本数据表[https://www.alldatasheet.com/datasheet-pdf/pdf/547581/SHARP/PC817X.html](https://www.alldatasheet.com/datasheet-pdf/pdf/547581/SHARP/PC817X.html)）
- en: 1 x SDR-5VDC-SL-C relay (sample datasheet: [https://www.alldatasheet.com/datasheet-pdf/pdf/1131858/SONGLERELAY/SRD-5VDC-SL-C.html](https://www.alldatasheet.com/datasheet-pdf/pdf/1131858/SONGLERELAY/SRD-5VDC-SL-C.html))
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x SDR-5VDC-SL-C继电器（样本数据表：[https://www.alldatasheet.com/datasheet-pdf/pdf/1131858/SONGLERELAY/SRD-5VDC-SL-C.html](https://www.alldatasheet.com/datasheet-pdf/pdf/1131858/SONGLERELAY/SRD-5VDC-SL-C.html)）
- en: 1 x 1N4001 diode
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x 1N4001二极管
- en: 2 x 1k Ω and 1 x 100k Ω resistors
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2 x 1kΩ和1 x 100kΩ电阻
- en: 1 x 5mm red LED
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x 5mm红色LED
- en: 1 x Size 130 (R130) DC motor rated 3-6 volts (ideally with a stall current <
    800mA) or alternate DC motor with compatible voltage and current ratings
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1 x 130号（R130）直流电机额定电压3-6伏特（最好具有失速电流<800mA）或具有兼容电压和电流额定值的替代直流电机
- en: Digital multimeter capable of measuring current (it'll have an A or mA setting)
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 能够测量电流的数字万用表（它将有A或mA设置）
- en: 2 x External power sources—at a minimum, a 3.3V/5V breadboard-mountable power
    supply
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2 x 外部电源—至少是3.3V/5V面包板可安装电源
- en: Exploring a relay driver circuit
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索继电器驱动电路
- en: 'A common introduction to electronic switching is the mechanical relay—a device
    that operates like a common switch, only it''s turned on and off by applying power
    to it. Unfortunately, connecting a relay directly to a Raspberry Pi is dangerous!
    Relays commonly require too much current and voltage and (if they do switch) can
    damage your Raspberry Pi. So, we need a driver circuit that sits between your
    Raspberry Pi and the relay. An example of this circuit is shown in *Figure 7.1*:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 电子开关的常见介绍是机械继电器 - 一种像普通开关一样工作的设备，只是通过给它供电来打开和关闭。不幸的是，直接连接继电器到树莓派是危险的！继电器通常需要太多的电流和电压，并且（如果它们确实切换）可能会损坏您的树莓派。因此，我们需要一个驱动电路，位于树莓派和继电器之间。这个电路的示例如图7.1所示：
- en: '![](assets/ca2a40c5-0e53-42e6-a25f-bf6361a8ddd7.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/ca2a40c5-0e53-42e6-a25f-bf6361a8ddd7.png)'
- en: Figure 7.1 – Relay driver circuit
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1 - 继电器驱动电路
- en: This is the circuit we will build, piece-by-piece during this chapter. This
    circuit is representative of the many relay control modules that you will find
    on eBay, Banggood, and similar web sites. These boards are certainly convenient
    to use—when you get them to work. Unfortunately, all too often, a lack of clear
    documentation can make getting them to work fiddly and difficult, especially if
    you are new to electronics.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将在本章逐步构建的电路。这个电路代表了您在eBay、Banggood和类似网站上找到的许多继电器控制模块。这些板确实很方便使用 - 当您让它们工作时。不幸的是，缺乏清晰的文档往往会使得让它们工作起来棘手和困难，特别是如果您是电子新手。
- en: We are about to build and explore the three sub-circuits depicted in *Figure
    7.1.* This will help you to understand how optocouplers, transistors, and relays
    work as switches and why they are often chained together to control a relay. This
    knowledge will also help you to reverse-engineer a pre-made relay control module
    in case you can't get one working.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将要构建并探索图7.1中所示的三个子电路。这将帮助您了解光耦、晶体管和继电器作为开关的工作原理，以及它们为什么经常被串联在一起来控制继电器。这些知识还将帮助您在无法使其工作时逆向工程预制继电器控制模块。
- en: Before we look at the optocoupler sub-circuit, we need to first discuss load
    voltages and currents.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们讨论光耦子电路之前，我们需要首先讨论负载电压和电流。
- en: Determining a load's voltage and current
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 确定负载的电压和电流
- en: A *load* is something that you want to control, or for this chapter, switch
    on and off. LEDs, transistors, optocouplers, relays, lights, electric motors,
    heaters, pumps, automatic garage doors, and TVs are all examples of a load. If
    you refer back to *Figure 7.1*, you will notice the word Load on the right-hand
    side of the diagram. This is where you connect the thing you want to switch on
    or off.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '*负载*是您想要控制的东西，或者在本章中，打开和关闭。LED、晶体管、光耦、继电器、灯、电动机、加热器、泵、自动车库门和电视都是负载的例子。如果您回到图7.1，您会注意到图表右侧的“负载”一词。这是您连接想要打开或关闭的东西的地方。'
- en: The *transistors, optocouplers,* and *relays* components appear in this aforementioned load
    list*.* Referring back to *Figure 7.1*, the relay appears as the load to the transistor
    sub-circuit while the transistor sub-circuit appears as the load to the optocoupler
    sub-circuit.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '*晶体管、光耦*和*继电器*组件出现在上述*负载列表*中。回到图7.1，继电器出现为晶体管子电路的负载，而晶体管子电路出现为光耦子电路的负载。'
- en: 'It''s important to know two properties about the load you want to control:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 了解您想要控制的负载的两个属性是很重要的：
- en: What **voltage** does the load require?
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载需要多少电压？
- en: What **current** does the load require?
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载需要多少电流？
- en: Sometimes, these properties can be found on the device itself or in its manual
    or datasheet. At other times, they need to be calculated or the load needs to
    be manually measured.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 有时，这些属性可以在设备本身或其手册或数据表中找到。其他时候，它们需要被计算或者负载需要被手动测量。
- en: Knowing these properties is important because they influence which components
    are chosen for a circuit, including the specifications for a suitable power supply.
    We will make mention of load currents as we build circuits throughout this chapter,
    so a little more context is coming. For now, let's look at how to measure the
    current load of a DC motor.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 知道这些属性很重要，因为它们影响了电路中选择哪些组件，包括适合的电源规格。在本章的整个电路构建过程中，我们将提到负载电流，因此稍后会有更多的上下文。现在，让我们看看如何测量直流电机的电流负载。
- en: Measuring the current requirement of a DC motor
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测量直流电机的电流需求
- en: 'Motors are a common item that people want to control, and they serve as an
    excellent example in current measurement. Let''s perform an exercise to measure
    the current used by our DC motor:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 电机是人们想要控制的常见物品，它们是电流测量的一个很好的例子。让我们进行一个练习来测量我们的直流电机所使用的电流：
- en: '![](assets/d5acaf87-b079-48d5-90bf-cbbc17d30445.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/d5acaf87-b079-48d5-90bf-cbbc17d30445.png)'
- en: Figure 7.2 – R130 DC Motor
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.2 - R130直流电机
- en: A typical size 130 (R130) DC motor is shown in the preceding photograph, together
    with a set of jumper leads soldered to the motor's terminals so it can be plugged
    easily into a breadboard. This motor has a red back, however, other colors are
    common—especially clear/white. The color has no bearing on the motor specifications.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的照片显示了一个典型的130（R130）直流电机，以及一组跳线引线焊接到电机的端子上，以便可以轻松地将其插入面包板。这个电机有一个红色的背面，但其他颜色也很常见
    - 尤其是透明/白色。颜色对电机规格没有影响。
- en: As you proceed with the following steps, please consult your multimeter manual
    if you are unsure how to place it into current measurement mode.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在进行以下步骤时，如果您不确定如何将万用表置于电流测量模式，请参考您的万用表手册。
- en: 'Here are the steps to follow:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是要遵循的步骤：
- en: 'Connect up a circuit as shown in *Figure 7.3*:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照图7.3中所示的连接电路：
- en: '![](assets/6b3b720f-a005-4681-bb38-757fb1735714.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/6b3b720f-a005-4681-bb38-757fb1735714.png)'
- en: Figure 7.3 – Measuring current with a multimeter
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.3 - 使用万用表测量电流
- en: We are assuming that the motor here is the one mentioned in the *Technical requirements*
    section at the start of the chapter. This motor is small enough to be powered
    from a breadboard power supply, which typically can supply between 500mA and 800mA.
    For larger motors (and other items where you do not know their ratings and want
    to measure them), you will require a more capable power supply.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们假设这里的电机是章节开头的*技术要求*部分提到的电机。这个电机足够小，可以从面包板电源供电，通常可以提供500mA到800mA。对于更大的电机（以及其他你不知道其额定值并想要测量的物品），你将需要一个更强大的电源。
- en: If you are powering a breadboard power supply from a USB phone charger, check
    your power supplies 5-volt output with a multimeter to make sure it is providing
    about 5 volts. Low wattage chargers and poor quality USB cables might not be able
    to deliver enough power for the power supply to operate correctly. Ideally, read
    the datasheet and use the suggested power adapter, which commonly are 7 to 12
    volts and 1 amp.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在用USB手机充电器给面包板电源供电，请用万用表检查你的电源输出的5伏特电压，确保它提供的是大约5伏特。低功率充电器和质量差的USB电缆可能无法提供足够的电源使电源正常工作。理想情况下，阅读数据表并使用建议的电源适配器，通常是7到12伏特和1安培。
- en: Make sure your multimeter is set to measure **milliamps** (**mA**), and that
    its red lead is connected to the correct lead input (typically it will be labeled
    A or mA). If your DMM has a µA input, *do not use it* or you may blow your DMM's
    protection fuse (the fuse can be replaced).
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保你的万用表设置为测量**毫安**（**mA**），并且红色表笔连接到正确的引脚输入（通常标有A或mA）。如果你的数字万用表有一个µA输入，*不要使用*，否则可能会烧坏你的数字万用表的保护保险丝（保险丝可以更换）。
- en: Apply power to the circuit, and the motor will spin.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给电路供电，电机会旋转。
- en: Your multimeter will display the current draw of the motor. Write down this
    value. This is known as the **continuous** or **free current** and is the current
    your motor uses while freely spinning with nothing connected to its shaft.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的万用表将显示电机的电流消耗。记下这个值。这被称为**连续**或**自由电流**，是电机在轴上自由旋转时使用的电流。
- en: Disconnect power to the motor.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 断开电机的电源。
- en: Using a pair of pliers, hold the motor's shaft so it cannot spin.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用一把钳子，抓住电机的轴，使其无法旋转。
- en: Reapply power to the motor, and quickly observe (and write down) the DMM's reading.
    This reading is called the **stall current***.* A motor will use the most current
    when its shaft has been forcefully stopped from moving.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新给电机供电，并迅速观察（并记下）数字万用表的读数。这个读数被称为**堵转电流**。电机在其轴被强行停止移动时会使用最大电流。
- en: Disconnect the power to the motor.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 断开电机的电源。
- en: 'We have now measured two currents. My readings on an R130 motor were as follows
    (and yours will be different):'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在已经测量了两种电流。我的R130电机的读数如下（你的可能会有所不同）：
- en: '**Continuous or free current**: ~110mA to ~200mA—As the motor heats from use,
    it will use less; the ~200mA measurement was when the motor was cold. Over one
    minute, it dropped to ~110mA.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**连续或自由电流**：~110mA到~200mA——随着电机使用而发热，它将使用更少；~200mA的测量是在电机冷却时进行的。一分钟后，它下降到了~110mA。'
- en: '**Stall current**: This was ~500mA to ~600mA.'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**堵转电流**：这是~500mA到~600mA。'
- en: What this means is that our motor will need between 200mA and 600mA milliamps
    for normal operation and that any circuit we wish to use with our motor must be
    able to realistically handle 600mA so that it will not get damaged if the motor
    stalls (or we need to design suitable protection, however, this is beyond our
    scope).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着我们的电机在正常运行时需要200mA到600mA的电流，任何我们希望用于电机的电路必须能够真实地处理600mA，以免在电机停转时受到损坏（或者我们需要设计合适的保护，然而，这超出了我们的范围）。
- en: It is interesting to note that there's also a **start-up current**, which is
    a momentary peak current that occurs when the motor starts, but we won't be able
    to measure that on a generic DMM.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的是，还有一个**启动电流**，这是电机启动时发生的瞬时峰值电流，但我们无法用通用数字万用表来测量。
- en: Now that we have the current draw for our R130 motor, let's collect more current
    data for a relay and an LED.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经得到了R130电机的电流消耗，让我们收集继电器和LED的更多电流数据。
- en: Measuring the current requirement of a relay and LED
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测量继电器和LED的电流需求
- en: 'We will also measure the current draw of an LED and the relay we will use in
    this chapter when we reach the section titled *Using a relay as a switch*. You
    can measure the current draw using *steps 1 to 4* from the preceding section.
    The setup to perform this measurement for an LED and resistor pair is illustrated
    here:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们到达标题为*使用继电器作为开关*的部分时，我们还将测量LED和继电器的电流消耗。你可以使用前一部分的*步骤1到4*来测量LED和电阻对的电流消耗。执行这个测量的设置如下图所示：
- en: '![](assets/8ad9ebbb-3904-4bd9-b56d-4355f09f095f.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/8ad9ebbb-3904-4bd9-b56d-4355f09f095f.png)'
- en: Figure 7.4 – Measuring current through a resistor/LED circuit
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.4 - 测量通过电阻/LED电路的电流
- en: 'This is the basic process we follow:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们遵循的基本流程：
- en: We attach an LED and a 1kΩ resistor (or a relay) in place of the motor shown
    in *Figure 7.3*.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们在*图7.3*中所示的电机位置上连接了一个LED和一个1kΩ电阻（或继电器）。
- en: Set your multimeter to milliamps mode.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你的万用表设置为毫安模式。
- en: Apply power to the circuit.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给电路供电。
- en: Measure the amperage on your multimeter.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用你的万用表测量电流。
- en: Once you have performed (and jotted down) the measurement you receive, remove
    the LED and resistor from the breadboard and wire in your relay and perform the
    same measurement.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了（并记下）你得到的测量值，从面包板上移除LED和电阻，接入继电器并进行相同的测量。
- en: 'The following diagram shows an SRD-05VDC-SL-C relay and which terminals on
    your relay you need to connect. Please note that you will need to solder header
    pins (pictured) or wires (a good option is to cut in half a DuPont cable) onto
    your relay''s terminals as it will not fit directly into a breadboard:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了SRD-05VDC-SL-C继电器以及你需要连接的继电器端子。请注意，你需要焊接排针（如图所示）或导线（一个很好的选择是将杜邦线剪成一半）到继电器的端子上，因为它不能直接插入面包板：
- en: '![](assets/89750306-8613-4edf-8650-96bb9ea9b654.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/89750306-8613-4edf-8650-96bb9ea9b654.png)'
- en: Figure 7.5 – SRD-05VDC-SL-C relay
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.5 - SRD-05VDC-SL-C继电器
- en: 'With a 5V source, you should obtain values similar to these on your multimeter:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 使用5V电源，您应该在万用表上获得类似以下数值：
- en: '5mm red LED in series with a 1000Ω resistor: 3mA (values from Ohms calculation
    and rounded up *I = (5V - 2.1V) / 1000Ω = 2.9mA*)'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 串联有5mm红色LED和1000Ω电阻：3mA（来自欧姆计算的数值并向上取整*I = (5V - 2.1V) / 1000Ω = 2.9mA*)
- en: 'Relay: 70mA to 90mA (values from the datasheet and confirmed by my own measurements)'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继电器：70mA至90mA（来自数据表并经过我的测量确认）
- en: The process for calculating the current for the LED was discussed in [Chapter
    6](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml), *Electronics 101 for the Software
    Engineer.* The only difference isthat here we are using a 5-volt source and a
    1kΩ resistor, not 3.3 volts and a 200Ω resistor as we did in that chapter.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 有关如何计算LED的电流的过程在[第6章](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml)中已经讨论过，*软件工程师的电子学101*。唯一的区别是，这里我们使用的是5伏电源和1kΩ电阻，而不是在那一章中使用的3.3伏和200Ω电阻。
- en: Please note that the optocoupler and MOSFET component we will be using do have
    a voltage drop aspect to them that does affect current through the attached load.
    This impact of these voltage drops are immaterial for our purposes, so they are
    not taken into account for the calculations in this chapter for brevity.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们将使用的光耦合器和MOSFET元件确实具有影响通过连接负载的电流的电压降方面。出于简洁起见，这些电压降的影响对我们的目的来说是不重要的，因此在本章的计算中不予考虑。
- en: You have now learned how to measure the current draw of a DC motor, LED/resistor
    pair, and a relay using a multimeter. Knowing the current limitations and expectations
    of a device you want to control, and even the sub-circuit you are connecting to,
    is a vital piece of information that is required so that you can select suitably
    rated components when designing a circuit and choosing a suitable power source.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在已经学会了如何使用万用表测量直流电机、LED/电阻对和继电器的电流。了解您想要控制的设备以及您要连接的子电路的电流限制和期望，甚至是一个至关重要的信息，这样您在设计电路和选择合适的电源时可以选择合适额定的元件。
- en: We will be referencing the measurements you have performed in this section as
    we explore optocouplers, MOSFETs, and relays throughout this chapter. Specifically,
    we will compare the current ratings of these components (found in their respective
    datasheets) to our DC motor, LED/resistor, and relay measurements and consider
    what components can be used to directly control which load.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将参考您在本节中进行的测量，探索光耦合器、MOSFET和继电器。具体来说，我们将比较这些元件的电流额定值（在各自的数据表中找到）与我们的直流电机、LED/电阻和继电器的测量，并考虑可以用于直接控制哪个负载的元件。
- en: We will start by learning about optocouplers and how to use them as a switch.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先学习光耦合器及其用作开关的方法。
- en: Using an optocoupler as a switch
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用光耦合器作为开关
- en: 'An optocoupler (or optoisolator) is a light-controlled component that is used
    to electrically isolate two circuits. An illustration and the schematic symbol
    of an optocoupler are shown here:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 光耦合器（或光隔离器）是一种用于电气隔离两个电路的光控组件。这里显示了光耦合器的示意图和原理图符号：
- en: '![](assets/22ab1665-4970-450c-a2f0-da1ada722194.png)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/22ab1665-4970-450c-a2f0-da1ada722194.png)'
- en: Figure 7.6 – Optocoupler symbol and component with pins labeled
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.6 - 光耦合器符号和带有标记引脚的元件
- en: 'The two sides of an optocoupler can be described as follows:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 光耦合器的两侧可以描述如下：
- en: 'An *input* side: The side we will connect to a Raspberry Pi GPIO pin'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*输入*端：我们将连接到树莓派GPIO引脚的一侧'
- en: 'An *output* side: The side we will connect to another circuit'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*输出*端：我们将连接到另一个电路的一侧'
- en: Inside an optocoupler on the *input* side is an internal LED (you will notice
    the LED symbol within the optocoupler symbol in *Figure 7.6*) while on the *output* side
    there is a phototransistor that responds to the LED's light. What this means is
    that the transfer of control (that is, switching) from the *input* side to the
    *outside* side is performed by light, hence, there is no physical electrical connection
    between the two sides. For us, this means that any failures or accidents on the
    output side should not cause damage to our Raspberry Pi. The PC817 has its isolation
    rated as 5000 volts, which are well beyond any voltages we would expect to be
    used with IoT electronics and devices.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在*输入*端的光耦合器内部有一个内部LED（您将在*图7.6*中的光耦合器符号中注意到LED符号），而在*输出*端有一个对LED光线做出响应的光电晶体管。这意味着控制（即开关）从*输入*端到*外部*端的传递是通过光线完成的，因此两侧之间没有物理电气连接。对我们来说，这意味着输出端的任何故障或意外不应对我们的树莓派造成损害。PC817的隔离额定为5000伏，远远超出我们预期在物联网电子设备中使用的任何电压。
- en: When the *input* side LED is off, the *output* side phototransistor is off.
    However, when the LED is illuminated (it's inside the optocoupler component, so
    you will not see it) by applying current to pins 1 (anode) and 2 (cathode), the
    phototransistor is activated (on) and allows current to flow between pins 4 (collector)
    and 3 (emitter).
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 当*输入*端LED关闭时，*输出*端光电晶体管关闭。然而，当LED被照亮（它在光耦合器元件内部，所以您看不到它）通过向引脚1（阳极）和2（阴极）施加电流时，光电晶体管被激活（打开），并允许电流在引脚4（集电极）和3（发射极）之间流动。
- en: 'Let''s create a simple circuit to demonstrate a PC817 optocoupler, which has
    the following specifications:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们创建一个简单的电路来演示PC817光耦合器，其规格如下：
- en: 'Input side (the LED): This has the following:'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输入端（LED）：具有以下数值：
- en: Typical **forward voltage (V[F])** is 1.2 volts DC
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 典型的**正向电压（V[F])**为1.2伏直流
- en: Maximum **forward current** **(I[F]) **is 50mA DC
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**正向电流（I[F])**为50mA直流
- en: 'Output side (the phototransistor): This has the following:'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 输出端（光电晶体管）：具有以下数值：
- en: 'Maximum **collector-emitter voltage (V[CEO])**: 80 volts DC'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**集电极-发射极电压（V[CEO])**：80伏直流
- en: 'Maximum **collector current (I[C])**: 50mA DC'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**集电流（I[C])**：50毫安直流
- en: '**Collector-Emitter Saturation Voltage V[CE(sat)]** in the range 0.1 to 0.2
    volts (basically the voltage drop)'
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**集电极-发射极饱和电压V[CE(sat)]**在0.1至0.2伏范围内（基本上是电压降）'
- en: Keeping these specifications in mind, let's begin our circuit build.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 牢记这些规格，让我们开始搭建电路。
- en: Building the optocoupler circuit
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 搭建光耦合器电路
- en: 'We''re about to build the circuit illustrated in the following diagram. This
    circuit uses the PC817 optocoupler to electrically isolate our Raspberry Pi and
    the LED subcircuit:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将要构建以下图示的电路。这个电路使用PC817光耦器来电气隔离我们的树莓派和LED子电路：
- en: '![](assets/d3d363ad-4fbd-47aa-841a-a0648293090f.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/d3d363ad-4fbd-47aa-841a-a0648293090f.png)'
- en: Figure 7.7 – Optocoupler circuit
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.7 - 光耦器电路
- en: 'The step numbers here match the numbered black circles in *Figure 7.7*:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的步骤编号与*图7.7*中编号的黑色圆圈相匹配：
- en: Place the LED into your breadboard, taking care to orientate the LED as illustrated
    regarding its cathode leg.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED放入你的面包板中，注意根据图示放置LED的阴极腿。
- en: Place a 1kΩ resistor into the breadboard. One end of this resistor connects
    inline with the cathode leg of the LED.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个1kΩ电阻放入面包板中。这个电阻的一端与LED的阴极腿联通。
- en: Place the PC817 Optocoupler IC into your breadboard. The white dot on the IC
    indicates pin number 1 of the IC. Your IC may have or not have the white dot,
    however, there should be a distinct marking on the IC to tell you the first pin.
    Please refer back to *Figure 7.6 *for all pin numberings.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817光耦IC放入面包板中。IC上的白点表示IC的引脚1。你的IC可能有也可能没有白点，但是IC上应该有一个明显的标记告诉你第一个引脚。请参考*图7.6*以获取所有引脚编号信息。
- en: Place a 1kΩ resistor into your breadboard. One end of this resistor connects
    with pin 1 of the PC817.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个1kΩ电阻放入你的面包板中。这个电阻的一端连接到PC817的引脚1。
- en: Connect the anode leg of the LED to the positive rail of the right-hand side
    power rail.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED的阳极腿连接到右侧电源轨的正电源。
- en: Connect pin 4 of the PC817 to the other end of the resistor you placed at *step
    2*.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817的引脚4连接到你在*步骤2*中放置的电阻的另一端。
- en: Connect pin 3 of the PC817 to the negative rail of the right-hand side power
    rail.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817的引脚3连接到右侧电源轨的负电源。
- en: Connect the positive output of a 5-volt power supply into the right-hand side positive
    power rail.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将5伏电源的正输出连接到右侧正电源轨。
- en: Connect the negative output of a power supply into the right-hand side negative
    power rail.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将电源的负输出连接到右侧负电源轨。
- en: Connect the other end of the resistor you placed at *step 4* to a 3.3-volt pin
    on your Raspberry Pi.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将你在*步骤4*中放置的电阻的另一端连接到树莓派上的3.3伏引脚。
- en: Finally, connect pin 2 of the PC817 to GPIO 21 on your Raspberry Pi.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，将PC817的引脚2连接到树莓派上的GPIO 21。
- en: In *Figure 7.7*, you could connect the wires at *steps 8* and *9* (which go
    to the External Power Supply) directly to your Raspberry Pi's +5-volt pin and
    a GND pin. We're only using a small amount of current for the red LED, however,
    for higher current loads, you must use an external power supply. The +5 volt pin
    on your Raspberry Pi is connected directly to the power supply you are using to
    power your Raspberry Pi. Using this power supply to power your circuits effectively robs current
    available to your Raspberry Pi. Take too much, and your Raspberry Pi will reset!
    **Please note (this is important) that the caveat of this action is that ****you
    lose the electrical isolation offered by the optocoupler** because you will have
    electrically connected the *input* and *output* sides of the optocoupler together
    (remember, the *input* and *output* sides are not electrically inside the optocoupler
    because control is achieved by light).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图7.7*中，你可以直接将*步骤8*和*9*（连接到外部电源）的导线连接到树莓派的+5伏引脚和一个GND引脚。我们只是为红色LED使用了少量电流，但是对于更大的电流负载，你必须使用外部电源。树莓派上的+5伏引脚直接连接到你用来给树莓派供电的电源。使用这个电源来为你的电路供电会有效地消耗树莓派可用的电流。如果消耗过多，你的树莓派将会重启！**请注意（这很重要）这个行为的警告是****你将失去光耦器提供的电气隔离**，因为你将会将*输入*和*输出*端连接在一起（记住，*输入*和*输出*端并不在光耦器内部电气连接，因为控制是通过光实现的）。
- en: Now that you have completed the circuit build, we will test the circuit and
    explore the code that makes it work.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经完成了电路的搭建，我们将测试电路并探索使其工作的代码。
- en: Controlling the optocoupler with Python
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用Python控制光耦
- en: 'Start by running the code in the `chapter07/optocoupler_test.py` file, and
    observe the LED blink. Following is the part of the code responsible for the blinking:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 首先运行`chapter07/optocoupler_test.py`文件中的代码，并观察LED的闪烁。以下是负责闪烁的代码部分：
- en: '[PRE1]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Here''s what''s happening:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是发生的事情：
- en: At line (1), GPIO 21 is low and the internal LED on the *input* side is on.
    The phototransistor on the *output* side detects this light and is activated,
    allowing current to flow between the output side's collector (pin 4) and emitter
    (pin 3), and hence our red LED illuminates.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第（1）行，GPIO 21是低电平，*输入*端的内部LED是开启的。*输出*端的光电晶体检测到这种光并被激活，允许电流在输出端的集电极（引脚4）和发射极（引脚3）之间流动，因此我们的红色LED亮起。
- en: The input side of the PC817 circuit is wired as *active low—*that's why at line
    (1), GPIO 21 is made low to turn the circuit on, and at line (2), GPIO 21 is set
    to high to turn the circuit off. Alternative wiring would be *active high.* If
    you want to experiment and change the circuit to be active-high, you would attach
    the wire from *step 10* in *Figure 7.7 *to a GND pin (rather than a 3.3-volt pin),
    and reverse the `pigpio.LOW` and `pigpio.HIGH` statements in the code.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PC817电路的输入端被布线为*主动低电平*，这就是为什么在第（1）行，GPIO 21被设为低电平以打开电路，在第（2）行，GPIO 21被设为高电平以关闭电路。另一种布线方式是*主动高电平*。如果你想要尝试并将电路改为主动高电平，你需要将*图7.7*中的*步骤10*的导线连接到GND引脚（而不是3.3伏引脚），并且在代码中颠倒`pigpio.LOW`和`pigpio.HIGH`语句。
- en: We could have used a lower value resistor for R1 for the input-side LED, however,
    a 1kΩ resistor provides more than enough current (*(3.3V - 1.2V)/1000Ω = 2.1mA*)
    to the internal LED for the optocoupler circuit to work. You'll see 1kΩ, 10kΩ,
    and 100kΩ resistors used in a lot of circuits simply because these are nice round
    values. We've also used a 1kΩ resistor for R2 for the red LED for convenience.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们本可以使用更低阻值的电阻R1来驱动输入端LED，但是1kΩ的电阻提供了超过光耦合器电路内部LED所需的电流（*(3.3V - 1.2V)/1000Ω
    = 2.1mA*）。您会看到1kΩ、10kΩ和100kΩ的电阻在许多电路中使用，因为这些都是比较常见的数值。我们还使用了1kΩ的电阻R2来方便地驱动红色LED。
- en: Can you remember from the previous chapter, [Chapter 6](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml), *Electronics
    101 for the Software Engineer*, when we discussed that we should not expect more
    than 8mA from a Raspberry Pi GPIO pin? Well, by using a PC817 optocoupler, we
    can now control up to 50mA by placing an optocoupler between a GPIO pin and a
    circuit. Furthermore, we are also not limited to the 3.3 volts of a GPIO pin since
    the PC817 can handle up to 80 volts.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 您还记得上一章[第6章](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml)中我们讨论过的内容吗？即我们不应该期望从树莓派GPIO引脚获得超过8mA的电流？是的，通过使用PC817光耦合器，我们现在可以通过在GPIO引脚和电路之间放置光耦合器来控制高达50mA的电流。此外，我们也不再受限于GPIO引脚的3.3伏电压，因为PC817可以处理高达80伏的电压。
- en: Remember that a GPIO pin's primary role is to *control* something, not *power* it,
    so always think about *control* and *power* requirements independently.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，GPIO引脚的主要作用是*控制*某物，而不是*为其供电*，因此始终要独立考虑*控制*和*电源*需求。
- en: 'In the previous section, we calculated (or measured) the current draw of our
    motor, relay, and an LED. Here is that data in the context of our PC817 optocoupler
    using a 5-volt power source on the output side:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，我们计算（或测量）了我们的电机、继电器和LED的电流消耗。以下是在输出端使用5伏电源的PC817光耦合器的数据：
- en: The LED and 1kΩ resistor needed a current of 3mA.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LED和1kΩ的电阻需要3mA的电流。
- en: The relay needed between 70mA and 90mA.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继电器需要70mA至90mA之间的电流。
- en: The motor needed ~500mA to ~600mA (stall current).
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电机需要约500mA至600mA（堵转电流）。
- en: The LED's 3mA is less than the optocouplers maximum output-side rating of 50mA,
    so it's fine to drive the LED directly on the output side. The relay and motor,
    however, require a current beyond the limits of the PC817, so using them on the
    output may result in damage to the optocoupler.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: LED的3mA小于光耦合器输出端的最大额定50mA，因此可以直接在输出端驱动LED。然而，继电器和电机需要超出PC817限制的电流，因此在输出端使用它们可能会损坏光耦合器。
- en: While we can and do use optoisolators as a digital switch, they are often used
    as an isolating barrier to drive other components, which in turn can drive loads
    requiring higher currents. We will see this later on when we build the full relay
    driver circuit from *Figure 7.1,* but for now, let's learn how to use a transistor
    as a digital switch.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们可以使用光隔离器作为数字开关，但它们通常被用作隔离屏障来驱动其他组件，这些组件反过来可以驱动需要更高电流的负载。当我们从*图7.1*构建完整的继电器驱动电路时，我们将在后面看到这一点，但现在，让我们学习如何将晶体管用作数字开关。
- en: Using a transistor as a switch
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用晶体管作为开关
- en: Transistors are a hands-down most significant electronic component in use today
    and the backbone of the digital revolution. They can be used in two basic ways—as
    an amplifier or as a digital switch. Our focus is going to be on digital switching,
    and we will be using a transistor type known as a **Metal-Oxide-Semiconductor-Field-Effect
    Transistor** (**MOSFET**), specifically, an N-Channel Enhancement Mode MOSFET—yes,
    it's a mouthful!
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 晶体管是当今使用最广泛的电子元件，也是数字革命的支柱。它们可以以两种基本方式使用——作为放大器或数字开关。我们的重点将放在数字开关上，我们将使用一种名为**金属氧化物半导体场效应晶体管**（**MOSFET**）的晶体管类型，具体来说是一种N-沟道增强型MOSFET——是的，这个名字有点拗口！
- en: Don't get too caught up on the long technical name or the many forms of transistors
    that exist. The simple take-home here is that an N-Channel Enhancement Mode MOSFET
    works well as a digital switch that we can control using our Raspberry Pi, or
    as we will see later, from another source such as an optocoupler.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 不要过分关注晶体管的冗长技术名称或存在的多种形式。这里的简单要点是，N-沟道增强型MOSFET作为数字开关效果很好，我们可以使用树莓派来控制它，或者后面将看到，也可以来自光耦合器等其他源。
- en: FETs are *voltage-*controlled transistors. Another type of transistor known
    as a **Bipolar Junction Transistor** (**BJT**) is a *current*-controlled transistor.
    BJTs are perfectly fine to use with a Raspberry Pi but require additional considerations.
    You'll find a link in the *Further reading* section to further your learning on
    transistors.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 场效应晶体管（FET）是*电压*控制的晶体管。另一种称为**双极晶体管**（**BJT**）的晶体管是*电流*控制的晶体管。BJT在树莓派上使用完全没问题，但需要额外考虑。在*进一步阅读*部分中，您会找到有关晶体管的更多学习资料的链接。
- en: 'The following exercise will be using a 2N7000, an N-Channel Enhancement Mode MOSFET,
    as illustrated in *Figure 7.8*. The leg names are ***S***ource, ***G***ate, and
    ***D***rain. Two different packaging styles are also illustrated, the TO92 and
    TO220\. Notice that the arrangement of the Source, Gate, and Drain legs on the
    two styles are different:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 以下练习将使用2N7000，一种N-沟道增强型MOSFET，如*图7.8*所示。引脚名称为***S***ource、***G***ate和***D***rain。还有两种不同的封装样式，TO92和TO220。请注意，两种样式的Source、Gate和Drain引脚的排列方式是不同的：
- en: '![](assets/d7baa943-66c4-4e49-9d06-54d41f12d36d.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/d7baa943-66c4-4e49-9d06-54d41f12d36d.png)'
- en: Figure 7.8 – N-Channel Enhancement MOSFET symbol and common package styles
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.8 - N-沟道增强型MOSFET符号和常见封装样式
- en: 'The 2N7000 has the following specifications in its datasheet:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 2N7000在其数据表中具有以下规格：
- en: Maximum **Drain Source Voltage (V[DSS])** of 60 volts DC
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**漏源电压（V[DSS])**为60伏直流
- en: Maximum **Continuous Drain Current (I[D])** of 200 mA DC
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**连续漏极电流（I[D])**为200毫安直流
- en: Maximum **Pulsed Drain Current (I[DM])** of 500 mA DC
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**脉冲漏极电流（I[DM])**为500毫安直流
- en: '**Gate Threshold Voltage (V[GS(th)])** in the range of 0.8 to 3 volts DC'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**栅阈电压（V[GS(th)])**在0.8至3伏直流范围内'
- en: '**Drain−Source On−Voltage (V[DS(on)])** in the range of 0.45 to 2.5 volts DC 
    (voltage drop)'
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漏极-源极开启电压（V[DS(on)]）**在0.45至2.5伏特直流范围内（电压降）'
- en: 'Here is how to interpret these parameters regarding the 2N7000:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是如何解释关于2N7000的这些参数：
- en: It can safely control a load not exceeding 60 volts (V[DSS]) and a continuous
    200mA (I[D]), but a pulse of 500mA (I[DM]) is OK.
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以安全地控制不超过60伏特（V[DSS]）和持续200毫安（I[D]）的负载，但脉冲500毫安（I[DM]）是可以的。
- en: It will ideally require a voltage >= 3 volts to switch it on (V[GS(th)]).
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它理想情况下需要大于3伏特的电压才能打开（V[GS(th)]）。
- en: It will consume, on the load-side circuit, a voltage in the range of 0.45 to
    2.5 volts (V[DS(on)]).
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它将在负载端电路上消耗0.45至2.5伏特（V[DS(on)]）的电压。
- en: The 2N7000 (and the FQP30N06L that we will discuss shortly) are logic-level
    comparable MOSFETs. They are suitable for a Raspberry Pi because their maximum
    gate voltage V[GS(th)]is less than a GPIO pin's 3.3 volts.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 2N7000（以及我们将很快讨论的FQP30N06L）是逻辑电平可比较的MOSFET。它们适用于树莓派，因为它们的最大门电压V[GS(th)]小于GPIO引脚的3.3伏特。
- en: Let's get started and build a circuit to use the 2N7000 with our Raspberry Pi.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始建立一个使用2N7000的电路与我们的树莓派。
- en: Building the MOSFET circuit
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建MOSFET电路
- en: 'We will build our circuit in two parts, starting with the placement of the
    components on our breadboard:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将分两部分建立我们的电路，首先是在面包板上放置组件：
- en: '![](assets/f2bd266b-bb0c-4d22-979f-3f16b40d3f84.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/f2bd266b-bb0c-4d22-979f-3f16b40d3f84.png)'
- en: Figure 7.9 – MOSFET transistor circuit (part 1 of 2)
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.9 - MOSFET晶体管电路（第1部分）
- en: 'Following are the steps for the first part of our build. The step numbers match
    the numbered black circles in *Figure 7.9*:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我们建设的第一部分的步骤。步骤编号与*图7.9*中编号的黑色圆圈相匹配：
- en: Place the MOSFET into your breadboard, taking care to orientate the component
    the correct way around regarding the Source, Gate, and Drain legs. Our example
    layout assumes a 2N7000 MOSFET. Please see *Figure 7.8 *if you need help to identify
    the legs.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET放入面包板中，注意根据源极、栅极和漏极的正确方向放置组件。我们的示例布局假定了一个2N7000 MOSFET。如果您需要帮助识别腿，请参阅*图7.8*。
- en: Place a 100kΩ resistor into your breadboard. One end of this resistor connects
    to the Gate leg of the MOSFET.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将100kΩ电阻放入面包板中。这个电阻的一端连接到MOSFET的栅极。
- en: Place a 1kΩ resistor into the breadboard. One end of this resistor also connects
    to the Gate leg of the MOSFET.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将1kΩ电阻放入面包板中。这个电阻的一端也连接到MOSFET的栅极。
- en: Place the LED into the breadboard, taking care to orientate the component as
    shown regarding its cathode leg.
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED放入面包板中，注意根据其阴极腿的显示方向放置组件。
- en: Place a 1kΩ resistor into the breadboard. One end of this resistor connects
    with the cathode leg of the LED.
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将1kΩ电阻放入面包板中。这个电阻的一端连接到LED的阴极腿。
- en: Place the diode into the breadboard, orientating the component so that the cathode
    leg (the end of the diode with the band on the casing) is facing toward the bottom
    of the breadboard. We will discuss the purpose of this diode shortly.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将二极管放入面包板中，使组件朝向底部的阴极腿（二极管外壳上带有条纹的一端）。
- en: 'Now that we have placed the components into our breadboards, let''s wire them
    all up:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经将组件放入面包板中，让我们把它们全部连接起来：
- en: '![](assets/848bd536-8eff-4760-a235-335d457bb7a1.png)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/848bd536-8eff-4760-a235-335d457bb7a1.png)'
- en: Figure 7.10 – MOSFET transistor circuit (part 2 of 2)
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.10 - MOSFET晶体管电路（第2部分）
- en: 'Following are the steps for the second part of the build. The step numbers
    match the numbered black circles in *Figure 7.10*:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是第二部分建设的步骤。步骤编号与*图7.10*中编号的黑色圆圈相匹配：
- en: Connect a GND pin from your Raspberry Pi into the negative rail of the right-hand
    side power rail.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将树莓派的GND引脚连接到右侧电源轨的负极。
- en: Connect the negative rails of the right-hand side and left-hand side power rails.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 连接右侧和左侧电源轨的负极。
- en: Connect the 100kΩ resistor into the negative power rail.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将100kΩ电阻连接到负电源轨。
- en: Connect the Source leg of the MOSFET into the negative power rail.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET的源腿连接到负电源轨。
- en: Connect the Drain leg of the MOSFET to the 1kΩ resistor.
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET的漏极连接到1kΩ电阻。
- en: Connect the anode leg of the LED to the cathode leg of the diode.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED的阳极腿连接到二极管的阴极腿。
- en: Connect the anode leg of the LED (and cathode leg of the diode) to the positive
    power rail on the right-hand side power rail.
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED的阳极腿（和二极管的阴极腿）连接到右侧电源轨的正极。
- en: Connect the 1kΩ resistor to GPIO 21 on your Raspberry Pi.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将1kΩ电阻连接到树莓派的GPIO 21。
- en: Connect the positive output terminal on your power supply into the positive
    rail of the right-hand side power rail.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将电源供应的正输出端连接到右侧电源轨的正极。
- en: Connect the negative output terminal on your power supply into the negative
    rail of the right-hand side power rail.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将电源供应的负输出端连接到右侧电源轨的负极。
- en: Well done. That's our circuit build complete. Let's briefly discuss this circuit
    before we test it out.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 干得好。我们的电路建设完成了。在我们测试之前，让我们简要讨论一下这个电路。
- en: Notice in* Figure 7.10 *(and *Figure 7.1*) the 100kΩ resistor R3\. This is an
    external pull-down resistor that ensures that the Gate leg of the MOSFET is tied
    to GND (0 volts) when it is not pulled up to +3.3 volts when GPIO 21 is high.
    MOSFETs have capacitive charge, so without a pull-down, the MOSFET may appear
    sticky and slow when it transitions from on (GPIO 21 is high) to off (GPIO 21
    goes low) as it discharges (note that this circuit is active high). The pull-down
    resistor ensures a rapid discharge into the off state. We use an external pull-down
    resistor in preference to an in-code activated pull-down to ensures the MOSFET
    Gate is pulled down even when the Raspberry Pi is powered off or when code has
    not run.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意*图7.10*（和*图7.1*）中的100kΩ电阻R3。这是一个外部下拉电阻，确保当GPIO 21为高电平时，MOSFET的Gate腿被拉到+3.3伏特，而当它没有被拉到高电平时，它被连接到GND（0伏特）。MOSFET具有电容电荷，因此如果没有下拉电阻，MOSFET在从通（GPIO
    21为高电平）到断（GPIO 21为低电平）的转换时可能会显得粘滞和缓慢，因为它在放电（请注意，此电路为主动高电平）。下拉电阻确保快速放电到断开状态。我们使用外部下拉电阻而不是在代码中激活的下拉电阻，以确保即使树莓派关闭电源或代码未运行时，MOSFET
    Gate也被拉低。
- en: You will also notice that R1 and R3 create a voltage divider. The ratio of 1kΩ
    and 100kΩ is suitable to ensure that >3 volts get to the gate leg of the MOSFET
    to switch it on. If you need a refresher on pull-down resistors and voltage dividers,
    we discussed them in [Chapter 6](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml),
    *Electronics 101 for the Software Engineer.*
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 您还会注意到R1和R3构成了一个电压分压器。1kΩ和100kΩ的比例适合确保>3伏特到达MOSFET的Gate腿以打开它。如果您需要关于下拉电阻和电压分压器的复习，我们在[第6章](2aba4d00-7883-42da-95fa-bcec2da3dd54.xhtml)中讨论过它们，*软件工程师的电子学101*。
- en: When adding resistors into a circuit—like adding in a pull-down—always consider
    with the wider impact of the change. If, for example, the addition creates a voltage
    divider due to the presence of an existing resistor, you then need to access the
    impact of the change on the surrounding circuit. For our scenario, this is to
    ensure enough voltage is reaching the MOSFET gate leg to turn it on.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在电路中添加电阻时，例如添加下拉电阻，始终要考虑更改的更广泛影响。例如，如果添加电阻由于现有电阻的存在而创建了电压分压器，那么您需要评估更改对周围电路的影响。对于我们的情况，这是为了确保足够的电压到达MOSFET的Gate腿以打开它。
- en: After running the code in the next section, try removing R3 and run the code
    again. I can't guarantee that you will see anything at your end, but you may observe that
    the red LED fizzles out slowly rather than turning off promptly when GPIO 21 goes
    low and that it behaves erratically instead of fading in and out smoothly.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行下一节中的代码后，尝试移除R3并再次运行代码。我不能保证您会在您的端看到任何东西，但您可能会观察到，当GPIO 21变为低电平时，红色LED不是立即熄灭而是缓慢消失，并且它的行为不是平稳地淡入淡出而是表现得不稳定。
- en: As with the optocoupler example, you can connect the wire's external power supply
    to your Raspberry Pi's +5 pin and a GND pin for this LED example since its current
    requirements are low.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 与光耦示例一样，由于LED示例的电流要求较低，您可以将电线的外部电源连接到树莓派的+5引脚和一个GND引脚。
- en: With this basic understanding of a MOSFET circuit, let's run and explore a simple
    Python program that interacts with our circuit.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在对MOSFET电路有了基本理解之后，让我们运行并探索一个与我们的电路交互的简单Python程序。
- en: Controlling the MOSFET with Python
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用Python控制MOSFET
- en: 'Run the code in the `chapter07/transistor_test.py` file, and the red LED will
    turn on then off, then fade in and out. Once you have confirmed that your circuit
    works, let''s continue and look at the code:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 运行`chapter07/transistor_test.py`文件中的代码，红色LED将先点亮然后熄灭，然后再淡入淡出。一旦确认电路工作正常，让我们继续看代码：
- en: '[PRE2]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: We are using PWM in this example. In line (1), we are telling PiGPIO that, for
    GPIO 21 (`GPIO_PIN = 21`), we want its duty cycle to be constrained to the value
    range 0 to 100 (rather than the default 0 to 255). This is an example of how we
    can change the granularity of duty cycle values in PiGPIO. We're using 0 to 100
    just to make reporting easier because it maps into 0% to 100% for terminal output.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们使用PWM。在第（1）行中，我们告诉PiGPIO，对于GPIO 21（`GPIO_PIN = 21`），我们希望其占空比受限于值范围0到100（而不是默认的0到255）。这是一个示例，说明了我们如何改变PiGPIO中占空比值的粒度。我们使用0到100只是为了使报告更容易，因为它映射到终端输出的0%到100%。
- en: Next, in line (2), we simply turn the GPIO on and off for a duration to test
    the transistor circuit, and we will see the LED turn on then off after a 2-second
    delay.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在第（2）行中，我们简单地打开和关闭GPIO一段时间，以测试晶体管电路，然后我们将看到LED在2秒延迟后点亮然后熄灭。
- en: 'In line (3) in the following code, we use PWM to fade in the LED, before fading
    it out again at line (4), both times using the duty cycle range set at line (1)
    in the preceding code block:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下代码的第（3）行中，我们使用PWM来淡入LED，然后在前面代码块中的第（1）行设置的占空比范围内再次淡出它（第（4）行）：
- en: '[PRE3]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let''s check whether our relay and motor are safe to use with this transistor
    circuit, given our 2N7000 is rated for 200 milliamps:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们检查一下我们的继电器和电机是否可以安全地与这个晶体管电路一起使用，考虑到我们的2N7000额定电流为200毫安：
- en: The relay can be used in place of the LED because it only needs between 70mA
    and 90mA.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 继电器可以用来替代LED，因为它只需要70mA到90mA之间的电流。
- en: The motor requires ~200mA to spin freely *(continuous* current), so it might
    be safe...or not? Let's see.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电机需要~200mA来自由旋转（连续电流），所以可能是安全的...或者不是？让我们看看。
- en: When we tested the motor earlier in this chapter, we anticipated it will need
    between ~200mA (the *continuous* current when cold) and ~500mA to ~600mA (the
    *stall* current)—*remember these are my measurements, so replace the values with
    your measurements*. So, in principle, our 2N7000 will be OK as long as the motor
    is not under load. Realistically, as soon as we place a load on the motor's shaft,
    it will require more than 200mA continuous current. In this respect, the 2N7000
    is probably not an ideal transistor for driving this motor. We need to seek out
    a MOSFET that can comfortably handle 600mA of continuous current or more. We'll
    see the FQP30N06L MOSFET shortly, which can handle this current and much more.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章早些时候测试电机时，我们预计它在冷态时需要约200mA（冷态时的*连续*电流）和约500mA至600mA（*堵转*电流）之间的电流- *请记住这些是我的测量值，所以请用您的测量值替换*。因此，原则上，我们的2N7000只要电机不承受负载就可以。实际上，一旦我们在电机轴上施加负载，它将需要超过200mA的连续电流。在这方面，2N7000可能不是驱动这个电机的理想晶体管。我们需要寻找一个可以轻松处理600mA或更多连续电流的MOSFET。我们很快就会看到FQP30N06L
    MOSFET，它可以处理这个电流以及更多。
- en: While the LED faded in and out with the PWM-related code, if you connect the
    motor into the circuit in place of the LED/resistor pair, you will notice it revs
    up then down. You've just discovered how to use the duty cycle property of PWM
    to control the speed of a motor! We will be covering motors in more detail in [Chapter 10](https://cdp.packtpub.com/hands_on_python_programming_for_iot/wp-admin/post.php?post=37&action=edit#post_34),
    *Movement with Servos, Motors, and Steppers*.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 当LED在PWM相关代码中逐渐变暗时，如果您将电机连接到电路中以替代LED/电阻对，您会注意到它会加速然后减速。您刚刚发现了如何使用PWM的占空比属性来控制电机的速度！我们将在[第10章](https://cdp.packtpub.com/hands_on_python_programming_for_iot/wp-admin/post.php?post=37&action=edit#post_34)中更详细地介绍电机，*使用舵机、电机和步进电机进行运动*。
- en: To use the motor or relay, you must use an external power supply and not the
    +5-volt pin on your Raspberry Pi. If you try and use the +5-volt pin, you may
    find your Raspberry Pi resets as you run the code.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用电机或继电器，必须使用外部电源，而不是树莓派上的+5伏引脚。如果您尝试使用+5伏引脚，可能会发现在运行代码时树莓派会重置。
- en: We do not use PWM with relays because they're too slow to switch and if they
    do work (at a very low PWM frequency), it's only wearing them out—but try it anyway
    to see what happens; a short test will do no harm (try adjusting the frequency
    of 8000 in code down to 10, that is, `pi.set_PWM_frequency(GPIO_PIN, 10)`).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不使用PWM控制继电器，因为它们切换速度太慢，而且如果它们工作（在非常低的PWM频率下），只会使它们耗损-但无论如何尝试一下，看看会发生什么；短暂的测试不会有害（尝试将代码中的频率从8000调整到10，即`pi.set_PWM_frequency(GPIO_PIN,
    10)`）。
- en: In our circuit, there is also the 1N4001 diode D1\. This is known as a fly-back
    or suppression diode. Its role is to protect the circuit from reverse voltage
    spikes that can occur in electromagnetic components such as a relay or motor when
    they are powered down. Granted, our LED is not magnetic, however, it does not
    do any harm having the diode present.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的电路中，还有1N4001二极管D1。这被称为反冲或抑制二极管。它的作用是保护电路免受在关闭电源时可能发生的继电器或电机等电磁元件的反向电压脉冲。诚然，我们的LED不是磁性的，但是有它在场也不会有任何害处。
- en: Anytime you are controlling a component that works on electromagnetism (also
    known as an inductive load), always correctly install a fly-back suppression diode.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 每当您控制一个工作在电磁学上的组件（也称为感性负载）时，都要正确安装反冲抑制二极管。
- en: 'In *Figure 7.8*, we also have an illustration of an FQP30N06L. This is a Power
    N-Channel Enhancement Mode MOSFET capable of driving high amperage loads. It has
    the following specifications in its datasheet:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在*图7.8*中，我们还有FQP30N06L的插图。这是一种能够驱动高电流负载的功率N-通道增强模式MOSFET。它在数据表中具有以下规格：
- en: Maximum **Drain Source Voltage (V[DSS])** of 60 volts DC
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**漏源电压（V[DSS])**为60伏特直流
- en: Maximum **Continuous Drain Current (I[D])** of 32A DC (amps not milliamps!)
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**连续漏极电流（I[D])**为32A DC（安培而不是毫安！）
- en: Maximum **Pulsed** **Drain Current (I[DM])** of 128A DC
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最大**脉冲**漏极电流（I[DM]）为128A DC
- en: '**Gate Threshold Voltage (V[GS(th)])** in the range of 1 to 2.5 volts DC (<
    5 volts so it''s logic-level compatible)'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**栅极阈值电压（V[GS(th)])**在1至2.5伏特直流范围内（<5伏特，因此它是逻辑电平兼容的）'
- en: '**Drain−Source On−Voltage (V[SD])** maximum of 1.5 volts DC'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**漏-源导通电压（V[SD])**最大为1.5伏特直流'
- en: 'You can substitute an FQP30N06L (or another N-Channel Enhancement mode logic-level
    capable MOSFET) in the preceding circuit and it will work, but keep the following
    in mind:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在前面的电路中替换FQP30N06L（或另一个N-通道增强模式逻辑电平MOSFET），它会起作用，但请记住以下几点：
- en: The G, D, and S legs of the FQP30N06L are in a different order to the 2N7000
    so you will need to adjust the wiring.
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FQP30N06L的G、D和S引脚的顺序与2N7000不同，因此您需要调整接线。
- en: When dealing with higher voltages and currents, it's a good idea to electrically
    isolate the MOSFET from the Raspberry Pi using an optocoupler (we'll see this
    configuration when we discuss relays next).
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在处理更高电压和电流时，最好使用光耦隔离器将MOSFET与树莓派隔离开（我们将在讨论继电器时看到这种配置）。
- en: At high currents, Power MOSFETs can get very hot—the surrounding components
    and wires and even the breadboard can melt, so approach their use with caution
    and care.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在高电流下，功率MOSFET可能会变得非常热-周围的元件和导线甚至是面包板都可能会熔化，因此在使用时要小心谨慎。
- en: Higher power MOSFETs can get hot when controlling high power loads and can be
    fitted with a heatsink, for example, the FQP30N06L has a metal top with a hole
    where the heatsink is attached. The determining factors and calculations as to
    when a headsink is required are beyond our scope, however, if your MOSFET is getting
    too hot (and you are using it within its datasheet parameters), then add a heatsink.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 当控制高功率负载时，高功率MOSFET可能会变热，并且可以安装散热器，例如，FQP30N06L的金属顶部上有一个散热器连接的孔。关于何时需要散热器的决定因素和计算超出了我们的范围，但是如果您的MOSFET变得太热（并且您在其数据表参数范围内使用它），那么请添加散热器。
- en: If you like the idea of controlling higher current loads using MOSFETs, you
    might like to research ready-made MOSFET modules on sites such as eBay. You now
    have the background after learning about optocouplers and MOSFETs to understand
    how these modules are constructed—some just use a MOSFET directly connected to
    the controlling device (that is, GPIO pin) as we have just done while others place
    an optocoupler in between the controlling device and the MOSFET.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您喜欢使用MOSFET控制更高电流负载的想法，您可能会喜欢在eBay等网站上研究现成的MOSFET模块。在学习了光耦合器和MOSFET之后，您现在可以理解这些模块是如何构建的
    - 有些直接使用MOSFET直接连接到控制设备（即GPIO引脚），就像我们刚刚做的那样，而其他一些则在控制设备和MOSFET之间放置光耦合器。
- en: You have learned the basics of using a MOSFET transistor as a digital switch.
    Next, we will put that learning together with our learning on optocouplers to
    build our relay driver circuit on a breadboard.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经学会了如何使用MOSFET晶体管作为数字开关的基础知识。接下来，我们将把这些知识与光耦合器的学习结合起来，在面包板上构建我们的继电器驱动电路。
- en: Using a relay as a switch
  id: totrans-224
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用继电器作为开关
- en: 'Classic relays are an electro-mechanical component that allows a smaller current
    device to switch a higher current device or load on and off. In principle, they
    are just like the MOSFET or optocoupler we used previously. So, why have relays?
    Here are a few reasons:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 经典继电器是一种电机械元件，允许较小电流的设备开关更高电流的设备或负载的开关。原则上，它们就像我们之前使用的MOSFET或光耦合器一样。那么为什么要使用继电器？以下是一些原因：
- en: For high voltage and current loads, they tend to be much cheaper compared to
    an equivalent MOSFET.
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于高电压和电流负载，它们往往比等效的MOSFET便宜得多。
- en: At high currents, they do not get untouchably hot like a MOSFET.
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在高电流下，它们不会像MOSFET那样变得不可触摸的热。
- en: Similar to an optocoupler, relays also provide electrical isolation between
    the input and output circuits.
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与光耦合器类似，继电器还提供输入和输出电路之间的电气隔离。
- en: They are simply electrically controlled switches so they are easy to understand
    and use for non-electrical engineers.
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们只是电控开关，因此非电气工程师很容易理解和使用。
- en: They have stood the test of time and proven to be a simple and robust way to
    control high loads (even though they eventually will wear out—the SRD-05VDC-SL-C
    datasheet lists its rated life expectancy to be 100,000 operations).
  id: totrans-230
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们经受住了时间的考验，被证明是控制高负载的简单而健壮的方式（尽管它们最终会磨损 - SRD-05VDC-SL-C的数据表列出了其额定寿命为100,000次操作）。
- en: There is also a type of relay known as a **Solid State Relay** (**SSR**) that
    has no moving parts, however, they are typically more expensive than a comparable
    mechanical relay.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一种被称为**固态继电器**（**SSR**）的继电器类型，它没有移动部件，但通常比可比较的机械继电器更昂贵。
- en: Our first task is to create our circuit, which we will do next.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的第一个任务是创建我们的电路，接下来我们将完成这一步。
- en: Building the relay driver circuit
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建继电器驱动电路
- en: 'Let''s build our relay driver circuit. We will do this in three parts, starting
    with the placements of the components:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们构建我们的继电器驱动电路。我们将分三部分进行，首先是放置组件：
- en: '![](assets/814252c9-a725-4bbe-b868-5afa0feb6307.png)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/814252c9-a725-4bbe-b868-5afa0feb6307.png)'
- en: Figure 7.11 – Relay driver circuit (part 1 of 3)
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.11 - 继电器驱动电路（第1部分）
- en: 'Following are the steps for the first part of the build. The step numbers match
    the numbered black circles in *Figure 7.11*:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是建设的第一部分的步骤。步骤编号与*图7.11*中的编号黑色圆圈相匹配：
- en: Place the PC817 into your breadboard, taking care that pin 1 of the IC is connected
    to the left-hand breadboard bank as illustrated.
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817放入面包板中，注意IC的引脚1连接到左侧面包板银行，如图所示。
- en: Place a 1kΩ resistor into your breadboard. One end of the resistor connects
    to pin 1 of the PC817.
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将1kΩ电阻器放入面包板中。电阻器的一端连接到PC817的引脚1。
- en: Place the MOSFET into your breadboard, taking care to orientate the component
    the correct way around regarding the Source, Gate, and Drain legs. Our example
    layout assumes a 2N7000 MOSFET. Please see *Figure 7.8 *if you need help to identify
    the legs.
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET放入面包板中，注意正确放置源腿、栅极和漏极。我们的示例布局假定使用2N7000 MOSFET。如果需要帮助识别腿部，请参阅*图7.8*。
- en: Place a 1kΩ resistor into your breadboard. One end of this resistor connects
    the Gate leg of the MOSFET.
  id: totrans-241
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将1kΩ电阻器放入面包板中。这个电阻器的一端连接到MOSFET的栅极。
- en: Place a 100kΩ resistor into your breadboard. One end of this resistor also connects
    the Gate leg of the MOSFET.
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将100kΩ电阻器放入面包板中。这个电阻器的一端也连接到MOSFET的栅极。
- en: Place the diode into your breadboard, taking care to orientate the component
    as illustrated with the cathode leg (the end of the component with the band) pointing
    toward the bottom of the breadboard.
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将二极管放入面包板中，注意正确放置组件，使带有标记的阴极腿（组件末端）指向面包板底部。
- en: 'Now that you have placed the individual components, next, we will wire up the
    components:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经放置了各个组件，接下来我们将连接这些组件：
- en: '![](assets/c7e47a62-1634-47f0-af11-1245d959e552.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/c7e47a62-1634-47f0-af11-1245d959e552.png)'
- en: Figure 7.12 – Relay driver circuit (part 2 of 3)
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.12 - 继电器驱动电路（第2部分）
- en: 'Following are the steps for the second part of the build. The step numbers
    match the numbered black circles in *Figure 7.12*:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是第二部分建设的步骤。步骤编号与*图7.12*中的编号黑色圆圈相匹配：
- en: Connect the resistor you placed at the previous *step 2* to a 3.3-volt pin on
    your Raspberry Pi.
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将您在上一个*步骤2*中放置的电阻器连接到树莓派上的3.3伏引脚。
- en: Connect pin 2 of the PC817 to GPIO 21 on your Raspberry Pi.
  id: totrans-249
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817的引脚2连接到树莓派上的GPIO 21。
- en: Connect pin 4 of the PC817 to the positive rail of the right-hand side power
    rail.
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817的引脚4连接到右侧电源轨的正轨。
- en: Connect the Source leg of the MOSFET into the negative rail of the right-hand
    side power rail.
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET的源腿连接到右侧电源轨的负轨。
- en: Connect the 100kΩ resistor that connects into the Drain leg of the MOSFET to
    the negative rail of the right-hand side power rail.
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将连接到MOSFET的漏极的100kΩ电阻器连接到右侧电源轨的负轨。
- en: Connect pin 4 of the PC817 to the cathode leg of the diode.
  id: totrans-253
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将PC817的引脚4连接到二极管的阴极腿。
- en: Connect the Drain leg of the MOSFET to the anode leg of the diode.
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将MOSFET的漏极引脚连接到二极管的阳极引脚。
- en: 'Finally, we will connect the power supplies and relay:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将连接电源和继电器：
- en: '![](assets/408611d1-d641-4d3f-a788-a1252a0bbb0e.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/408611d1-d641-4d3f-a788-a1252a0bbb0e.png)'
- en: Figure 7.13 – Relay driver circuit (part 3 of 3)
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.13 - 继电器驱动电路（3/3）
- en: 'Following are the steps for the third and last part of the build. The step
    numbers match the numbered black circles in *Figure 7.13*:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是构建的第三部分和最后一部分的步骤。步骤编号与*图7.13*中的编号黑色圆圈相匹配：
- en: Connect the positive rail of the right-hand side power rail to the positive
    output terminal of a 5-volt power supply.
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将右侧电源轨道的正轨连接到5伏特电源的正输出端。
- en: Connect the negative rail of the right-hand side power rail to the negative
    output terminal of a 5-volt power supply.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将右侧电源轨道的负轨连接到5伏特电源的负输出端。
- en: Connect the anode leg of the diode to one of the relay's coil terminal.
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将二极管的阳极引脚连接到继电器的一个线圈端子。
- en: Connect the cathode leg of the diode to the relay's other coil terminal.
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将二极管的阴极引脚连接到继电器的另一个线圈端子。
- en: Connect the negative output of a *different* 5-volt power supply to the com
    terminal on your relay.
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将*另一个*5伏特电源的负输出端连接到继电器的com端子。
- en: At *step 5*, you must use two different external power sources for this circuit
    because the current requirements of the relay coil and potential relay load will
    very likely be too much to borrow (rob) from your Raspberry Pi's power supply.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤5*中，您必须为这个电路使用两个不同的外部电源，因为继电器线圈的电流要求和潜在的继电器负载很可能太大，无法从树莓派的电源中借用。
- en: Connect the positive output terminal of the *different* 5-volt power supply
    to the positive input terminal of your load (for example, one of the terminals
    on a motor).
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将*另一个*5伏特电源的正输出端连接到负载的正输入端（例如，电机上的一个端子）。
- en: Finally, connect the **NO** (**Normally Open**) terminal of the relay to the
    negative input terminal of your load.
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，将继电器的**NO**（**常开**）端子连接到负载的正输入端。
- en: Using the NO terminal on the relay means the load will be off by default and
    only powered when the relay is engaged, which happens when GPIO 21 is low (remembering
    this circuit is *active-low*). If you connect your load to the **NC** (**Normally
    Closed**) terminal in the relay, the load will be powered by default, including
    when your Raspberry Pi is switched off.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在继电器上使用NO端子意味着负载默认处于关闭状态，只有在继电器吸合时才通电，这发生在GPIO 21为低电平时（记住这个电路是*低电平有效*）。如果将负载连接到继电器中的**NC**（**常闭**）端子，负载将默认通电，即使树莓派关闭也是如此。
- en: 'Well done! Your completed breadboard circuit, as illustrated in *Figure 7.13**.*
    This is the breadboard build that matches the schematic diagram shown at the commencement
    of this chapter in *Figure 7.1*. This breadboard circuit is shown with a 5-volt
    *relay coil power* sourc*e* and a 5-volt *load power* source. This circuit, however,
    can be used with different power supplies subject to the following pointers:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 干得好！您完成了面包板电路，如*图7.13*所示。这是与本章开头的*图7.1*中显示的原理图相匹配的面包板电路。该面包板电路显示了一个5伏特的*继电器线圈电源*和一个5伏特的*负载电源*。然而，该电路可以使用不同的电源，但需要遵循以下几点：
- en: The choice of resistors and the 2N7000 MOSFET used in this circuit is capable
    of driving a 12-volt relay like an SRD-12VDC-SL-C. You'll just need to make sure
    the *relay coil power* source is 12 volts rather than 5 volts.
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在这个电路中使用的电阻和2N7000 MOSFET能够驱动一个12伏特的继电器，比如SRD-12VDC-SL-C。您只需要确保*继电器线圈电源*是12伏特而不是5伏特。
- en: The load power source is illustrated as 5 volts, however, if your load requires
    more voltage (that's within the relay's specifications), it can be increased.
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 负载电源被说明为5伏特，但是，如果您的负载需要更高的电压（在继电器规格内），可以增加。
- en: Now that we have a finished circuit, let's run a Python program to control the
    relay.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了一个完成的电路，让我们运行一个Python程序来控制继电器。
- en: Controlling the Relay Driver Circuit with Python
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Python控制继电器驱动电路
- en: Run the following code, which is in the `chapter07/optocoupler_test.py` file.
    The relay should activate with a click sound, and deactivate after 2 seconds.
    This is the same code we used when we created and tested our optocoupler circuit
    since it's the optocoupler that our Raspberry Pi is connected to.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 运行以下代码，该代码位于`chapter07/optocoupler_test.py`文件中。继电器应该会发出点击声并在2秒后停止。这是我们创建和测试光耦电路时使用的相同代码，因为我们的树莓派连接到了光耦。
- en: We saw earlier when we learned about MOSFETs that we could connect the MOSFET
    directly to a GPIO pin and control the relay, without needing an optoisolator.
    So, why does the preceding circuit have one?
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们之前学习MOSFET时看到，我们可以直接将MOSFET连接到GPIO引脚并控制继电器，而无需光耦。那么，为什么前面的电路有一个光耦呢？
- en: The answer is that our circuit does not technically need one, and there are
    ready-made relay modules to be found (though rarer) that do not have an optoisolator.
    However, there is no harm in having one present since it does provide a level
    of electrical isolation protection just in case the relay control circuit fails
    or there is a mishap when wiring up the power supply.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 答案是我们的电路在技术上并不需要，而且有现成的继电器模块（尽管较少）不带有光耦。然而，有一个光耦存在并没有坏处，因为它提供了一定程度的电气隔离保护，以防继电器控制电路失效或在接线电源时发生意外。
- en: Finally, what about relay modules you can find on sites such as eBay that have
    more than one relay? There is just a single relay circuit replicated multiple
    times—you will typically be able to count a transistor and optocoupler pair for
    each relay (although optocouplers and transistors can come in chip form, that
    is, multiple optocouplers or optocouplers in a single package, so on some modules
    you may just see the chips instead). Also, note that some modules will use a BJT
    rather than a MOSFET. If you can read the part numbers on the components, you
    can always perform a web search to determine what they are.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，关于在eBay等网站上可以找到的具有多个继电器的继电器模块呢？通常只有一个继电器电路被复制多次——通常您可以为每个继电器计数一个晶体管和光耦对（尽管光耦和晶体管可以以芯片形式出现，即多个光耦或多个光耦在一个封装中，因此在某些模块上您可能只会看到芯片）。另外，请注意，有些模块将使用BJT而不是MOSFET。如果您可以读取元件的零件号，您可以随时进行网络搜索以确定它们是什么。
- en: 'To conclude our exploration of turning things on and off, here is a table comparing
    the switching components we used in this chapter:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，为了总结我们对打开和关闭的探索，这里是一个比较本章中使用的开关元件的表格：
- en: '|  | **Optocoupler** | **MOSFET** | **Relay** |'
  id: totrans-278
  prefs: []
  type: TYPE_TB
  zh: '- 光耦 | MOSFET | 继电器'
- en: '| **Construction** | Solid state | Solid state | Mechanical |'
  id: totrans-279
  prefs: []
  type: TYPE_TB
  zh: '- 结构 | 固态 | 固态 | 机械'
- en: '| **Current** | AC or DC (depending on optocoupler)  | DC only (start your
    research with TRIACS for AC) | AC and DC |'
  id: totrans-280
  prefs: []
  type: TYPE_TB
  zh: '- 电流 | 交流或直流（取决于光耦） | 仅直流（从TRIACS开始研究交流） | 交流和直流'
- en: '| **Cost** | $ - $$ | $ (low capacity) to $$$ (high capacity) | $ |'
  id: totrans-281
  prefs: []
  type: TYPE_TB
  zh: '- 成本 | $ - $$ | $（低容量）至$$$（高容量） | $'
- en: '| **Gets Really Hot (Can''t touch)** | No | Yes for high current power MOSFETs
    | No |'
  id: totrans-282
  prefs: []
  type: TYPE_TB
  zh: '- 很热（不能触摸） | 否 | 对于高电流功率MOSFET是 | 否'
- en: '| **Control Voltage / Current** | Low (need to turn off and on the internal
    LED) | Low (need to apply voltage to the Gate) | High (need to energize the relay
    coil) |'
  id: totrans-283
  prefs: []
  type: TYPE_TB
  zh: '- 控制电压/电流 | 低（需要打开和关闭内部LED） | 低（需要对栅极施加电压） | 高（需要通电继电器线圈）'
- en: '| **Load Voltage / Current** | Low (for example, PC817 max 50mA) | Low (for
    example, 2N27000 at 200mA); High (for example, FQP30N06L at 32A) | High (for example, SRD-05VDC-SL-C 10A)
    |'
  id: totrans-284
  prefs: []
  type: TYPE_TB
  zh: '- 负载电压/电流 | 低（例如，PC817最大50mA） | 低（例如，2N27000为200mA）；高（例如，FQP30N06L为32A） | 高（例如，SRD-05VDC-SL-C
    10A）'
- en: '| **Electrical Isolation** | Yes | No | Yes |'
  id: totrans-285
  prefs: []
  type: TYPE_TB
  zh: '- 电气隔离 | 是 | 否 | 是'
- en: '| **Example application** | Provides electrical isolation between a controlling
    circuit and the circuit to be controlled | Allows a low current/voltage circuit
    to control a higher voltage/current circuit | Allows a low current/voltage circuit
    to control a higher voltage/current circuit |'
  id: totrans-286
  prefs: []
  type: TYPE_TB
  zh: '- 示例应用 | 在控制电路和被控电路之间提供电气隔离 | 允许低电流/电压电路控制更高电压/电流电路 | 允许低电流/电压电路控制更高电压/电流电路'
- en: '| **Longevity** | Long life | Long life  | Short life (moving parts will wear
    out eventually) |'
  id: totrans-287
  prefs: []
  type: TYPE_TB
  zh: '- 寿命 | 长寿命 | 长寿命 | 短寿命（活动部件最终会磨损）'
- en: '| **Use PWM** | Yes | Yes | No—a relay will not switch fast enough, plus you''ll
    only wear out the relay faster! |'
  id: totrans-288
  prefs: []
  type: TYPE_TB
  zh: '- 使用PWM | 是 | 是 | 不是——继电器无法切换得足够快，而且只会更快地磨损继电器！'
- en: Well done on completing this chapter! You now understand multiple ways to control
    loads that have voltage and current requirements beyond the 3.3 volt/8mA limits
    of your Raspberry Pi's GPIO pins.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜您完成了本章！您现在了解了多种控制具有电压和电流要求的负载的方法，这些要求超出了树莓派GPIO引脚的3.3伏特/8毫安的限制。
- en: Summary
  id: totrans-290
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we learned how to switch things on and off. We commenced by
    briefly reviewing a typical relay driver circuit, before learning how to measure
    the current requirements of a DC motor, LED, and relay using a multimeter. Next,
    we discussed the properties of an optocoupler and learned at low to use it as
    a digital switch. Then, we discussed MOSFETs and discovered how to use them as
    a switch and for motor speed control using PWM.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何打开和关闭开关。我们首先简要回顾了典型的继电器驱动电路，然后学习了如何使用万用表测量直流电机、LED和继电器的电流需求。接下来，我们讨论了光耦的特性，并学会了如何将其用作数字开关。然后，我们讨论了MOSFET，并发现了如何将其用作开关和使用PWM进行电机速度控制。
- en: The information, circuits, and exercises you have learned in this chapter will
    help you to make informed decisions and make the necessary calculations and measurements
    to select suitable components and create circuits that can be used to switch devices on
    and off and other loads that demand more current and higher voltages that can
    be sourced safely from a Raspberry Pi pin.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中学到的信息、电路和练习将帮助您做出明智的决策，并进行必要的计算和测量，以选择合适的元件并创建可以安全地从树莓派引脚中获取更多电流和更高电压的电路，用于打开和关闭设备和其他负载。
- en: Our approach to this chapter was to incrementally explore and build a relay
    driver circuit, which provides you with a practical example of how and why switching
    components are chained together to control higher power components and/or loads.
    Also, we learned that optocouplers can be used to electrically isolate circuits,
    which can be a useful and practical technique to help us to isolate and protect
    our Raspberry Pi from accidental damage should a circuit fail or be wired incorrectly.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对本章的方法是逐步探索和构建继电器驱动电路，这为您提供了一个实际示例，说明了为什么和如何将开关元件串联起来控制更高功率的元件和/或负载。此外，我们了解到光耦可以用于电气隔离电路，这可以是一种有用和实用的技术，可以帮助我们隔离和保护树莓派，以防电路故障或接线错误造成意外损坏。
- en: In the next chapter, we turn our attention to different types of LEDs, buzzers,
    and visual components we can use to signal or display information to users.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将关注不同类型的LED、蜂鸣器和可视元件，这些元件可以用来向用户发出信号或显示信息。
- en: Questions
  id: totrans-295
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: 'As we conclude, here is a list of questions for you to test your knowledge
    regarding this chapter''s material. You will find the answers in the *Assessments*
    section of the book:'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，这里是一系列问题，供您测试对本章材料的了解。您将在本书的“评估”部分找到答案：
- en: When it comes to controlling a transistor, how do MOSFET and BJT differ?
  id: totrans-297
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在控制晶体管时，MOSFET和BJT有何不同？
- en: You are controlling a motor using a MOSFET, however, you switch off the MOSFET
    (for example, making the GPIO pin low), but the motor does not turn off promptly
    but instead spins down. Why?
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您正在使用MOSFET控制电机，但是当您关闭MOSFET（例如，使GPIO引脚低电平）时，电机并没有立即关闭，而是减速旋转。为什么？
- en: You have selected a random MOSFET that you want to control from a Raspberry
    Pi 3.3-volt GPIO but it does not work. What is some possible cause of the problem?
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您选择了一个随机的MOSFET，想要从树莓派3.3伏特的GPIO控制它，但它不起作用。可能的问题原因是什么？
- en: Other than switching, what common feature do optocouplers and relays share that
    transistors do not?
  id: totrans-300
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 除了开关功能，光耦和继电器与晶体管不同的常见特征是什么？
- en: What is the difference between an active low and active high GPIO?
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 主动低电平和主动高电平的GPIO有什么区别？
- en: Why do we prefer a physical pull-down resistor for the MOSFET's Gate leg over
    an in-code activated pull-down?
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为什么我们更喜欢在MOSFET的栅极上使用物理下拉电阻，而不是在代码中激活的下拉电阻？
- en: For a DC motor, what does the stall current represent?
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于直流电机，失速电流代表什么？
- en: For a DC motor, what is the difference between continuous and free current?
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 直流电机的连续电流和自由电流有什么区别？
- en: Further reading
  id: totrans-305
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'The following tutorial is a thorough introduction to transistors, their various
    types, and applications:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 以下教程是关于晶体管、它们的各种类型和应用的全面介绍：
- en: '[https://www.electronics-tutorials.ws/category/transistor](https://www.electronics-tutorials.ws/category/transistor)
    (start with the MOSFET sections)'
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.electronics-tutorials.ws/category/transistor]（从MOSFET部分开始）'
