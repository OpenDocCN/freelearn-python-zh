- en: Chapter 10. Building Your Own Robot
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章. 构建你自己的机器人
- en: In this chapter we will see how to build our own robot using BeagleBone Black
    with Motors and Motor Driver IC interfaced with it. First we will learn about
    DC motors, followed by the L293D motor driver IC that will help us drive the DC
    motors. Then we will see how we can stream live video on a web page from the camera
    connected to the BeagleBone board. At the end we will build our own telecontrolled
    robot that you can control from a web page with a live video feed streaming from
    the camera connected to the BeagleBone Black.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将了解如何使用BeagleBone Black和与之接口的电机和电机驱动IC来构建自己的机器人。首先，我们将了解直流电机，然后是L293D电机驱动IC，它将帮助我们驱动直流电机。然后我们将了解如何从连接到BeagleBone板的摄像头在网页上实时流式传输视频。最后，我们将构建一个可以远程控制的机器人，你可以通过网页上的实时视频流从连接到BeagleBone
    Black的摄像头来控制它。
- en: 'The contents of this chapter are divided into:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章内容分为：
- en: Prerequisites
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 前提条件
- en: DC motors and the L293D motor driver IC
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直流电机和L293D电机驱动IC
- en: Live video streaming on the BeagleBone board
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BeagleBone板上的实时视频流
- en: 'Advanced Project: A tele-controlled robot with live video streaming'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高级项目：带有实时视频流的遥控机器人
- en: Prerequisites
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 前提条件
- en: This topic will cover the parts you will need to get started with building the
    robot. These materials can be purchased from your local electrical hobby store
    or by ordering online from websites like Adafruit, Sparkfun, Seed Studio and so
    on.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 本主题将涵盖你开始构建机器人所需的部件。这些材料可以从你当地的电子爱好商店购买，或者从Adafruit、Sparkfun、Seed Studio等网站在线订购。
- en: Materials Needed
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 需要的材料
- en: 1x BeagleBone Black
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x BeagleBone Black
- en: 1x microSD card with latest version of Debian flashed on it to boot the BeagleBone
    board from a microSD card
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x 带有最新版本Debian的microSD卡，用于从microSD卡启动BeagleBone板
- en: 1x 5V DC, 2A power supply/mobile power bank with USB output of 5V 2A or more
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x 5V DC，2A电源/移动电源，具有5V 2A或更高输出
- en: 1x USB WiFi dongle
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x USB WiFi外置设备
- en: 1x BreadBoard
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x 面板
- en: 2x DC motors 50 to 100 RPM range operating at 12V
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 2x 50至100 RPM范围内的12V直流电机
- en: 1x L293D motor driver IC
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x L293D电机驱动IC
- en: 1x USB camera
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x USB摄像头
- en: 1x USB hub
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x USB集线器
- en: 1x 12V or 9V battery
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x 12V或9V电池
- en: 1x USB cable
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x USB线
- en: 1x DC barrel jack
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1x 直流柱状插头
- en: Connecting wires
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接线
- en: DC motors
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 直流电机
- en: A DC motor is a motor that runs using a DC power supply.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 直流电机是一种使用直流电源运行的电机。
- en: '![DC motors](img/4602_10_01.jpg)'
  id: totrans-25
  prefs: []
  type: TYPE_IMG
  zh: '![直流电机](img/4602_10_01.jpg)'
- en: As shown in the preceding picture, it has two terminal wires. We can call one
    of these terminal wire positive and the other one negative. Usually, these wires
    are marked red and black where red is positive and black is negative. Although
    these wires are marked positive and negative, unlike the battery, where these
    polarities can't be mixed, here in the DC motors they can be mixed.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，它有两个端子线。我们可以称其中一条端子线为正极，另一条为负极。通常，这些线被标记为红色和黑色，红色代表正极，黑色代表负极。尽管这些线被标记为正负极，但与电池不同，电池的极性不能混合，在这里的直流电机中，它们可以混合。
- en: 'Say, for example, on a motor, if the positive wire is connected to the positive
    terminal of the battery and the negative wire is connected to the negative terminal
    of the battery, or the power source, the motor rotates in a clockwise direction.
    When you reverse the connection, say from the positive terminal of the motor to
    the negative terminal of the battery and the negative terminal of the motor to
    the positive terminal of the battery, then the motor will rotate in an anti-clockwise
    direction, as shown in the following picture:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在一个电机上，如果正极线连接到电池的正极，负极线连接到电池的负极或电源，电机将按顺时针方向旋转。当你反转连接，例如从电机的正极到电池的负极，电机的负极到电池的正极，那么电机将按逆时针方向旋转，如下图所示：
- en: '![DC motors](img/4602_10_02.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![直流电机](img/4602_10_02.jpg)'
- en: While the polarity of the voltage source's connection to terminals of the motor
    controls the DC motor's direction of rotation, the magnitude of the DC voltage
    source determines the speed of it.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 当电压源连接到电机的端子时，其极性控制直流电机的旋转方向，而直流电压源的幅度则决定了其速度。
- en: But changing the polarity and switching the circuit on and off every time manually
    can be hectic job, and we need an electronic circuit that can help us do this
    without having to physically switch the connections. This is where motor driver
    ICs will come in useful to complete the task with digital inputs. One such motor
    driver IC is the L293D which will be discussing next.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，每次手动改变极性和开关电路都是一项繁琐的工作，我们需要一个电子电路来帮助我们完成这项工作，而无需物理切换连接。这就是电机驱动IC将派上用场的地方，以数字输入完成这项任务。其中一种电机驱动IC是L293D，我们将在下一节讨论。
- en: L293D motor driver IC
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: L293D电机驱动IC
- en: As we mentioned previously, the L293D can be defined as a, H-Bridge motor driver
    circuit, which is made into a IC allowing us to drive a DC motor in either direction
    using digital inputs.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们之前提到的，L293D可以被定义为H桥电机驱动电路，它被制作成IC，使我们能够使用数字输入驱动直流电动机。
- en: 'The pin configuration of the **L293D** is as shown in the following picture:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '**L293D**的引脚配置如图所示：'
- en: '![L293D motor driver IC](img/4602_10_03.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![L293D电机驱动IC](img/4602_10_03.jpg)'
- en: As shown in the preceding picture, in the L293D there are four input pins and
    four output pins. The two input pins, pin two and seven regulate the rotation
    of the motor connected to output pins three and six. Similarly, the input pins
    on the right, pin fifteen and ten regulate the rotation of the motor connected
    to output pins eleven and fourteen. The enable pins one and two, on the left and
    the right side of the IC on pin one and nine of the IC enables the operation of
    the output based on the input on that side of the IC. The motors rotate based
    on the inputs provided across the input pins as Logic `0` and Logic `1`. Supply
    **5V** to the **Vcc** pin of the IC for its operation, and connect the ground
    pins to the ground and negative pins of the power supply. And finally, you need
    to connect the positive of the DC power source/battery to the **Vss** pin to provide
    a power supply to the motor, and connect the negative of the power supply to the
    **GND** pin.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 如前图所示，在L293D中，有四个输入引脚和四个输出引脚。两个输入引脚，即第二个和第七个引脚，调节连接到输出引脚三和六的电动机的旋转。同样，右侧的输入引脚，即第十五个和第十个引脚，调节连接到输出引脚十一和十四的电动机的旋转。左、右两侧的使能引脚一和二，位于IC的第一个和第九个引脚上，根据IC该侧的输入来启用输出操作。电动机根据输入引脚提供的逻辑`0`和逻辑`1`来旋转。为IC的**Vcc**引脚供电**5V**以供其工作，并将地引脚连接到地线和电源的负极。最后，您需要将直流电源/电池的正极连接到**Vss**引脚，为电动机提供电源，并将电源的负极连接到**GND**引脚。
- en: 'Consider the circuit connection as shown in the following picture:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考以下图片中的电路连接：
- en: '![L293D motor driver IC](img/4602_10_04.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![L293D电机驱动IC](img/4602_10_04.jpg)'
- en: 'For the circuit shown previously, when input 1 is LOW and input 2 is HIGH,
    the motor 1 will rotate in a clockwise direction, similarly when both inputs 1
    and 2 are LOW or HIGH the motor will not rotate. This can be explained using a
    logic table:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 对于前面所示的电路，当输入1为低电平且输入2为高电平时，电动机1将顺时针旋转，同样，当输入1和2都为低电平或高电平时，电动机将不会旋转。这可以用逻辑表来解释：
- en: '| Input 1 | Input2 | Motor 1 Running Direction |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| 输入1 | 输入2 | 电动机1运行方向 |'
- en: '| --- | --- | --- |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| HIGH | LOW | ANTI-CLOCKWISE |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| 高 | 低 | 逆时针 |'
- en: '| LOW | HIGH | CLOCKWISE |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| 低 | 高 | 顺时针 |'
- en: '| HIGH | HIGH | IDLE – NO ROTATION |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| 高 | 高 | 空转 – 无旋转 |'
- en: '| LOW | LOW | IDLE – NO ROTATION |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| 低 | 低 | 空转 – 无旋转 |'
- en: 'Similarly for input 3 and input 4 the output will be as shown in the following
    table:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 对于输入3和输入4，输出将如以下表格所示：
- en: '| Input 3 | Input4 | Motor 2 Running Direction |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| 输入3 | 输入4 | 电动机2运行方向 |'
- en: '| --- | --- | --- |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| HIGH | LOW | ANTI-CLOCKWISE |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| 高 | 低 | 逆时针 |'
- en: '| LOW | HIGH | CLOCKWISE |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| 低 | 高 | 顺时针 |'
- en: '| HIGH | HIGH | IDLE – NO ROTATION |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| 高 | 高 | 空转 – 无旋转 |'
- en: '| LOW | LOW | IDLE – NO ROTATION |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| 低 | 低 | 空转 – 无旋转 |'
- en: You can test it by connecting it to the BeagleBone Black by writing a similar
    Python code to our blink code or the home automation code that we tried in our
    previous chapters. With this knowledge, you will have a clear idea of the concept
    of how the L293D operates. You can look at the datasheet of the L293D IC to get
    more details about the specifications and ratings of the IC. You can get this
    datasheet provided by the IC manufacturer on the Internet.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过将其连接到BeagleBone Black并编写与我们的闪烁代码或我们在前几章中尝试的智能家居代码类似的Python代码来测试它。有了这些知识，您将清楚地了解L293D的工作原理。您可以通过查看L293D
    IC的数据表来获取有关IC规格和额定值的更多详细信息。您可以在互联网上找到由IC制造商提供的数据表。
- en: We will use the same circuit interfaced with the BeagleBone board at the end
    of the chapter to the build the robot in our final project. Now let's go ahead
    and see how we can stream video live on the BeagleBone board using the USB camera
    connected to it.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章末使用与BeagleBone板连接的相同电路来构建我们最终项目中的机器人。现在让我们继续看看如何使用连接到它的USB摄像头在BeagleBone板上进行实时视频流。
- en: Live video streaming on the BeagleBone board
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BeagleBone板上的实时视频流
- en: 'To stream live video from Logitech HD webcam C270 USB camera, connected via
    local server to the BeagleBone board you need to have a software package that
    can do the job. But you also need to install some essential software before you
    download and compile the live video streaming software. Let''s get started with
    the installation of the software packages by executing the following commands
    :'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 要从Logitech HD C270 USB摄像头通过本地服务器连接到BeagleBone板进行实时视频流，你需要一个能够完成这项工作的软件包。但在下载和编译实时视频流软件之前，你还需要安装一些基本软件。让我们通过执行以下命令开始安装软件包：
- en: '`sudo apt-get install imagemagick`![Live video streaming on the BeagleBone
    board](img/4602_10_05.jpg)'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo apt-get install imagemagick`![BeagleBone板上的实时视频流](img/4602_10_05.jpg)'
- en: 'When you are prompted to continue the operation, type `Y`, as shown at the
    end of the preceding screenshot, and hit `Enter` to continue and finish the installation:'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当你被提示继续操作时，输入`Y`，如前一个截图的末尾所示，然后按`Enter`继续并完成安装：
- en: '`sudo apt-get install libjpeg8-dev`![Live video streaming on the BeagleBone
    board](img/4602_10_06.jpg)'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo apt-get install libjpeg8-dev`![BeagleBone板上的实时视频流](img/4602_10_06.jpg)'
- en: '`sudo apt-get install subversion`![Live video streaming on the BeagleBone board](img/4602_10_07.jpg)'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo apt-get install subversion`![BeagleBone板上的实时视频流](img/4602_10_07.jpg)'
- en: Now that we have installed all the prerequite softwares, let's download and
    compile the video streaming software.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经安装了所有预置软件，让我们下载和编译视频流软件。
- en: 'First create a separate directory in the home directory, and put the contents
    of the streaming software inside it:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 首先在主目录中创建一个单独的目录，并将流软件的内容放入其中：
- en: '`mkdir mjpg`![Live video streaming on the BeagleBone board](img/4602_10_08.jpg)'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mkdir mjpg`![BeagleBone板上的实时视频流](img/4602_10_08.jpg)'
- en: 'Now let us change our working directory to the directory we created:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们将我们的工作目录更改为我们创建的目录：
- en: '`cd mjpg`![Live video streaming on the BeagleBone board](img/4602_10_09.jpg)'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cd mjpg`![BeagleBone板上的实时视频流](img/4602_10_09.jpg)'
- en: 'Once you are in the `mjpg` directory, you can download the mjpg-streamer software
    package using the command given following from the URL mentioned in the command:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你进入了`mjpg`目录，你可以使用命令中提到的URL下载mjpg-streamer软件包：
- en: '`svn co https://svn.code.sf.net/p/mjpg-streamer/code/mjpg-streamer/ mjpg-streamer`![Live
    video streaming on the BeagleBone board](img/4602_10_10.jpg)'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`svn co https://svn.code.sf.net/p/mjpg-streamer/code/mjpg-streamer/ mjpg-streamer`![BeagleBone板上的实时视频流](img/4602_10_10.jpg)'
- en: 'Once you have downloaded it there will be aa `mjpg-streamer` folder created,
    inside which you will have the source code of the software. Let''s go ahead and
    change the directory to that first:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 下载完成后，将创建一个`mjpg-streamer`文件夹，其中包含软件的源代码。让我们继续更改目录到那个文件夹：
- en: '`cd mjpg-streamer`![Live video streaming on the BeagleBone board](img/4602_10_11.jpg)'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cd mjpg-streamer`![BeagleBone板上的实时视频流](img/4602_10_11.jpg)'
- en: 'Now our next step will be compile the software using the `make` command:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在接下来的步骤将是使用`make`命令编译软件：
- en: '`make`![Live video streaming on the BeagleBone board](img/4602_10_12.jpg)'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`make`![BeagleBone板上的实时视频流](img/4602_10_12.jpg)'
- en: 'Once you have successfully compiled the software without errors you can go
    ahead and run the software using the following command:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你成功编译了软件且没有错误，你可以继续使用以下命令运行软件：
- en: '`/mjpg_streamer -i "./input_uvc.so -d /dev/video0 -n -y" -o "./output_http.so
    -w ./www"`'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`/mjpg_streamer -i "./input_uvc.so -d /dev/video0 -n -y" -o "./output_http.so
    -w ./www"`'
- en: 'If the Apache server is installed on your Debian package then it might show
    an error saying **bind: Address already in use** as shown in the following screenshot
    when you execute the preceding command to run the video streaming software:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '如果你已经在Debian包中安装了Apache服务器，那么当你执行运行视频流软件的先前命令时，可能会显示一个错误，说**bind: Address already
    in use**，如下面的截图所示：'
- en: '![Live video streaming on the BeagleBone board](img/4602_10_13.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_13.jpg)'
- en: 'This is due to port `8080` being used by default by the Apache server. In this
    case, to resolve the issue, we can change the port used by Apache to `8079`, or
    any other permited number as shown in the following screenshot, by changing the
    details in the `ports.conf` file:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为Apache服务器默认使用端口`8080`。在这种情况下，为了解决这个问题，我们可以通过更改`ports.conf`文件中的详细信息，将Apache使用的端口更改为`8079`或任何其他允许的数字，如下面的截图所示：
- en: '`sudo nano /etc/apache2/ports.conf`![Live video streaming on the BeagleBone
    board](img/4602_10_14.jpg)'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo nano /etc/apache2/ports.conf`![BeagleBone板上的实时视频流](img/4602_10_14.jpg)'
- en: 'Once you open the file you can change the `NameVirtualHost` to `8079` and `Listen`
    to `8079` port as shown in the following screenshot and save it:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 打开文件后，你可以将`NameVirtualHost`更改为`8079`，并将`Listen`更改为`8079`端口，如下面的截图所示，并保存它：
- en: '![Live video streaming on the BeagleBone board](img/4602_10_15.jpg)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_15.jpg)'
- en: 'Once you save it, you need to restart the Apache server to perform the changes.
    To do that, execute the `service restart` command:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 保存后，你需要重新启动Apache服务器以执行更改。为此，执行`service restart`命令：
- en: '`sudo service apache2 restart`![Live video streaming on the BeagleBone board](img/4602_10_16.jpg)'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo service apache2 restart`![BeagleBone板上的实时视频流](img/4602_10_16.jpg)'
- en: 'Once you restart and get the output as shown in the preceding screenshot, it
    means the changes have been made. Now you can go ahead and run the streaming software
    by executing the following command:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 重新启动并得到前面截图所示的输出，这意味着更改已经完成。现在你可以继续运行流媒体软件，通过执行以下命令：
- en: '`sudo ./mjpg_streamer -i "./input_uvc.so -d /dev/video0 -n -y" -o "./output_http.so
    -w ./www"`![Live video streaming on the BeagleBone board](img/4602_10_17.jpg)'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo ./mjpg_streamer -i "./input_uvc.so -d /dev/video0 -n -y" -o "./output_http.so
    -w ./www"`![BeagleBone板上的实时视频流](img/4602_10_17.jpg)'
- en: If you see the output as shown in the previous screenshot, then the streaming
    software is running properly. We can test it by visiting the local server at port
    `8080` as shown in the following screenshot. The IP address is the IP address
    of the BeagleBone Black on your router, which is same as the one we used to login
    to the BeagleBone board.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你看到前面截图所示的输出，那么流媒体软件正在正常运行。我们可以通过访问如下面的截图所示的本地服务器在端口`8080`来测试它。IP地址是你路由器上BeagleBone
    Black的IP地址，它与用于登录BeagleBone板的IP地址相同。
- en: 'Once you open the web link, you will see the streaming software''s home webpage
    as shown on the next page:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 打开网页链接后，你将看到流媒体软件的主页，如下一页所示：
- en: '![Live video streaming on the BeagleBone board](img/4602_10_18.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_18.jpg)'
- en: 'The software description page with the details about which streaming software
    we are running on the BeagleBone board is shown in the previous screenshot. On
    the home page itself you can see the image captured from the camera but it''s
    a static image which is not a live stream. To see the live stream, click on the
    **Stream** button on the left and it will show you the live streamed web page
    where you can see the live feed from the camera as shown in the following screenshot:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 前一截图显示了有关我们在BeagleBone板上运行的流媒体软件的详细信息页。在主页本身，你可以看到从摄像头捕获的图像，但它是一个静态图像，不是实时流。要查看实时流，请点击左侧的**Stream**按钮，它将显示包含从摄像头实时视频流的网页，如下面的截图所示：
- en: '![Live video streaming on the BeagleBone board](img/4602_10_19.jpg)'
  id: totrans-87
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_19.jpg)'
- en: 'Click the button **here**, which is highlighted in red saying **To see a simple
    example click here**. You will see just the video feed separately as a image element
    on an HTML page as shown in the following screenshot:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**此处**的按钮，该按钮以红色突出显示，并标注为**要查看简单示例，请点击此处**。你将看到仅作为HTML页面上的一个图像元素单独显示的视频流，如下面的截图所示：
- en: '![Live video streaming on the BeagleBone board](img/4602_10_20.jpg)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_20.jpg)'
- en: 'A setup of the BeagleBone board with the USB camera whilst the live feed is
    being streamed is shown in the following screenshot:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了在实时流传输时，带有USB摄像头的BeagleBone板的设置：
- en: '![Live video streaming on the BeagleBone board](img/4602_10_21.jpg)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_21.jpg)'
- en: So, you can see that the BeagleBone and the power bank which are in front of
    the camera are visible on the live feed. If you just wave your hand in front of
    the camera you can see it live on the web page.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你可以看到摄像头前方的BeagleBone和移动电源在实时流中是可见的。如果你在摄像头前挥手，你可以在网页上实时看到。
- en: Now that we have seen the live video feed on this, if you want to include it
    on any HTML page you want to create, you can do so by adding the image source
    element created by the streaming software. You get the information of that image
    source by right clicking on the browser and hitting the inspect element which
    will show the details as shown in the following screenshot. Almost all of the
    browsers we use like Chrome, IE or Mozilla shows these details now, and you can
    learn more about this by browsing the Internet.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到了这个直播视频流，如果你想在创建的任何HTML页面上包含它，你可以通过添加由流媒体软件创建的图像源元素来实现。你可以通过在浏览器上右键单击并点击“检查元素”来获取该图像源的信息，这将显示如下截图中的详细信息。现在我们使用的几乎所有浏览器，如Chrome、IE或Mozilla，都显示这些详细信息，你可以通过浏览互联网了解更多信息。
- en: '![Live video streaming on the BeagleBone board](img/4602_10_22.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![BeagleBone板上的实时视频流](img/4602_10_22.jpg)'
- en: 'The image element can be identified on the inspection block on the right side
    of the browser window where the details is mentioned as shown in the preceding
    screenshot:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在浏览器窗口右侧的检查块中识别图像元素，其中详细说明了如下截图：
- en: '[PRE0]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: We will be using this in our project at the end of this chapter to get a live
    feed on the web page using a Flask framework and Python. Now that we know how
    to get a live feed from the USB camera and integrate it on a webpage, let's go
    ahead to the next topic in this chapter where we will be building a robot with
    live video streaming.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本章的末尾使用这个元素，通过Flask框架和Python在网页上获取实时视频流。现在我们知道了如何从USB摄像头获取实时视频流并将其集成到网页上，让我们继续本章的下一个主题，我们将构建一个带有实时视频流的机器人。
- en: Advanced project – a telecontrolled robot with live video streaming
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 高级项目 – 带直播视频流的遥控机器人
- en: 'First connect the motor driver IC with motors, power supply as shown in the
    following circuit:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先连接电机驱动IC和电机，电源如下电路所示：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_23.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带直播视频流的遥控机器人](img/4602_10_23.jpg)'
- en: 'The whole setup will look like the following picture:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 整个设置看起来如下：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_24.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带直播视频流的遥控机器人](img/4602_10_24.jpg)'
- en: 'So you can see from the preceding picture that the BeagleBone Black is connected
    to a USB hub to which the WiFi dongle and USB camera are connected. Also the L293D
    is connected to motors of the robot and an external 12V battery is used to drive
    the motors. The input pins of L293D are connected to the BeagleBone Black to control
    the L293D. The BeagleBone Black is powered using a mobile power bank using a USB
    to DC barrel connector cable, which you can make on your own as shown in the following
    picture:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的图片中你可以看到，BeagleBone Black连接到一个USB集线器，Wi-Fi适配器和USB摄像头都连接到这个集线器。L293D连接到机器人的电机，并使用外部12V电池来驱动电机。L293D的输入引脚连接到BeagleBone
    Black，以控制L293D。BeagleBone Black使用USB到DC柱状连接器电缆通过移动电源供电，你可以按照以下图片所示自己制作：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_25.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带直播视频流的遥控机器人](img/4602_10_25.jpg)'
- en: So why can't the BeagleBone board be powered using the inbuilt USB connection?.
    This is because the USB only draws 500mAh in total from the input supply, which
    isn't sufficient to power up the USB webcam and the Wi-Fi dongle.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 那为什么BeagleBone板不能使用内置的USB连接供电呢？这是因为USB总共只从输入电源中抽取了500mAh，这不足以给USB摄像头和Wi-Fi适配器供电。
- en: Now, you can login into the BeagleBone Black and write the code to control the
    robot from the web page.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以登录到BeagleBone Black并编写代码，从网页上控制机器人。
- en: 'In this project, we will not be writing the code from scratch – instead we
    will be writing it by editing the code from our home automation project from [Chapter
    6](ch06.html "Chapter 6. Home Automation Using BeagleBone"), *Home Automation
    Using BeagleBone*. So let''s go ahead to the home automation directory in the
    Linux shell after logging into it:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，我们不会从头编写代码——相反，我们将通过编辑来自[第6章](ch06.html "第6章。使用BeagleBone进行家庭自动化")“使用BeagleBone进行家庭自动化”中我们的家庭自动化项目的代码来编写代码。所以，在登录后，让我们先进入Linux
    shell中的家庭自动化目录：
- en: '`cd WorkSpace/HomeAutomation`![Advanced project – a telecontrolled robot with
    live video streaming](img/4602_10_26.jpg)'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cd WorkSpace/HomeAutomation`![高级项目 – 带直播视频流的遥控机器人](img/4602_10_26.jpg)'
- en: 'If you list the contents in the directory using the `ls` command, you will
    see the following:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用`ls`命令列出目录内容，你会看到以下：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_27.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_27.jpg)'
- en: 'Once you are in the home automation directory, let''s first edit the HTML template:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您处于智能家居目录中，让我们首先编辑 HTML 模板：
- en: '`cd templates`![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_28.jpg)'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cd templates`![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_28.jpg)'
- en: 'Now we can go ahead and edit the `main.html` file that we created in our home
    automation project and then save it as `Robot.html` file, as shown in following
    screenshot:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以继续编辑我们在智能家居项目中创建的 `main.html` 文件，并将其保存为 `Robot.html` 文件，如下所示屏幕截图：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_29.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_29.jpg)'
- en: 'Once you have opened the `main.html` file, using the nano text editor, edit
    the content to make it look like the following screen shot:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您打开了 `main.html` 文件，使用 nano 文本编辑器，编辑内容使其看起来像以下屏幕截图：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_30.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_30.jpg)'
- en: You can see that we have added the image source element from our previous topic
    into this HTML file and added four buttons. Once you have saved the file, you
    can go ahead and make the changes in the Python file that we need to run in order
    to create a server using Python.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到，我们已经将之前主题中的图像源元素添加到这个 HTML 文件中，并添加了四个按钮。一旦保存文件，您就可以继续在需要运行的 Python 文件中进行更改，以创建服务器。
- en: 'First let us go back to the home automation directory:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们回到智能家居目录：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_31.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_31.jpg)'
- en: 'Now let''s open the `GPIOControlWebApp.py` file that we created in the home
    automation project:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们打开我们在智能家居项目中创建的 `GPIOControlWebApp.py` 文件：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_32.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_32.jpg)'
- en: 'Edit the file as shown in the following screenshot and save it as `Robot.py`:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下屏幕截图所示编辑文件，并将其保存为 `Robot.py`：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_33.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_33.jpg)'
- en: 'Now you can run the Python code by using the following command:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以通过以下命令运行 Python 代码：
- en: '`sudo python Robot.py`![Advanced project – a telecontrolled robot with live
    video streaming](img/4602_10_34.jpg)'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sudo python Robot.py`![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_34.jpg)'
- en: 'Just running this code is not enough. We also need to run the streaming software
    to give our project the live video feed. So, login to the BeagleBone Black using
    another PuTTY session, and run the streaming software as shown in the following
    screenshot:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 仅运行此代码是不够的。我们还需要运行流媒体软件，为我们的项目提供实时视频流。因此，使用另一个 PuTTY 会话登录到 BeagleBone Black，并按照以下屏幕截图所示运行流媒体软件：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_35.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_35.jpg)'
- en: 'When the streaming software and the Python code are running simulatneously,
    you can go ahead and check the server file by pointing your BeagleBone Black''s
    IP address at port `5000`, from any browser, via a PC or mobile phone connected
    to the same local network same as to which the the BeagleBone board is connected.
    You will see the output shown in the picture on the next page, from where you
    can see the live feed and control the robot:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 当流媒体软件和 Python 代码同时运行时，您可以通过将 BeagleBone Black 的 IP 地址指向同一本地网络中的端口 `5000`（通过
    PC 或手机连接到同一网络，与 BeagleBone 板连接的网络相同），在任何浏览器中检查服务器文件。您将看到下一页上的输出图片，从那里您可以查看实时视频并控制机器人：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_36.jpg)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带有实时视频流的遥控机器人](img/4602_10_36.jpg)'
- en: So, in the preceding screenshot you can see the robot's wheels. The setup is
    the same as that shown in the picture at the beginning of this topic, where the
    camera was pointing at the wheels of the robot. This will show you how the wheel
    movement works when you click on each button on the web page. We will discuss
    this next where you can see the wheel movement on the images themselves, as the
    wheel that is running will look blurred.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在先前的截图中，你可以看到机器人的轮子。设置与本章开头图片中显示的相同，当时摄像头指向机器人的轮子。这将向你展示当你点击网页上的每个按钮时，轮子的运动是如何工作的。我们将在下一部分讨论，你可以在图像本身上看到轮子的运动，因为正在运行的轮子看起来会模糊。
- en: When you click for the forward button. Both motors run as discussed out previous
    chapter regarding the differential drive system. That is the motors will drive
    the robot in forward direction, you can see the difference in the following screenshot
    where the motors are running when compared with the previous image shown in the
    previous page of this chapter where the wheels are idle and not running.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 当你点击前进按钮时，两个电机按照我们在上一章讨论的差速驱动系统运行。也就是说，电机将驱动机器人向前行驶，你可以在下面的截图中看到与上一页本章中显示的图像中的轮子闲置且未运行时的区别。
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_37.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带实时视频流的遥控机器人](img/4602_10_37.jpg)'
- en: 'You can also see the log of the movement in the Python output when you press
    the button as shown in the following screenshot:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 当你按下按钮时，你还可以在Python输出中看到移动日志，如下面的截图所示：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_38.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带实时视频流的遥控机器人](img/4602_10_38.jpg)'
- en: 'Similarly, for turning left, the right motor needs to be running and the left
    one stopped, as shown in the following screenshot:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，对于左转，右电机需要运行，而左电机停止，如下面的截图所示：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_39.jpg)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带实时视频流的遥控机器人](img/4602_10_39.jpg)'
- en: 'And when you press the **RIGHT** button then the **LEFT** motor is running,
    and the **RIGHT** one is stopped, as shown in the following screenshot:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 当你按下**右键**按钮时，**左键**电机运行，而**右键**电机停止，如下面的截图所示：
- en: '![Advanced project – a telecontrolled robot with live video streaming](img/4602_10_40.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![高级项目 – 带实时视频流的遥控机器人](img/4602_10_40.jpg)'
- en: Similarly when you click on stop, both motors will be stopped. If you mount
    all these electronics on top of the robot as desired, you can make it drive around
    as a telecontrolled robot with a live feed carrying the BeagleBone Black with
    the camera. In this chapter I gave you all the resources you need to understand
    this idea. Now, you can go ahead and mount the electronics on the robot base.
    To find out how people make a simple prototyping shield with electronics soldered
    onto it on top of the hardware development boards. Just type in Google, `prototyping
    capes for BeagleBone` or `hats for raspberry pi and shields for Arduino`. Even
    though these are made for different hardware development boards like BeagleBone
    and Raspberry Pi, the same electronics can be mounted on a BeagleBone board with
    slight modifications which will help you get rid of the messy wiring. Also, try
    using the sub-process Python module to execute the shell command and start streaming
    software at the beginning of the Python code to start running the server. By using
    this sub-process you need not run two instances of PuTTY, you can finish your
    work with just one.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，当你点击停止时，两个电机都会停止。如果你按照需求将这些电子元件安装在机器人顶部，你可以让它作为一个带有实时视频流的遥控机器人四处行驶。在本章中，我为你提供了理解这个想法所需的所有资源。现在，你可以继续在机器人基座上安装电子元件。要了解人们是如何在硬件开发板上焊接电子元件以制作简单的原型保护罩，只需在谷歌上输入`BeagleBone的原型保护罩`或`树莓派的帽子以及Arduino的保护罩`。尽管这些是为不同的硬件开发板（如BeagleBone和树莓派）制作的，但经过轻微修改，相同的电子元件可以安装在BeagleBone板上，这将帮助你摆脱杂乱的布线。此外，尝试使用子进程Python模块来执行shell命令，并在Python代码的开头启动流媒体软件以运行服务器。通过使用这个子进程，你不需要运行两个PuTTY实例，只需一个就可以完成你的工作。
- en: Summary
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: With that we are at the end of this chapter, where we have learnt some basics
    about DC motors and their operation, as well finding out what an L293D motor driver
    IC is, and how we can use it to control a connected DC motor connected. Next,
    we saw how to live stream video on the local server with BeagleBone Black using
    mjpg-streamer package. Finally we worked on a project where we interfaced the
    L293D motor driver IC with the BeagleBone Black, and a live streaming image source,
    to HTML templates and controlled a robot using the input buttons on the webpage
    that we created using the Python and Flask web server framework.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这些，我们就结束了这一章的内容，其中我们学习了一些关于直流电机及其操作的基础知识，还了解了L293D电机驱动IC是什么，以及我们如何使用它来控制连接的直流电机。接下来，我们看到了如何使用mjpg-streamer软件包在BeagleBone
    Black本地服务器上直播视频。最后，我们进行了一个项目，其中我们将L293D电机驱动IC与BeagleBone Black以及实时图像源接口，并通过我们使用Python和Flask网络服务器框架创建的网页上的输入按钮控制机器人。
