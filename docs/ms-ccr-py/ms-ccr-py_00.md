# 前言

并发性可能非常难以正确实现，但幸运的是，Python 编程语言使得处理并发性变得可行且容易。本书展示了如何使用 Python 编写高性能、健壮、并发的程序，以及其独特的编程形式。

本书适合任何对构建快速、非阻塞和资源节约型系统应用感兴趣的好奇开发人员，本书将涵盖最佳实践和模式，帮助您将并发性整合到您的系统中。此外，本书还将讨论 Python 并发编程中的新兴主题，包括新的 AsyncIO 语法，广泛接受的“锁不锁任何东西”的观点，原子消息队列的使用，并发应用架构和最佳实践。

我们将通过实际和引人入胜的代码示例来解决复杂的并发概念和模型。阅读本书后，您将深入了解 Python 并发生态系统中的主要组件，以及对现实并发问题的不同方法的实际欣赏。

# 这本书适合谁

如果您是熟悉 Python 并且想学习如何利用单核、多核或分布式并发来构建可扩展的高性能应用程序的开发人员，那么本书适合您。

# 本书涵盖内容

第一章，*并发和并行编程的高级介绍*，向您介绍了并发的概念，并演示了并发编程如何显著提高 Python 程序的速度。

第二章，*阿姆达尔定律*，采用理论方法讨论了并发性在提高应用程序速度方面的局限性。我们将看看并发性真正提供了什么，以及如何最好地整合它。

第三章，*在 Python 中使用线程*，介绍了线程的正式定义，并涵盖了在 Python 程序中实现线程的不同方法。在本章中，我们还将讨论并发编程中的一个重要元素——同步的概念。

第四章，*在线程中使用 with 语句*，将上下文管理的概念与 Python 中的线程结合在一起，放在并发编程的整体背景中。我们将介绍上下文管理背后的主要思想，以及它在各种编程实践中的应用，包括线程。

第五章，*并发网络请求*，涵盖了并发编程的主要应用之一：网络爬虫。它还涵盖了网络爬虫的概念，以及其他相关元素，然后讨论了如何将线程应用于网络爬虫程序以实现显著的加速。

第六章，*在 Python 中使用进程*，展示了多进程的正式定义以及 Python 如何支持它。我们还将更多地了解线程和多进程之间的关键区别，这两者经常被混淆。

第七章，*进程中的约简运算符*，将约简运算符的概念与多进程结合起来作为并发编程实践。本章将介绍约简运算符的理论基础，以及它与多进程以及一般编程的相关性。

第八章，《并发图像处理》，涉及并发的一个特定应用：图像处理。除了一些最常见的处理技术之外，还讨论了图像处理背后的基本思想。当然，我们将看到并发，特别是多进程，如何加速图像处理任务。

第九章，《异步编程简介》，将异步编程的正式概念作为三种主要并发编程模型之一，除了线程和多进程。我们将学习异步编程如何从这两种模型根本上不同，但仍然可以加速并发应用程序。

第十章，《在 Python 中实现异步编程》，深入探讨了 Python 提供的 API，以便促进异步编程。具体来说，我们将学习`asyncio`模块，这是在 Python 中实现异步编程的主要工具，以及异步应用程序的一般结构。

第十一章，《使用 asyncio 构建通信通道》，结合了前几章涵盖的异步编程知识和网络通信主题。具体来说，我们将研究使用`aiohttp`模块作为工具向 Web 服务器发出异步 HTTP 请求，以及实现异步文件读取/写入的`aiofile`模块。

第十二章，《死锁》，介绍了并发编程中常见的问题之一。我们将学习关于古典的餐桌哲学家问题，作为死锁如何导致并发程序停止运行的示例。本章还将涵盖一些潜在的死锁方法以及相关概念，如活锁和分布式死锁。

第十三章，《饥饿》，考虑了并发应用中另一个常见问题。本章使用经典的读者-写者问题叙述来解释饥饿的概念及其原因。当然，我们还将通过 Python 的实际示例讨论这些问题的潜在解决方案。

第十四章，《竞争条件》，讨论了可能是最知名的并发问题：竞争条件。我们还将讨论临界区的概念，这是竞争条件特别重要的元素，也是并发编程的一般情况。本章还将涵盖互斥作为这个问题的潜在解决方案。

第十五章，《全局解释器锁》，介绍了臭名昭著的 GIL，被认为是 Python 并发编程中最大的挑战。我们将了解 GIL 实施背后的原因以及它引发的问题。本章最后会对 Python 程序员和开发人员应该如何思考和与 GIL 交互提出一些想法。

第十六章，《设计基于锁和无互斥的并发数据结构》，分析了设计两种常见的涉及锁作为同步机制的并发数据结构的过程：基于锁和无互斥。本章还包括对数据结构实施的高级分析，以及性能分析，以便读者在设计并发应用程序时能够形成批判性的思维。

第十七章，*内存模型和原子类型的操作*，包括涉及 Python 语言底层结构以及程序员如何在并发应用中利用它的理论主题。本章还向读者介绍了原子操作的概念。

第十八章，*从头开始构建服务器*，指导读者通过构建低级别的非阻塞服务器的过程。我们将了解 Python 中套接字模块提供的网络编程功能，以及如何使用它们来实现一个功能齐全的服务器。我们还将应用本书早期讨论的异步程序的一般结构，将阻塞服务器转换为非阻塞服务器。

第十九章，*测试、调试和调度并发应用*，涵盖了并发程序的更高级别用法。本章首先介绍了如何通过 APScheduler 模块将并发应用于 Python 应用程序调度的任务。然后我们将讨论并发在测试和调试 Python 程序的复杂性。

# 充分利用本书

本书的读者应该知道如何在开发环境中执行 Python 程序，或者直接从命令提示符中执行。他们还应该熟悉 Python 编程中的一般语法和实践（变量、函数、导入包等）。本书在各个部分假定读者具有一些基本的计算机科学知识，如像素、执行堆栈和字节码指令。

第一章的最后一部分，*并发和并行编程的高级介绍*，涵盖了设置 Python 环境的过程。本书的各章可能会讨论使用外部库或工具，这些库或工具必须通过 pip 和 Anaconda 等软件包管理器安装，其安装说明将包含在相应的章节中。

# 下载示例代码文件

您可以从[www.packt.com](http://www.packt.com)的帐户中下载本书的示例代码文件。如果您在其他地方购买了本书，可以访问[www.packt.com/support](http://www.packt.com/support)注册，直接将文件发送到您的邮箱。

您可以按照以下步骤下载代码文件：

1.  登录或注册，请访问[www.packt.com](http://www.packt.com)。

1.  选择“支持”选项卡。

1.  点击“代码下载和勘误”。

1.  在搜索框中输入书名，并按照屏幕上的说明操作。

下载文件后，请确保使用最新版本的解压缩软件解压文件夹：

+   Windows 系统可使用 WinRAR/7-Zip。

+   Mac 系统可使用 Zipeg/iZip/UnRarX。

+   Linux 系统可使用 7-Zip/PeaZip。

该书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Mastering-Concurrency-in-Python`](https://github.com/PacktPublishing/Mastering-Concurrency-in-Python)。如果代码有更新，将在现有的 GitHub 存储库上进行更新。

我们还有其他代码包，来自我们丰富的书籍和视频目录，可在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**上找到。快去看看吧！

# 下载彩色图片

我们还提供了一份 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图片。您可以在此处下载：[`www.packtpub.com/sites/default/files/downloads/9781789343052_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/9781789343052_ColorImages.pdf)。

# 代码实例

访问以下链接查看代码运行的视频：[`bit.ly/2BsvQj6`](http://bit.ly/2BsvQj6)

# 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄。例如：“`asyncio`模块提供了许多不同的传输类。”

代码块设置如下：

```py
async def main(url):
    async with aiohttp.ClientSession() as session:
        await download_html(session, url)
```

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```py
urls = [
    'http://packtpub.com',
    'http://python.org',
    'http://docs.python.org/3/library/asyncio',
    'http://aiohttp.readthedocs.io',
    'http://google.com'
]
```

任何命令行输入或输出都以以下方式编写：

```py
> python3 example5.py
Took 0.72 seconds.
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词会在文本中以这种方式出现。例如：“要下载存储库，只需单击窗口右上角的克隆或下载按钮。”

警告或重要说明会以这种方式出现。提示和技巧会以这种方式出现。
