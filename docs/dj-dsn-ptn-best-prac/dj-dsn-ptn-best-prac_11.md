# 第十一章：生产就绪

在本章中，我们将讨论以下主题：

+   选择 Web 堆栈

+   托管方法

+   部署工具

+   监控

+   性能提示

因此，您已经在 Django 中开发和测试了一个完全功能的 Web 应用程序。部署此应用程序可能涉及从选择托管提供商到执行安装等多种活动。更具挑战性的可能是保持生产站点在没有中断的情况下运行，并处理意外的流量突发情况。

系统管理的学科是广泛的。因此，本章将涵盖很多内容。然而，鉴于空间有限，我们将尝试让您熟悉构建生产环境的各个方面。

# 生产环境

尽管我们大多数人直觉上理解生产环境是什么，但值得澄清它的真正含义。生产环境只是最终用户使用您的应用程序的地方。它应该是可用的、有弹性的、安全的、响应迅速的，并且必须具有当前（和未来）需求的充足容量。

与开发环境不同，生产环境中出现任何问题可能会导致真正的业务损失。因此，在进入生产环境之前，代码会被移动到各种测试和验收环境，以尽可能消除尽可能多的错误。为了方便追踪，对生产环境所做的每一次更改都必须进行跟踪、记录并向团队中的每个人提供访问权限。

因此，绝对不应该直接在生产环境中进行开发。事实上，生产环境中不需要安装开发工具，如编译器或调试器。任何额外软件的存在都会增加您站点的攻击面，并可能构成安全风险。

大多数 Web 应用程序部署在几乎没有停机时间的站点上，比如全年无休运行的大型数据中心。通过设计以应对故障，即使内部组件出现故障，也有足够的冗余来防止整个系统崩溃。这种避免**单点故障**（**SPOF**）的概念可以应用于每个层面——硬件或软件。

因此，选择在生产环境中运行的软件集合至关重要。

## 选择 Web 堆栈

到目前为止，我们还没有讨论您的应用程序将在其上运行的堆栈。尽管我们在最后才谈论它，但最好不要将这样的决定推迟到应用程序生命周期的后期阶段。理想情况下，您的开发环境必须尽可能接近生产环境，以避免“但它在我的机器上运行”这种论点。

通过 Web 堆栈，我们指的是用于构建 Web 应用程序的一组技术。它通常被描述为一系列组件，如操作系统、数据库和 Web 服务器，都堆叠在一起。因此，它被称为堆栈。

我们主要将关注开源解决方案，因为它们被广泛使用。但是，如果它们更适合您的需求，也可以使用各种商业应用程序。

## 堆栈的组件

生产 Django Web 堆栈是使用多种应用程序（或层，根据您的术语）构建的。在构建 Web 堆栈时，您可能需要做出以下选择：

+   选择哪种操作系统和发行版？例如：Debian，Red Hat 或 OpenBSD。

+   选择哪种 WSGI 服务器？例如：Gunicorn，uWSGI。

+   选择哪种 Web 服务器？例如：Apache，Nginx。

+   选择哪种数据库？例如：PostgreSQL，MySQL 或 Redis。

+   选择哪种缓存系统？例如：Memcached，Redis。

+   选择哪种进程控制和监控系统？例如：Upstart，Systemd 或 Supervisord。

+   如何存储静态媒体？例如：Amazon S3，CloudFront。

可能还有其他几种选择，这些选择也不是互斥的。有些人同时使用这些应用程序。例如，用户名的可用性可能在 Redis 上查找，而主数据库可能是 PostgreSQL。

在选择堆栈时，没有一个“一刀切”的答案。不同的组件有不同的优势和劣势。只有经过慎重考虑和测试后才选择它们。例如，你可能听说过 Nginx 是一个流行的 Web 服务器选择，但你实际上可能需要 Apache 的丰富模块或选项。

有时，选择堆栈是基于各种非技术原因的。你的组织可能已经将特定的操作系统，比如 Debian，作为所有服务器的标准。或者你的云托管提供商可能只支持有限的堆栈。

因此，你选择如何托管你的 Django 应用程序是确定你的生产设置的关键因素之一。

# 托管

在托管方面，你需要确保是否选择像 Heroku 这样的托管平台。如果你不太了解如何管理服务器，或者团队中没有人具备这方面的知识，那么托管平台是一个方便的选择。

## 平台即服务

平台即服务（PaaS）被定义为一个云服务，其中解决方案堆栈已经为你提供和管理。Django 托管的热门平台包括 Heroku、PythonAnywhere 和 Google App Engine。

在大多数情况下，部署 Django 应用程序应该就像选择堆栈的服务或组件，然后推送你的源代码一样简单。你不需要进行任何系统管理或自己设置。平台完全由管理。

与大多数云服务一样，基础设施也可以根据需求进行扩展。如果你需要额外的数据库服务器或者服务器上的更多内存，可以很容易地从 Web 界面或命令行进行配置。定价主要基于你的使用情况。

这些托管平台的底线是它们非常容易设置，非常适合较小的项目。随着用户群体的增长，它们往往会变得更加昂贵。

另一个缺点是，你的应用程序可能会与某个平台绑定，或者变得难以移植。例如，Google App Engine 只支持非关系型数据库，这意味着你需要使用 `django-nonrel`，这是 Django 的一个分支。现在，谷歌云 SQL 已经在一定程度上缓解了这个限制。

## 虚拟专用服务器

虚拟专用服务器（VPS）是在共享环境中托管的虚拟机。从开发者的角度来看，它看起来像是一个预装有操作系统的专用机器（因此称为私有）。你需要自己安装和设置整个堆栈，尽管许多 VPS 提供商，比如 WebFaction 和 DigitalOcean，提供了更简单的 Django 设置。

如果你是一个初学者，并且可以抽出一些时间，我强烈推荐这种方法。你将获得 root 访问权限，可以构建整个堆栈。你不仅会理解堆栈的各个部分是如何组合在一起的，还可以完全控制每个单独组件的微调。

与 PaaS 相比，VPS 可能会更有性价比，特别是对于高流量的网站。你可能还可以从同一台服务器上运行多个站点。

## 其他托管方法

尽管在平台或 VPS 上托管是迄今为止最流行的两种托管选项，但还有很多其他选择。如果你想最大化性能，你可以选择从提供商（比如 Rackspace）那里获得裸金属服务器的托管。

在托管光谱的较轻端，您可以通过在 Docker 容器中托管多个应用程序来节省成本。Docker 是一种将应用程序和依赖项打包到虚拟容器中的工具。与传统虚拟机相比，Docker 容器启动更快，开销更小（因为没有捆绑的操作系统或 hypervisor）。

Docker 非常适合托管基于微服务的应用程序。它正变得像虚拟化一样普遍，几乎每个 PaaS 和 VPS 提供商都支持它们。它也是一个很好的开发平台，因为 Docker 容器封装了整个应用程序状态，可以直接部署到生产环境。

# 部署工具

一旦您确定了您的托管解决方案，您的部署过程中可能会有几个步骤，从运行回归测试到生成后台服务。

成功的部署过程的关键是自动化。由于部署应用程序涉及一系列明确定义的步骤，因此可以正确地将其视为一个编程问题。一旦您有了自动化的部署，您就不必担心部署，以免错过任何步骤。

事实上，部署应该是无痛的，并且可以根据需要频繁进行。例如，Facebook 团队可以每天发布代码到生产环境多达两次。考虑到 Facebook 庞大的用户群和代码库，这是一个令人印象深刻的壮举，然而，由于紧急错误修复和补丁需要尽快部署，这变得必要。

一个良好的部署过程也是幂等的。换句话说，即使您意外地运行了部署工具两次，操作也不应该执行两次（或者它应该保持在相同的状态）。

让我们看一些用于部署 Django 应用程序的流行工具。

## Fabric

Fabric 在 Python Web 开发者中备受青睐，因为它简单易用。它期望一个名为`fabfile.py`的文件，定义项目中的所有操作（部署或其他）。这些操作可以是本地或远程 shell 命令。远程主机通过 SSH 连接。

Fabric 的关键优势在于其能够在一组远程主机上运行命令。例如，您可以定义一个包含生产环境中所有 Web 服务器主机名的`web`组。您可以通过在命令行上指定 web 组名称来仅针对这些 Web 服务器运行 Fabric 操作。

为了说明使用 Fabric 部署站点涉及的任务，让我们看一个典型的部署场景。

### 典型的部署步骤

假设您在单个 Web 服务器上部署了一个中等规模的 Web 应用程序。Git 被选择为版本控制和协作工具。一个与所有用户共享的中央仓库已经以裸 Git 树的形式创建。

假设您的生产服务器已经完全设置好。当您运行 Fabric 部署命令，比如`fab deploy`时，以下脚本化的一系列操作会发生：

1.  在本地运行所有测试。

1.  提交所有本地更改到 Git。

1.  推送到远程中央 Git 仓库。

1.  解决合并冲突（如果有）。

1.  收集静态文件（CSS，图像）。

1.  将静态文件复制到静态文件服务器。

1.  在远程主机上，从中央 Git 仓库拉取更改。

1.  在远程主机上，运行（数据库）迁移。

1.  在远程主机上，触发`app.wsgi`以重新启动 WSGI 服务器。

整个过程是自动的，应该在几秒钟内完成。默认情况下，如果任何步骤失败，则部署将中止。尽管没有明确提到，但会有检查确保该过程是幂等的。

请注意，Fabric 目前还不兼容 Python 3，尽管开发人员正在进行移植。与此同时，您可以在 Python 2.x 虚拟环境中运行 Fabric，或者查看类似的工具，比如 PyInvoke。

## 配置管理

使用 Fabric 在不同状态下管理多个服务器可能很困难。Chef、Puppet 或 Ansible 等配置管理工具试图将服务器带到特定的期望状态。

与需要以命令方式指定部署过程的 Fabric 不同，这些配置管理工具是声明性的。你只需要定义你希望服务器达到的最终状态，它就会找出如何达到那个状态。

例如，如果你想确保 Nginx 服务在所有的 Web 服务器上启动时运行，那么你需要定义一个服务器状态，其中 Nginx 服务既在运行又在启动时启动。另一方面，使用 Fabric，你需要指定确切的步骤来安装和配置 Nginx 以达到这种状态。

配置管理工具最重要的优势之一是它们默认是幂等的。你的服务器可以从一个未知状态变为已知状态，从而实现更容易的服务器配置管理和可靠的部署。

在配置管理工具中，Chef 和 Puppet 因为是这一类别中最早的工具之一，所以受到了广泛的欢迎。然而，它们在 Ruby 中的根源可能会让 Python 程序员感到有些陌生。对于这样的人来说，我们有 Salt 和 Ansible 作为很好的替代品。

与简单的工具（如 Fabric）相比，配置管理工具有相当大的学习曲线。然而，它们是创建可靠的生产环境的必要工具，绝对值得学习。

# 监控

即使是一个中等规模的网站也可能非常复杂。Django 可能是数百个应用程序和服务之一，它们运行并相互交互。与人体的心跳和其他生命体征可以不断监测以评估人体健康的方式相同，大多数生产系统中也会收集、分析和呈现各种指标。

虽然日志记录各种事件，比如 Web 请求的到达或异常，监控通常是指定期收集关键信息，比如内存利用率或网络延迟。然而，在应用程序级别，差异变得模糊，比如，监控数据库查询性能，这很可能是从日志中收集的。

监控还有助于早期发现问题。异常模式，比如突然上升或逐渐增加的负载，可能是更大潜在问题的迹象，比如内存泄漏。一个良好的监控系统可以在问题发生之前提醒网站所有者。

监控工具通常需要一个后端服务（有时称为*代理*）来收集统计数据，以及一个前端服务来显示仪表板或生成报告。流行的数据收集后端包括 StatsD 和 Monit。这些数据可以传递给前端工具，比如 Graphite。

有一些托管的监控工具，比如 New Relic 和 Status.io，更容易设置和使用。

性能测量是监控的另一个重要作用。正如我们将很快看到的，任何提出的优化在实施之前都必须经过仔细的测量和监控。

# 性能

性能是一个特性。研究表明，网站速度慢对用户和收入都有不利影响。例如，2007 年在亚马逊进行的测试显示，[amazon.com](http://amazon.com)每增加 100 毫秒的加载时间，销售额就会减少 1%。

令人放心的是，一些高性能的 Web 应用程序，如 Disqus 和 Instagram，都是基于 Django 构建的。在 Disqus，2013 年，他们可以处理 150 万个并发连接用户，每秒新建 45000 个连接，每秒发送 165000 条消息，端到端延迟不到 0.2 秒。

改善性能的关键是找出瓶颈所在。与其依赖猜测，建议您始终测量和分析您的应用程序，以确定这些性能瓶颈。正如开尔文勋爵所说：

> *如果你不能测量它，你就不能改善它。*

在大多数 Web 应用程序中，瓶颈可能在浏览器端或数据库端，而不是在 Django 内部。但是，对于用户来说，整个应用程序都需要响应。

让我们看一些改善 Django 应用程序性能的方法。由于技术差异很大，这些建议被分成了两部分：前端和后端。

## 前端性能

Django 程序员可能会快速忽视前端性能，因为它涉及了解客户端，通常是浏览器，的工作原理。然而，引用 Steve Souders 对 Alexa 排名前 10 的网站的研究：

> *80-90%的最终用户响应时间都花在了前端。从那里开始。*

前端优化的一个很好的起点是使用 Google Page Speed 或 Yahoo! YSlow（通常用作浏览器插件）检查您的网站。这些工具将对您的网站进行评分，并推荐各种最佳实践，比如最小化 HTTP 请求的数量或对内容进行 gzip 压缩。

作为最佳实践，您的静态资产，如图像、样式表和 JavaScript 文件，不应通过 Django 提供。而是应该由静态文件服务器、云存储（如 Amazon S3）或内容传递网络（CDN）为其提供更好的性能。

即使如此，Django 可以帮助您以多种方式改善前端性能：

+   使用`CachedStaticFilesStorage`无限缓存：加载静态资产的最快方法是利用浏览器缓存。通过设置长时间的缓存时间，您可以避免反复下载相同的资产。但是，挑战在于知道何时不使用缓存当内容发生变化时。

`CachedStaticFilesStorage`通过将资产的 MD5 哈希附加到其文件名中来优雅地解决了这个问题。这样，您可以无限扩展这些文件的缓存 TTL。

要使用这个功能，将`STATICFILES_STORAGE`设置为`CachedStaticFilesStorage`，或者如果您有自定义存储，可以继承`CachedFilesMixin`。此外，最好配置缓存以使用本地内存缓存后端来执行静态文件名到其哈希名称的查找。

+   **使用静态资产管理器**：资产管理器可以预处理您的静态资产，对它们进行缩小、压缩或合并，从而减小它们的大小并减少请求。它还可以对它们进行预处理，使您能够用其他语言编写它们，比如 CoffeeScript 和 Sass。有几个 Django 包提供了静态资产管理，比如`django-pipeline`或`webassets`。

## 后端性能

后端性能改进的范围涵盖了整个服务器端 Web 堆栈，包括数据库查询、模板渲染、缓存和后台作业。您将希望从中获得最高的性能，因为这完全在您的控制范围内。

对于快速和简单的分析需求，`django-debug-toolbar`非常方便。我们还可以使用 Python 分析工具，比如`hotshot`模块进行详细分析。在 Django 中，您可以使用几个分析中间件片段之一来在浏览器中显示 hotshot 的输出。

最近的实时分析解决方案是`django-silk`。它将所有请求和响应存储在配置的数据库中，允许在整个用户会话中进行聚合分析，比如查找性能最差的视图。它还可以通过添加装饰器来对任何 Python 代码进行分析。

与以前一样，我们将看一些改善后端性能的方法。但是，考虑到它们本身是广泛的主题，它们已被分成了几个部分。这些方法中的许多已经在前几章中进行了介绍，但在这里进行了总结以便易于参考。

### 模板

如文档建议的那样，应在生产中启用缓存模板加载程序。这样可以避免每次需要呈现时重新解析和重新编译模板的开销。缓存模板在首次需要时编译，然后存储在内存中。对相同模板的后续请求将从内存中提供。

如果发现其他模板语言（如 Jinja2）呈现页面的速度明显更快，则可以很容易地替换内置的 Django 模板语言。有几个库可以集成 Django 和 Jinja2，如 `django-jinja`。预计 Django 1.8 将默认支持多个模板引擎。

### 数据库

有时，Django ORM 可以生成低效的 SQL 代码。有几种优化模式可以改善这一点：

+   **使用** `select_related` **减少数据库访问次数**：如果您在大量对象上使用了 `OneToOneField` 或外键关系，可以使用 `select_related()` 执行 SQL 连接并减少数据库访问次数。

+   **使用** `prefetch_related` **减少数据库访问次数**：对于访问`ManyToManyField` 方法或反向的外键关系，或大量对象中的外键关系，请考虑使用 `prefetch_related` 来减少数据库访问次数。

+   **使用** `values()` **或** `values_list` **仅获取所需字段的值**：通过限制查询仅返回所需字段并跳过模型实例化，可以节省时间和内存使用。

+   **去规范化模型**：选择性去规范化通过减少连接来提高性能，但会牺牲数据一致性。它也可以用于预先计算值，比如字段的总和或活动状态报告到额外的列中。与在查询中使用注释值相比，去规范化字段通常更简单更快。

+   **添加索引**：如果在查询中经常搜索非主键字段，请考虑在模型定义中将该字段的 `db_index` 设置为 True。

+   **一次创建、更新和删除多行**：可以使用 `bulk_create()`、`update()` 和 `delete()` 方法在单个数据库查询中操作多个对象。但是，它们有一些重要的注意事项，比如跳过该模型上的 `save()` 方法。因此，在使用它们之前，请仔细阅读文档。

作为最后的手段，您始终可以使用经过验证的数据库性能专业知识微调原始 SQL 语句。但是，随着时间的推移，维护 SQL 代码可能会很痛苦。

### 缓存

任何需要时间的计算都可以利用缓存，并更快地返回预先计算的结果。但是，问题在于过期数据，或者经常被引用为计算机科学中最难的事情之一，即缓存失效。这通常在刷新页面后，YouTube 视频的观看次数不会改变时被发现。

Django 有一个灵活的缓存系统，允许您从模板片段到整个站点进行缓存。它允许各种可插拔的后端，如基于文件或基于数据的后端存储。

大多数生产系统使用基于内存的缓存系统，如 Redis 或 Memcached。这纯粹是因为易失性内存比基于磁盘的存储快得多。

这样的缓存存储非常适合存储频繁使用但短暂的数据，比如用户会话。

#### 缓存会话后端

默认情况下，Django 将用户会话存储在数据库中。通常会为每个请求检索。为了提高性能，可以通过更改 `SESSION_ENGINE` 设置将会话数据存储在内存中。例如，可以在 `settings.py` 中添加以下内容来将会话数据存储在缓存中：

```py
SESSION_ENGINE = "django.contrib.sessions.backends.cache"
```

由于一些缓存存储可能会清除过期数据导致会话数据丢失，最好使用 Redis 或 Memcached 作为会话存储，内存限制足够支持最大数量的活动用户会话。

#### 缓存框架

对于基本的缓存策略，使用缓存框架可能更容易。两个流行的框架是`django-cache-machine`和`django-cachalot`。它们可以处理常见的情况，比如自动缓存查询结果，以避免每次执行读取时都要访问数据库。

其中最简单的是 Django-cachalot，它是 Johnny Cache 的后继者。它需要非常少的配置。它非常适合那些有多次读取和不经常写入的站点（也就是绝大多数应用程序），它以一致的方式缓存所有 Django ORM 读取查询。

#### 缓存模式

一旦您的站点开始受到大量访问，您将需要开始在整个堆栈中探索几种缓存策略。使用 Varnish，一个位于用户和 Django 之间的缓存服务器，您的许多请求甚至可能根本不会到达 Django 服务器。

Varnish 可以使页面加载速度极快（有时比正常快数百倍）。然而，如果使用不当，它可能会向用户提供静态页面。Varnish 可以很容易地配置为识别动态页面或页面的动态部分，比如购物车。

**俄罗斯套娃缓存**，在 Rails 社区很受欢迎，是一种有趣的模板缓存失效模式。想象一个用户的时间线页面，其中包含一系列帖子，每个帖子都包含一个嵌套的评论列表。事实上，整个页面可以被视为几个嵌套的内容列表。在每个级别上，渲染的模板片段都被缓存。

因此，如果对帖子添加了新评论，只有相关的帖子和时间线缓存会失效。请注意，我们首先使缓存内容在更改内容之外直接失效，然后逐渐移动到最外层的内容。对于这种模式的工作，需要跟踪模型之间的依赖关系。

另一种常见的缓存模式是永久缓存。即使内容发生变化，用户也可能从缓存中获取到过时的数据。然而，也会触发异步作业，比如 Celery 作业，来更新缓存。您还可以定期在一定的时间间隔内预热缓存以刷新内容。

基本上，成功的缓存策略确定了站点的静态和动态部分。对于许多站点来说，动态部分是用户登录时的用户特定数据。如果这些数据与通常可用的公共内容分开，那么实施缓存就变得更容易。

不要把缓存视为站点工作的一部分。即使缓存系统崩溃，站点也必须退回到一个速度较慢但可工作的状态。

### 注意

**Cranos**

清晨六点，S.H.I.M.大楼被一层灰蒙蒙的雾气所包围。在某个地方，一个小会议室被指定为“作战室”。在过去的三个小时里，SuperBook 团队一直在这里努力执行他们的上线前计划。

来自世界各地的 30 多名用户已经登录到 IRC 聊天室#superbookgolive。聊天记录被投影在一个巨大的白板上。当最后一项被划掉时，埃文看了史蒂夫一眼。然后，他按下了一个键，触发了部署过程。

当脚本输出不断从墙上滚动时，房间里变得一片寂静。史蒂夫想，只要有一个错误，他们就有可能被拖回数小时。几秒钟后，命令提示符重新出现了。它是活的！团队中爆发出了欢乐。他们从椅子上跳起来，互相高五。有些人因为幸福而流泪。经过数周的不确定和辛苦工作，一切都显得不真实。

然而，庆祝活动很快就结束了。楼上传来一声巨响，整栋建筑都震动了。史蒂夫知道第二次入侵已经开始。他对埃文喊道：“在收到我的消息之前不要打开信标”，然后冲出了房间。

当史蒂夫匆匆赶上楼梯到达屋顶时，他听到楼上脚步声。那是欧小姐。她打开门，扑了进来。他听到她尖叫着“不！”然后不久后是一声震耳欲聋的爆炸声。

当他到达屋顶时，他看到奥小姐靠在墙上坐着。她抱着左臂，面部带着疼痛的表情。史蒂夫慢慢地探头向墙后张望。远处，一个高个秃头男子似乎正在和两个机器人一起忙碌着。

“他看起来像……”史蒂夫停顿了，不确定自己。

“是的，哈特。不如说现在他是克拉诺斯了。”

“什么？”

“是的，一个分裂的人格。一个隐藏在哈特心中多年的怪物。我曾试图帮他控制它。多年前，我以为我已经阻止它再次出现。然而，所有这些压力对他造成了影响。可怜的家伙，要是我能靠近他就好了。”

可怜的家伙，他几乎试图杀了她。史蒂夫掏出手机，发送了一条消息打开信标。他必须临时应对。

他双手高举，交叉着手指，走了出去。两个机器人立刻对准了他。克拉诺斯示意它们停下。

“噢，我们这里是谁？超级书先生本人。我撞上了你的发布派对，史蒂夫？”

“这是我们的启动，哈特。”

“别叫我那个，”克拉诺斯咆哮道。“那家伙是个傻瓜。他写了哨兵代码，但他从来没有理解它的潜力。我是说，看看哨兵能做什么——解开人类已知的每个密码算法。当它进入星际网络时会发生什么？”

史蒂夫没有错过这个暗示。“超级书？”他慢慢地问道。

克拉诺斯露出了一丝邪恶的笑容。在他身后，机器人们正忙着连接到 S.H.I.M.的核心网络。“当你们的超级书用户忙着玩超级城市时，哨兵的触手将扩展到新的毫无戒备的世界。每个智慧物种的关键系统都将受到破坏。超级英雄们将不得不向一个新的星际超级恶棍——克拉诺斯屈服。”

克拉诺斯正在发表这篇长篇演说时，史蒂夫注意到他眼角的动静。那是松鼠阿科恩，一只超级聪明的松鼠，在屋顶的右边沿匆匆而过。他还看到赫克萨在另一边策略性地盘旋。他向他们点了点头。

赫克萨悬浮着一个垃圾箱，朝机器人扔了过去。阿科恩用尖锐的口哨声分散了它们的注意力。“杀了他们！”克拉诺斯恼怒地说道。当他转身看向入侵者时，史蒂夫掏出手机，拨通了 FaceTime，把它对准了克拉诺斯。

“向你的老朋友克拉诺斯问好，”史蒂夫说道。

克拉诺斯转身面对电话，屏幕上显示出奥小姐的脸。微笑着，她低声嘀咕道：“胡言乱语！”

克拉诺斯脸上的表情瞬间改变。那股愤怒消失了。他现在看起来像他们曾经认识的那个人。

“发生了什么？”哈特困惑地问道。

“我们以为我们失去了你，”奥小姐在电话那头说道。“我不得不使用催眠触发词才能把你带回来。”

哈特花了一会儿时间环顾了一下他周围的场景。然后，他慢慢地微笑着对她点了点头。

----------------------------------------------------

**一年后**

谁能想到阿科恩会在不到一年的时间里成为一个星际歌唱偶像？他的最新专辑《阿科恩的原声演唱》登上了公告牌排行榜的榜首。他在俯瞰湖泊的新白色豪宅举办了一场盛大的派对。来宾名单上包括了超级英雄、流行歌手、演员和各种名人。

“所以，你果然是个歌手，”显而易见队长端着一杯马天尼说道。

“我想是的，”阿科恩回答道。他穿着一套金色礼服，闪闪发光。

史蒂夫带着赫克萨出现了，她穿着一条流动的银色长裙，看起来迷人极了。

“嘿，史蒂夫，赫克萨……好久不见了。超级书还让你加班到很晚吗，史蒂夫？”

“这些天没怎么发生。碰碰木头，”赫克萨微笑着回答。

“啊，你们做得太棒了。我对超级书欠了很多。我的第一支单曲《警告：含坚果》在 Tucana 星系大获成功。他们在超级书上观看了视频超过十亿次！”

“我相信每个其他超级英雄也对 SuperBook 有好话要说。拿 Blitz 来说，他的 AskMeAnything 采访赢得了粉丝们的心。他们一直以为他一直在用实验药物。直到他透露他的父亲是飓风时，他的能力才有意义。”

“顺便问一下，哈特最近怎么样？”

“好多了，”史蒂夫说。“他得到了专业的帮助。哨兵被交还给了 S.H.I.M。他们正在开发一种新的量子密码算法，这将更加安全。”

“所以，我猜我们在下一个超级恶棍出现之前是安全的，”显而易见船长犹豫地说道。

“嘿，至少信标起作用了，”史蒂夫说，人群爆发出笑声。

# 总结

在这最后一章中，我们探讨了各种方法来使您的 Django 应用程序稳定、可靠和快速。换句话说，使其达到生产就绪状态。虽然系统管理可能是一个完整的学科，但对 Web 堆栈的基本了解是必不可少的。我们探讨了几种托管选项，包括 PaaS 和 VPS。

我们还研究了几种自动化部署工具和典型的部署场景。最后，我们介绍了几种改进前端和后端性能的技术。

网站最重要的里程碑是完成并将其投入生产。然而，这绝不是您开发之旅的终点。将会有新的功能、修改和重写。

每次重新访问代码时，利用机会退一步，找到更清晰的设计，识别隐藏的模式，或者考虑更好的实现方式。其他开发人员，有时甚至是您未来的自己，会因此而感谢您。
