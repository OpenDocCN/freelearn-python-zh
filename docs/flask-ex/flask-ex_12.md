# 附录 A. 未来的一瞥

在本书中，我们涵盖了各种主题，并且演示了构建三个功能齐全且有用的 Web 应用程序。然而，书籍本质上是有限的，而 Web 开发的世界趋向无限，因此我们无法添加所有内容。在本章中，我们将快速浏览我们无法详细介绍的技术。我们将首先看看可以直接用于扩展或改进本书中创建的项目的技术。然后，我们将研究一些更高级的 Flask 功能，这些功能在我们的项目中并不需要使用，但在其他项目中几乎肯定会有用。最后，我们将简要讨论对 Web 开发有用但不特定于我们在此构建的项目或 Flask 的技术。

# 扩展项目

我们构建的项目都是功能齐全的，但还不够准备好用于大规模、实时使用。如果它们要扩展到处理成千上万的用户或者是商业应用程序，它们需要一些更多的功能。这些将在接下来的部分中讨论。

## 添加域名

我们使用 VPS 的 IP 地址访问了所有项目。您几乎肯定习惯了使用域名而不是 IP 地址访问 Web 应用程序。当您使用域名（例如[`google.com`](http://google.com)）时，您的浏览器首先向 DNS 服务器发送请求，以找出与此域关联的 IP 地址是什么。DNS 服务器类似于巨大的自动电话簿，专门用于将人类更容易记住的域名（例如[`google.com`](http://google.com)）翻译成组织互联网的 IP 地址（例如 123.456.789.123）。

要使用域名而不是 IP 地址，您需要从注册商那里购买一个。通常，您的**互联网服务提供商**（**ISP**）可以帮助您购买域名（例如`yourname.com`）。域名通常价格不贵，您可以每年以几美元的价格购买。

一旦购买了域名，您需要正确设置 DNS 设置。大多数 ISP 都有在线控制面板，您可以自己完成这些设置，但您可能需要联系他们来协助您。您的域名需要指向您的 VPS。为此，您需要创建一个将域名映射到您的 IP 的“A”类型 DNS 记录。

一旦您的域名指向您的服务器，您可以配置 Apache 来识别它，而不是使用我们在 Apache 配置文件中放置的`example.com`占位符，例如`/etc/apache2/sites-available/waitercaller.conf`。

域名的更改也需要一段时间才能传播，即世界上的主要 DNS 服务器需要更新，以便当有人访问您的域名时，DNS 服务器可以将其重定向到您的 IP 地址。DNS 传播可能需要几个小时。

## 添加 HTTPS

您可能已经注意到，银行、谷歌和微软等大型公司以及越来越多的其他公司的网站都会自动重定向到**HTTPS**版本。这里的“S”代表*安全*，因此完整的缩写变成了**超文本传输安全协议**。每当您在浏览器的导航栏中看到 HTTPS（通常旁边有一个绿色的挂锁）时，这意味着您和服务器之间的所有流量都是加密的。这可以防止所谓的*中间人攻击*，即位于您和服务器之间的恶意人员可以查看或修改您和服务器交换的内容。

直到最近，这种加密是由网站所有者通过从**证书颁发机构**（**CA**）购买昂贵的证书来实现的。CA 的工作是充当您和服务器之间的可信第三方，向网站所有者签发一个签名证书。这个证书可以用来建立客户端和服务器之间的加密通道。由于成本过高，HTTPS 只在绝对必要的安全性场合（例如在线银行业务）和像谷歌这样能够支付高额费用的公司中使用。随着每个人开始意识到基于信任的万维网模型本质上存在缺陷，HTTPS 变得越来越受欢迎，即使是对于小型博客和个人网站也是如此。像 Let's Encrypt（[`letsencrypt.org`](https://letsencrypt.org)）这样的公司现在提供免费证书，这些证书可以轻松安装和配置以与流行的 Web 服务器（如 Apache）一起使用。

对于我们的最终项目，由于我们处理敏感数据（特别是密码），对于我们的应用程序的非平凡使用，使用 HTTPS 是必须的，对于我们的其他两个项目也是理想的（HTTPS 总是比 HTTP 更好）。尽管现在设置证书以与您的 Web 服务器一起使用的过程比几年前简单得多，但是如何设置 Apache2 以与 CA 证书一起使用的完整演练超出了本书的范围。

但是，如果您只花时间了解本章提到的技术中的一种，那么应该是这个。这是一个非常简单的 Digital Ocean 教程链接，向您展示如何在 Ubuntu 14.04 上设置证书以与 Apache2 一起使用（这是本书中使用的确切配置）：

[`www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04`](https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-14-04)

## 新注册的电子邮件确认

在我们的第三个项目中，您可能注意到我们的注册流程有点不同寻常。新用户在网站上注册的正常方式如下：

1.  用户填写注册表并提交。

1.  服务器将数据保存在数据库中。

1.  服务器生成一个唯一且安全的令牌，并将该令牌与注册关联起来，并将其标记为不完整。

1.  服务器通过 URL 向用户发送一个唯一且安全的令牌，并请求用户点击该 URL 以确认账户。

1.  用户点击带有唯一令牌的 URL。

1.  服务器找到与此令牌关联的不完整注册，并将注册标记为已确认。

上述过程是为了证明用户向我们提供了一个真实的电子邮件地址，并且可以访问该地址。当然，用户不希望等待某人手动发送电子邮件，因此确认电子邮件必须自动发送。这会导致一些复杂情况，包括需要设置邮件服务器以及我们发送的自动确认电子邮件可能最终会出现在用户的垃圾邮件文件夹中，导致所有人都感到沮丧。另一个选择是使用*电子邮件作为服务*平台，例如亚马逊的**简单电子邮件服务**（**SES**）。但是，这些通常不是免费的。

一旦用户确认了电子邮件账户，我们也可以用它来允许用户重置忘记的密码。同样，这将涉及向想要重置密码的用户发送自动电子邮件。该电子邮件将再次包含 URL 中的安全唯一令牌，用户将点击该令牌以证明他或她确实发出了密码重置请求。然后，我们将允许用户输入新密码，并使用新的（散列和加盐的）密码更新数据库。请注意，我们不能也不应该发送用户自己的密码，因为我们只存储密码的加盐和散列版本；我们无法发现忘记的密码。

完整的用户帐户系统具有自动电子邮件确认和“忘记密码”功能是相当复杂的。我们可以使用 Python 和 Flask 以及电子邮件服务器来设置它，但在下一节中，我们还将讨论一些更多的 Flask 扩展，这些扩展可以使这个过程更容易。

## 谷歌分析

如果我们商业运行任何网络应用程序，我们可能会对实际使用它们的人数感兴趣。这将帮助我们决定如何（以及是否）为我们的应用程序收费，并提供其他有用的见解。

通过 Google Analytics 是实现这一目标的最常见方式。这是谷歌提供的一项服务，不仅可以追踪有多少人访问您的网站，还可以追踪他们在网站上花费的时间、他们是如何找到网站的、他们来自哪个国家、关于他们用于网页浏览的设备的信息，以及许多其他有见地的统计数据。Google Analytics 是免费的，要开始使用它，您只需要在[`analytics.google.com`](https://analytics.google.com)上创建一个帐户（或使用您现有的谷歌帐户）。在填写有关您的网站的一些信息后，您将获得一小段 JavaScript 代码。这段 JavaScript 代码包含一个分配给您的网站的唯一跟踪 ID。您需要将 JavaScript 代码添加到您的网站上，每当有人访问网站时，JavaScript 代码将加载到他们的网络浏览器中，并将有关他们的信息发送到谷歌，然后谷歌将使用唯一 ID 将信息与您关联起来。在 Google Analytics 仪表板上，您可以看到访问者数量、访问时间的图表，以及许多其他信息。

在我们的服务员呼叫项目中，我们将在`base.html`文件的末尾添加 JavaScript 代码以及 Bootstrap JavaScript 代码。

## 可扩展性

作为网络应用程序创建者最好的问题是创建了一个太受欢迎的应用程序。如果有很多人访问您的应用程序，这意味着您创造了一些好东西（并且可能开始向人们收费）。我们的小型 VPS 将无法处理大量流量。如果成千上万的人同时访问网站，我们将很快耗尽网络带宽、处理能力、内存和磁盘空间。

关于创建可扩展的 Web 应用程序的完整讨论将是一本专门的书。然而，我们需要采取的一些步骤包括：

+   **在专用机器上运行数据库**：目前，我们在同一台物理机器上运行我们的 Web 服务器和数据库。对于较大的 Web 应用程序，数据库将有自己的专用机器，以便大量的数据库使用（例如，许多餐厅顾客创建新请求）不会对只想浏览我们主页的人产生负面影响。通常情况下，数据库机器会有大量的磁盘空间和内存，而运行 Web 服务器的机器将更注重高带宽可用性和处理能力。

+   **运行负载均衡器**：如果我们有很多访问者，一台机器无论多么大和强大都无法跟上负载。因此，我们将运行几台重复的 Web 服务器。然后问题将是如何均匀地将新访问者分配到所有不同的机器中。为了解决这个问题，我们将使用一个叫做*负载均衡器*的东西，它负责接受用户的初始请求（也就是当用户访问您的主页时）并将这个用户分配给一个复制的 Web 服务器。

随着我们的规模越来越大，情况会变得越来越复杂，我们还会添加副本数据库机器。一个受欢迎的网站需要全天候维护，通常需要一个团队的人来维护，因为硬件会出现故障，恶意用户存在，而更新（为了减轻恶意用户的攻击而必要）往往会破坏软件之间的兼容性。好的一面是，如果任何 Web 应用程序变得足够受欢迎，需要上述的情况，那么这个应用程序可能也会产生足够的收入，以至于让所有讨论的问题成为“SEP”，或者是别人的问题。也就是说，我们可以雇佣一个系统管理员，一个数据库管理员和一位首席安全官，让他们解决问题，然后度过余生在海上巡航。在这一点上，让我们来看看一些关于 Flask 的特定扩展，以丰富我们的知识。

# 扩展你的 Flask 知识

你可能期望 Flask 作为一个微框架，可以在一本书中完整地介绍。然而，Flask 有一些潜在非常有用的部分，我们在我们的三个项目中都不需要。我们将在这里简要概述这些部分。

## VirtualEnv

第一个值得一提的库实际上并不是特定于 Flask 的，如果你之前在 Python 开发上花了一些时间，你几乎肯定会遇到它。`VirtualEnv`是一个 Python 库，它在你的机器上创建一个虚拟的 Python 环境。它可以与 Flask 一起在你的开发机器上使用，也可以在你的开发机器和服务器上同时使用。它的主要目的是将你的整个 Python 环境隔离成一个虚拟的环境，包括你使用的所有 Python 模块。这有两个主要的好处。第一个是有时你需要在同一台机器上运行两个不同的 Python 项目，但每个项目需要不同版本的相同库。使用`VirtualEnv`，每个项目都会有自己的虚拟化的 Python 设置，因此安装两个不同版本的相同库变得微不足道。第二个优势是你的环境变得更加可移植，理论上，很容易将在`VirtualEnv`环境中运行的应用程序迁移到另一台安装了`VirtualEnv`的机器上。

`VirtualEnv`环境在 Python 开发中被广泛使用，特别是在 Flask 中。我决定不将其包含在书的主体部分中，这一决定在审阅者中引起了很大的争议，其中许多人认为没有包含它的书是不完整的。我决定不包括它有两个原因。第一个原因是，当我学习 Flask 时，我阅读了许多教程和示例，其中包括了 VirtualEnv。我总是觉得为设置和解释`VirtualEnv`和虚拟环境所需的额外工作会分散教程的主要内容（即使用 Flask）。第二个原因是，即使在我今天构建的 Flask 项目中，我仍然经常不使用它。如果你不运行依赖于特定库的特定版本的旧软件，那么在系统范围内安装有用的 Python 库，以便它们可以被所有的 Python 应用程序使用，是很方便的。此外，有时，VirtualEnv 可能只是一项任务，而没有提供任何价值。

当然，你可能已经对 VirtualEnv 有自己的看法，如果是这样，你可以随意使用它。没有什么能阻止任何人在`VirtualEnv`环境中构建本书中的任何项目，如果他们有一点经验的话。如果你以前没有使用过，那么值得一试。你可以通过 pip 安装它并尝试一下，看看它到底是做什么的，以及它是否在你的特定场景中有用。你可以在这里阅读更多关于它以及如何使用它的信息：

[`docs.python-guide.org/en/latest/dev/virtualenvs/`](http://docs.python-guide.org/en/latest/dev/virtualenvs/)

## Flask Blueprints

也许我们在本书中没有提到的 Flask 最大的特性是 Flask 蓝图。在构建了三个 Flask 应用程序之后，您一定会注意到一些模式一次又一次地出现。重复的代码是糟糕的代码，即使在多个不同的应用程序中；如果您找到了更好的方法来做某事，或者需要对更新进行一些更改，您不希望在几个应用程序中进行相同的更改。

蓝图提供了一种指定 Flask 应用程序模式的方法。如果您有几个应用程序使用相同的代码来返回模板或连接到数据库，您可以将这些通用代码写在一个蓝图中，然后让所有应用程序注册该蓝图。

您可以在[`flask.pocoo.org/docs/0.10/blueprints/`](http://flask.pocoo.org/docs/0.10/blueprints/)了解更多关于 Flask 蓝图的信息，查看示例，并学习如何开始使用它们。

## Flask 扩展

在我们的三个项目过程中，我们看了很多不同的 Flask 扩展。但是，由于本书的教育重点，我们选择从头开始编写一些代码，可能更适合使用现有的扩展。（通常在开发时，我们希望避免重复造轮子。如果其他人已经考虑解决问题并提供了一个经过深思熟虑和良好维护的解决方案，最好使用他们的成果，而不是试图创建我们自己的。）特别感兴趣的是我们可以使用的扩展，使我们的用户帐户系统更简单更强大，以及那些为我们提供更抽象的方式与数据库交互的扩展。

### Flask-SQLAlchemy

本书中另一个有争议的决定是不介绍 Flask-SQLAlchemy 扩展与 MySQL 一起使用。SQLAlchemy 提供了一个 SQL 工具包和 ORM，使从 Python 环境与 SQL 数据库交互更容易和更安全。ORM 提供了另一层抽象，使 Web 应用程序与数据库之间的交互更加简单。与其直接编写 SQL 代码，不如使用 Python 对象调用数据库，然后 ORM 将其转换为 SQL。这样可以更轻松地编写和维护数据库，也更安全（ORM 通常非常擅长减轻潜在的 SQL 注入漏洞）。省略它的原因与省略 VirtualEnv 的原因类似——在学习时，太多的抽象层可能会带来更多的伤害，而且在盲目使用工具之前，首先亲身体验工具解决的问题总是有利的。

对于任何使用 MySQL 数据库的 Flask 应用程序，比如我们的犯罪地图项目，强烈建议使用 ORM，就像大多数 Flask 扩展一样。Flask-SQLAlchemy 只是一个现有的非 Flask 特定库的包装器。您可以在[`www.sqlalchemy.org/`](http://www.sqlalchemy.org/)找到更多关于 SQLAlchemy 的信息，以及关于 Flask-SQLAlchemy 的全面指南，包括常见的使用模式：

[`flask.pocoo.org/docs/0.10/patterns/sqlalchemy/`](http://flask.pocoo.org/docs/0.10/patterns/sqlalchemy/)

### Flask MongoDB 扩展

有几个 Flask 扩展旨在使与 MongoDB 的交互更容易。由于 MongoDB 相对较新，这些扩展都没有达到 SQLAlchemy 的成熟度，也没有被广泛使用；因此，如果您打算使用其中之一，建议您检查每个以决定哪一个最适合您的需求。

#### Flask-MongoAlchemy

也许最类似于 SQLAlchemy（不仅仅是名称）的是 Flask-MongoAlchemy。与 SQLAlchemy 类似，MongoAlchemy 也不是 Flask 特定的。您可以在[`www.mongoalchemy.org`](http://www.mongoalchemy.org)找到有关主项目的更多信息。Flask-MongoAlchemy 是 MongoAlchemy 的 Flask 包装器，您可以在这里找到更多信息：

[`pythonhosted.org/Flask-MongoAlchemy`](http://pythonhosted.org/Flask-MongoAlchemy)

#### Flask-PyMongo

一个更薄的 MongoDB 包装器，更接近于直接使用 PyMongo，就像我们在第三个项目中所做的那样，是 Flask-PyMongo。与 MongoAlchemy 不同，它不提供 ORM 等效；相反，它只是提供了一种通过 PyMongo 连接到 MongoDB 的方式，使用的语法更符合 Flask 通常处理外部资源的方式。您可以在其 GitHub 页面上快速了解 Flask-PyMongo：

[`github.com/dcrosta/flask-pymongo`](https://github.com/dcrosta/flask-pymongo)

### Flask-MongoEngine

使用 Flask 与 MongoDB 结合的另一个解决方案是 MongoEngine ([`mongoengine.org`](http://mongoengine.org))。这很显著，因为它与 WTForms 和 Flask-Security 集成，我们将在接下来的部分中讨论。您可以在[`pypi.python.org/pypi/flask-mongoengine`](https://pypi.python.org/pypi/flask-mongoengine)上了解有关 Mongo Engine 的 Flask 特定扩展的更多信息。

### Flask-Mail

如果我们想要实现自动发送电子邮件的解决方案，比如本章前面描述的那样，一个有用的扩展是 Flask-Mail。这允许您轻松地从 Flask 应用程序发送电子邮件，同时处理附件和批量邮寄。正如之前提到的，如今，考虑使用亚马逊的 SES 等第三方服务来发送电子邮件而不是自己发送是值得的。您可以在[`pythonhosted.org/Flask-Mail`](http://pythonhosted.org/Flask-Mail)上了解更多关于 Flask-Mail 的信息。

### Flask-Security

我们将讨论的最后一个扩展是 Flask-Security。这个扩展很显著，因为它的很大一部分实际上是通过组合其他 Flask 扩展构建的。在某种程度上，它偏离了 Flask 的哲学，即尽可能少地做事情，以便有用，并允许用户完全自由地进行自定义实现。它假设您正在使用我们描述的数据库框架之一，并从 Flask-Login、WTForms、Flask-Mail 和其他扩展中汇集功能，试图使构建用户帐户控制系统尽可能简单。如果我们使用这个，我们将有一个集中处理注册帐户、登录帐户、加密密码和发送电子邮件的方式，而不是必须分别实现登录系统的每个部分。您可以在这里了解更多关于 Flask-Security 的信息：

[`pythonhosted.org/Flask-Security`](https://pythonhosted.org/Flask-Security)

### 其他 Flask 扩展

有许多 Flask 扩展，我们只强调了我们认为在许多 Web 开发场景中通常适用的扩展。当然，当您开发一个独特的 Web 应用程序时，您将有更具体的需求，很可能已经有人有类似的需求并创建了解决方案。您可以在这里找到一个广泛的（但不完整）Flask 扩展列表：

[`flask.pocoo.org/extensions`](http://flask.pocoo.org/extensions)

# 扩展您的 Web 开发知识

在本书中，我们专注于后端开发——通过 Python 或 Flask 完成。开发 Web 应用程序的一个重要部分是构建一个功能强大、美观、直观的前端。虽然我们提供了 HTML、CSS 和 JavaScript 的坚实基础，但每个主题都足够大，可以有自己的书籍，而且有许多这样的书籍存在。

JavaScript 可能是这三种语言中最重要的。它被称为“Web 的语言”，在过去几年中稳步增长（尽管像所有语言一样，它也有其批评者）。有许多用于构建 JavaScript 密集型 Web 应用程序的框架（事实上，它们的数量之多以及新框架的发布频率已经成为开发人员之间的笑柄）。我们在本书中介绍了 Bootstrap，其中包括基本的 JavaScript 组件，但对于更加交互式的应用程序，存在着更大的框架。其中三个较受欢迎的前端框架包括 AngularJS（由 Google 开发）、React.js（由 Facebook 开发）和 Ember.js（由包括 Yahoo 在内的多家公司赞助）。学习其中任何一个框架或其他许多框架中的一个都将帮助您构建更大更复杂的 Web 应用程序，具有更丰富的前端。

JavaScript 也不再局限于前端，许多现代 Web 应用程序也使用 JavaScript 在服务器端构建。实现这一点的常见方法是通过 Node.js，在我们构建的任何项目中，它完全可以取代 Python 和 Flask。

HTML5 和 CSS3 比它们演变而来的旧技术强大得多。以前，HTML 用于内容，CSS 用于样式，JavaScript 用于操作，分工明确。现在，这三种技术的能力之间有了更多的重叠，一些令人印象深刻的交互式应用程序是仅使用 HTML5 和 CSS3 构建的，而没有通常的 JavaScript 补充。

# 总结

在这个附录中，我们展望未来，指出了一些关键领域和资源，这些将帮助您超越本书中详细介绍的内容。我们在三个主题中涵盖了这些领域：本书中我们所做的项目、我们没有使用的 Flask 资源以及 Web 开发的一般情况。

这就是结尾。然而，技术世界如此广阔，发展如此迅速，希望这更像是一个开始而不是结束。在您继续冒险，了解更多关于生活、Python 和 Web 开发的知识时，我希望本书中提出的一些想法能够留在您心中。
